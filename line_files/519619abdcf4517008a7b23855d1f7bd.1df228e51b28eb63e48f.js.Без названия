(self.webpackChunkvk=self.webpackChunkvk||[]).push([[56058],{337057:(e,t,n)=>{"use strict";n.d(t,{VkIndexer:()=>a});var a=function(){function e(e,t,n){this.delimiter=new RegExp("[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\#\\+\\?\\\\]+","g"),this.trimmer=new RegExp("^[\\s\\-\\.,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\+\\?\\\\]+|[\\s\\-,\\\"\\'\\«\\(\\)\\[\\]\\{\\}\\\\]+$","g"),this.toTranslit={1072:"a",1073:"b",1074:"v",1075:"g",1076:"d",1077:"e",1078:"zh",1079:"z",1080:"i",1081:"y",1082:"k",1083:"l",1084:"m",1085:"n",1086:"o",1087:"p",1088:"r",1089:"s",1090:"t",1091:"u",1092:"f",1093:"h",1094:"ts",1095:"ch",1096:"sh",1097:"sh",1099:"y",1101:"e",1102:"yu",1103:"ya",1105:"e",1098:"",1100:""},this.toLocalCase={f:"a",",":"b","<":"b",d:"v",u:"g",l:"d",t:"e",";":"zh",":":"zh",p:"z",b:"i",q:"y",r:"k",k:"l",v:"m",y:"n",j:"o",g:"p",h:"r",c:"s",n:"t",e:"u",a:"f","[":"h","{":"kh",w:"ts",x:"ch",i:"sh",o:"sh",s:"y","'":"e",'"':"e",".":"yu",">":"yu",z:"ya","`":"e","~":"e",m:"","]":"","}":""},this.toLocalTranslit={1072:"f",1074:"d",1075:"u",1076:"l",1077:"t",1079:"p",1080:"b",1081:"q",1082:"r",1083:"k",1084:"v",1085:"y",1086:"j",1087:"g",1088:"h",1089:"c",1090:"n",1091:"e",1092:"a",1094:"w",1095:"x",1096:"i",1097:"o",1099:"s",1103:"z",1098:"m"},this.list=e||[],this.iterCur=0,this.iterEnd=e?e.length:0,this.index={},this.callback=n||function(){},this.prepareFunc=t||function(e){return e},setTimeout(this.indexIteration.bind(this),10)}return e.prototype.indexIteration=function(){for(var e=Math.min(this.iterEnd,this.iterCur+200),t=this.iterCur;t<e;t++){var n=this.list[t];try{n._order=t}catch(e){}this.add(n)}this.iterCur=t,t>=this.iterEnd?this.callback(this):setTimeout(this.indexIteration.bind(this),10)},e.prototype.strToPrefixes=function(e){for(var t,n={},a=(t=e,t.replace(/&#(\d\d+);/g,(function(e,t){return(t=!0===(n=t)?1:parseInt(n)||0)>=32?String.fromCharCode(t):e;var n})).replace(/&quot;/gi,'"').replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&amp;/gi,"&")).toLowerCase().split(this.delimiter),o=a.length;o--;){var s=a[o],i="";if(s){for(var r=0;r<6;r++){var l=s.charCodeAt(r);if(l){var c=this.toTranslit[l],d=s.substr(r,1);i+=null!=c?c:d}}n[i]=1}}return n},e.prototype.strToSearchPrefixes=function(e){for(var t=[],n=e.toLowerCase().split(this.delimiter),a=n.length;a--;){var o={},s=n[a],i="",r="",l="",c=s.length>1;if(s){for(var d=0;d<6;d++){var u=s.charCodeAt(d);if(u){var h=this.toTranslit[u],g=s.substr(d,1);if(i+=null!=h?h:g,c){var v=this.toLocalCase[g],m=this.toLocalTranslit[u];r+=null!=v?v:g,l+=null!=m?m:g}}}o[i]=1,c&&(o[r]=2,o[l]=3),t.push(o)}}return t},e.prototype.toIndexTree=function(e,t){for(var n=this.index,a=0;a<6;a++){var o=e.substr(a,1)||-1;n=n[o]?n[o]:n[o]=5==a?[]:{}}n.push(t)},e.prototype.remove=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)if(n.hasOwnProperty(a)){for(var o=this.index,s=0;s<6;s++){var i=a.substr(s,1)||-1;if(!o[i])break;o=o[i]}if(o.length)for(var s in o)if(this.equals(o[s],e)){o.splice(s,1);break}}},e.prototype.equals=function(e,t){for(var n in e)if(e.hasOwnProperty(n))switch(typeof e[n]){case"object":if(!this.equals(e[n],t[n]))return!1;break;case"function":if(void 0===e[n]||e[n].toString()!=t[n].toString())return!1;break;default:if(e[n]!=t[n])return!1}for(var n in t)if(void 0===t[n])return!1;return!0},e.prototype.intersect=function(e,t){var n=[];if(o(e[0])||o(t[0]))return e.filter((function(e){return-1!==t.indexOf(e)}));for(;e.length>0&&t.length>0;)if(e[0]._order<t[0]._order)e.shift();else if(e[0]._order>t[0]._order)t.shift();else{if(this.equals(e[0],t[0])){var a=e.shift();a&&n.push(a)}t.shift()}return n},e.prototype.add=function(e){var t=this.prepareFunc(e),n=this.strToPrefixes(t);for(var a in n)n.hasOwnProperty(a)&&this.toIndexTree(a,e)},e.prototype.search=function(e){var t=this.index,n=this.strToSearchPrefixes(e),a=[],o=!1;for(var s in n)if(n.hasOwnProperty(s)){if(o&&!a)break;var i=this.localSearch(n[s],0,t);i.sort((function(e,t){return e._order-t._order})),a=o?this.intersect(a,i):i,o=!0}for(var r=a[0],l=a.length+1,c=[],d=1;d<l;d++){var u=a[d];u!=r&&(c.push(r),r=u)}return c},e.prototype.localSearch=function(e,t,n){if(!n)return[];var a={};for(var o in e)e.hasOwnProperty(o)&&(a[i=o.substr(t,1)||-1]||(a[i]={}),a[i][o]=1);if(6==t++)return n;var s=[];for(var i in a)if("-1"===i)for(var r in n)n.hasOwnProperty(r)&&s.push.apply(s,this.localSearch(a[i],t,n[r]));else{var l=this.localSearch(a[i],t,n[i]);s.push.apply(s,l)}return s},e}();function o(e){return!isNaN(e)}},947934:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon20Add","add_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="add_20"><path fill-rule="evenodd" d="M10 3a.75.75 0 0 1 .75.75v5.5h5.5a.75.75 0 0 1 0 1.5h-5.5v5.5a.75.75 0 0 1-1.5 0v-5.5h-5.5a.75.75 0 0 1 0-1.5h5.5v-5.5A.75.75 0 0 1 10 3Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},927384:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon20MailOutline","mail_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="mail_outline_20"><path fill="currentColor" fill-rule="evenodd" d="M6.577 2.5h6.846c1.773 0 2.418.18 3.067.528.64.343 1.14.845 1.483 1.486.347.65.527 1.296.527 3.074v4.824c0 1.778-.18 2.424-.527 3.074a3.568 3.568 0 0 1-1.483 1.486c-.649.347-1.294.528-3.067.528H6.577c-1.773 0-2.418-.18-3.067-.528a3.567 3.567 0 0 1-1.483-1.486c-.347-.65-.527-1.296-.527-3.074V7.588c0-1.778.18-2.424.527-3.074A3.568 3.568 0 0 1 3.51 3.028c.649-.347 1.294-.528 3.067-.528ZM3 12.412V7.588c0-1.598.156-1.997.33-2.328l4.463 4.464c.28.28.52.52.736.703.226.192.473.363.776.462a2.249 2.249 0 0 0 1.39 0c.303-.099.55-.27.776-.462.215-.182.456-.424.736-.703L16.67 5.26c.173.331.329.73.329 2.328v4.824c0 1.663-.169 2.027-.35 2.368-.203.379-.49.667-.868.87-.34.181-.701.35-2.36.35H6.578c-1.658 0-2.02-.169-2.359-.35a2.068 2.068 0 0 1-.867-.87C3.169 14.44 3 14.075 3 12.412ZM13.423 4H6.577c-1.326 0-1.823.108-2.142.244l4.398 4.399c.306.305.504.502.666.64.156.133.23.166.27.179a.75.75 0 0 0 .463 0c.04-.013.113-.046.269-.179.162-.138.36-.335.666-.64l4.398-4.399C15.245 4.108 14.75 4 13.423 4Z" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},6057:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon20PhoneOutline","phone_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="phone_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" opacity=".1" /><path fill="currentColor" fill-rule="nonzero" d="m7.78 2.7.7.833c1.373 1.628 1.229 4.054-.299 5.582l-.297.296c.226.38.633.878 1.23 1.475.53.53.984.912 1.344 1.149l.13.082.298-.297c1.526-1.527 3.95-1.672 5.58-.302l.833.702c1.46 1.229 1.602 3.419.346 4.894a3.859 3.859 0 0 1-2.29 1.289l-.506.06c-3.005.292-6.037-1.16-9.094-4.217-3.056-3.056-4.51-6.09-4.226-9.025l.06-.515a3.834 3.834 0 0 1 1.3-2.354l.168-.135c1.462-1.107 3.54-.924 4.723.484Zm-3.911.788c-.321.276-.562.633-.698 1.033a2.37 2.37 0 0 0-.115.552c-.343 2.548.898 5.25 3.76 8.112 2.86 2.862 5.562 4.103 8.123 3.758a2.376 2.376 0 0 0 1.571-.81c.719-.844.636-2.082-.177-2.766l-.833-.701-.142-.112c-1.02-.739-2.471-.614-3.411.326l-.597.598-.088.076a.903.903 0 0 1-.862.133c-.648-.238-1.425-.818-2.346-1.74-.923-.923-1.503-1.7-1.74-2.347a.903.903 0 0 1 .209-.95l.598-.597.129-.137c.862-.987.906-2.44.084-3.416l-.702-.834-.112-.122c-.7-.697-1.853-.735-2.651-.056Z" /></g></symbol>',20,20,!1,void 0)},601931:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon20PlaceOutline","place_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" id="place_outline_20"><g fill="none" fill-rule="evenodd"><path d="M0 0h20v20H0z" opacity=".4" /><path fill="currentColor" fill-rule="nonzero" d="M10 1c4.148 0 7.5 3.433 7.5 7.5 0 2.85-1.843 6.172-5.435 10.095a2.8 2.8 0 0 1-4.13 0C4.343 14.672 2.5 11.35 2.5 8.5 2.5 4.433 5.852 1 10 1Zm0 1.5c-3.382 0-6 2.825-6 6 0 2.383 1.68 5.41 5.041 9.082a1.3 1.3 0 0 0 1.918 0C14.319 13.911 16 10.883 16 8.5c0-3.175-2.618-6-6-6ZM10 5a3.5 3.5 0 1 1-.001 7.001A3.5 3.5 0 0 1 10 5Zm0 1.5a2 2 0 1 0 .001 4.001A2 2 0 0 0 10 6.5Z" /></g></symbol>',20,20,!1,void 0)},282725:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon20Sync","sync_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="sync_20"><clipPath id="sync_20_a"><path d="M0 0h20v20H0z" /></clipPath><g fill="currentColor" clip-path="url(#sync_20_a)"><path d="M16.25 1.5a.75.75 0 0 1 .75.75v3a.75.75 0 0 1-.75.75h-3a.75.75 0 0 1 0-1.5h1.081a6.977 6.977 0 0 0-4.33-1.5 6.976 6.976 0 0 0-4.95 2.05 6.976 6.976 0 0 0-1.973 5.996c.073.483-.278.954-.766.954a.69.69 0 0 1-.69-.563A8.54 8.54 0 0 1 1.5 10c0-2.174.83-4.35 2.49-6.01A8.476 8.476 0 0 1 10 1.5c1.958 0 3.918.673 5.5 2.019V2.25a.75.75 0 0 1 .75-.75zM3 14.75a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 0 1.5H5.669C6.935 16.5 8.467 17 10 17a6.976 6.976 0 0 0 4.95-2.05 6.976 6.976 0 0 0 1.972-5.996C16.85 8.47 17.2 8 17.688 8a.69.69 0 0 1 .69.563 8.476 8.476 0 0 1-2.368 7.448A8.476 8.476 0 0 1 10 18.5a8.476 8.476 0 0 1-5.5-2.019v1.269a.75.75 0 0 1-1.5 0z" /></g></symbol>',20,20,!1,void 0)},147650:(e,t,n)=>{"use strict";n.d(t,{default:()=>a});const a=(0,n(28178).makeIcon)("Icon24SmileOutline","smile_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="smile_outline_24"><path d="M8.438 14.297a.9.9 0 0 1 1.259.133c.013.016.196.223.53.432.383.24.97.488 1.773.488a3.3 3.3 0 0 0 1.773-.488c.191-.12.382-.26.53-.432a.9.9 0 0 1 1.4 1.132 4.045 4.045 0 0 1-.976.826A5.094 5.094 0 0 1 12 17.15a5.094 5.094 0 0 1-2.727-.762 3.987 3.987 0 0 1-.976-.826.9.9 0 0 1 .14-1.265Zm1.812-4.047a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0ZM15 11.5A1.25 1.25 0 1 0 15 9a1.25 1.25 0 0 0 0 2.5Zm-3-9.4c-5.468 0-9.9 4.432-9.9 9.9s4.432 9.9 9.9 9.9 9.9-4.432 9.9-9.9-4.432-9.9-9.9-9.9ZM3.9 12a8.1 8.1 0 1 1 16.2 0 8.1 8.1 0 0 1-16.2 0Z" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},380557:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="m7.28 4.99-.52 1.2c-.04.1-.06.14-.09.17a.28.28 0 0 1-.09.07.62.62 0 0 1-.17.04l-.75.1c-2.15.3-3.23.46-3.68.96a1.86 1.86 0 0 0-.44 1.61c.13.67.98 1.35 2.68 2.7l.27.23c.08.06.12.09.14.13a.28.28 0 0 1 .04.11c.01.05 0 .1-.02.2l-.08.44c-.48 2.5-.71 3.75-.34 4.36a1.85 1.85 0 0 0 1.5.9c.72.02 1.7-.79 3.65-2.42l.34-.28c.1-.08.15-.12.2-.14a.28.28 0 0 1 .16 0c.06.02.11.06.21.14l.34.28c1.95 1.63 2.93 2.44 3.65 2.41a1.85 1.85 0 0 0 1.5-.89c.37-.6.14-1.86-.34-4.36l-.08-.45c-.02-.1-.03-.14-.02-.19a.28.28 0 0 1 .04-.11.62.62 0 0 1 .14-.13l.27-.22c1.7-1.36 2.55-2.04 2.68-2.7a1.86 1.86 0 0 0-.44-1.62c-.45-.5-1.53-.65-3.68-.96l-.75-.1c-.09-.02-.13-.02-.17-.04a.28.28 0 0 1-.1-.07l-.08-.16-.52-1.21c-.86-2-1.3-2.99-1.9-3.29a1.85 1.85 0 0 0-1.66 0C8.57 2 8.14 3 7.28 5Z"/></svg>',name:"favorite_20"}}n.d(t,{getIcon20Favorite:()=>a})},498645:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" fill-rule="evenodd" d="M10.4 3.13a.92.92 0 0 0-.82 0c-.05.03-.19.13-.44.6-.24.45-.52 1.09-.92 2-.16.38-.33.74-.48 1.12-.02.05-.09.2-.2.33a1.02 1.02 0 0 1-.33.25c-.16.08-.35.1-.38.1l-.68.1c-1 .14-1.69.24-2.19.35-.52.13-.66.23-.7.27a.92.92 0 0 0-.21.8c0 .05.07.22.46.59.37.35.92.8 1.7 1.42l.25.2a1.02 1.02 0 0 1 .42 1.13l-.08.41a35.03 35.03 0 0 0-.43 2.56c-.07.64 0 .82.03.86a.92.92 0 0 0 .74.44c.05 0 .24-.02.77-.39.49-.34 1.13-.87 2.03-1.62l.31-.26.15-.12c.07-.04.17-.11.32-.15a1.02 1.02 0 0 1 .55 0c.15.04.25.1.32.15l.15.12.31.26c.9.75 1.54 1.28 2.03 1.62.53.37.72.4.77.4a.92.92 0 0 0 .74-.45c.03-.04.1-.22.03-.86-.06-.6-.21-1.4-.43-2.56l-.08-.42a1.25 1.25 0 0 1-.02-.4 1.03 1.03 0 0 1 .15-.42c.1-.17.26-.28.3-.3l.24-.2c.78-.63 1.33-1.07 1.7-1.42.39-.37.45-.54.46-.59a.92.92 0 0 0-.22-.8c-.03-.04-.17-.14-.7-.27-.5-.11-1.18-.21-2.18-.35l-.7-.1c-.04 0-.2-.03-.36-.1a1.02 1.02 0 0 1-.33-.25c-.12-.14-.19-.31-.2-.34l-.48-1.1c-.4-.92-.68-1.56-.92-2-.25-.48-.4-.58-.44-.6ZM8.9 1.76a2.45 2.45 0 0 1 2.2 0c.5.25.82.73 1.1 1.24.28.51.58 1.22.96 2.09l.41.95.53.07c.94.14 1.7.24 2.28.38.56.13 1.11.32 1.49.74a2.46 2.46 0 0 1 .58 2.12c-.11.55-.5 1-.9 1.4-.43.4-1.03.89-1.78 1.48l-.11.1.04.22c.21 1.1.38 1.99.45 2.66.06.64.07 1.3-.25 1.81a2.46 2.46 0 0 1-1.99 1.18c-.6.02-1.18-.3-1.7-.67-.56-.38-1.24-.95-2.1-1.67l-.11-.09-.11.09c-.87.72-1.55 1.29-2.1 1.67-.53.37-1.1.7-1.71.67a2.46 2.46 0 0 1-2-1.18c-.3-.51-.3-1.17-.24-1.81.07-.67.24-1.55.45-2.66l.04-.23-.11-.09c-.74-.6-1.35-1.07-1.77-1.48-.42-.4-.8-.85-.9-1.4a2.46 2.46 0 0 1 .58-2.12c.37-.42.92-.61 1.48-.74.58-.14 1.34-.24 2.28-.38l.53-.07.4-.95c.39-.87.7-1.58.97-2.1.28-.5.6-.98 1.1-1.23Z" clip-rule="evenodd"/></svg>',name:"favorite_outline_20"}}n.d(t,{getIcon20FavoriteOutline:()=>a})},893299:(e,t,n)=>{"use strict";function a(){return{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path fill="currentColor" d="M12.6 2.22a.75.75 0 0 0-1.27.38l-.3 1.54a.3.3 0 0 1-.09.16L8.48 6.76a.3.3 0 0 1-.19.08l-3.86.3a1.01 1.01 0 0 0-.63 1.73l2.96 2.96-4.47 4.46a1 1 0 0 0 1.42 1.42l4.46-4.47 2.97 2.96c.61.62 1.65.22 1.72-.63l.3-3.86a.3.3 0 0 1 .08-.19l2.47-2.46a.3.3 0 0 1 .15-.08l1.54-.31c.58-.12.8-.84.38-1.27L12.6 2.22Z"/></svg>',name:"pin_20"}}n.d(t,{getIcon20Pin:()=>a})},775349:(e,t,n)=>{"use strict";n.d(t,{MessageForward:()=>A});var a=n(722122),o=n(785893),s=n(667294),i=n(501389),r=n(508414),l=n(740733),c=n(413374),d=n(384032),u=n(511492),h=n(661711),g=n(284863),v=n(459554),m=n(645523),p=n(70162),_=n(516703),C=n(483295),f=n(519037),b=n(125672),I=n(146143),w=n(923876),S=n(147650),L=n(254589),T=n(844142),y=(0,u.debouncedPromise)(d.searchHints,300);class k extends s.Component{constructor(e){var t;super(e),t=this,this.toggleMode=()=>{var e=this.props.store;if((0,g.isCommunityInterface)(e)){var t=0===this.state.mode?1:0,n=0===t?d.searchImTopConv:d.searchTopConv;this.setState({value:"",mode:t,loading:!0,selected:null,found:[]},(()=>n("",e.get()).then((e=>this.setSearchResults(this.filterResults(e)))).then((()=>this.searchInput.focus())).catch((e=>console.error(e)))))}},this.onChange=e=>{this.setState({value:e.target.value,loading:!0,error:null});var t=e.target.value;this.searchQuery!==t&&(this.searchQuery=t,this.onSearch(t))},this.filterResults=e=>{var t=(0,g.isCommunityInterface)(this.props.store)&&1===this.state.mode;return e.filter((e=>{var n=e.peerId;return(!t||!T.Ranges.isGroupId(n))&&(!(t&&T.Ranges.isChatOrChannelPeer(n)&&!(0,v.doesChatTabHaveFlag)(e,1024))&&!(!t&&T.Ranges.isChatOrChannelPeer(n)&&(0,v.doesChatTabHaveFlag)(e,1024)))}))},this.onSearch=e=>{var t=this.props.store,n=t.get(),a=(0,g.isCommunityInterface)(t)&&0===this.state.mode,o=a?d.searchImTopConv:d.searchTopConv;return 1===this.state.mode&&""===e?this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})):o(e,n).then((t=>{var o=t.map((e=>e.peerId));return t=this.filterResults(t),this.setSearchResults(t,!1,!t.length),e?y(e,o,"all",{hidegid:a},n):Promise.resolve([])})).then((t=>{e===this.state.value&&this.setSearchResults(this.filterResults(t),!0)})).catch((()=>{}))},this.emptySearch=()=>{var e=this.props.store,t=e.get(),n=t.dialog_tabs.all,a={},o={};return(0,d.searchTopConv)("",t).then((s=>(s.forEach((e=>{o[e.peerId]=e})),[t.peer].concat(n.filter((e=>e!==t.peer))).map((t=>{var n=(0,g.getTab)(e,t);return a[t]=!0,{name:o[t]&&o[t].tab||n.tab,photo:o[t]&&o[t].photo||n.photo,lastmsg:n.lastmsg,major_sort_id:n.major_sort_id,minor_sort_id:n.minor_sort_id,data:n.data,peerId:t}})).concat(s.filter((e=>!a[e.peerId]))).sort(((n,a)=>n.peerId===t.peer?-1:a.peerId===t.peer?1:(0,w.sortFn)(e,n,a))))))},this.sendRecipient=e=>{var t=this.props.store,n=t.get();1===this.state.mode?(n.longpoll.push([(0,m.changePeer)(e,!1,!0,!0,"forward_messages_popup")]),(0,_.statlogsForwardEvent)(t),(0,g.isCommunityInterface)(t)&&(0,_.statlogsForwardFromCommunityEvent)(t,!1)):this.setState({selected:e,error:null},(()=>{Emoji.focus(this.input)}))},this.loadMore=()=>{},this.getSearchInputEl=e=>this.searchInput=e,this.setSearchResults=function(e,n,a){if(void 0===a&&(a=!1),!t.unmounted)if(n){var o=e.filter((e=>!t.found[e.peerId]));o.forEach((e=>{t.found[e.peerId]=!0})),t.setState({found:[].concat(t.state.found,o),loading:a})}else t.found=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),t.setState({found:e,loading:a,activeElement:0})},this.getFormRef=e=>{this.form=e},this.getInputRef=e=>{this.input=e},this.getEmojiButtonRef=e=>{this.emojiButton=e},this.onEmojiButtonMouseOver=e=>{e.persist(),Emoji.show(this.emojiButton,e)},this.onEmojiButtonMouseOut=e=>{e.persist(),Emoji.hide(this.emojiButton,e)},this.send=()=>{var e=this.props.store,t=this.state.selected,n=Emoji.val(this.input).trim(),o=new f.ImDraft({},0),s=e.get().pendingForward;if(t&&!(0,h.isMessageTooLong)(n)){this.setState({sending:!0});var r=(0,g.isCommunityInterface)(e)&&0===this.state.mode;r||o.addAttach("mail",s.msgIds.join(";"),s.object||null);var l={message:n,attaches:o.dData.attaches.map((e=>[e.type,e.id]))||[]},c={hidegid:!0,external:{original_gid:e.get().id,fwd_group_msg_ids:r?s.msgIds.join(";"):void 0}};new Promise((n=>{(0,d.loadHashes)([t],{hidegid:!0},e.get()).then((e=>{var a=e[0];return n(a[t])}))})).then((n=>e.set(d.sendMessage.bind(null,t,l,(0,a.default)({hash:n},c))))).then((()=>{(0,_.statlogsForwardFromCommunityEvent)(e,!0),e.setState({pendingForward:null}),this.props.closePopup(),(0,i.showDoneBox)(p.getLang("mail_send3"))})).catch((e=>{this.unmounted||this.setState({sending:!1},(()=>{(0,I.showFastBox)(p.getLang("mail_error"),e)}))}))}},this.onSearchKeyDown=e=>{27===e.keyCode&&this.state.value&&(this.searchInput.blur(),this.searchQuery="",this.setState({value:"",loading:!0,error:null},this.onSearch.bind(this,"")),e.stopPropagation())},this.onMessageInputKeyDown=e=>{27===e.keyCode&&(this.state.sending||(Emoji.val(this.input,""),this.setState({selected:null}),this.searchInput.focus()),e.stopPropagation())},this.state={value:"",found:[],mode:1,loading:!0,sending:!1,selected:null,activeElement:0},this.emptySearch().then((e=>{this.setSearchResults(this.filterResults(e))})).catch((e=>console.error(e)))}componentDidMount(){this.props.updatePopup(),Emoji.init(this.input,{noStickers:!0,onSend:this.send}),this.input.addEventListener("keydown",this.onMessageInputKeyDown)}componentWillUnmount(){this.input.removeEventListener("keydown",this.onMessageInputKeyDown),this.unmounted=!0}render(){var e=this.props,t=e.store,n=e.closePopup,a=this.state,i=a.mode,d=a.loading,u=a.selected,h=a.found,v=a.sending,m=(0,C.classNames)("MessageForward",{"MessageForward--form":0===i&&!!u});return(0,o.jsxs)("section",{className:m,children:[(0,o.jsx)(r.default,{title:(0,o.jsxs)(s.Fragment,{children:[(0,o.jsx)("span",{className:"MessageForward__title",children:p.getLang("mail_forward_messages")}),(0,g.isCommunityInterface)(t)&&(0,o.jsx)("span",{className:"MessageForward__switch",onClick:this.toggleMode,children:0===i?p.getLang("mail_forward_to_community_messages"):p.getLang("mail_forward_to_im")})]}),onCloseClick:n}),(0,o.jsxs)("div",{className:"MessageForward__content",children:[(0,o.jsx)(c.ConvoPicker,{searchValue:this.state.value,isLoading:d,convos:h.map((e=>e||(0,g.getTab)(t,e.peerId))),mode:1===i?c.convoPickerMode.DEFAULT:c.convoPickerMode.RADIO,selectedConvos:[u],onSearchValueChange:this.onChange,onSearchInputKeydown:this.onSearchKeyDown,onConvoSelect:this.sendRecipient,onListLoadMore:this.loadMore,searchInputGetter:this.getSearchInputEl,className:"MessageForward__convoPicker"}),(0,o.jsxs)("footer",{className:"MessageForward__footer",ref:this.getFormRef,children:[(0,o.jsxs)("div",{className:"MessageForward__form _emoji_field_wrap",children:[(0,o.jsx)("div",{className:"MessageForward__input",tabIndex:"0",contentEditable:!0,role:"textbox","aria-multiline":!0,ref:this.getInputRef,placeholder:p.getLang("mail_im_enter_msg")}),(0,o.jsx)("div",{className:"MessageForward__emoji emoji_smile_wrap _emoji_wrap",children:(0,o.jsx)("div",{ref:this.getEmojiButtonRef,className:"emoji_smile _emoji_btn",title:p.getLang("global_emoji_hint"),onMouseOver:this.onEmojiButtonMouseOver,onMouseOut:this.onEmojiButtonMouseOut,onClick:this.onEmojiButtonClick,children:(0,o.jsx)(S.default,{})})})]}),v?(0,o.jsx)("div",{className:"MessageForward__send-spinner",children:(0,o.jsx)(l.default,{})}):(0,o.jsx)("button",{className:"MessageForward__send",onClick:this.send,children:(0,o.jsx)(L.default,{})})]},"footer")]})]})}}var A=(0,b.connect)(k)},287285:(e,t,n)=>{"use strict";n.d(t,{checkContactListLoaded:()=>V,mount:()=>re});var a=n(290846),o=n(810890),s=n(733164),i=n(152278),r=n(501389),l=n(70162),c=n(610124),d=n(384032),u=n(661711),h=n(663825),g=n(645523),v=n(284863),m=n(483295),p=n(43229),_=n(238283),C=n(955647),f=n(142875),b=n(734209),I=n(553995),w=n(459554),S=n(993421),L=n(873589),T=n(342269),y=n(57757),k=n(124041),A=n(893299),x=n(545892),M=n(380557),j=n(498645),P=n(748136),E=n(844142),R="_im_dialog_action_wrapper",N="_im_dialog_call_action_wrapper",O="_im_header_icon",B="_im_page_action",F="_im_chat_verified",D="._im_page_status",H="im-page--chat-header_reconnected",U="im-page--header-action_loading";function q(e,t,n){return!e.map((e=>{var a=(0,v.getMessage)(t,n,e);return a&&(0,p.isImportant)(a)})).reduce(((e,t)=>e&&t),!0)}function G(e,t){var n=t.get(),a=n.peer,o=n.tabs[a].pinned;return 1===e.length&&o&&e[0]===(0,v.parserMessage)(o).messageId}function V(e){return e.get().contactsList?Promise.resolve(e):e.set(d.getContactsList)}function z(e,t,n){var a=l.getLang("mail_selected_shorted",t.length);W({actions:!0},"im-page--chat-header"),(0,L.val)((0,L.geByClass1)("im-page--selected-messages"),(0,T.getTemplate)("im_selected_messages",{label:a.replace("{count}",t.length),tip:l.getLang("mail_deselect_all")}));var o=(0,v.getTab)(n,n.get().peer),s=t.some((e=>{var t=(0,v.getMessage)(n,n.get().peer,e);if(!t)return!1;var a=t.attaches[0];return!(!a||"widget"!==a.type)})),i=e.querySelector("._im_mess_actions"),r=q(t,n,n.get().peer),c=G(t,n),d=t.length>1,h=!d&&E.Ranges.isChatOrChannelPeer(o.peerId)&&(0,u.canPinMessage)(n,t[0]),g=(0,u.canForwardMessages)(n,t)&&!s,p=e.querySelector('._im_page_action[data-action="pin"]'),_=e.querySelector('._im_page_action[data-action="star"]'),C=e.querySelector('._im_page_action[data-action="respond"]'),f=e.querySelector('._im_page_action[data-action="forward"]'),b=Boolean((0,v.tabIsOutgoingMessageRequest)(o)),I=Boolean((0,v.tabIsMessageRequest)(o)),S=(0,w.isBusinessNotifyPeer)(n,n.get().peer);i.className=(0,m.classNames)("im-page--mess-actions _im_mess_actions",{"im-page--mess-actions_important":!r&&!s,"im-page--mess-actions_pinned":c,"im-page--mess-actions_channel":E.Ranges.isChatOrChannelPeer(o)&&!n.get().gid,"im-page--mess-actions_multiple-selection":d,"im-page--mess-actions_no-pin-btn":!h,"im-page--mess-actions_out-mr":b,"im-page--mess-actions_in-mr":I,"im-page--mess-actions_business-notify":S,"im-page--mess-actions_no-important-btn":!(0,u.canMarkImportant)(n,t)||s}),p.innerHTML=c?(0,A.getIcon20Pin)().icon:(0,x.getIcon20PinOutline)().icon,_.innerHTML=r||s?(0,j.getIcon20FavoriteOutline)().icon:(0,M.getIcon20Favorite)().icon,t.length>1?k.FlatButton.setLabel(C,l.getLang("mail_forward_here")):k.FlatButton.setLabel(C,l.getLang("mail_im_mark_reply")),g?k.FlatButton.setDisabled(f,!1):k.FlatButton.setDisabled(f,!0),d&&!g||(0,w.isBusinessNotifyTab)(o)||s?k.FlatButton.setDisabled(C,!0):k.FlatButton.setDisabled(C,!1);var y=r?l.getLang("mail_im_toggle_important"):l.getLang("mail_im_toggle_important_off"),P=c?l.getLang("mail_unpin"):l.getLang("mail_pin");(0,L.attr)((0,L.geByClass1)("im-page-action_star",e),"aria-label",y),(0,L.attr)((0,L.geByClass1)("im-page-action_pin",e),"aria-label",P)}function K(e,t,n){var a=t.get(),o=a.peer,s=a.tabs[o],i=(0,L.geByClass1)(F,e),r=(0,L.geByClass1)(u.PINNED_CONTAINER_CLASS,e),l=E.Ranges.isChatOrChannelPeer(o),c=l&&(0,v.isChannelPeer)(s),h=l&&(0,w.isBusinessNotifyTab)(s)&&(0,S.isBusinessNotifyEnabled)(t),g=a.selectedMessages&&!!a.selectedMessages.length;i.tt=!1;var m=s.is_nft_photo,p=(0,u.renderPhotosFromTab)(t,s,!1),f=m?(0,T.getTemplate)("im_simple_link",{href:c?"/club"+-s.ownerId:s.href,content:(0,T.getTemplate)("im_peer_photo_nft",{user_photo:(0,T.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:s.photo,size:30}),user_icon:s.photo_icon||"",modifier_class:"nim-peer_smaller"})}):(0,T.getTemplate)("im_simple_link",{href:c?"/club"+-s.ownerId:s.href,content:(0,T.getTemplate)("im_peer_photo",{online_class:"",owner_photo:p,modifier_class:"nim-peer_smaller"})});(0,L.val)((0,L.geByClass1)("im-page--aside-photo",e),f);var b=l&&(0,v.isChatActive)(s),I={muted:(0,T.inArray)(o,a.mutedPeers),verified:!!s.verified,verified_by_other_services:!s.verified&&!!s.verified_by_other_services,chat:l,vkcomgroup:c,actions:g,derelict:l&&!b&&!c&&!h,pinned:!1};if(l){var y=(0,v.getPinnedMessage)(t),k=function(e){var t=(0,v.getPinnedMessage)(e);if(!t||(0,_.oCacheGet)(e,t.userId))return!1;return t.userId}(t);y&&(0,C.isPinnedMessageVisibleInTab)(t,o)&&(k?t.set(d.loadChatMember.bind(null,{[o]:[k]})).then(K.bind(null,e,t,n)):I.pinned=!0)}$(t,s,e);var A=!s.top_banner&&r.innerHTML,x=!s.top_banner&&Z(t,e,r),M=(0,L.geByClass1)("_im_page_peer_name",e);(0,L.removeClass)(M,u.DESELECT_ALL_CLASS),function(e,t,n){var a=n.length>0;(0,L.geByClass)(O,e).forEach((e=>{if("star"===e.dataset.type&&(0,u.isFoldersAvailable)(t)&&((0,L.toggleClass)(e,"im-page--header-icon_shown",!a),(0,L.toggleClass)(e,"im-page--header-icon_star-active",(0,u.isImportant)(t))),"answer"===e.dataset.type&&(0,u.isFoldersAvailable)(t)&&(0,L.toggleClass)(e,"im-page--header-icon_shown",!a&&(0,u.isUnrespond)(t)),"search"===e.dataset.type&&!(0,u.isCommunityInterface)(t)){var n=t.get().peer,o=!a&&(0,u.isFullyLoadedTab)(t,n)&&(0,v.getTab)(t,n).offset&&!(0,u.isCommunityInterface)(t)&&(!(0,u.isCallToPeerAvailable)(t,n)||!(0,u.isClassicInterface)(t));(0,L.toggleClass)(e,"im-page--header-icon_shown",o)}}))}(e,t,[]);var j=e.querySelector("._im_dialog_call_action_wrapper"),P=e.querySelector("._im_header_icon[data-type=call]");if(j&&j.classList.toggle("im-page--header-call-is-hidden",!(0,u.isCallToPeerAvailable)(t,o)||!!s.callInProgress),P&&(P.classList.toggle("im-page--header-icon_shown",(0,u.isCallToPeerAvailable)(t,o)&&!!s.callInProgress),P.classList.toggle("im-page--header-icon_call-active",!!s.callInProgress&&s.callInProgress.participants.count>0)),(0,u.isClassicInterface)(t)){var R=(0,L.geByClass1)("_im_page_back",e);(0,L.attr)(R,"href",`${(0,u.getBaseLink)(t)}?tab=${a.active_tab}`)}W(I,"im-page--chat-header"),(0,u.compensateHistoryHeightChange)(t,x,A,n)}function $(e,t,n){var a=E.Ranges.isChatOrChannelPeer(t.peerId),o=a&&(0,v.isChannelPeer)(t),i=a&&(0,v.isChatActive)(t),r=a&&(0,v.isCasperChatTab)(t),c=a&&(0,w.isBusinessNotifyTab)(t)&&(0,S.isBusinessNotifyEnabled)(e),d=E.Ranges.isContactId(t.peerId),h=t.isDonutChat,g="";a?g=o?(0,T.getTemplate)("im_vkcomgroup_members",{name:l.getLang("mail_im_n_vkcomgroup_members",(0,u.getAliveMembersCount)(t))}):i?(0,T.getTemplate)("im_chat_members",{name:l.getLang("mail_im_n_chat_members",(0,u.getAliveMembersCount)(t))}):"":E.Ranges.isUserIdTransitional(t.peerId)&&(g=(0,u.getLastSeenTextInHeader)(e,t.peerId));var m=[];""!==g||c||m.push("im-page--title--1line"),r&&m.push("im-page--title--casper"),h&&m.push("im-page--title--donut"),c&&m.push("im-page--title--business-notify"),m=m.join(" ");var p=d?(0,u.prepareContactName)(t.name):t.tab,_=(0,T.getTemplate)("im_simple_name",{name:p,href:o?"/club"+-t.ownerId:t.href,name_attr:(0,s.stripHTML)(p),ads_union:t.ad_union_ids_attr,online:g,more_cls:m,more_children:c?(0,T.getTemplate)("sImSimpleNameBusinessNotifyLabel",{text:l.getLang("mail_tab_business_notify")}):""});(0,L.val)((0,L.geByClass1)("im-page--title-wrapper",n),_)}function Z(e,t,n){var a=(0,v.getPinnedMessage)(e),o=n||(0,L.geByClass1)(u.PINNED_CONTAINER_CLASS,t);if((0,L.removeClass)(o,"im-page--pinned_with-bar"),a&&(0,p.isMoneyRequest)(a)){if(void 0===a.kludges.attach1_tr_amount)return;a.kludges.attach1_total_amount&&(0,L.addClass)(o,"im-page--pinned_with-bar")}var s=(0,u.renderPinnedMessage)(e);return(0,L.val)(o,s),!!s}function W(e,t){var n=(0,L.geByClass1)(t);Object.keys(e).forEach((a=>{(0,L.toggleClass)(n,`${t}_${a}`,!!e[a])}))}function Y(e,t,n,a,o){e.set(d.removeMessagesWithRestore.bind(null,n,o,a)).then(t().removeMessagesRestore.bind(null,n,o,a)),(0,d.removeMessageSend)(n,o,null,a,e.get()).then((()=>{var a=(0,v.getTab)(e,o);n.includes(a.lastmsg)&&(0,d.loadActualLastMessage)(e,o).then((()=>{t().updateConvoInList(o,e),t().updateState(o,e)}))}))}function Q(e,t,n,a,o){var s=e.get().selectedMessages,i=(0,L.domData)(o,"action"),r=e.get().peer,l=(0,v.getTab)(e,r),c=!0;if(!["star","delete"].includes(i)&&(0,v.tabIsOutgoingMessageRequest)(l))return X(e,t,n);switch(i){case"delete":var g=!(vk.id==r&&!e.get().gid)&&s.every((t=>(0,u.canMessageBeDeletedForAll)(e,(0,v.getMessage)(e,r,t))));if(g||s.length>1){c=!1;var m=(0,u.showMsgDeleteDialog)(r,s.length,g,(a=>{X(e,t,n),m.hide(),cur.imDb.updateByKey("del_forall_checked",a),a?(0,d.removeMessageSend)(s,r,null,"deleteforall",e.get()):Y(e,t,s,i,r)}))}else Y(e,t,s,i,r);break;case"spam":Y(e,t,s,i,r);break;case"forward":if(!(0,u.canForwardMessages)(e,s))return;(0,d.processFwd)(s,r,e).then((t=>e.set(d.prepareForward.bind(null,t)))).then((()=>n().showForward(e))).catch((e=>console.error(e)));break;case"star":var p=q(s,e,r);e.set(d.favMessage.bind(null,s,p,r)),e.get().longpoll.push(s.map((e=>({type:p?h.SET_FLAGS:h.RESET_FLAGS,messageId:e,peerId:r,flags:h.FLAG_IMPORTANT}))));break;case"respond":var _=e.get(),C=1===s.length;(0,d.processFwd)(s,_.peer,e).then((t=>e.set(d.forwardMessages.bind(null,t,_.tfdraft,C)))).then((()=>{t().respond(e,r)}));break;case"pin":var f=(0,v.getLocalId)(e,s[0]);if(!(0,u.canPinMessage)(e,f))return;var b=G(s,e),I=b?d.unpinMessageOptimistic.bind(null,r):d.pinMessageOptimistic.bind(null,f,r),w=b?d.unpinMessage.bind(null,r):d.pinMessage.bind(null,f,r),S=se.bind(null,t,r);e.set(d.checkChatMember.bind(null,e,f,r)).then((e=>e.set(I))).then(S).then((e=>e.set(w))).then(S)}c&&X(e,t,n)}function J(e,t,n,a,o,s,i){var r=(0,L.domData)(i,"action"),l=a.querySelector(`.${R} ._ui_menu`).parentNode,c=e.get().peer;(0,y.handleUiActionForPeer)(e,t,n,r,c,o),uiActionsMenu.toggle(l,!1),t().cancelEditing()}function X(e,t,n){var a=e.get().selectedMessages;e.set(d.cleanSelected).then(n().changedMessageSelection).then(t().cleanSelection.bind(null,a))}function ee(e,t,n,o){var s,i,r=(0,u.isClassicInterface)(e);switch((0,L.domData)(o,"type")){case"star":i=[4,6],s=()=>(0,u.isImportant)(e)?l.getLang("mail_im_toggle_important_off"):l.getLang("mail_im_toggle_important");break;case"answer":i=[4,6],s=l.getLang("mail_end_conversation");break;case"search":i=r?[5,6]:[4,-9],s=l.getLang("mail_search_in_peer")}(0,a.showTooltip)(o,{text:s||"",black:1,shift:i,forcetoup:!0,appendParentCls:r?"_im_dialog_actions":"_im_mess_actions"})}function te(e,t,n){var o=(0,u.isClassicInterface)(e),s=(0,L.domData)(n.target,"action");"respond"!==s&&"forward"!==s&&(0,a.showTooltip)(n.target,{text:ne.bind(null,e,s)||"",black:1,shift:[2,o?-4:11],forcetodown:!0,appendParentCls:"_im_dialog_actions"})}function ne(e,t){var n=e.get(),a=n.selectedMessages,o=n.peer;switch(t){case"pin":return G(a,e)?l.getLang("mail_unpin"):l.getLang("mail_pin");case"star":return q(a,e,o)?l.getLang("mail_im_toggle_important"):l.getLang("mail_im_toggle_important_off");case"delete":return l.getLang("mail_delete");case"spam":return l.getLang("mail_im_mark_spam")}}function ae(e,t,n,a,o){var s=(0,L.domData)(o,"type"),i=e.get().peer;switch(s){case"star":e.set(d.toggleDialogImportant.bind(null,i)).then((()=>{setTimeout((()=>ee(e,0,0,o)),40)}));break;case"search":n().showSearch(e),window.tooltips&&tooltips.hide(o,{fasthide:!0});break;case"answer":(0,v.getTab)(e,i)&&(e.set(d.markDialogAnswered.bind(null,e.get().peer)),(0,r.showDoneBox)(l.getLang("mail_marked_as_answered"),{out:1e3}),e.get().longpoll.push([(0,g.resetPeer)()]));break;case"call":if((0,u.isCallToPeerAvailable)(e,i)){var c=(0,v.getTab)(e,i).callInProgress;c&&(0,u.joinCallFromIm)(e,i,c.join_link,!1,u.CALL_ENTRY_POINT_JOIN_HEADER)}}}function oe(e,t){var n=Number(t),a=(0,u.formatTimespan)(n,!0),o=l.getLang("mail_network_waiting").replace(/{timer}/gi,a);e.querySelector(D).innerHTML=o}function se(e,t,n){return e().updateChatTopic(t,n),n}function ie(e,t,n,a){var s={};return{changeActions(t){var n=e.querySelector(`.${R} ._ui_menu`),a=e.querySelector(`.${R}`),o=t.get().curActions||{},s=Object.keys(o).sort(((e,t)=>d.ACTION_PRIORITIES[e]-d.ACTION_PRIORITIES[t]));if(0!==s.length){for(var i=(0,T.getTemplate)("sUiActionsMenuSeparator"),r="",l=0,c=0;c<s.length;c++){var u=s[c];c>0&&(l/10|0)!=(d.ACTION_PRIORITIES[u]/10|0)&&(r+=i),r+=(0,T.getTemplate)("sImUiActionMenuItem",{action:u,name:o[u].name,icon:o[u].icon,classes:"_im_action"}),l=d.ACTION_PRIORITIES[u]}n.innerHTML=r,a.classList.remove(U)}else a.classList.add(U)},setNetworkWaitingStatus(t,n){s.interval&&clearInterval(s.interval);var a=(0,v.getTab)(n,(0,w.getCurrentTab)(n));a&&!(0,w.isBusinessNotifyTab)(a)&&(oe(e,t),s.timeout=t,s.interval=setInterval((()=>{s.timeout>1?(s.timeout--,oe(e,s.timeout)):(clearInterval(s.interval),s={})}),1e3))},setNetworkReconnectingStatus(t){s.interval&&clearInterval(s.interval),s={};var n,a,o=(0,v.getTab)(t,(0,w.getCurrentTab)(t));o&&!(0,w.isBusinessNotifyTab)(o)&&(n=e.querySelector(D),a=l.getLang("mail_network_reconnecting"),n&&(n.innerHTML=a))},clearNetworkStatus(){s.interval&&clearInterval(s.interval),s={},e.querySelector(D).innerHTML=""},showSettings(t){var n=t.get(),o=(0,v.getTab)(t,n.peer);(0,v.isChatActive)(o)&&(0,f.mount)(e,t,a)},showForward(t){(0,b.mount)(e,t,a)},renderPeer(n){K(e,n,t)},reRenderPinned(t){var n=(0,w.getCurrentTab)(t);n&&n.pinned&&Z(t,e)},reRenderTitle(t){var n=(0,w.getCurrentTab)(t);n&&$(t,n,e)},renderActions(t){var n=t.get().selectedMessages||[];n.length>0&&z(e,n,t)},hideActions(t){if(!(0,u.isFullyLoadedTab)(t,t.get().peer)){(0,L.geByClass)(O,e).forEach((e=>{(0,L.addClass)(e,U)}));var n=(0,L.geByClass1)(R,e);(0,L.addClass)(n,U);var a=(0,L.geByClass1)(N,e);(0,L.addClass)(a,U)}},showActions(t){if((0,u.isFullyLoadedTab)(t,t.get().peer)){(0,L.geByClass)(O,e).forEach((e=>{(0,L.removeClass)(e,U)}));var n=(0,L.geByClass1)(R,e);(0,L.removeClass)(n,U);var a=(0,L.geByClass1)(N,e);(0,L.removeClass)(a,U)}},changedMessageSelection(n){var a=n.get(),o=a.peer;if(0!==o&&a.tabs[o]){var s=n.get().selectedMessages||[];s.length>0?z(e,s,n):K(e,n,t)}},updateLastSeen(t){!function(e,t){var n=e.get().peer,a=(0,L.geByClass1)("_im_page_peer_online",t);a&&E.Ranges.isUserIdTransitional(n)&&(0,v.getTab)(e,n)&&(0,u.applyInnerHtml)(a,(0,u.getLastSeenTextInHeader)(e,n))}(t,e)},deselectAll(e){X(e,t,a)},updateState(e){t().updateState.bind(null,e)},unmount(){(0,c.destroyModule)(n),(0,o.cancelStackFilter)("forward")}}}function re(e,t,n){var a=(0,c.createMutations)(ie),o=a.callMutations,s=a.bindMutations,r=new P.ConvoAttaches(t,n),l=Q.bind(null,t,n,o),h=J.bind(null,t,n,o,e,r),m=X.bind(null,t,n,o),p=(e,n)=>{var a=t.get().peer,o=(0,v.getTab)(t,a);(0,u.showVerifiedTooltip)(n,(0,w.isBusinessNotifyTab)(o)?o.ownerId:a)},_=ee.bind(null,t,e),C=te.bind(null,t,e),f=ae.bind(null,t,e,n),b=()=>o().showSettings(t),S=n=>{var a=t.get().peer;E.Ranges.isContactId(a)&&((0,I.mount)(t,a,e),(0,i.cancelEvent)(n)),!(0,L.gpeByClass)("im-page--chat-header_chat",n.target,e)||(0,L.gpeByClass)("im-page--chat-header_vkcomgroup",n.target,e)||(0,i.checkEvent)(n)||(b(),(0,i.cancelEvent)(n))},T=()=>function(e,t){var n=()=>{t&&(t.classList.remove(H),t.removeEventListener("mouseleave",n))};t&&(t.classList.add(H),t.addEventListener("mouseleave",n)),e.get().longpoll.abortWaiting()}(t,e),y=(0,c.createModule)({handlers:(n,a)=>{a(e,"click",B,l),a(e,"click","_im_action",h),a(e,"click",u.DESELECT_ALL_CLASS,m),a(e,"mouseover",F,p),a(e,"mouseover",O,_),a(e,"mouseover",B,C),a(e,"click",O,f),a(e,"click","_im_header_link",S),a(e,"click","_im_page_peer_name",S),a(e,"click","_im_chat_members",b),a(e,"click","_im_page_reconnect",T),a(e,"click","_im_page_back",(e=>{(0,i.checkEvent)(e)||(t.get().longpoll.push([(0,g.resetPeer)()]),(0,i.cancelEvent)(e))}))}});return E.Ranges.isZeroOwner(t.get().peer)||setTimeout((()=>{t.set(d.setActions).then(o().changeActions)})),s(e,n,y,o)}},553995:(e,t,n)=>{"use strict";n.d(t,{mount:()=>u});var a=n(785893),o=(n(667294),n(610124)),s=n(973935),i=n(336022),r=n(287285);function l(e,t,n){var o=c();if(o){var l=t-19e8;s.render((0,a.jsx)(i.ContactPopup,{store:e,onClose:n.closeContactPopup,getContactInfo:()=>function(e,t){return(0,r.checkContactListLoaded)(e).then((e=>{var n=function(e,t){var n=e.get().contactsList;return n?n.find((e=>e.id===t)):null}(e,t);return Promise.resolve(n)}))}(e,l)}),o)}}function c(){return document.getElementById("ContactPopup")}function d(e,t){return{unmount:()=>function(e,t){var n=c();n&&s.unmountComponentAtNode(n),(0,o.destroyModule)(e)}(e),closeContactPopup(){var e=c();s.unmountComponentAtNode(e)}}}function u(e,t,n,a){var s=(0,(0,o.createMutations)(d).bindMutations)((0,o.createModule)({handlers:(e,t)=>{}}),e);return l(e,t,s),s}},734209:(e,t,n)=>{"use strict";n.d(t,{mount:()=>_});var a,o=n(785893),s=n(610124),i=n(873589),r=n(501389),l=(n(667294),n(973935)),c=n(125672),d=n(775349),u=n(384032),h=n(146143);function g(){a&&a.hide()}function v(){a&&a.updateBoxCoords()}function m(){return document.querySelector("#MessageForward")}function p(e){var t=document.querySelector("#box_layer_wrap"),n=document.querySelector("#box_loader"),a=(0,i.isVisible)(t);return{unmount(){var t=m();t&&l.unmountComponentAtNode(t),(0,s.destroyModule)(e)},showLoader(){(0,r.boxRefreshCoords)(n),(0,i.show)(n),a||(0,i.show)(t)},hideLoader(){(0,i.hide)(n),a||(0,i.hide)(t)}}}function _(e,t,n){var i=(0,(0,s.createMutations)(p).bindMutations)((0,s.createModule)({handlers:(e,t)=>{}})),r={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow(){!function(e){var t=m();t&&l.render((0,o.jsx)(c.default,{value:e,children:(0,o.jsx)(d.MessageForward,{closePopup:g,updatePopup:v})}),t)}(t),requestAnimationFrame((()=>a.updateBoxCoords()))},onHideAttempt:()=>(t.set(u.prepareForward.bind(null,null)),t.set(u.cleanSelected),i.unmount(),!0)};return i.showLoader(),Promise.resolve().then((e=>{i.hideLoader(),a=new h.MessageBox(r).content('<div id="MessageForward"></div>').show()})),i}},957680:(e,t,n)=>{"use strict";n.d(t,{ChatCreation:()=>S});var a,o=n(785893),s=n(667294),i=n(70162),r=n(792110),l=n(790422),c=n(110188),d=n(385211),u=n(623481),h=n(150382),g=n(288420),v=n(476288),m=n(179203),p=n(712439),_=n(511492),C=n(917791),f=n(826542),b=n(287285),I=n(923876),w=n(827749);!function(e){e[e.LOADING=0]="LOADING",e[e.LIST=1]="LIST",e[e.SETTINGS=2]="SETTINGS",e[e.PHOTO=3]="PHOTO",e[e.ERROR=4]="ERROR"}(a||(a={}));const S=({store:e,uploadAvatar:t,onClose:n,onBack:S,onCreateChat:L,onGoToConvo:T,preselectedUsers:y})=>{const[k,A]=(0,s.useState)([]),[x,M]=(0,s.useState)(a.LOADING),[j,P]=(0,s.useState)(0),[E,R]=(0,s.useState)(""),[N,O]=(0,s.useState)(""),[B,F]=(0,s.useState)(void 0),[D,H]=(0,s.useState)(y?new Map(y.map((e=>[e.id,(0,d.getTokenFromUserItem)(e)]))):new Map);(0,s.useEffect)((()=>{(function(e){return(0,p.unpackStore)(e).hintsTree.then((t=>{const n=t.list.map((([e,t,n])=>({id:+e,peerId:+e,name:t,photo:n})));return function(e,t){return(0,b.checkContactListLoaded)(e).then((e=>{const n=e.get().contactsList.filter((e=>!e.user)).sort(((e,t)=>e.id<t.id?1:-1)).map((e=>({id:(0,I.getContactPeerId)(e.id),peerId:(0,I.getContactPeerId)(e.id),name:e.name,photo:e.photo||""}))),a=n.splice(0,n.length<3?n.length:3);return[...t.slice(0,4),...a,...t.slice(4),...n]}))}(e,n)}))})(e).then((e=>{if(y){const t=y.reduce(((e,t)=>(e[t.peerId]=!0,e)),{}),n=y.concat(e.filter((e=>!t[e.peerId])));A(n)}else A(e)})).then((()=>M(a.LIST))).catch((()=>{M(a.ERROR)}))}),[]);const U=(0,_.debouncedPromise)(C.searchHints,300),q=(t,n)=>U(t,n,f.HintsSearchType.FRIENDS_AND_CONTACTS,{},e.get()),G=()=>{const t=Array.from(D.keys()),n=B||void 0;return e.set((e=>(0,m.createChatAction)(e,n,t,E,j))).then((e=>{const t=e.get().next_peer;L(t),(0,w.collectChatCreateStats)(t,"create_chat__create_new")}))},V=()=>{M(a.PHOTO),t().then((e=>{if(e.photo&&e.photoData){const{photo:t,photoData:n}=e;O(t),F(n)}else F(void 0);M(a.LIST)})).catch((()=>{M(a.ERROR)}))},z=()=>{O(""),F(void 0)};switch(x){case a.SETTINGS:return(0,o.jsx)(l.ChatCreationModal,Object.assign({title:i.getLang("mail_chat_creation_settings"),onClose:n,onBack:()=>M(a.LIST)},{children:(0,o.jsx)(c.ChatSettingsContainer,{flags:j,setFlags:P,onClose:()=>M(a.LIST)},void 0)}),void 0);case a.LIST:return(0,o.jsxs)(l.ChatCreationModal,Object.assign({title:i.getLang("mail_im_create_chat"),onBack:S,onClose:n},{children:[(0,o.jsx)(d.UsersListContainer,{usersList:k,selectedMap:D,setSelectedMap:H,onServerSearch:q},void 0),(0,o.jsx)(u.ConvoInfoContainer,{title:E,photo:N,selectedUserIds:Array.from(D.keys()),onTitleChange:R,onShowSettings:()=>M(a.SETTINGS),onCreateChat:G,onUploadAvatar:V,onRemoveAvatar:z,onGoToConvo:T},void 0)]}),void 0);case a.ERROR:return(0,o.jsxs)(l.ChatCreationModal,Object.assign({title:i.getLang("global_error"),onClose:n},{children:[(0,o.jsx)(v.ModalBody,{children:(0,o.jsx)("p",{children:i.getLang("global_error")},void 0)},void 0),(0,o.jsx)(h.ModalFooter,{actionButtons:(0,o.jsx)(g.default,Object.assign({onClick:n},{children:i.getLang("global_close")}),void 0)},void 0)]}),void 0);case a.LOADING:return(0,o.jsx)(r.default,{},void 0);case a.PHOTO:return(0,o.jsx)(o.Fragment,{},void 0)}}},523928:(e,t,n)=>{"use strict";n.d(t,{ChatCreationInfo:()=>d});var a=n(785893),o=n(461311),s=n(897404),i=n(811226),r=n(118690),l=n(70162),c=n(125396);const d=({onChangeTitle:e,onResetTitle:t,onShowSettings:n,onButtonClickHandler:d,title:u,photo:h,loading:g,onUploadAvatar:v,onRemoveAvatar:m,isButtonDisabled:p,buttonText:_})=>(0,a.jsxs)("div",Object.assign({className:"ChatCreationInfo"},{children:[(0,a.jsxs)("div",Object.assign({className:"ChatCreationInfo__avatarWrapper"},{children:[(0,a.jsx)(o.default,{photo:h,title:u,className:"ChatCreationInfo__avatar",onClick:v},void 0),h&&(0,a.jsx)(s.default,Object.assign({text:l.getLang("mail_settings_remove_photo"),position:"t",align:"left"},{children:(0,a.jsx)("button",{onClick:m,className:"ChatCreationInfo__avatarRemove"},void 0)}),void 0)]}),void 0),(0,a.jsx)(i.default,{className:"ChatCreationInfo__titleInput",isControlledOutside:!0,value:u,onChange:t=>e(t.target.value),onCancel:t,placeholder:l.getLang("mail_im_chat_title_intro")},void 0),(0,a.jsx)(s.default,Object.assign({text:l.getLang("mail_chat_creation_settings_icon_tooltip"),position:"t"},{children:(0,a.jsx)("button",Object.assign({className:"ChatCreationInfo__settings",onClick:n,"aria-label":l.getLang("mail_chat_creation_settings_icon_tooltip")},{children:(0,a.jsx)(c.default,{},void 0)}),void 0)}),void 0),(0,a.jsx)(r.default,Object.assign({disabled:p,loading:g,onClick:d},{children:_}),void 0)]}),void 0)},790422:(e,t,n)=>{"use strict";n.d(t,{ChatCreationModal:()=>r});var a=n(785893),o=n(359284),s=n(743927),i=n(70162);const r=({children:e,title:t,onClose:n,onBack:r})=>(0,a.jsxs)(o.default,Object.assign({onClose:n,disableBodyScroll:!0,className:"ChatCreationModal"},{children:[(0,a.jsx)(s.ModalHeader,{title:t,onClose:n,backText:r?i.getLang("global_back"):void 0,onBack:r},void 0),(0,a.jsx)("div",Object.assign({className:"ChatCreationModal__content"},{children:e}),void 0)]}),void 0)},270800:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserRow:()=>c});var a=n(785893),o=n(652997),s=n(787255),i=n(814210),r=n(661711),l=n(406042);const c=({data:e,onSelect:t,isSelected:n})=>{const c=e.photo?e.photo:(0,a.jsx)(l.ConversationNoPhoto,{id:e.peerId,text:(0,r.getUserInitials)(e.name),size:"34",specificType:7},void 0);return(0,a.jsx)(s.default,Object.assign({"data-id":e.peerId,onClick:()=>t(e.peerId),selectable:!0,aside:(0,a.jsx)(i.ListMultiSelectControl,{isSelected:n},void 0)},{children:(0,a.jsx)(o.default,{"data-id":e.peerId,size:"34",title:e.name,photo:c},void 0)}),void 0)}},182747:(e,t,n)=>{"use strict";n.d(t,{ChatCreationUserList:()=>i});var a=n(785893),o=n(675077),s=n(70162);const i=({usersList:e,onRemoveToken:t,onChange:n,onSelect:i,renderSuggest:r,tokens:l,query:c})=>(0,a.jsx)(o.default,{className:"ChatCreationUserList",tokens:l,removeTokenPlaceholder:s.getLang("mail_create_chat_remove_user"),onRemoveToken:t,placeholder:s.getLang("mail_search_creation"),value:c,onChange:n,onSelect:i,useInfiniteScroll:!0,hasMore:!1,virtualized:!0,loadMore:()=>{},notFoundText:s.getLang("mail_no_users_found"),autoFocus:!0,isSearching:!1,renderSuggest:r,data:e},void 0)},110188:(e,t,n)=>{"use strict";n.d(t,{ChatSettingsContainer:()=>s});var a=n(785893),o=n(136256);const s=({setFlags:e,flags:t,onClose:n})=>(0,a.jsx)(o.ChatSettingsOptions,{flags:t,back:n,isChatCreation:!0,onSave:t=>(e(t),Promise.resolve()),afterSave:n,onCancel:n},void 0)},623481:(e,t,n)=>{"use strict";n.d(t,{ConvoInfoContainer:()=>r});var a=n(785893),o=n(523928),s=n(667294),i=n(70162);const r=({title:e,photo:t,selectedUserIds:n,onShowSettings:r,onTitleChange:c,onCreateChat:d,onUploadAvatar:u,onRemoveAvatar:h,onGoToConvo:g})=>{const[v,m]=(0,s.useState)(!1),[p,_]=(0,s.useState)(!l(e)),C=1===n.length&&!p&&!t,f=0!==n.length||p,b=(0,s.useCallback)((e=>{_(!l(e)),c(e)}),[]),I=!C&&!f,w=C?i.getLang("mail_im_go_to_dialog"):i.getLang("mail_im_create_chat");return(0,a.jsx)(o.ChatCreationInfo,{title:e,onResetTitle:()=>b(""),onChangeTitle:b,photo:t,onShowSettings:r,onButtonClickHandler:()=>{if(!v)if(m(!0),C){const[e]=n;g(+e)}else d().catch((()=>{m(!1)}))},loading:v,isButtonDisabled:I,onUploadAvatar:u,onRemoveAvatar:h,buttonText:w},void 0)};function l(e){return!e.trim().replace("\n","")}},385211:(e,t,n)=>{"use strict";n.d(t,{UsersListContainer:()=>c,getTokenFromUserItem:()=>u});var a=n(785893),o=n(667294),s=n(182747),i=n(270800),r=n(203524),l=n(659397);const c=({usersList:e,selectedMap:t,setSelectedMap:n,onServerSearch:l})=>{const[c,h]=(0,o.useState)(""),[g,v]=(0,o.useState)(e.map((e=>e.peerId))),m=(0,o.useRef)(d(e)),p=(0,o.useCallback)((e=>e.name),[]),_=(0,o.useCallback)((e=>e.peerId),[]),C=(0,r.useIndexer)(Array.from(m.current.values()),p,_),f=(0,o.useMemo)((()=>Array.from(m.current.keys())),[m.current]),b=(0,o.useCallback)(((e,t)=>l(e,t)),[l]);(0,o.useEffect)((()=>{const e=C.search(c).map((e=>e.peerId));v(e),b(c,e).then((t=>{if(0!==c.length){const n=[],a=[];t.forEach((e=>{m.current.has(e.peerId)||(a.push(e.peerId),n.push(function(e){return{id:e.peerId,peerId:e.peerId,name:e.name,photo:e.photo}}(e)))})),n.length&&(!function(e,t){const n=d(t);e.current=new Map([...Array.from(e.current.entries()),...Array.from(n.entries())])}(m,n),v([...e,...a]))}})).catch((()=>{}))}),[c]);const I=e=>{t.delete(e),n((()=>new Map(t)))},w=e=>{t.has(e)?I(e):((e=>{const a=m.current.get(e);a&&(t.set(e,u(a)),n((()=>new Map(t))))})(e),h(""))},S=(0,o.useCallback)((e=>{I(+e)}),[t]),L=(0,o.useCallback)((e=>{h(e.target.value)}),[c]),T=Array.from(t.values());return(0,a.jsx)(s.ChatCreationUserList,{query:c,tokens:T,usersList:c?g:f,onSelect:w,onChange:L,onRemoveToken:S,renderSuggest:e=>{const n=m.current.get(e);return n?(0,a.jsx)(i.ChatCreationUserRow,{data:n,onSelect:w,isSelected:t.has(e)},e):(0,a.jsx)(a.Fragment,{},void 0)}},void 0)};function d(e){return e.reduce(((e,t)=>(t.name=(0,l.decodeHTMLEntities)(t.name),e.set(t.id,t))),new Map)}function u(e){return{id:e.id.toString(),text:e.name}}},336022:(e,t,n)=>{"use strict";n.d(t,{ContactPopup:()=>u});var a=n(785893),o=n(667294),s=n(359284),i=n(781402),r=n(80291),l=n(792110),c=n(70162),d=n(67328);const u=({getContactInfo:e,onClose:t})=>{const[n,u]=(0,o.useState)({kind:"loading"});switch((0,o.useEffect)((()=>{const n=e=>{(0,d.showErrorBox)(e),u({kind:"failed"}),t()};e().then((e=>{e?u({kind:"loaded",contact:e}):n(c.getLang("mail_contact_was_removed"))})).catch((()=>{n(c.getLang("global_error"))}))}),[]),n.kind){case"failed":return(0,a.jsx)(a.Fragment,{},void 0);case"loading":return(0,a.jsx)(l.default,{},void 0);case"loaded":return(0,a.jsxs)(s.default,Object.assign({onClose:t,className:"ContactPopup"},{children:[(0,a.jsx)(i.default.Header,{title:c.getLang("mail_contact"),onClose:t},void 0),(0,a.jsx)(r.ContactPopupContent,{contact:n.contact},void 0)]}),void 0)}}},387765:(e,t,n)=>{"use strict";n.d(t,{ContactIconRow:()=>d});var a=n(785893),o=n(6057),s=n(927384),i=n(265187),r=n(601931),l=n(282725);const c=e=>{switch(e){case"phone":return(0,a.jsx)(o.default,{},void 0);case"mail":return(0,a.jsx)(s.default,{},void 0);case"calendar":return(0,a.jsx)(i.default,{},void 0);case"location":return(0,a.jsx)(r.default,{},void 0);case"sync":return(0,a.jsx)(l.default,{},void 0)}},d=({icon:e,children:t})=>(0,a.jsxs)("div",Object.assign({className:"ContactIconRow"},{children:[(0,a.jsx)("div",Object.assign({className:"ContactIconRow__icon"},{children:c(e)}),void 0),(0,a.jsx)("div",Object.assign({className:"ContactIconRow__text"},{children:t}),void 0)]}),void 0)},80291:(e,t,n)=>{"use strict";n.d(t,{ContactPopupContent:()=>d});var a=n(785893),o=n(661711),s=n(387765),i=n(406042),r=n(938767),l=n(70162),c=n(923876);const d=({contact:e})=>{const t=(0,c.getContactPeerId)(e.id);return(0,a.jsxs)("div",Object.assign({className:"ContactPopupContent"},{children:[(0,a.jsxs)("header",Object.assign({className:"ContactPopupContent__header"},{children:[(0,a.jsx)("div",Object.assign({className:"ContactPopupContent__photo"},{children:e.photo?(0,a.jsx)("img",{className:"ContactPopupContent__contactAvatarImage",src:e.photo,alt:e.name},void 0):(0,a.jsx)(i.ConversationNoPhoto,{text:(0,o.getUserInitials)(e.name),size:"80",id:t,specificType:7},e.id)}),void 0),(0,a.jsx)("h3",Object.assign({className:"ContactPopupContent__title"},{children:(0,a.jsx)(r.InnerHTML,{children:(0,o.prepareContactName)(e.name)},void 0)}),void 0),(0,a.jsx)("div",Object.assign({className:"ContactPopupContent__meta"},{children:l.getLang("mail_from_contacts_list")}),void 0)]}),void 0),(0,a.jsxs)("div",Object.assign({className:"ContactPopupContent__info"},{children:[e.main_phone&&(0,a.jsx)(s.ContactIconRow,Object.assign({icon:"phone"},{children:(0,o.formatPhoneNumber)(e.main_phone)}),void 0),e.emails[0]&&(0,a.jsx)(s.ContactIconRow,Object.assign({icon:"mail"},{children:(0,a.jsx)("a",Object.assign({href:`mailto:${e.emails[0]}`},{children:e.emails[0]}),void 0)}),void 0)]}),void 0),e.sync_date&&(0,a.jsx)("div",Object.assign({className:"ContactPopupContent__info"},{children:(0,a.jsx)(s.ContactIconRow,Object.assign({icon:"sync"},{children:e.sync_date}),void 0)}),void 0)]}),void 0)}},413374:(e,t,n)=>{"use strict";n.d(t,{convoPickerMode:()=>a,ConvoPicker:()=>b});var a,o=n(570655),s=n(785893),i=n(667294),r=n(973935),l=n(483295),c=n(878517),d=n(841118),u=n(740733),h=n(468916),g=n(891326),v=n(70162),m=n(61580),p=n(661711),_=n(787255),C=n(239132),f=n(145072);!function(e){e.DEFAULT="default",e.RADIO="radio"}(a||(a={}));const b=e=>{var{searchValue:t="",isLoading:n=!1,convos:f,mode:b=a.DEFAULT,selectedConvos:w=[],checkDisabled:S,onSearchValueChange:L,onSearchInputKeydown:T,onConvoSelect:y,onListLoadMore:k=(()=>{}),onAddClick:A,searchInputGetter:x,className:M,style:j}=e,P=(0,o.__rest)(e,["searchValue","isLoading","convos","mode","selectedConvos","checkDisabled","onSearchValueChange","onSearchInputKeydown","onConvoSelect","onListLoadMore","onAddClick","searchInputGetter","className","style"]);const E=(0,l.classNames)("ConvoPicker",M),R=(0,i.createRef)();let N;const[O,B]=(0,i.useState)(0),F=e=>{const t=Math.max(e-1,0);return S&&S(f[t])?F(t):t},D=e=>{const t=Math.min(e+1,f.length-1);return S&&S(f[t])?D(t):t},H=e=>{e!==O&&(B(e),(e=>{if(!N)return;const t=f[e].peerId,n=N.querySelector(`[data-id="${t}"]`);if(!(n&&n instanceof HTMLElement))return;const a=n.offsetTop,o=N.scrollTop;if(a<o)N.scrollTop=a;else{const e=N.offsetHeight,t=a+n.offsetHeight;t>o+e&&(N.scrollTop=t-e)}})(e))};(0,i.useEffect)((()=>{x&&R.current&&x(R.current.element)}),[]);const U=!!A&&!t,q=(U?[(0,s.jsx)(_.default,Object.assign({selectable:!1,"data-id":0},{children:(0,s.jsx)(C.ListAddControl,Object.assign({onClick:A,size:34},{children:v.getLang("mail_new_convo_from_invite")}),void 0)}),"add")]:[]).concat(f.map(((e,t)=>{const{peerId:n,photo:a,name:o,online:i}=e,r=!!S&&S(e);return(0,s.jsx)(m.ConvoPickerRow,{"data-id":n,peerId:n,photo:a,name:o,online:i,memberCount:(0,p.getChatMemberCount)(e),mode:b,isCasper:I(e),isSelected:w.includes(n),isActive:t===O,isDisabled:r,onClick:()=>{r||y(n)},onMouseEnter:()=>B(r?-1:t)},n)})));return(0,s.jsxs)("div",Object.assign({className:E,onMouseLeave:()=>B(-1),style:j},P,{children:[(0,s.jsx)(c.BlockSearchInput,{value:t,onChange:L,onKeyDown:e=>{switch(e.which||e.keyCode){case g.ARROW_UP:H(F(O)),e.preventDefault();break;case g.ARROW_DOWN:H(D(O)),e.preventDefault();break;case g.ENTER:y(f[O].peerId),e.preventDefault()}T(e)},placeholder:v.getLang("mail_top_search"),autoFocus:!0,ref:R},"search"),n&&(0,s.jsx)(d.default,Object.assign({className:"ConvoPicker__stub"},{children:(0,s.jsx)(u.default,{},void 0)}),"loading"),!n&&t&&0===f.length&&(0,s.jsx)(d.default,Object.assign({className:"ConvoPicker__stub"},{children:v.getLang("mail_im_search_empty_chats")}),"no-results"),!n&&(f.length>0||U)&&(0,s.jsx)(h.default,Object.assign({virtualized:!0,className:"ConvoPicker__results",loadMore:k,hasMore:!1,ref:e=>{const t=r.findDOMNode(e);t&&t instanceof HTMLElement&&(N=t)}},{children:q}),"results")]}),void 0)};function I(e){var t;const n=null===(t=e.data)||void 0===t?void 0:t.flags;return!!n&&(n&f.MAIL_CHAT_FLAG_IS_CASPER)>0}},61580:(e,t,n)=>{"use strict";n.d(t,{ConvoPickerRow:()=>m});var a=n(570655),o=n(785893),s=n(483295),i=n(787255),r=n(652997),l=n(661711),c=n(413374),d=n(293223),u=n(406042),h=n(461311),g=n(840060),v=n(844142);const m=e=>{var{peerId:t,name:n,photo:m,online:p,memberCount:_,mode:C=c.convoPickerMode.DEFAULT,isSelected:f,isDisabled:b,isActive:I,isCasper:w,className:S}=e,L=(0,a.__rest)(e,["peerId","name","photo","online","memberCount","mode","isSelected","isDisabled","isActive","isCasper","className"]);const T=function(e,t,n,a=0){const s=v.Ranges.isContactId(e);switch(!0){case Array.isArray(n):return(0,o.jsx)(d.default,{photos:n},void 0);case s:return(0,o.jsx)(u.ConversationNoPhoto,{id:e,text:(0,l.getUserInitials)(t),size:"34",specificType:7},void 0);default:return(0,o.jsx)(h.default,{isOnline:!!a,isMobile:!!g.mobPlatforms[a],title:t,photo:n,onlineSize:"s"},void 0)}}(t,n,m,p),y=w?`<span class="ConvoPickerRow__itemTitle ConvoPickerRow__itemTitle--casper">\n        <span class="ConvoPickerRow__itemTitleText">\n          ${n}\n        </span>\n      </span>`:n,k=C===c.convoPickerMode.RADIO?(0,o.jsx)("span",{className:(0,s.classNames)("ConvoPickerRow__radio",{"ConvoPickerRow__radio--selected":f})},void 0):void 0,A=(0,s.classNames)("ConvoPickerRow",S,{"ConvoPickerRow--disabled":b});return(0,o.jsx)(i.default,Object.assign({active:I,selectable:!b,canBeHovered:!1,chevron:C===c.convoPickerMode.DEFAULT&&!b,aside:k,className:A},L,{children:(0,o.jsx)(r.default,{ignoreDecodeHTML:!0,size:"34",title:(0,o.jsx)("span",{dangerouslySetInnerHTML:{__html:y}},void 0),photo:T,description:_,className:"ConvoPickerRow__itemContent"},void 0)}),void 0)}},195477:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteContainer:()=>A});var a,o=n(785893),s=n(667294),i=n(327012),r=n(150382),l=n(451865),c=n(413374),d=n(179203),u=n(672385),h=n(459554),g=n(146143),v=n(70162),m=n(792110),p=n(917791),_=n(608021),C=n(475234),f=n(407381),b=n(608490),I=n(810890),w=n(923876),S=n(826542),L=n(957680),T=n(62839),y=n(827749),k=n(844142);!function(e){e[e.PICKER=0]="PICKER",e[e.CREATION=1]="CREATION"}(a||(a={}));const A=({user:e,store:t,onClose:n,onInviteSent:A,onGoToConvo:x})=>{const[M,j]=(0,s.useState)(a.PICKER),[P,E]=(0,s.useState)(!function(e){var t;const n=e.get(),a=n.chatList||(null===(t=n.dialog_tabs)||void 0===t?void 0:t.all);return Boolean(a&&a.length>0)}(t)),[R,N]=(0,s.useState)(!0),[O,B]=(0,s.useState)(!1),[F,D]=(0,s.useState)(function(e){var t;const n=e.get(),a=n.chatList||((null===(t=n.dialog_tabs)||void 0===t?void 0:t.all)||[]).filter(k.Ranges.isChatOrChannelPeer);if(a&&a.length>0)return a.map((t=>(0,h.getTab)(e,t)));return[]}(t)),[H,U]=(0,s.useState)(""),q=(0,s.useCallback)((e=>{U(e.target.value)}),[H]),G=(0,s.useCallback)((()=>{}),[]),V=(0,s.useRef)(null),[z,K]=(0,b.useHints)(t,F,H,{queryType:S.HintsSearchType.ALL,filterFn:e=>k.Ranges.isChatOrChannelPeer(e.peerId)});(0,s.useEffect)((()=>((0,p.loadConversations)(t.get(),u.ConvoFilters.CHATS,200).then((e=>{const t=e.items;return D((0,w.mergeConvoLists)(F,t)),t})).then((e=>{const n=e.reduce(((e,t)=>(e[t.peerId]=t,e)),{});return t.set((t=>(0,f.mergeTabs)(t,n).then((t=>(0,C.setChatList)(t,e.map((e=>e.peerId)))))))})).finally((()=>E(!1))),(0,I.cancelStackPush)("convo_invite",(()=>{})),()=>{setTimeout((()=>(0,I.cancelStackFilter)("convo_invite")),0)})),[]);const $=e.inv_name?(0,_.langStr)((0,_.langSex)(e.sex,v.getLang("mail_im_invite_user","raw")),"user",e.inv_name):v.getLang("mail_convo_invite_title");return(0,o.jsxs)(o.Fragment,{children:[M===a.PICKER&&(0,o.jsx)(i.UserConvoInviteModal,Object.assign({title:$,onCloseModal:n,footer:(0,o.jsx)(r.ModalFooter,{children:(0,o.jsx)(l.default,Object.assign({checked:R,onChange:(e,t)=>N(t)},{children:v.getLang("mail_im_chat_add_members_show_history")}),void 0)},void 0)},{children:(0,o.jsx)(c.ConvoPicker,{convos:z.map((e=>(0,h.getTab)(t,e.peerId)||e)),searchValue:H,onSearchValueChange:q,onSearchInputKeydown:G,onConvoSelect:a=>{B(!0),Promise.resolve().then((()=>t.set((t=>(0,d.addNewMember)(a,[e.id],R,t))))).then((()=>A(a))).then((()=>{n(),B(!1)})).catch((e=>{B(!1),(0,g.showFastBox)(v.getLang("global_error"),e)}))},checkDisabled:e=>!e.canInvite,searchInputGetter:e=>V.current=e,isLoading:P||K&&0===z.length,style:{height:410},onAddClick:()=>j(a.CREATION)},void 0)}),void 0),M===a.CREATION&&(0,o.jsx)(L.ChatCreation,{store:t,uploadAvatar:T.uploadConvoPhoto,onClose:n,onBack:()=>j(a.PICKER),onCreateChat:e=>{A(e).then((()=>{}),(()=>{})),n(),(0,y.collectChatCreateStats)(e,"create_chat__create_invite")},onGoToConvo:e=>{x(e),n()},preselectedUsers:[{id:e.id,peerId:e.id,name:e.name,photo:e.photo}]},void 0),O&&(0,o.jsx)(m.default,{},void 0)]},void 0)}},327012:(e,t,n)=>{"use strict";n.d(t,{UserConvoInviteModal:()=>r});var a=n(785893),o=n(359284),s=n(70162),i=n(743927);const r=({title:e,onCloseModal:t,footer:n,isWithBackButton:r=!1,onBackClick:l,children:c})=>(0,a.jsxs)(o.default,Object.assign({className:"UserConvoInviteModal",disableBodyScroll:!0,onClose:t},{children:[(0,a.jsx)(i.ModalHeader,{title:e,onClose:t,backText:r?s.getLang("global_back"):void 0,onBack:l,className:"UserConvoInviteModal__header"},void 0),(0,a.jsx)("div",Object.assign({className:"UserConvoInviteModal__content"},{children:c}),void 0),n]}),void 0)},614413:(e,t,n)=>{"use strict";n.d(t,{mount:()=>c});var a=n(785893),o=n(610124),s=n(973935),i=n(195477);function r(){const e="_im_user_convo_invite",t=document.getElementById(e);if(t)return t;const n=document.createElement("section");return n.setAttribute("id",e),document.body.appendChild(n),n}function l(e){return{unmount:()=>{const t=r();t&&s.unmountComponentAtNode(t),(0,o.destroyModule)(e)}}}function c(e,t,n,c){const{bindMutations:d}=(0,o.createMutations)(l),u=d((0,o.createModule)({handlers:()=>{}}));return function(e,t,n,o,l){const c=r();s.render((0,a.jsx)(i.UserConvoInviteContainer,{user:n,store:e,onClose:t.unmount,onInviteSent:o,onGoToConvo:l},void 0),c)}(e,u,t,n,c),u}},57757:(e,t,n)=>{"use strict";n.d(t,{handleUiActionForPeer:()=>x});var a=n(179288),o=n(661711),s=n(384032),i=n(274642),r=n(645523),l=n(70162),c=n(146143),d=n(917791),u=n(67328),h=n(827749),g=n(309756),v=n(222131),m=n(606542),p=n(614413),_=n(955647),C=n(993421),f=n(342269),b=n(897449),I=n(240367),w=n(407381),S=n(501389),L=n(459554),T=n(663825),y=n(712860),k=n(506770),A=n(186699);function x(e,t,n,x,M,j,P=(e=>console.error("im_ui_action",{error:e},!1))){var E,R,N,O,B,F,D,H,U;switch(x){case a.ConvoAction.CLEAR:{const n=(0,L.getTab)(e,M);let a=(0,o.showFlushChat)(n,M,(()=>{(0,o.cleanHistory)(e,a,t,s.flushHistory,M)}));break}case a.ConvoAction.MEDIA:(0,k.partConfigEnabled)("me_fc_attaches_new_modal")?j.show(M):(0,i.showWiki)({w:"history"+(0,o.convertPeerToUrl)(M)+"_photo"},null,{});break;case a.ConvoAction.CALL_AUDIO:case a.ConvoAction.CALL_VIDEO:(0,o.isCallToPeerAvailable)(e,M)&&(0,o.startCallFromIm)(e,M,x===a.ConvoAction.CALL_VIDEO,[],o.CALL_ENTRY_POINT_HEADER);break;case a.ConvoAction.CALL_APP:(0,o.isCallToPeerAvailable)(e,M)&&(null===(E=window.Calls)||void 0===E?void 0:E.showStartCallModal)&&(0,o.startCallFromIm)(e,M,!1,[],o.CALL_ENTRY_POINT_HEADER,!0);break;case a.ConvoAction.CALL_BY_NAME:(0,o.isCallToPeerAvailable)(e,M)&&(null===(R=window.Calls)||void 0===R?void 0:R.showCallByNamePopup)&&(0,o.startCallFromIm)(e,M,!1,[],o.CALL_ENTRY_POINT_HEADER,!1,!0);break;case a.ConvoAction.SEARCH:null===(O=(N=t()).showSearch)||void 0===O||O.call(N,e);break;case a.ConvoAction.ADD_FRIEND:{const n=e.get().tabs[M],a=(0,m.oCacheGet)(e,M);if(!n||!a)return;const o={type:"done_box",text:n.is_subscribed_to_me?l.getLang("mail_im_friend_added").replace("{name}",a.first_name_gen):(0,l.langSex)(a.sex,l.getLang("mail_im_friend_request_sent","raw")).replace("{name}",a.first_name)};e.set((e=>(0,y.setPeerSubscribedStatus)(M,!1,e))).then((()=>e.set(w.setActions))).then((()=>{var n,a,s,i;(0,g.showNotification)(o),null===(a=(n=t()).updateState)||void 0===a||a.call(n,M,e),null===(i=(s=t()).updateActions)||void 0===i||i.call(s,e)})).catch(P);break}case a.ConvoAction.BLOCK_NOTIFY:case a.ConvoAction.BLOCK_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!1,M)).then((()=>{var t,n;null===(n=null===(t=e.get())||void 0===t?void 0:t.longpoll)||void 0===n||n.push([(0,r.resetPeer)()]),(0,S.showDoneBox)(l.getLang("mail_community_was_blocked"))})).catch(P);break;case a.ConvoAction.ALLOW_COMMUNITY:e.set(s.toggleCommunityMessages.bind(null,!0,M)).then((()=>{var t,a;return null===(a=(t=n()).changeActions)||void 0===a?void 0:a.call(t,e)})).catch(P);break;case a.ConvoAction.BLOCK:(0,o.showBlacklistBox)(M,e).once("success",(t=>{var n,a;t.delta&&((0,S.showDoneBox)(t.msg),null===(a=null===(n=e.get())||void 0===n?void 0:n.longpoll)||void 0===a||a.push([(0,r.resetPeer)()]))}));break;case a.ConvoAction.UNBLOCK_USER:e.set((e=>(0,y.setPeerBanStatus)(M,!0,e))).then((()=>e.set(w.setActions))).then((()=>{var n,a,o,s;(0,S.showDoneBox)(l.getLang("mail_peer_was_unblocked")),null===(a=(n=t()).updateState)||void 0===a||a.call(n,M,e),null===(s=(o=t()).updateActions)||void 0===s||s.call(o,e)})).catch(P);break;case a.ConvoAction.BLOCK_USER:{const n=(0,c.showFastBox)(l.getLang("mail_blacklist_confirm"),l.getLang("mail_blacklist_message"),l.getLang("box_yes"),(function(){n.hide(),e.set((e=>(0,y.setPeerBanStatus)(M,!1,e))).then((()=>e.set(w.setActions))).then((()=>{var n,a,o,s;(0,S.showDoneBox)(l.getLang("mail_peer_was_blocked")),null===(a=(n=t()).updateState)||void 0===a||a.call(n,M,e),null===(s=(o=t()).updateActions)||void 0===s||s.call(o,e)})).catch(P)}),l.getLang("box_no"));break}case a.ConvoAction.REPORT_USER:if(window.cur.viewAsBox)return void window.cur.viewAsBox();(0,A.showReportForm)("user",M,0);break;case a.ConvoAction.LEAVE:{const n=(0,o.showLeaveDialog)(e,M,(a=>{var i,l;const c=e.set(s.leaveChat.bind(null,M)).then((()=>e.set(s.unpinMessageOptimistic.bind(null,M))));a&&c.then((()=>(0,o.cleanHistory)(e,n,t,s.flushHistory,M,a))).catch(P),n.hide(),null===(l=null===(i=e.get())||void 0===i?void 0:i.longpoll)||void 0===l||l.push([(0,r.resetPeer)()])}));break}case a.ConvoAction.UNREAD:(0,s.markDialogUnread)(M,e.get()).catch(P);break;case a.ConvoAction.RETURN:e.set(s.returnToChat.bind(null,M)).then((e=>e.set(s.getPinnedMessage.bind(null,M)))).then(null===(B=t().updateChatTopic)||void 0===B?void 0:B.bind(null,M)).catch((e=>{(0,c.showFastBox)(l.getLang("global_error"),e),P(e)}));break;case a.ConvoAction.MUTE:case a.ConvoAction.UNMUTE:{const n=x===a.ConvoAction.MUTE;e.set((e=>(0,s.setMutedPeer)(M,n,e))).then((e=>{var n,a;return null===(a=(n=t()).updateState)||void 0===a?void 0:a.call(n,M,e)})).then((()=>e.set((e=>(0,s.toggleMutePeer)(M,n,-1,e))))).catch(P);break}case a.ConvoAction.PIN_CONVO:(0,d.pinConvoHandler)(e.get(),M).catch((e=>{(0,u.showErrorBox)(e),P(e)}));break;case a.ConvoAction.UNPIN_CONVO:(0,d.unpinConvoHandler)(e.get(),M).catch((e=>{(0,u.showErrorBox)(e),P(e)}));break;case a.ConvoAction.CHAT_INVITE:(0,o.inviteUser)(e,M,t,s.setCreationType);break;case a.ConvoAction.USER_INVITE:{const t=(0,L.getTab)(e,M);if(t&&((0,L.isUserConvo)(t)||(0,L.isContactConvo)(t))&&t.canBeAddedToChat){(0,h.collectConvoInviteStats)(h.ConvoInviteEntryPoint.DIALOG_ACTIONS,M);const n=(0,L.isContactConvo)(t)?(0,v.makeUserFromUserConvo)(t):(0,m.oCacheGet)(e,M),a=t=>{var n;return Promise.resolve(null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,r.changePeer)(t,!1,!1,!1,"convo_invite")]))},o=t=>{var n;return null===(n=e.get().longpoll)||void 0===n?void 0:n.push([(0,r.changePeer)(t,!1,!1,!1,"convo_invite")])};n&&(0,p.mount)(e,n,a,o)}break}case a.ConvoAction.CREATE_CHAT:{const n=(0,L.getTab)(e,M),a=[[M,null==n?void 0:n.tab]];e.set(s.setCreationType.bind(null,"chat",[])).then((()=>{var n,o;return null===(o=(n=t()).showCreation)||void 0===o?void 0:o.call(n,e,a)})).catch(P);break}case a.ConvoAction.PIN_HIDE:(0,_.pinnedMessageHide)(e,(0,C.getPeer)(e),t);break;case a.ConvoAction.PIN_UNHIDE:(0,_.pinnedMessageUnHide)(e,(0,C.getPeer)(e),t);break;case a.ConvoAction.UNPIN:(0,_.pinnedMessageUnpin)(e,(0,C.getPeer)(e),t);break;case a.ConvoAction.SETTINGS:null===(D=(F=n()).showSettings)||void 0===D||D.call(F,e);break;case a.ConvoAction.DISABLE_BUSINESS_NOTIFY:{const n=(0,L.getTab)(e,M),a=n&&(0,L.isChatConvo)(n)&&n.ownerId;if(!a)return;const o=new c.MessageBox({title:l.getLang("mail_business_notify_disable_box_title")}).content((0,f.getTemplate)("sImBusinessNotifyDisableBoxContent",{text:l.getLang("mail_business_notify_disable_box_text")})).addButton(l.getLang("mail_business_notify_disable_box_button"),(n=>{(0,b.lockButton)(n),e.set((e=>(0,w.setConvoBusinessNotifyEnabled)(e,M,!1))).then((()=>e.set(w.setActions))).then((()=>{var n,o,s,i;return null===(o=(n=t()).updateActions)||void 0===o||o.call(n,e),null===(i=(s=t()).updateState)||void 0===i||i.call(s,M,e),(0,I.denyMessagesFromGroup)({group_id:-a})})).then((()=>{o.hide()})).catch(P)})).show();break}case a.ConvoAction.ENABLE_BUSINESS_NOTIFY:{const n=(0,L.getTab)(e,M),a=n&&(0,L.isChatConvo)(n)&&n.ownerId;if(!a)return;e.set((e=>(0,w.setConvoBusinessNotifyEnabled)(e,M,!0))).then((()=>e.set(w.setActions))).then((()=>{var n,o,s,i;return null===(o=(n=t()).updateActions)||void 0===o||o.call(n,e),null===(i=(s=t()).updateState)||void 0===i||i.call(s,M,e),(0,I.allowMessagesFromGroup)({group_id:-a})})).catch(P);break}case a.ConvoAction.ARCHIVE:if(!(0,L.getTab)(e,M))break;e.set((e=>(0,s.updateFolderState)(M,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],T.SET_DIRECTORIES,!0,!1,(0,u.unpackStore)(e)))).then((()=>e.set(w.setActions))).then((()=>{var n,a,o,s,i,r,l,c;null===(a=(n=t()).updateActions)||void 0===a||a.call(n,e),null===(s=(o=t()).removePeer)||void 0===s||s.call(o,e,M),null===(r=(i=t()).updateFolderCounters)||void 0===r||r.call(i,e),null===(c=(l=t()).addEntityToArchiveMentionsMap)||void 0===c||c.call(l,e,M)})).then((()=>(0,I.archiveConversation)({peer_id:M}))).catch(P);break;case a.ConvoAction.UNARCHIVE:if(!(0,L.getTab)(e,M))break;e.set((e=>(0,s.updateFolderState)(M,a.FOLDER_MASKS[a.FOLDER_ARCHIVE],T.RESET_DIRECTORIES,!0,!1,(0,u.unpackStore)(e)))).then((()=>e.set(w.setActions))).then((()=>{var n,o,s,i,l,c;null===(o=(n=t()).updateActions)||void 0===o||o.call(n,e),null===(i=(s=t()).removePeer)||void 0===i||i.call(s,e,M);const d=(0,u.unpackStore)(e);d.active_tab!==a.ConvoListFolder.ARCHIVE||(null===(l=d.dialog_tabs[a.ConvoListFolder.ARCHIVE])||void 0===l?void 0:l.length)||null===(c=null==d?void 0:d.longpoll)||void 0===c||c.push([(0,r.changeTab)(a.ConvoListFolder.ALL)])})).then((()=>(0,I.unarchiveConversation)({peer_id:M}))).catch(P);break;case a.ConvoAction.CALL_FINISH:{const t=(0,L.getTab)(e,M),n=null===(H=null==t?void 0:t.callInProgress)||void 0===H?void 0:H.call_id;(null===(U=null==t?void 0:t.callInProgress)||void 0===U?void 0:U.can_finish_call)&&n&&(0,I.forceCallFinish)(n).catch(P);break}}}},203524:(e,t,n)=>{"use strict";n.d(t,{useIndexer:()=>s});var a=n(337057),o=n(667294);const s=(e,t,n)=>{const s=(0,o.useRef)(null);s.current=s.current?s.current:new a.VkIndexer(e,t);const i=s.current,r=(0,o.useCallback)((e=>e.reduce(((e,t)=>(e[n(t)]=!0,e)),{})),[]),[l,c]=(0,o.useState)(e),[d,u]=(0,o.useState)(r(e));return(0,o.useEffect)((()=>{const t=r(e),a=e.filter((e=>!d[n(e)])),o=l.filter((e=>!t[n(e)]));(a.length||o.length)&&(a.forEach((e=>{i.add(e)})),o.forEach((e=>{i.remove(e)})),c(e),u(t))}),[e]),i}},608490:(e,t,n)=>{"use strict";n.d(t,{useHints:()=>u});var a=n(667294),o=n(511492),s=n(917791),i=n(203524),r=n(923876),l=n(826542);const c=(0,o.debouncedPromise)(s.searchHints,300),d=()=>!0;function u(e,t,n,o){const[s,u]=(0,a.useState)(t),[h,g]=(0,a.useState)(!1),v=(0,a.useRef)(n),m=(0,a.useCallback)((e=>e.name),[]),p=(0,a.useCallback)((e=>e.peerId),[]),_=(0,i.useIndexer)(t,m,p),C=(0,a.useCallback)((e=>o.filterFn?e.filter(o.filterFn):e),[o.filterFn]);return(0,a.useEffect)((()=>{if(v.current=n,n){const t=_.search(n),a=t.map((e=>e.peerId));u(C(t)),g(!0),c(n,a,o.queryType||l.HintsSearchType.ALL,o,e.get()).then((e=>{v.current===n&&(u((0,r.mergeConvoLists)(t,e,o.filterFn||d)),g(!1))})).catch((()=>{}))}else u(C(t)),g(!1)}),[n,t]),[s,h]}},62839:(e,t,n)=>{"use strict";n.d(t,{uploadConvoPhoto:()=>i});var a=n(733164),o=n(501389),s=n(826542);function i(){const e=2e9+Math.round((0,a.rand)(1e6,2e6));return new Promise((t=>{window.cur.recieveCropResult=n=>{window.cur.recieveCropResult=!1,(0,s.ownerPhoto)(JSON.parse(n).data[0],e).then((e=>{const a=Array.isArray(e)?e[0]:e;t({photo:a,photoData:n}),(0,o.curBox)()&&(0,o.curBox)().hide(!0)}),(()=>{}))},window.Page.ownerPhoto(e),(0,o.curBox)().setOptions({onHideAttempt:e=>(e||t({}),!0)})}))}},672385:(e,t,n)=>{"use strict";var a;n.d(t,{ConvoFilters:()=>a}),function(e){e.ALL="all",e.ARCHIVE="archive",e.UNREAD="unread",e.IMPORTANT="important",e.UNANSWERED="unanswered",e.MESSAGE_REQUEST="message_request",e.BUSINESS_NOTIFY="business_notify",e.CHATS="chats"}(a||(a={}))},186699:(e,t,n)=>{"use strict";n.d(t,{ReportReasonIds:()=>v,showReportForm:()=>m,afterCommentReportSubmit:()=>p});var a,o,s=n(785893),i=n(769488),r=n(70162),l=n(196022),c=n(189798),d=n(448632),u=n(548838),h=n(856330);(0,l.makeAuthAndApiGlobal)();const g=window.vk;var v;function m(e,t,a,o,i){const r=(0,u.asyncComponent)((()=>Promise.all([n.e(24509),n.e(98066),n.e(68592),n.e(29019)]).then(n.bind(n,71018))),(({ReportForm:e})=>e));(0,h.showMessageBoxModalSuspense)((n=>(0,s.jsx)(r,Object.assign({},n,{reportSource:e,reportSourceOwnerId:t,reportSourceId:a,onSubmit:o}),void 0)),{onDestroy:i})}function p(e,t,n){const a=function(e,t,n){switch(e){case"photo":return`#post${t}photo_${n}`;case"video":return`#post${t}video_${n}mv`;case"market":return`#post${t}market_${n}`}}(e,t,n);if("photo"===e){const e=document.querySelector(`${a} .dld`);null!==e&&(e.outerHTML="")}const o=document.querySelector(`${a} .reply_wrap`);null!==o?(o.style.display="none",o.outerHTML+=`<div class="dld">${r.getLang("global_report_sent")}</div>`):(0,i.debugLog)(`Unable to hide report button for ${e} comment`)}(0,c.setLoginConfig)({onCaptcha:d.handleCaptcha,domain:null===(a=null==g?void 0:g.apiConfigDomains)||void 0===a?void 0:a.loginDomain}),(0,c.setApiConfig)({onCaptcha:d.handleCaptcha,domain:null===(o=null==g?void 0:g.apiConfigDomains)||void 0===o?void 0:o.apiDomain}),function(e){e[e.NotOriginalContent=28]="NotOriginalContent"}(v||(v={}))}}]);try{stManager.done("dist/519619abdcf4517008a7b23855d1f7bd.1df228e51b28eb63e48f.js")}catch(e){}