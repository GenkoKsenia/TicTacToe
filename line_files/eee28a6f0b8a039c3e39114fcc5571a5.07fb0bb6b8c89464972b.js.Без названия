(self.webpackChunkvk=self.webpackChunkvk||[]).push([[22061],{686478:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});const i=(0,s(28178).makeIcon)("Icon24Gift","gift_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="gift_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M21 10v2a1 1 0 0 1-1 1h-1v6.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 5 19.5V13h1-2a1 1 0 0 1-1-1v-2a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2Zm-8 3h6v2h-6v7h-2v-7H5v-2h6V8h2v5Zm-1-5C9 8 5.5 7 5.5 5.5s2-3 3.5-2.5c1 .333 2 2 3 5 1-3 2-4.667 3-5 1.5-.5 3.5 1 3.5 2.5S15 8 12 8Z" /></g></symbol>',24,24,!1,void 0)},891047:(e,t,s)=>{"use strict";function i(e){return new Promise(((t,s)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>s(e.error)}))}function r(e,t){const s=indexedDB.open(e);s.onupgradeneeded=()=>s.result.createObjectStore(t);const r=i(s);return(e,s)=>r.then((i=>s(i.transaction(t,e).objectStore(t))))}let n;function c(){return n||(n=r("keyval-store","keyval")),n}function a(e,t=c()){return t("readonly",(t=>i(t.get(e))))}function o(e,t,s=c()){return s("readwrite",(s=>(s.put(t,e),i(s.transaction))))}function l(e,t=c()){return t("readwrite",(t=>(t.delete(e),i(t.transaction))))}function d(e=c()){return e("readwrite",(e=>(e.clear(),i(e.transaction))))}s.d(t,{clear:()=>d,createStore:()=>r,del:()=>l,get:()=>a,set:()=>o})},748759:(e,t,s)=>{"use strict";s.d(t,{InView:()=>p,useInView:()=>f});var i=s(667294),r=s(702177);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e},c.apply(this,arguments)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var o=new Map,l=new Map,d=new Map,u=0;function g(e,t,s){void 0===s&&(s={}),s.threshold||(s.threshold=0);var i=s,n=i.root,c=i.rootMargin,a=i.threshold;if(o.has(e)&&(0,r.default)(!1),e){var g=function(e){return e?d.has(e)?d.get(e):(u+=1,d.set(e,u.toString()),d.get(e)+"_"):""}(n)+(c?a.toString()+"_"+c:a.toString()),_=l.get(g);_||(_=new IntersectionObserver(h,s),g&&l.set(g,_));var p={callback:t,element:e,inView:!1,observerId:g,observer:_,thresholds:_.thresholds||(Array.isArray(a)?a:[a])};return o.set(e,p),_.observe(e),p}}function _(e){if(e){var t=o.get(e);if(t){var s=t.observerId,i=t.observer,r=i.root;i.unobserve(e);var n=!1,c=!1;s&&o.forEach((function(t,i){i!==e&&(t.observerId===s&&(n=!0,c=!0),t.observer.root===r&&(c=!0))})),!c&&r&&d.delete(r),i&&!n&&i.disconnect(),o.delete(e)}}}function h(e){e.forEach((function(e){var t=e.isIntersecting,s=e.intersectionRatio,i=e.target,r=o.get(i);if(r&&s>=0){var n=r.thresholds.some((function(e){return r.inView?s>e:s>=e}));void 0!==t&&(n=n&&t),r.inView=n,r.callback(n,e)}}))}var p=function(e){var t,s;function o(){for(var t,s=arguments.length,i=new Array(s),r=0;r<s;r++)i[r]=arguments[r];return n(a(t=e.call.apply(e,[this].concat(i))||this),"state",{inView:!1,entry:void 0}),n(a(t),"node",null),n(a(t),"handleNode",(function(e){t.node&&(_(t.node),e||t.props.triggerOnce||t.setState({inView:!1,entry:void 0})),t.node=e||null,t.observeNode()})),n(a(t),"handleChange",(function(e,s){(e!==t.state.inView||e)&&t.setState({inView:e,entry:s}),t.props.onChange&&t.props.onChange(e,s)})),t}s=e,(t=o).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s;var l=o.prototype;return l.componentDidMount=function(){this.node||(0,r.default)(!1)},l.componentDidUpdate=function(e,t){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(_(this.node),this.observeNode()),t.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(_(this.node),this.node=null)},l.componentWillUnmount=function(){this.node&&(_(this.node),this.node=null)},l.observeNode=function(){if(this.node){var e=this.props,t=e.threshold,s=e.root,i=e.rootMargin;g(this.node,this.handleChange,{threshold:t,root:s,rootMargin:i})}},l.render=function(){var e=this.state,t=e.inView,s=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:t,entry:s,ref:this.handleNode});var r=this.props,n=r.children,a=r.as,o=r.tag,l=(r.triggerOnce,r.threshold,r.root,r.rootMargin,r.onChange,function(e,t){if(null==e)return{};var s,i,r={},n=Object.keys(e);for(i=0;i<n.length;i++)s=n[i],t.indexOf(s)>=0||(r[s]=e[s]);return r}(r,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return(0,i.createElement)(a||o||"div",c({ref:this.handleNode},l),n)},o}(i.Component);n(p,"displayName","InView"),n(p,"defaultProps",{threshold:0,triggerOnce:!1});var m={inView:!1,entry:void 0};function f(e){void 0===e&&(e={});var t=(0,i.useRef)(),s=(0,i.useState)(m),r=s[0],n=s[1],c=(0,i.useCallback)((function(s){t.current&&_(t.current),s&&g(s,(function(t,i){n({inView:t,entry:i}),t&&e.triggerOnce&&_(s)}),e),t.current=s}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return(0,i.useEffect)((function(){t.current||r===m||e.triggerOnce||n(m)})),[c,r.inView,r.entry]}},702177:(e,t,s)=>{"use strict";s.d(t,{default:()=>r});var i="Invariant failed";const r=function(e,t){if(!e)throw new Error(i)}},67941:(e,t,s)=>{"use strict";s.d(t,{STICKER_PACK_ICON:()=>r,STICKER_PACK_THUMB:()=>n,STICKER_IMAGE:()=>c,STICKER_ANIMATION:()=>a,DEFAULT_CACHE:()=>o,SAMPLE_RECIPIENT_ID:()=>l,ORDER_ERRORS:()=>d,ORDER_ITEM_ERRORS:()=>u});var i=s(749091);const r={square_png:{id:"square.png",width:104,height:104},square_15x_png:{id:"square_1.5x.png",width:156,height:156},square_2x_png:{id:"square_2x.png",width:208,height:208},square_3x_png:{id:"square_3x.png",width:312,height:312},square_4x_png:{id:"square_4x.png",width:416,height:416}},n={"102_png":{id:"102.png",width:102,height:102,theme:i.Theme.LIGHT},"51_png":{id:"51.png",width:51,height:51,theme:i.Theme.LIGHT},"68_png":{id:"68.png",width:68,height:68,theme:i.Theme.LIGHT},"34_png":{id:"34.png",width:34,height:34,theme:i.Theme.LIGHT},"60_png":{id:"60.png",width:60,height:60,theme:i.Theme.LIGHT},"30_png":{id:"30.png",width:30,height:30,theme:i.Theme.LIGHT},"102b_png":{id:"102b.png",width:102,height:102,theme:i.Theme.DARK},"51b_png":{id:"51b.png",width:51,height:51,theme:i.Theme.DARK},"68b_png":{id:"68b.png",width:68,height:68,theme:i.Theme.DARK},"34b_png":{id:"34b.png",width:34,height:34,theme:i.Theme.DARK},"60b_png":{id:"60b.png",width:60,height:60,theme:i.Theme.DARK},"30b_png":{id:"30b.png",width:30,height:30,theme:i.Theme.DARK},"44_png":{id:"44.png",width:44,height:44},"22_png":{id:"22.png",width:22,height:22}},c={"64_png":{id:"64.png",width:64,height:64,theme:i.Theme.LIGHT},"128_png":{id:"128.png",width:128,height:128,theme:i.Theme.LIGHT},"256_png":{id:"256.png",width:256,height:256,theme:i.Theme.LIGHT},"352_png":{id:"352.png",width:352,height:352,theme:i.Theme.LIGHT},"512_png":{id:"512.png",width:512,height:512,theme:i.Theme.LIGHT},"64b_png":{id:"64b.png",width:64,height:64,theme:i.Theme.DARK},"128b_png":{id:"128b.png",width:128,height:128,theme:i.Theme.DARK},"256b_png":{id:"256b.png",width:256,height:256,theme:i.Theme.DARK},"352b_png":{id:"352b.png",width:352,height:352,theme:i.Theme.DARK},"512b_png":{id:"512b.png",width:512,height:512,theme:i.Theme.DARK}},a={[i.Theme.LIGHT]:"animation.json",[i.Theme.DARK]:"animation.b.json"},o={products:(0,i.createProductsMap)([]),productIdsQueue:new Set,productsPromise:void 0,productPromises:new Map,stickers:new Map},l=-1;var d,u;!function(e){e.NOT_SIGNED_IN="not_signed_in",e.NO_VALID_ITEMS="no_valid_items"}(d||(d={})),function(e){e.DUPLICATE_PRODUCT="duplicate_product"}(u||(u={}))},749091:(e,t,s)=>{"use strict";var i;s.d(t,{Theme:()=>i,imageSizesIndex:()=>r,imageSizeCache:()=>n,createProductsMap:()=>c,UserProductStateKey:()=>a,isBasePack:()=>o,isStyleProduct:()=>l,isPackProduct:()=>d,ProductsByType:()=>g}),function(e){e.LIGHT="light",e.DARK="dark",e.DEFAULT="light"}(i||(i={}));const r=Symbol(),n=Symbol(),c=e=>new Map(e);var a;!function(e){e.IsNew="is_new"}(a||(a={}));const o=e=>void 0!==e.sticker_ids,l=e=>void 0!==e.base_id,d=e=>o(e)&&!l(e);var u;!function(e){e.Pack="pack",e.Style="style"}(u||(u={}));class g{constructor(e=[]){this.pack=new Set,this.style=new Set,e.forEach((e=>this.add(e)))}add(e){e&&(d(e)?this.pack.add(e):l(e)&&this.style.add(e))}getPack(){return this.pack.values().next().value}getStyles(){return Array.from(this.style.values())}getCount(){return this.pack.size+this.style.size}}},922377:(e,t,s)=>{"use strict";s.d(t,{getStickerImageUrl:()=>c,getStickerAnimationUrl:()=>a,getStickerPackIconUrl:()=>o,isSampleOrderItem:()=>l});var i=s(749091),r=s(67941);const n=(e,t,s,r=i.Theme.DEFAULT)=>{const n=window.devicePixelRatio,c=[t*=n,s*=n,r].toString();let a=e[i.imageSizeCache];if(a&&a.has(c)){const e=a.get(c);if(e)return e}a||(a=new Map,e[i.imageSizeCache]=a);const o=(e=>{let t=e[i.imageSizesIndex];return t||(t=Object.values(e).sort(((e,t)=>e.width-t.width||e.height-t.height)),e[i.imageSizesIndex]=t),t})(e).filter((e=>!e.theme||e.theme===r)),l=o.find((e=>e.width>=t&&e.height>=s))||o[o.length-1];return a.set(c,l),l};function c(e,t,s,c=i.Theme.DEFAULT){var a;if(null===(a=e.render)||void 0===a?void 0:a.images){const{images:i}=e.render;let r;i.sort(((e,t)=>e.width-t.width||e.height-t.height));for(const e of i)if(e.width>=t&&e.height>=s){if(e.theme===c)return e.url;r=e}if(r)return r.url}return((e,t)=>e.image.base_url+"/"+t.id+(e.image.version?`?${e.image.version}`:""))(e,((e,t,s=i.Theme.DEFAULT)=>n(r.STICKER_IMAGE,e,t,s))(t,s,c))}const a=(e,t=i.Theme.DEFAULT)=>e.animation?e.animation.base_url+"/"+r.STICKER_ANIMATION[t]+(e.animation.version?`?${e.animation.version}`:""):"",o=(e,t,s,c=i.Theme.DEFAULT)=>((e,t)=>e.icon.base_url+"/"+t.id+(e.thumb.version?`?${e.thumb.version}`:""))(e,((e,t,s=i.Theme.DEFAULT)=>n(r.STICKER_PACK_ICON,e,t,s))(t,s,c)),l=e=>e.recipient_id===r.SAMPLE_RECIPIENT_ID},730304:(e,t,s)=>{"use strict";s.d(t,{moveStickersHintsToStickerPicker:()=>r});const i="StickersHints__marginTransition",r=(e,t)=>{const s=window.Emoji.opts[e];if(!(null==s?void 0:s.txt))return;const r=s.txt.parentNode.querySelector("._sticker_hints");if(!r)return;if(!("none"!==getComputedStyle(r).getPropertyValue("display")))return;t&&(r.classList.add(i),requestAnimationFrame((()=>r.classList.remove(i)))),r.style.setProperty("margin-left","0px");const{right:n}=r.getBoundingClientRect();if(window.StickerPickerViewer){const{isShown:e,isDown:t,wrapper:s}=window.StickerPickerViewer;if(!e||!s||t)return;const i=-(n-s.getBoundingClientRect().left+10);r.style.setProperty("margin-left",`${i}px`)}}},665820:(e,t,s)=>{"use strict";s.d(t,{getCache:()=>o,updateCache:()=>l,getSticker:()=>d,getStickers:()=>u,getPackByStickerId:()=>_});var i=s(514191),r=s(67941),n=s(749091),c=s(310835),a=s(15305);const o=()=>{if(!window.stickersCache){const e=a.ls.get("stickers_cache");window.stickersCache=Object.assign(Object.assign({},r.DEFAULT_CACHE),e)}return window.stickersCache},l=e=>{window.stickersCache=Object.assign(Object.assign({},o()),e)},d=e=>o().stickers.get(e),u=e=>{const{stickers:t}=o();return e.map((e=>t.get(e)))},g=e=>{const t=d(e);if(!t||!t.pack_id)return null;const s=(0,c.getProductFromCache)(t.pack_id);return s&&(0,n.isBasePack)(s)?s:null},_=e=>{const t=g(e);return t?Promise.resolve(t):new Promise((t=>{i.ajax.post("stickers.php",{act:"get_products",sticker_ids:[e]},{onDone(s){(0,c.cacheProductsData)(s),t(g(e))},onFail:e=>(console.error(e),t(null),!0)})}))}},399321:(e,t,s)=>{"use strict";s.d(t,{Cart:()=>a});var i=s(514191),r=s(319367),n=s(67941),c=s(310835);class a{constructor(e,t=[]){this.loadTimeout=null,this.loadCancellationToken=null,this.isGift=!1,this.onChange=null,this._order=null,this.setItems(e),this.recipientIds=new Set(t),this.recipients=new Map}static create(e,t=[]){const s=e.map((e=>({product_id:e,amount:1})));return new a(s,t)}copy(){const e=new a(this.getItems(),this.getRecipientIds());return e.setOrder(this.getOrder()),e}getItems(){return Array.from(this.items.values())}setItems(e){this.items=new Map(e.map((e=>[e.product_id,e])))}loadItems(){const e=Array.from(this.items.keys());return(0,c.getProducts)(e).then((()=>{for(const e of Array.from(this.items.values()))e.product=(0,c.getProductFromCache)(e.product_id)}))}getProducts(){return(0,c.getProductsFromCache)(Array.from(this.items.keys()))}hasProduct(e){return this.items.has(e)}addProduct(e,t=!1){if(!this.hasProduct(e)){const s={product_id:e,amount:1};t?this.setItems([...this.getItems(),s]):this.setItems([s,...this.getItems()]),this.onChange&&this.onChange()}}removeProduct(e){this.hasProduct(e)&&(this.items.delete(e),this.onChange&&this.onChange())}getRecipientIds(e=!1){return this.recipientIds.size?Array.from(this.recipientIds.values()):this.isGift&&e?[n.SAMPLE_RECIPIENT_ID]:[]}setRecipientIds(e){this.recipientIds=new Set(e)}hasRecipientId(e){return this.recipientIds.has(e)}addRecipientId(e){this.hasRecipientId(e)||(this.recipientIds.add(e),this.onChange&&this.onChange())}removeRecipientId(e){this.hasRecipientId(e)&&(this.recipientIds.delete(e),this.onChange&&this.onChange())}setOrder(e){if(this._order=e,e){this.recipientIds.clear();for(const t of e.items)t.recipient_id!==n.SAMPLE_RECIPIENT_ID&&this.recipientIds.add(t.recipient_id)}}loadOrder(e){const t=e.items.map((e=>e.product_id));return(0,c.getProducts)(t).then((t=>Object.assign(Object.assign({},e),{items:e.items.map(((e,s)=>Object.assign(Object.assign({},e),{product:t[s]})))})),(()=>e))}getOrder(){return this._order}getRecipientsMap(){return this.recipients}getRecipients(){return Array.from(this.recipients.values())}getRecipientById(e){return this.recipients.get(e)}addRecipients(e){this.recipients=new Map([...this.getRecipients(),...e].map((e=>[e[0],e])))}getJSON(){return JSON.stringify({items:this.getItems().map((e=>Object.assign(Object.assign({},e),{product:void 0}))),recipient_ids:this.getRecipientIds(!0)})}isLoaded(){return null!==this.getOrder()}cancelLoad(){this.loadTimeout&&(window.clearTimeout(this.loadTimeout),this.loadTimeout=null),this.loadCancellationToken&&(this.loadCancellationToken.cancel(),this.loadCancellationToken=null)}load(e=!1){return this.cancelLoad(),new Promise((t=>{this.loadTimeout=window.setTimeout((()=>{this.loadCancellationToken=new r.AjaxCancellationToken,i.ajax.post("stickers.php",{act:"preview_products_order",cart:this.getJSON(),with_suggested_recipients:e?1:0},{cancellationToken:this.loadCancellationToken,onDone:e=>{(0,c.cacheProductsData)(e),Promise.all([this.loadItems(),this.loadOrder(e.order)]).then((([,s])=>{this.setOrder(s),e.recipients&&this.addRecipients(e.recipients),t(this)}),(()=>{}))},onFail:e=>(e&&window.__dev&&console.error(e),t(this),!0)})}),300)}))}order(e={}){return new Promise((t=>{var s;i.ajax.post("stickers.php",{act:"order_products",cart:this.getJSON(),hash:e.hash||(null===(s=this.getOrder())||void 0===s?void 0:s.hash),message:e.message,is_private:e.is_private?1:0,ref:e.ref,gift_ref:e.gift_ref},{onDone:e=>{(0,c.cacheProductsData)(e),Promise.all([this.loadOrder(e.order),this.loadOrder(e.result)]).then((([e,s])=>{this.setOrder(e),t(s)}),(()=>{}))},onFail:e=>(e&&console.error(e),t(null),!0)})}))}}},360989:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var i=s(785893),r=s(667294),n=s(748759),c=s(483295),a=s(749091),o=s(330494),l=s(166347);const d=({className:e,sticker:t,theme:s=a.Theme.LIGHT,width:d,height:u})=>{const[g,_]=(0,n.useInView)({threshold:0}),h=void 0!==t.animation,[p,m]=(0,r.useState)(!1);return(0,i.jsx)("div",Object.assign({className:(0,c.classNames)("Sticker",e),ref:g,onMouseEnter:()=>{m(!0)},onMouseLeave:()=>{m(!1)}},{children:h?(0,i.jsx)(l.default,{sticker:t,theme:s,width:d,height:u,isInView:_,play:p},void 0):(0,i.jsx)(o.default,{sticker:t,theme:s,width:d,height:u,isInView:_},void 0)}),void 0)}},166347:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(785893),r=s(667294),n=s(483295),c=s(211248),a=s.n(c),o=s(922377);const l=({className:e,sticker:t,theme:s,width:c,height:l,isInView:d=!0,play:u=!1})=>{const g=(0,r.useRef)(null),[_,h]=(0,r.useState)(null),p=(0,o.getStickerAnimationUrl)(t,s);return(0,r.useEffect)((()=>{if(!_||!_.isLoaded)return;const e=u&&d;e&&!_.playing&&(_.item.play(),h(Object.assign(Object.assign({},_),{playing:!0}))),!e&&_.playing&&(_.item.pause(),h(Object.assign(Object.assign({},_),{playing:!1})))}),[_,u,d]),(0,r.useEffect)((()=>{if(!_||_.url!==p)if(_&&_.item.destroy(),p&&d){const e=a().loadAnimation({container:g.current,path:p,renderer:"svg",autoplay:!1,loop:!0,rendererSettings:{className:"StickerAnimation__animation",progressiveLoad:!0,hideOnTransparent:!0}}),t={url:p,isLoaded:!1,item:e,playing:!1};e.addEventListener("DOMLoaded",(()=>{h(Object.assign(Object.assign({},t),{isLoaded:!0}))})),h(t)}else h(null)}),[p,d]),(0,i.jsx)("div",{className:(0,n.classNames)("StickerAnimation",e),style:{width:c,height:l},ref:g},void 0)}},330494:(e,t,s)=>{"use strict";s.d(t,{default:()=>a});var i=s(785893),r=s(667294),n=s(483295),c=s(922377);const a=({className:e,sticker:t,theme:s,width:a,height:o,isInView:l=!0})=>{const d=(0,r.useRef)(null),u=(0,c.getStickerImageUrl)(t,a,o,s);return(0,r.useLayoutEffect)((()=>{d.current&&d.current.src!==u&&l&&(d.current.src=u)}),[l,u]),(0,i.jsx)("div",Object.assign({className:(0,n.classNames)("StickerImage",e),style:{width:a,height:o}},{children:(0,i.jsx)("img",{className:"StickerImage__image",ref:d},void 0)}),void 0)}},60578:(e,t,s)=>{"use strict";s.d(t,{default:()=>I});var i=s(785893),r=s(667294),n=s(86894),c=s(501389),a=s(146143),o=s(608021),l=s(70162),d=s(938767),u=s(733024),g=s(686478),_=s(749091),h=s(67941),p=s(665820),m=s(348230),f=s(451322),v=s(683791),k=s(155639),S=s(450134),y=s(360989),j=s(295565),w=s(54637),P=s(369783),b=s(870264),x=s(511417),L=s(659397);const I=({pack:e,cart:t,options:{recipientIds:s=[],ref:I,gift_ref:O},closeBox:N})=>{const[C]=(0,f.usePack)(e.id);C&&(e=C);const[T,R]=(0,v.useStyles)(e.style_ids||[]),[M,A]=(0,S.useCart)((()=>t)),[G]=(0,k.useWithProducts)(M.getItems()),B=M.getProducts(),D=M.getOrder(),E=(0,p.getSticker)(e.sticker_ids[0]),H=function(e){if(!e)return null;const t=[],s=[];for(const i of e.items){const{product:e,error:r}=i;e&&!r&&((0,_.isPackProduct)(e)?t.push(i):(0,_.isStyleProduct)(e)&&s.push(i))}const i=s.reduce(((e,t)=>{var s;return e+((null===(s=t.price)||void 0===s?void 0:s.current)||0)}),0);if(t.length){const e=t.reduce(((e,t)=>{var s;return e+((null===(s=t.price)||void 0===s?void 0:s.current)||0)}),0);return e?s.length?i?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_for",s.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",s.length,"styles_price_sum",i):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for_styles_free",s.length),"pack_price",l.getLang("global_n_votes",e),"styles_num",s.length):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_for"),"pack_price",l.getLang("global_n_votes",e)):s.length?i?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_for",s.length),"styles_num",s.length,"styles_price_sum",l.getLang("global_n_votes",i)):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free_styles_free",s.length),"styles_num",s.length):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_pack_free"))}if(s.length)return i?(0,o.langStr)(l.getLang("purchases_stickers_order_summary_styles_for",s.length),"styles_num",s.length,"styles_price_sum",l.getLang("global_n_votes",i)):(0,o.langStr)(l.getLang("purchases_stickers_order_summary_styles_free",s.length),"styles_num",s.length);return null}(D),F=!A&&D&&!D.error,[V,U]=(0,r.useState)(!1);let z=null;if(D)if(D.error){if(D.error===h.ORDER_ERRORS.NOT_SIGNED_IN){const e=()=>{(0,c.showDoneBox)(l.getLang("purchases_please_sign_in").replace(/\{link\}(.*?)\{\/link\}/,"<a href=\"/join\" onclick=\"return !showBox('join.php', { act: 'box', from: nav.strLoc }, {}, event)\">$1</a>"))};z=(0,i.jsx)(n.Button,Object.assign({mode:"primary",size:"m",loading:A,onClick:e},{children:l.getLang("purchases_stickers_get_pack_btn")}),void 0)}else if(D.error===h.ORDER_ERRORS.NO_VALID_ITEMS){if(1===D.items.length){const{product:e,error:t}=D.items[0];if(e&&t!==h.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT&&e.purchase_details){const{label:t,title:s,text:r,button_title:c,button_url:o}=e.purchase_details,d=()=>{(0,a.showFastBox)(s||l.getLang("purchases_stickers_catalog_purchase_details_title"),r,o&&c||void 0,o?()=>{window.location.href=o}:void 0)};z=(0,i.jsx)(n.Button,Object.assign({mode:"primary",size:"m",loading:A,onClick:d},{children:t||l.getLang("purchases_stickers_product_unavailable")}),void 0)}}if(!z){const e=!D.items.find((e=>e.error!==h.ORDER_ITEM_ERRORS.DUPLICATE_PRODUCT));z=(0,i.jsx)(n.Button,Object.assign({mode:"secondary",size:"m",disabled:!0},{children:e?l.getLang("purchases_stickers_product_purchased"):l.getLang("purchases_stickers_product_unavailable")}),void 0)}}}else{const e=()=>{V||(U(!0),M.order({ref:I,gift_ref:O}).then((e=>{U(!1),e&&!e.error&&(0,c.showDoneBox)((0,m.getPurchaseResult)(e))}),(()=>{})))},t=A||V;z=(0,i.jsx)(P.default,{mode:"primary",size:"m",loading:t,disabled:t,price:D.price,text:D.price.current?l.getLang("purchases_stickers_buy_for"):l.getLang("purchases_stickers_get_for_free"),onClick:e},void 0)}const K=!A&&void 0!==B.find((e=>null==e?void 0:e.can_gift)),W=G.reduce(((e,t)=>(t.product&&t.product.copyright&&e.add(t.product.copyright),e)),new Set),q=x.colorScheme.isDarkScheme()?_.Theme.DARK:_.Theme.LIGHT;return(0,i.jsxs)("article",Object.assign({className:"StickerPackPreview"},{children:[(0,i.jsxs)("header",Object.assign({className:"StickerPackPreview__header"},{children:[(0,i.jsx)("a",Object.assign({className:"StickerPackPreview__close",onClick:N},{children:(0,i.jsx)(u.default,{},void 0)}),void 0),E&&(0,i.jsx)(y.default,{className:"StickerPackPreview__icon",sticker:E,theme:q,width:128,height:128},void 0),(0,i.jsxs)("div",Object.assign({className:"StickerPackPreview__info"},{children:[(0,i.jsx)(d.InnerHTML,Object.assign({Component:"h1",className:"StickerPackPreview__title"},{children:e.title}),void 0),(0,i.jsx)(d.InnerHTML,Object.assign({Component:"div",className:"StickerPackPreview__author"},{children:e.author}),void 0),(0,i.jsx)(d.InnerHTML,Object.assign({Component:"div",className:"StickerPackPreview__description"},{children:e.description}),void 0)]}),void 0)]}),void 0),T.length>0&&(0,i.jsx)(j.default,{className:"StickerPackPreview__styles",styles:T,isLoading:R,isAdded:e=>M.hasProduct(e.id),add:e=>M.addProduct(e.id),remove:e=>M.removeProduct(e.id),gift:e=>{return t=e.id,void(0,b.giftStickerProducts)([t],s);var t}},void 0),(0,i.jsxs)("div",Object.assign({className:"StickerPackPreview__footerContainer"},{children:[(0,i.jsx)("section",Object.assign({className:"StickerPackPreview__items"},{children:G.map((e=>(0,i.jsx)(w.default,{item:e,showHeader:T.length>0,remove:e.product&&(0,_.isStyleProduct)(e.product)?()=>M.removeProduct(e.product_id):void 0},e.product_id)))}),void 0),W.size>0&&(0,i.jsx)("section",Object.assign({className:"StickerPackPreview__copyrights"},{children:Array.from(W).map(((e,t)=>(0,i.jsx)("div",Object.assign({className:"StickerPackPreview__copyright"},{children:(0,L.decodeHTMLEntities)(e)}),t)))}),void 0),(0,i.jsxs)("footer",Object.assign({className:"StickerPackPreview__footer"},{children:[!A&&(F||K)&&(0,i.jsx)("div",Object.assign({className:"StickerPackPreview__footerNote"},{children:H}),void 0),(0,i.jsxs)(n.ButtonGroup,{children:[K&&(0,i.jsx)(n.Button,Object.assign({mode:"primary",size:"m",onClick:()=>(()=>{const e=M.copy();e.setRecipientIds(s),(0,b.giftStickersCart)(e)})(),before:(0,i.jsx)(g.default,{width:20,height:20},void 0)},{children:l.getLang("purchases_stickers_gift")}),void 0),z]},void 0)]}),void 0)]}),void 0)]}),void 0)}},187925:(e,t,s)=>{"use strict";s.d(t,{default:()=>S});var i=s(785893),r=s(667294),n=s(86894),c=s(608021),a=s(70162),o=s(743927),l=s(740733),d=s(938767),u=s(749091),g=s(310835),_=s(399321),h=s(451322),p=s(683791),m=s(295565),f=s(190291),v=s(369783),k=s(870264);const S=({pack:e,options:t,closeBox:s,updateBox:S})=>{const[y,j]=(0,h.usePack)(e.id);y&&(e=y);const[w,P]=(0,p.useStyles)(e.style_ids||[]),b=j||P;(0,r.useEffect)((()=>{S()}),[b]);const x=Object.assign(Object.assign({},e),{base_id:e.id,title:a.getLang("purchases_stickers_product_preview_title_base_pack"),style_sticker_ids:e.sticker_ids}),L=[x,...w],I=L.find((e=>e&&e.is_active))||x,[O,N]=(0,r.useState)(),C=O&&L.find((e=>e&&e.id===O)),T=e=>{N(e&&e.id)},R=C||I,M=R===x?a.getLang("purchases_stickers_product_preview_title_base_pack"):(0,c.langStr)(a.getLang("purchases_stickers_product_preview_title_style"),"title",R.title);(0,r.useEffect)((()=>{R.is_new&&(0,g.updateUserProductState)(R.id,u.UserProductStateKey.IsNew,0).finally((()=>{}))}),[R,R.is_new]);const[A,G]=(0,r.useState)(!1),[B,D]=(0,r.useState)(!1);return(0,i.jsxs)("article",Object.assign({className:"StickerPackSettings"},{children:[(0,i.jsx)(o.ModalHeader,{className:"StickerPackSettings__header",title:e?(0,c.langStr)(a.getLang("purchases_stickers_style_selection_for_pack"),"title",e.title):"",onClose:s},void 0),b?(0,i.jsx)("section",Object.assign({className:"StickerPackSettings__content StickerPackSettings__content--loading"},{children:(0,i.jsx)(l.default,{size:24},void 0)}),void 0):(0,i.jsxs)(r.Fragment,{children:[L.length>0&&(0,i.jsx)(m.default,{className:"StickerPackSettings__styles",styles:L,isLoading:P,activeStyle:I,selectedStyle:R,select:e=>T(e)},void 0),(0,i.jsxs)("div",Object.assign({className:"StickerPackSettings__footerContainer"},{children:[(0,i.jsxs)("section",Object.assign({className:"StickerPackSettings__stylePreview"},{children:[(0,i.jsx)(d.InnerHTML,Object.assign({Component:"h2",className:"StickerPackSettings__stylePreviewTitle"},{children:M}),void 0),(0,i.jsx)(f.default,{product:R},void 0)]}),void 0),(0,i.jsx)("footer",Object.assign({className:"StickerPackSettings__footer"},{children:(0,i.jsxs)(n.ButtonGroup,{children:[R.can_gift&&(0,i.jsx)(n.Button,{mode:"secondary",size:"m",onClick:()=>{return e=R.id,void(0,k.giftStickerProducts)([e],t.recipientIds||[]);var e}},void 0),R.is_purchased?(0,i.jsx)(n.Button,Object.assign({mode:"primary",size:"m",disabled:R===I,loading:B,onClick:()=>{return e=R,void(B||(D(!0),(0,g.activateProduct)(e).then((()=>{D(!1),T(void 0)}),(()=>{}))));var e}},{children:a.getLang("purchases_stickers_product_settings_save")}),void 0):(0,i.jsx)(v.default,{className:"StickerPackSettings__buy",mode:"primary",size:"m",price:R.price.purchase,text:R.price.purchase.current?a.getLang("purchases_stickers_buy_for"):a.getLang("purchases_stickers_get_for_free"),loading:A,onClick:()=>{return e=R,void(A||(G(!0),_.Cart.create([e.id]).load().then((e=>e.order())).then((()=>{G(!1)}),(()=>{}))));var e}},void 0)]},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},490808:(e,t,s)=>{"use strict";s.d(t,{default:()=>y});var i=s(785893),r=s(667294),n=s(501389),c=s(608021),a=s(70162),o=s(743927),l=s(740733),d=s(546847),u=s(451865),g=s(330491),_=s(599940),h=s(749091),p=s(922377),m=s(450134),f=s(820159),v=s(945752),k=s(369783),S=s(659397);const y=({cart:e,options:{ref:t,gift_ref:s},closeBox:y,updateBox:j})=>{const[w,P]=(0,m.useCart)(e),b=!w.isLoaded()&&P;(0,r.useEffect)((()=>{j()}),[b]);const x=w.getRecipientIds(),L=w.getOrder(),I=L&&!L.error&&L.items.find((e=>!e.error&&!(0,p.isSampleOrderItem)(e))),[O,N]=function(e){if(!e)return[null,null];let t;for(const s of e.items){const{product:e}=s;if(e&&(0,h.isPackProduct)(e)){t=e;break}}let s=e.items.filter((({product:e})=>null==e?void 0:e.can_gift));const i=s.filter((e=>!e.error&&!(0,p.isSampleOrderItem)(e)));i.length&&(s=i);const r=new h.ProductsByType(s.map((e=>e.product))),n=r.pack.values().next().value,o=Array.from(r.style);let l="",d="";if(1===o.length)l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_1_style"),"title",o[0].title),n?d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_with_pack"),"title",n.title):t&&(d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_for_pack"),"title",t.title));else if(n){if(l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_pack"),"title",n.title),o.length)switch(o.length){case 2:d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_with_2_styles"),"title1",o[0].title,"title2",o[1].title);break;case 3:d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;case 4:d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles_and_1_more"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;default:const e=o.length-3;d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_with_3_styles_and_n_more",e),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title,"n",e)}}else if(o.length){switch(o.length){case 2:l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_2_styles"),"title1",o[0].title,"title2",o[1].title);break;case 3:l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_3_styles"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;case 4:l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_3_styles_and_1_more"),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title);break;default:const e=o.length-3;l=(0,c.langStr)(a.getLang("purchases_stickers_gift_title_3_styles_and_n_more",e),"title1",o[0].title,"title2",o[1].title,"title3",o[2].title,"n",e)}t&&(d=(0,c.langStr)(a.getLang("purchases_stickers_gift_description_for_pack"),"title",t.title))}o.length?d+=" "+a.getLang("purchases_stickers_gift_description_styles"):d+=" "+a.getLang("purchases_stickers_gift_description");return[l,d]}(L),[,C]=(0,r.useState)(null);(0,r.useLayoutEffect)((()=>{const e=w.getRecipients();if(C(window.WideDropdown.init("StickerProductsGiftRecipientsDropdown",{defaultItems:e,items:e,noResult:a.getLang("gifts_nobody_found"),introText:a.getLang("gifts_start_typing_recipient"),maxItems:20,onChange:(e,t)=>{1===e?w.addRecipientId(+t):w.removeRecipientId(+t)}})),x.length)for(const e of x){const t=w.getRecipientById(e);t&&window.WideDropdown.select("StickerProductsGiftRecipientsDropdown",!1,t)}else window.WideDropdown.focus("StickerProductsGiftRecipientsDropdown");return()=>{window.WideDropdown.deinit("StickerProductsGiftRecipientsDropdown")}}),[b]);const[T,R]=(0,r.useState)(""),[M,A]=(0,r.useState)(!1),[G,B]=(0,r.useState)(!1),D=()=>{G||(B(!0),w.order({message:T,is_private:M,ref:t,gift_ref:s}).then((e=>{B(!1),e&&!e.error&&((0,n.showDoneBox)(function(e,t){const s=new h.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),i=function(e){const t=e.getPack(),s=e.getStyles();if(t)return s.length?(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_pack_and_styles",s.length),"title",t.title,"styles_num",s.length):(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_pack"),"title",t.title);if(s.length)switch(s.length){case 1:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_1_style"),"title",s[0].title);case 2:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_2_styles"),"title1",s[0].title,"title2",s[1].title);case 3:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);case 4:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles_and_1_more"),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title);default:{const e=s.length-3;return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_products_3_styles_and_n_more",e),"title1",s[0].title,"title2",s[1].title,"title3",s[2].title,"n",e)}}return null}(s);if(!i)return null;const r=new Set;for(const s of e.items){const{error:e,recipient_id:i}=s;if(e)continue;const n=t(i);n&&r.add(n)}const n=function(e,t){const s=Array.from(e.values());switch(s.length){case 0:return null;case 1:{const e=1===t?a.getLang("purchases_stickers_gift_result_1_recipient_single","raw"):a.getLang("purchases_stickers_gift_result_1_recipient_multiple","raw");return(0,c.langStr)((0,a.langSex)(s[0][8],e),"name",s[0][8])}case 2:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_2_recipients",t),"name1",s[0][8],"name2",s[1][8]);case 3:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_3_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8]);case 4:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_4_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8]);case 5:return(0,c.langStr)(a.getLang("purchases_stickers_gift_result_5_recipients",t),"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8],"name5",s[4][8]);default:{const e=s.length-4,i=1===t?a.getLang("purchases_stickers_gift_result_4_recipients_and_n_more_single"):a.getLang("purchases_stickers_gift_result_4_recipients_and_n_more_multiple");return(0,c.langStr)(i,"name1",s[0][8],"name2",s[1][8],"name3",s[2][8],"name4",s[3][8],"n",e)}}return null}(r,s.getCount());if(!n)return null;return(0,c.langStr)(n,"products",i)}(e,(e=>w.getRecipientById(e)))),y())}),(()=>{})))};return(0,r.useEffect)((()=>{window.WideDropdown.disable("StickerProductsGiftRecipientsDropdown",G)}),[G]),(0,i.jsxs)("article",Object.assign({className:"StickerProductsGift"},{children:[(0,i.jsx)(o.ModalHeader,{className:"StickerProductsGift__header",title:a.getLang("purchases_stickers_gift_box_title"),onClose:y},void 0),b?(0,i.jsx)("section",Object.assign({className:"StickerProductsGift__content StickerProductsGift__content--loading"},{children:(0,i.jsx)(l.default,{size:24},void 0)}),void 0):(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("section",Object.assign({className:"StickerProductsGift__content"},{children:[(0,i.jsx)(f.default,{order:L,forceValid:!I},void 0),(0,i.jsx)("h1",Object.assign({className:"StickerProductsGift__productsTitle"},{children:(0,S.decodeHTMLEntities)(O||"")}),void 0),(0,i.jsx)("p",Object.assign({className:"StickerProductsGift__productsDescription"},{children:(0,S.decodeHTMLEntities)(N||"")}),void 0),L&&(0,i.jsxs)(r.Fragment,{children:[(0,i.jsxs)("dl",Object.assign({className:"StickerProductsGift__price"},{children:[(0,i.jsx)("dt",Object.assign({className:"StickerProductsGift__priceLabel"},{children:a.getLang("purchases_gift_price_label")}),void 0)," ",(0,i.jsx)("dd",Object.assign({className:"StickerProductsGift__priceValue"},{children:a.getLang("global_n_votes",L.price.current)}),void 0)]}),void 0),(0,i.jsx)("div",Object.assign({className:"StickerProductsGift__balance"},{children:(0,c.langStr)(a.getLang("gifts_you_have_X_votes"),"votes",a.getLang("global_n_votes",L.balance))}),void 0)]},void 0),(0,i.jsxs)("div",Object.assign({className:"StickerProductsGift__recipients"},{children:[(0,i.jsx)("label",Object.assign({className:"StickerProductsGift__recipientsLabel",htmlFor:"StickerProductsGiftRecipientsInput"},{children:a.getLang("gifts_receiver")}),void 0),(0,i.jsxs)("div",Object.assign({className:"wdd StickerProductsGift__recipientsDropdown",id:"StickerProductsGiftRecipientsDropdown"},{children:[(0,i.jsx)("div",{className:"fl_r wdd_arr"},void 0),(0,i.jsx)("input",{className:"wdd_text fl_l",id:"StickerProductsGiftRecipientsInput",placeholder:a.getLang("gifts_choose_recipients")},void 0)]}),void 0)]}),void 0),(0,i.jsxs)("div",Object.assign({className:"StickerProductsGift__message"},{children:[(0,i.jsx)("label",Object.assign({className:"StickerProductsGift__messageLabel",htmlFor:"StickerProductsGiftMessageInput"},{children:a.getLang("purchases_gift_your_message")}),void 0),(0,i.jsx)(d.default,{className:"StickerProductsGift__messageInput",id:"StickerProductsGiftMessageInput",value:T,onChange:e=>R(e.currentTarget.value),onResize:()=>j(),style:{height:80},disabled:G},void 0)]}),void 0),(0,i.jsx)(u.default,Object.assign({className:"StickerProductsGift__isPrivate",checked:M,disabled:G,onChange:()=>A(!M)},{children:a.getLang("gifts_receiver_only")}),void 0)]}),void 0),(0,i.jsxs)("footer",Object.assign({className:"StickerProductsGift__footer"},{children:[(0,i.jsx)("div",Object.assign({className:"StickerProductsGift__footerNote"},{children:!P&&L&&(0,i.jsxs)("div",Object.assign({className:"StickerProductsGift__details"},{children:[a.getLang("purchases_stickers_gift_details_label"),(0,i.jsx)(_.default,Object.assign({className:"StickerProductsGift__detailsTooltip",text:(0,i.jsx)(v.default,{order:L,recipients:w.getRecipientsMap()},void 0),position:"t",align:"center",appearance:"light"},{children:(0,i.jsx)(g.default,{className:"StickerProductsGift__detailsHintIcon"},void 0)}),void 0)]}),void 0)}),void 0),(0,i.jsx)("div",Object.assign({className:"StickerProductsGift__footerButtons"},{children:(0,i.jsx)(k.default,{className:"StickerProductsGift__gift",mode:I?"primary":"secondary",size:"m",loading:P||G,disabled:!I,price:null==L?void 0:L.price,text:I?(0,c.langStr)(a.getLang("purchases_stickers_gift_send_for"),"price",a.getLang("global_n_votes",null==L?void 0:L.price.current)):a.getLang("purchases_stickers_gift_send"),onClick:()=>D()},void 0)}),void 0)]}),void 0)]},void 0)]}),void 0)}},945752:(e,t,s)=>{"use strict";s.d(t,{default:()=>g});var i=s(785893),r=s(667294),n=s(608021),c=s(70162),a=s(938767),o=s(749091),l=s(922377),d=s(659397);function u(e){const t=e.getPack(),s=e.getStyles();let i="";return s.length&&(i=s.map((e=>(0,n.langStr)(c.getLang("purchases_stickers_gift_details_recipient_style_title"),"title",e.title))).join(", ")),t?i?(0,n.langStr)(c.getLang("purchases_stickers_gift_details_recipient_pack_and_styles"),"pack_title",t.title,"style_titles",i):(0,n.langStr)(c.getLang("purchases_stickers_gift_details_recipient_pack"),"title",t.title):i?(0,n.langStr)(c.getLang("purchases_stickers_gift_details_recipient_styles"),"style_titles",i):null}const g=({order:e,recipients:t})=>{const s=function(e){if(!e)return null;let t=e.items.filter((({product:e})=>null==e?void 0:e.can_gift));const s=t.filter((e=>!e.error&&!(0,l.isSampleOrderItem)(e)));s.length&&(t=s);const i=[],r=[];for(const e of t){const{product:t}=e;t&&((0,o.isPackProduct)(t)?i.push(e):(0,o.isStyleProduct)(t)&&r.push(e))}const a=r.reduce(((e,t)=>{var s;return e+((null===(s=t.price)||void 0===s?void 0:s.current)||0)}),0);if(i.length){const e=i.reduce(((e,t)=>{var s;return e+((null===(s=t.price)||void 0===s?void 0:s.current)||0)}),0);return r.length?(0,n.langStr)(c.getLang("purchases_stickers_gift_details_summary_pack_with_styles",r.length),"pack_price_sum",c.getLang("global_n_votes",e),"styles_num",r.length,"styles_price_sum",c.getLang("global_n_votes",a)):(0,n.langStr)(c.getLang("purchases_stickers_gift_details_summary_pack"),"pack_price_sum",c.getLang("global_n_votes",e))}if(r.length)return(0,n.langStr)(c.getLang("purchases_stickers_gift_details_summary_styles",r.length),"styles_num",r.length,"styles_price_sum",c.getLang("global_n_votes",a));return null}(e),g=new Map;for(const s of e.items){const{error:e,product:i,recipient_id:r}=s;if(e)continue;const n=t.get(r);if(!n)continue;let c=g.get(n);c||(c=new o.ProductsByType,g.set(n,c)),c.add(i)}const _=Array.from(g.entries()),h=(0,r.useRef)(null);return(0,r.useEffect)((()=>{const e=h.current;e&&(e.style.maxHeight=e.getBoundingClientRect().bottom-22+"px")})),(0,i.jsxs)("div",Object.assign({className:"StickerProductsGiftDetails",ref:h},{children:[s&&(0,i.jsx)(a.InnerHTML,Object.assign({Component:"p",className:"StickerProductsGiftDetails__summary"},{children:s}),void 0),_.length>0&&(0,i.jsx)("ul",Object.assign({className:"StickerProductsGiftDetails__recipients"},{children:_.map((([e,t])=>(0,i.jsxs)("li",Object.assign({className:"StickerProductsGiftDetails__recipient"},{children:[(0,i.jsx)(a.InnerHTML,Object.assign({Component:"div",className:"StickerProductsGiftDetails__recipientName"},{children:e[1]}),void 0),(0,i.jsx)("div",Object.assign({className:"StickerProductsGiftDetails__recipientProducts"},{children:(0,d.decodeHTMLEntities)(u(t)||"")}),void 0)]}),e[0])))}),void 0)]}),void 0)}},820159:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var i=s(785893),r=s(483295),n=s(749091),c=s(922377);const a={s:56,m:96,l:168},o=({order:e,forceValid:t=!1})=>{var s,o,l;const d=new Map,u=new Map;if(e)for(const t of e.items){const{product:e}=t;e&&((0,n.isPackProduct)(e)?d.has(e)?null===(s=d.get(e))||void 0===s||s.push(t):d.set(e,[t]):(0,n.isStyleProduct)(e)&&(u.has(e)?null===(o=u.get(e))||void 0===o||o.push(t):u.set(e,[t])))}const g=d.keys().next().value,_=(g?1:0)+u.size,h=_>1?_>2?"s":"m":"l",p=a[h],m=Array.from(u.entries());t||m.sort((([,e],[,t])=>t.filter((e=>!e.error)).length-e.filter((e=>!e.error)).length));const f=m.slice(0,3);let v=m.slice(3),k=!0;if(!t){const e=v.filter((([,e])=>e.find((e=>!e.error))));e.length?v=e:k=!1}return(0,i.jsxs)("ul",Object.assign({className:"StickerProductsGiftIcons"},{children:[g&&(0,i.jsx)("li",{className:(0,r.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${h}`,"StickerProductsGiftIcons__icon--pack",{"StickerProductsGiftIcons__icon--invalid":!t&&!(null===(l=d.get(g))||void 0===l?void 0:l.find((e=>!e.error)))}),style:{backgroundImage:`url(${(0,c.getStickerPackIconUrl)(g,p,p)})`}},g.id),f.map((([e,s])=>(0,i.jsx)("li",{className:(0,r.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${h}`,"StickerProductsGiftIcons__icon--style",{"StickerProductsGiftIcons__icon--invalid":!t&&!s.find((e=>!e.error))}),style:{backgroundImage:`url(${(0,c.getStickerPackIconUrl)(e,p,p)})`}},e.id))),v.length?(0,i.jsxs)("li",Object.assign({className:(0,r.classNames)("StickerProductsGiftIcons__icon",`StickerProductsGiftIcons__icon--${h}`,"StickerProductsGiftIcons__icon--more",{"StickerProductsGiftIcons__icon--invalid":!k})},{children:["+",v.length]}),"more"):null]}),void 0)}},618610:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(785893),r=s(608021),n=s(70162),c=s(86894),a=s(743927),o=s(190291);const l=({style:e,options:{add:t},closeBox:s})=>(0,i.jsxs)("article",Object.assign({className:"StickerStylePreview"},{children:[(0,i.jsx)(a.ModalHeader,{className:"StickerStylePreview__header",title:(0,r.langStr)(n.getLang("purchases_stickers_stickers_of_style"),"title",e.title),onClose:s},void 0),(0,i.jsx)(o.default,{className:"StickerStylePreview__content",product:e},void 0),(0,i.jsxs)("footer",Object.assign({className:"StickerStylePreview__footer"},{children:[(0,i.jsx)(c.Button,Object.assign({mode:"tertiary",size:"m",onClick:s},{children:n.getLang("global_cancel")}),void 0),t&&(0,i.jsx)(c.Button,Object.assign({mode:"primary",size:"m",onClick:()=>t(e)},{children:n.getLang("purchases_stickers_preview_add_item")}),void 0)]}),void 0)]}),void 0)},295565:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var i=s(785893),r=s(483295),n=s(70162),c=s(647560),a=s(599940),o=s(330491),l=s(290625),d=s(171134);const u=({className:e,styles:t,isLoading:s,isAdded:u,add:g,remove:_,gift:h,activeStyle:p,selectedStyle:m,select:f})=>{const v=(0,l.default)({wrapperSelector:".StickerStylesMenu__wrapper",itemSelector:".StickerStylesMenu__item"});if(s)return(0,i.jsx)("section",Object.assign({className:(0,r.classNames)("StickerStylesMenu","StickerStylesMenu--loading",e)},{children:(0,i.jsx)(c.default,{className:"StickerStylesMenu__progress"},void 0)}),void 0);const k=[{title:n.getLang("purchases_stickers_purchased_styles"),styles:t.filter((e=>e.is_purchased&&!e.is_disabled))},{title:n.getLang("purchases_stickers_other_styles"),styles:t.filter((e=>!e.is_purchased&&!e.is_disabled&&!e.is_hidden)),tooltip:n.getLang("purchases_stickers_styles_hint")}].filter((e=>e.styles.length));return k.length?(0,i.jsxs)("section",Object.assign({className:(0,r.classNames)("StickerStylesMenu",e),ref:v.ref,onWheel:e=>v.onWheel(e)},{children:[(0,i.jsx)("a",{className:(0,r.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--prev",{"StickerStylesMenu__nav--disabled":!v.hasPrev}),onClick:()=>v.prev()},void 0),(0,i.jsx)("a",{className:(0,r.classNames)("StickerStylesMenu__nav","StickerStylesMenu__nav--next",{"StickerStylesMenu__nav--disabled":!v.hasNext}),onClick:()=>v.next()},void 0),(0,i.jsx)("div",Object.assign({className:"StickerStylesMenu__wrapper"},{children:k.map(((e,t)=>(0,i.jsxs)("section",Object.assign({className:"StickerStylesMenu__group"},{children:[(0,i.jsxs)("h2",Object.assign({className:"StickerStylesMenu__groupTitle"},{children:[e.title,e.tooltip&&(0,i.jsx)(a.default,Object.assign({className:"StickerStylesMenu__groupTitleHint",text:e.tooltip,position:"b",align:"center",appearance:"light"},{children:(0,i.jsx)(o.default,{className:"StickerStylesMenu__groupTitleHintIcon"},void 0)}),void 0)]}),void 0),(0,i.jsx)("div",Object.assign({className:"StickerStylesMenu__groupItems"},{children:e.styles.map((e=>(0,i.jsx)(d.default,{className:"StickerStylesMenu__item",style:e,isLoading:s,isAdded:u&&u(e),add:g&&(()=>g(e)),remove:_&&(()=>_(e)),gift:h&&(()=>h(e)),isActive:void 0===p?void 0:e===p,isSelected:void 0===m?void 0:e===m,select:f&&(()=>f(e))},e.id)))}),void 0)]}),t)))}),void 0)]}),void 0):null}},171134:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var i=s(785893),r=s(483295),n=s(70162),c=s(288420),a=s(938767),o=s(665820),l=s(686478),d=s(360989);const u=({className:e,style:t,isAdded:s=!1,add:u,remove:g,gift:_,isActive:h,isSelected:p,select:m})=>{let f;f=t.is_new?t.title.trim().replace(/(^|\s)([^\s]+)$/,'$1<span class="StickerStylesMenuItem__titleLastWord">$2</span>'):t.title;const v=(0,o.getSticker)(t.style_sticker_ids[0]),k=e=>t=>{t.stopPropagation(),e()};return(0,i.jsxs)("div",Object.assign({className:(0,r.classNames)("StickerStylesMenuItem",e,{"StickerStylesMenuItem--selected":Boolean(p),"StickerStylesMenuItem--added":Boolean(s),"StickerStylesMenuItem--new":t.is_new}),onClick:()=>{m?m():s?g&&g():u&&u()}},{children:[v&&(0,i.jsx)(d.default,{className:"StickerStylesMenuItem__icon",sticker:v,width:100,height:100},void 0),(0,i.jsx)(a.InnerHTML,Object.assign({Component:"div",className:"StickerStylesMenuItem__title"},{children:f}),void 0),t.is_purchased?void 0===h?(0,i.jsx)("div",Object.assign({className:"StickerStylesMenuItem__notice"},{children:n.getLang("purchases_stickers_you_have_it")}),void 0):h&&(0,i.jsx)("div",Object.assign({className:"StickerStylesMenuItem__notice"},{children:n.getLang("purchases_stickers_active_style")}),void 0):t.price.purchase.regular?(0,i.jsx)("div",Object.assign({className:"StickerStylesMenuItem__price"},{children:n.getLang("global_n_votes",t.price.purchase.current)}),void 0):(0,i.jsx)("div",Object.assign({className:"StickerStylesMenuItem__price"},{children:n.getLang("purchases_for_free_btn")}),void 0),(u||g||_&&t.can_gift)&&(0,i.jsxs)("div",Object.assign({className:"StickerStylesMenuItem__actions"},{children:[s?g&&(0,i.jsx)(c.default,Object.assign({className:"StickerStylesMenuItem__remove",appearance:"secondary",size:"s",onClick:k(g)},{children:n.getLang("purchases_stickers_preview_remove_item")}),void 0):u&&(0,i.jsx)(c.default,Object.assign({className:"StickerStylesMenuItem__add",appearance:"primary",size:"s",onClick:k(u)},{children:n.getLang("purchases_stickers_preview_add_item")}),void 0),_&&t.can_gift&&(0,i.jsx)(c.default,Object.assign({className:"StickerStylesMenuItem__gift",size:"s",appearance:"primary",onClick:k(_)},{children:(0,i.jsx)(l.default,{width:20,height:20,className:"StickerStylesMenuItem__giftIcon"},void 0)}),void 0)]}),void 0)]}),void 0)}},54637:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(785893),r=s(608021),n=s(70162),c=s(938767),a=s(749091),o=s(190291);const l=({item:e,showHeader:t=!1,remove:s})=>{if(!e.product)return null;let l="";return(0,a.isPackProduct)(e.product)?l=(0,r.langStr)(n.getLang("purchases_stickers_product_preview_title_pack"),"title",e.product.title):(0,a.isStyleProduct)(e.product)&&(l=(0,r.langStr)(n.getLang("purchases_stickers_product_preview_title_style"),"title",e.product.title)),(0,i.jsxs)("div",Object.assign({className:"StickersCartItem"},{children:[t&&(0,i.jsxs)("div",Object.assign({className:"StickersCartItem__header"},{children:[(0,i.jsx)(c.InnerHTML,Object.assign({Component:"span",className:"StickersCartItem__title"},{children:l}),void 0),s&&(0,i.jsx)("span",Object.assign({className:"StickersCartItem__actions"},{children:(0,i.jsx)("button",Object.assign({className:"StickersCartItem__remove",onClick:()=>s()},{children:n.getLang("purchases_stickers_preview_remove_item")}),void 0)}),void 0)]}),void 0),(0,i.jsx)(o.default,{className:"StickersCartItem__preview",product:e.product},void 0)]}),void 0)}},369783:(e,t,s)=>{"use strict";s.d(t,{default:()=>u});var i=s(570655),r=s(785893),n=s(667294),c=s(86894),a=s(608021),o=s(483295),l=s(70162);const d=e=>{var{className:t,price:s,text:d,placeholder:u}=e,g=(0,i.__rest)(e,["className","price","text","placeholder"]);let _=(0,n.useMemo)((()=>{if(s){let e;s.current!==s.regular&&s.regular&&(e=(0,r.jsx)("span",Object.assign({className:"StickersPriceButton__regular"},{children:s.current?s.regular:(0,a.langStr)(l.getLang("purchases_stickers_n_for_m"),"%n","","%m",l.getLang("global_n_votes",s.regular))}),"regular"));const t=(0,r.jsx)("span",Object.assign({className:"StickersPriceButton__current"},{children:s.current?l.getLang("global_n_votes",s.current):l.getLang("purchases_for_free_btn").toLowerCase()}),"current");return d?d.split(/(\{regular_price\}|\{price\})/).map(((s,i)=>"{regular_price}"===s?e:"{price}"===s?t:s?(0,r.jsx)("span",Object.assign({className:"StickersPriceButton__label"},{children:s}),`label${i}`):void 0)):[e,t]}return[u]}),[d,u,null==s?void 0:s.regular,null==s?void 0:s.current]);return(0,r.jsx)(c.Button,Object.assign({className:(0,o.classNames)("StickersPriceButton",t)},g,{children:_}),void 0)};d.defaultProps=Object.assign({},c.Button.defaultProps);const u=d},190291:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var i=s(785893),r=s(483295),n=s(511417),c=s(749091),a=s(665820),o=s(360989);const l=({className:e,product:t})=>{if(!(0,c.isPackProduct)(t)&&!(0,c.isStyleProduct)(t))return null;const s=(0,a.getStickers)((0,c.isStyleProduct)(t)?t.style_sticker_ids:t.sticker_ids),l=n.colorScheme.isDarkScheme()?c.Theme.DARK:c.Theme.LIGHT;return(0,i.jsx)("div",Object.assign({className:(0,r.classNames)("StickersProductPreview",e)},{children:(0,i.jsx)("ul",Object.assign({className:"StickersProductPreview__stickers"},{children:s.map((e=>e&&(0,i.jsx)(o.default,{className:"StickersProductPreview__sticker",sticker:e,width:128,height:128,theme:l},e.id)))}),void 0)}),void 0)}},450134:(e,t,s)=>{"use strict";s.d(t,{useCart:()=>r});var i=s(667294);const r=e=>{const[t,s]=(0,i.useState)(e),[r,n]=(0,i.useState)(null),c=(0,i.useCallback)((()=>{const e=t.load();n(e),e.then((t=>{s(t),n((t=>t===e?null:t))}),(()=>{}))}),[t]);return(0,i.useEffect)((()=>(t.onChange=c,t.isLoaded()||c(),()=>{t.onChange=null,t.cancelLoad()})),[t]),[t,null!==r]}},451322:(e,t,s)=>{"use strict";s.d(t,{usePack:()=>n});var i=s(749091),r=s(516067);const n=e=>{const[t,s]=(0,r.useProduct)(e);return t&&(0,i.isPackProduct)(t)?[t,s]:[void 0===t?void 0:null,s]}},516067:(e,t,s)=>{"use strict";s.d(t,{useProduct:()=>n});var i=s(667294),r=s(310835);const n=e=>{const[,t]=(0,i.useState)({}),s=(0,r.getProductFromCache)(e);return void 0===s?((0,r.getProduct)(e,!1).then((()=>t({})),(()=>{})),[s,!0]):[s,!1]}},227110:(e,t,s)=>{"use strict";s.d(t,{useProducts:()=>n});var i=s(667294),r=s(310835);const n=e=>{const[,t]=(0,i.useState)({}),s=(0,r.getProductsFromCache)(e);return s.some((e=>void 0===e))?((0,r.getProducts)(e,!1).then((()=>t({})),(()=>{})),[s,!0]):[s,!1]}},290625:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var i=s(667294);const r={getOffset:()=>({x:0,y:0}),scrollTo:()=>{},scrollBy:()=>{},onWheel:()=>{},updateItems:()=>{},hasPrev:!1,hasNext:!1,prev:()=>{},next:()=>{}};function n(e,t){switch(t.type){case"updateState":return Object.assign(Object.assign({},e),t.state);case"updateNav":return t.hasPrev!==e.hasPrev||t.hasNext!==e.hasNext?Object.assign(Object.assign({},e),{hasPrev:t.hasPrev,hasNext:t.hasNext}):e;default:throw new Error}}const c=e=>{const t=Array.from(e.entries());for(let e=0;e<t.length;e++){const[s,i]=t[e];if(i&&i.intersectionRatio)return i.intersectionRatio<1?s:t[e-1]?t[e-1][0]:null}return null},a=e=>{const t=Array.from(e.entries());for(let e=t.length-1;e>=0;e--){const[s,i]=t[e];if(i&&i.intersectionRatio)return i.intersectionRatio<1?s:t[e+1]?t[e+1][0]:null}return null};const o=function(e){const t=(0,i.useRef)(null),[s,o]=(0,i.useReducer)(n,r),l=(0,i.useCallback)((e=>{o({type:"updateState",state:e})}),[o]),d=(0,i.useCallback)((i=>{if(t.current&&s.onMouseWheel&&t.current.removeEventListener("mousewheel",s.onMouseWheel),i){const t=i.querySelector(e.wrapperSelector);if(t){let r={x:0,y:0};const n=new Map,d=()=>r;let u;const g=()=>{u&&u.disconnect(),u=new IntersectionObserver((e=>{for(const t of e)n.has(t.target)&&n.set(t.target,t);o({type:"updateNav",hasPrev:null!==c(n),hasNext:null!==a(n)})}),{root:i,threshold:[0,1]}),n.clear();for(const t of i.querySelectorAll(e.itemSelector))n.set(t,null),u.observe(t)},_=s=>{let n=0;t.offsetWidth>i.offsetWidth&&(n=Math.max(0,Math.min(t.offsetWidth-i.offsetWidth,s.x)));let c=0;t.offsetHeight>i.offsetHeight&&(c=Math.max(0,Math.min(t.offsetHeight-i.offsetHeight,s.y))),t.style.transform=`translate3d(-${n}px, -${c}px, 0)`,t.style.transitionDuration=s.noTransition?"0s":"",r={x:n,y:c},e.onScroll&&e.onScroll(n,c)},h=e=>{_(Object.assign(Object.assign({},e),{x:r.x+e.x,y:r.y+e.y}))},p=e=>{h({x:e.deltaX,y:e.deltaY,noTransition:!0})},m=()=>{const e=c(n);if(e){const s=getComputedStyle(t),i=parseInt(s.paddingLeft)||0,r=parseInt(s.paddingTop)||0,n=t.getBoundingClientRect(),c=e.getBoundingClientRect();_({x:c.left-n.left-i,y:c.top-n.top-r})}},f=()=>{const e=a(n);if(e){const s=getComputedStyle(t),r=parseInt(s.paddingBottom)||0,n=parseInt(s.paddingRight)||0,c=i.getBoundingClientRect(),a=t.getBoundingClientRect(),o=e.getBoundingClientRect();_({x:o.left-a.left-c.width+o.width+n,y:o.top-a.top-c.height+o.height+r})}},v=e=>{e.deltaX&&e.preventDefault()};i.addEventListener("mousewheel",v),l(Object.assign(Object.assign({},s),{onMouseWheel:v,updateItems:g,getOffset:d,scrollTo:_,scrollBy:h,onWheel:p,prev:m,next:f}))}}t.current=i}),[e.wrapperSelector,e.itemSelector,e.onScroll]);return(0,i.useLayoutEffect)((()=>{s.updateItems()})),Object.assign({ref:d},s)}},683791:(e,t,s)=>{"use strict";s.d(t,{useStyles:()=>n});var i=s(749091),r=s(227110);const n=e=>{const[t,s]=(0,r.useProducts)(e),n=[];for(const e of t)e&&(0,i.isStyleProduct)(e)&&n.push(e);return[n,s]}},155639:(e,t,s)=>{"use strict";s.d(t,{useWithProducts:()=>n});var i=s(667294),r=s(227110);function n(e){const[t,s]=(0,r.useProducts)(e.map((e=>e.product_id)));return[(0,i.useMemo)((()=>e.map(((e,s)=>Object.assign(Object.assign({},e),{product:t[s]})))),[e]),s]}},751595:(e,t,s)=>{"use strict";s.d(t,{previewSticker:()=>f,previewStickerProduct:()=>v});var i=s(785893),r=s(973935),n=s(99656),c=s(146143),a=s(70162),o=s(749091),l=s(310835),d=s(665820),u=s(399321),g=s(501389),_=s(60578),h=s(187925),p=s(618610);const m=new Map;function f(e,t){const s=(0,g.showBoxLoader)();(0,d.getPackByStickerId)(e).then((e=>{!(0,g.isBoxLoadingCancelled)(s)&&e&&((0,g.hideBoxLoader)(),v(e.id,t))}),(()=>{}))}function v(e,t){let s;const d=Object.assign({},t);function f(){return null==s?void 0:s.bodyNode.querySelector(".StickersProductPreviewBox")}function v(){null==s||s.hide(),window.nav.objLoc[0].match(/^stickers\/(.*?)$/)&&window.nav.setLoc({0:"stickers"})}function k(){null==s||s.updateBoxCoords()}function S(e,t){let s=null,c=null;if((0,o.isPackProduct)(e))s=e.is_purchased&&(null==d?void 0:d.settings)?(0,i.jsx)(h.default,{pack:e,options:d,closeBox:v,updateBox:k},void 0):(0,i.jsx)(_.default,{pack:e,cart:t,options:d,closeBox:v,updateBox:k},void 0),c=e.name;else if((0,o.isStyleProduct)(e)){const r=(0,l.getProductFromCache)(e.base_id);if(r)return t.addProduct(r.id,!0),void S(r,t);s=(0,i.jsx)(p.default,{style:e,options:d,closeBox:v,updateBox:k},void 0),c=e.name}const a=f();if(a&&s&&(r.render((0,i.jsx)(n.AppRootProvider,{children:s},void 0),a),c)){const e=window.nav.objLoc[0].split("/");"stickers"===e[0]&&e[1]!==c&&window.nav.setLoc({0:"stickers/"+c})}}const y=(0,g.showBoxLoader)(!1),j=u.Cart.create([e]);return Promise.all([j.load(),window.stManager.add(["stickers.css"])]).then((([t])=>{if((0,g.isBoxLoadingCancelled)(y))return;(0,g.hideBoxLoader)();const i=(0,l.getProductFromCache)(e);i&&!i.is_disabled?(s=new c.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:640,onShow(){S(i,t),requestAnimationFrame((()=>{k(),function(){if(m.has(e)){const t=(0,g.getBoxLayerWrap)();t&&(t.scrollTop=m.get(e)||0),m.delete(e)}}()}))},onBeforeHide(){!function(){const t=(0,g.getBoxLayerWrap)();t&&m.set(e,t.scrollTop)}()},onHideAttempt:()=>(function(){const e=f();e&&r.unmountComponentAtNode(e)}(),!0)}),s.content('<div class="StickersProductPreviewBox"></div>'),s.show()):(0,c.showFastBox)(a.getLang("global_box_error_title"),a.getLang("purchases_stickers_product_not_found"))}),(()=>{})),{hide:v}}},310835:(e,t,s)=>{"use strict";s.d(t,{cacheProductsData:()=>n,getProductFromCache:()=>c,getProductsFromCache:()=>a,getProducts:()=>d,getProduct:()=>u,activateProduct:()=>g,updateUserProductState:()=>_});var i=s(514191),r=s(665820);const n=(e,t=[])=>{const s=(0,r.getCache)();if(e.stickers){const{stickers:t}=s;for(const s of e.stickers)t.has(s.id)?t.set(s.id,Object.assign(Object.assign({},t.get(s.id)),s)):t.set(s.id,s)}if(e.products)for(const t of e.products)s.products.set(t.id,t),s.productPromises.delete(t.id);for(const e of t)s.products.has(e)||s.products.set(e,null),s.productPromises.delete(e);e.emoji&&window.Emoji&&window.Emoji.updateTabs(e.emoji.stickers,e.emoji.keywords,!0),(0,r.updateCache)(s)},c=e=>(0,r.getCache)().products.get(e),a=e=>{const t=(0,r.getCache)().products;return e.map((e=>t.get(e)))};function o(){let{productsPromise:e}=(0,r.getCache)();return e||(e=new Promise((e=>setTimeout((()=>{const t=(0,r.getCache)().productIdsQueue,s=Array.from(t);t.clear(),(0,r.updateCache)({productIdsQueue:t,productsPromise:void 0}),i.ajax.post("stickers.php",{act:"get_products",product_ids:s},{onDone(t){n(t,s),e([])},onFail:t=>(console.error(t),n({},s),e([]),!0)})}),300))),(0,r.updateCache)({productsPromise:e})),e}const l=e=>{if(!e.length)return Promise.resolve([]);const{productPromises:t,productIdsQueue:s}=(0,r.getCache)(),i=new Set;for(const r of e)if(t.has(r)){const e=t.get(r);e&&i.add(e)}else{s.add(r);const e=o();t.set(r,e),i.add(e)}return(0,r.updateCache)({productIdsQueue:s,productPromises:t}),Promise.all(i).then((()=>a(e)))},d=(e,t=!0)=>{const s=t?e.filter((e=>void 0===c(e))):e;return s.length?l(s).then((()=>a(e))):Promise.resolve(a(e))},u=(e,t=!0)=>{if(t){const t=c(e);if(void 0!==t)return Promise.resolve(t)}return l([e]).then((()=>c(e)))},g=e=>new Promise((t=>{i.ajax.post("stickers.php",{act:"activate_product",product_id:e.id,hash:e.csrf_hash},{onDone(e){n(e),t()},onFail:e=>(console.error(e),t(),!0)})})),_=(e,t,s,r=!0)=>new Promise((c=>{i.ajax.post("stickers.php",{act:"update_user_product_state",product_ids:[e],key:t,value:s},{onDone(e){r&&n(e),c()},onFail:e=>(console.error(e),c(),!0)})}))},870264:(e,t,s)=>{"use strict";s.d(t,{giftStickersCart:()=>u,giftStickerProducts:()=>g});var i=s(785893),r=s(973935),n=s(99656),c=s(146143),a=s(399321),o=s(348230),l=s(665820),d=s(490808);function u(e,t){const{productsGiftLock:s}=(0,l.getCache)();if(s)return null;let a;(0,l.updateCache)({productsGiftLock:!0});const u=Object.assign({},t);function g(){return null==a?void 0:a.bodyNode.querySelector(".StickersProductsGift")}function _(){null==a||a.hide()}function h(){null==a||a.updateBoxCoords()}return(0,o.showLoader)(),e.isGift=!0,Promise.all([e.load(!0),window.stManager.add(["stickers.css","wide_dd.js","wide_dd.css"])]).then((([e])=>{(0,o.hideLoader)(),a=new c.MessageBox({hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:450,onShow(){!function(e){const t=g();t&&r.render((0,i.jsx)(n.AppRootProvider,{children:(0,i.jsx)(d.default,{cart:e,options:u,closeBox:_,updateBox:h},void 0)},void 0),t)}(e),requestAnimationFrame((()=>{h()}))},onHideAttempt:()=>(function(){const e=g();e&&r.unmountComponentAtNode(e)}(),!0),onHide(){(0,l.updateCache)({productsGiftLock:!1})}}),a.content('<div class="StickersProductsGift"></div>'),a.show()}),(()=>{})),{hide:_}}function g(e,t=[],s){return u(a.Cart.create(e,t),s)}},348230:(e,t,s)=>{"use strict";s.d(t,{getBoxLayerWrap:()=>d,showLoader:()=>u,hideLoader:()=>g,getPurchaseResult:()=>_,updateStickersFromQueue:()=>h,getLangCode:()=>p});var i=s(608021),r=s(70162),n=s(511417),c=s(873589),a=s(501389),o=s(749091);function l(){return document.querySelector("#box_loader")}function d(){return document.querySelector("#box_layer_wrap")}function u(){const e=l();(0,a.boxRefreshCoords)(e),(0,c.show)(e),(0,c.show)(d())}function g(){(0,c.hide)(l())}function _(e){const t=new o.ProductsByType(e.items.filter((e=>!e.error)).map((e=>e.product))),s=t.getPack(),n=t.getStyles();if(s)return n.length?(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_pack_and_styles",n.length),"pack_title",s.title,"n",n.length):(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_pack"),"title",s.title);if(n.length)switch(n.length){case 1:return(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_1_style"),"title",n[0].title);case 2:return(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_2_styles"),"title1",n[0].title,"title2",n[1].title);case 3:return(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_3_styles"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);case 4:return(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_3_styles_and_1_more"),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title);default:const e=n.length-3;return(0,i.langStr)(r.getLang("purchases_stickers_purchase_result_3_styles_and_n_more",e),"title1",n[0].title,"title2",n[1].title,"title3",n[2].title,"n",e)}return null}function h(e){!function(e){const t=n.colorScheme.isDarkScheme()?"data-src-dark":"data-src-light";e.querySelectorAll(`.sticker_img[${t}]`).forEach((e=>{const s=e.getAttribute(t);s&&(e.src=s)}))}(e)}const p=()=>window.vk.lang||"ru"},575867:(e,t,s)=>{"use strict";s.d(t,{vmojiSubscribeToQueue:()=>r,vmojiPurchaseProduct:()=>n,vmojiGetAvatar:()=>c,vmojiGetStickerPacksRecommendationBlocks:()=>a,vmojiGetStickerPacksRecommendationBlock:()=>o,vmojiGetStickerPacks:()=>l,vmojiGetCharacterById:()=>d,vmojiSetAvatarState:()=>u,storeActivateProduct:()=>g,storeDeactivateProduct:()=>_,VmojiLangSection:()=>h,vmojiGetLangs:()=>p});var i=s(189798);const r=()=>(0,i.api)("vmoji.subscribeToQueue",{}),n=(e,t=!1)=>(0,i.api)("vmoji.purchaseProduct",{product_id:e,confirm:t?1:0}),c=e=>{const t={};return e&&Object.assign(t,{avatar_id:e}),(0,i.api)("vmoji.getAvatar",t)},a=e=>(0,i.api)("vmoji.getStickerPacksRecommendationBlocks",e),o=(e,t)=>{const s={block_id:e};return t&&Object.assign(s,{count:t}),(0,i.api)("vmoji.getStickerPacksRecommendationBlock",s)},l=e=>(0,i.api)("vmoji.getStickerPacks",e),d=(e,t)=>(0,i.api)("vmoji.getCharacterById",{character_id:e,with_stickers:t?1:0}),u=(e,t)=>(0,i.api)("vmoji.setAvatarState",{avatar_id:e,is_active:t?1:0}),g=e=>(0,i.api)("store.activateProduct",{type:"stickers",product_id:e}),_=e=>(0,i.api)("store.deactivateProduct",{type:"stickers",product_id:e});var h;!function(e){e.LAYER="layer",e.PURCHASE="purchase"}(h||(h={}));const p=e=>new Promise(((t,s)=>{window.ajax.post("al_vmoji.php",{act:"lang_keys",section:e},{onDone:()=>{t()},onFail:()=>(s(),!1)})}))}}]);try{stManager.done("dist/eee28a6f0b8a039c3e39114fcc5571a5.07fb0bb6b8c89464972b.js")}catch(e){}