(self.webpackChunkvk=self.webpackChunkvk||[]).push([[23299],{612214:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=(0,r(951201).makeIcon)("Icon12OnlineMobile","online_mobile_12","0 0 8 12",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 8 12" id="online_mobile_12"><path fill="currentColor" d="M5.99 0C7.1 0 8 .9 8 2.01v7.98C8 11.1 7.1 12 5.99 12H2.01C.9 12 0 11.1 0 9.99V2.01C0 .9.9 0 2.01 0h3.98Zm.007 3H2.004a.502.502 0 0 0-.503.502v4.995c0 .278.225.503.503.503h3.995a.502.502 0 0 0 .502-.502V3.503A.502.502 0 0 0 5.997 3Z" /></symbol>',8,12,!1,void 0)},76109:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=(0,r(951201).makeIcon)("Icon24Cancel","cancel_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="cancel_24"><path d="M7.536 6.264a.9.9 0 0 0-1.272 1.272L10.727 12l-4.463 4.464a.9.9 0 0 0 1.272 1.272L12 13.273l4.464 4.463a.9.9 0 1 0 1.272-1.272L13.273 12l4.463-4.464a.9.9 0 1 0-1.272-1.272L12 10.727 7.536 6.264Z" /></symbol>',24,24,!1,void 0)},718305:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=(0,r(951201).makeIcon)("Icon28ChevronLeftOutline","chevron_left_outline_28","0 0 28 28",'<symbol fill="none" viewBox="0 0 28 28" xmlns="http://www.w3.org/2000/svg" id="chevron_left_outline_28"><path d="m12.414 14 5.793-5.793a1 1 0 0 0-1.414-1.414l-6.5 6.5a1 1 0 0 0 0 1.414l6.5 6.5a1 1 0 0 0 1.414-1.414z" fill="currentColor" /></symbol>',28,28,!1,void 0)},516013:(e,t,r)=>{"use strict";r.d(t,{Player:()=>o});var a=r(722122),s=r(675648),n=r(262448),i="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=";class o extends s.EventEmitter{constructor(e){super(),this.player=void 0,this.state=void 0,this.state=e,this.player=document.createElement("audio"),this.player.volume=e.volume/100,this.player.src=i,this.player.playbackRate=e.playbackRate,this.player.addEventListener("ended",(()=>{var e=this.state.currentTrackEntity;if(null==e?void 0:e.audioTrack){var t=(0,a.default)({},this.state,{status:"ended"});this.setState(t),this.stopCurrentTrackAutomatically(),this.startNextTrackAutomatically()}})),this.player.addEventListener("error",(()=>{this.stopCurrentTrackByError()})),this.player.addEventListener("timeupdate",(()=>{var e,t=(0,a.default)({},this.state);if(null==(e=t.currentTrackEntity)?void 0:e.audioTrack){var r=this.player,s=r.currentTime,n=r.duration,i=t.currentTrackEntity.audioTrack,o=i.duration,u=i.progress,c=i.id,d=s/o;d>0&&(t.playedTimeAccumulator[c]=(e=>{for(var t=e.played,r=0,a=0;a<t.length;a++)r+=t.end(a)-t.start(a);return r})(this.player)),this.setState((0,a.default)({},t,{currentTrackEntity:(0,a.default)({},t.currentTrackEntity,{audioTrack:(0,a.default)({},t.currentTrackEntity.audioTrack,{progress:d>1?1:d})})})),n===1/0&&(0===d&&0!==u||d>1)&&this.player.dispatchEvent(new Event("ended"))}}))}play(e,t){var r,a;(null==(r=this.state.currentTrackEntity)||null==(a=r.audioTrack)?void 0:a.url)!==e.audioTrack.url?("stopped"!==this.state.status&&this.stopCurrentTrackBeforeStartingNewTrack(),this.startNewTrack(e,t)):"stopped"===this.state.status?this.repeateCurrentTrack(e,t):"paused"===this.state.status?this.resumeTrack(e,t):this.player.currentTime=e.audioTrack.duration*e.audioTrack.progress}playNext(e,t){var r=this.getState(),a=r.shuffle,s=r.repeatMode,n=t.getNext(e,a,s);n&&this.play(n,t)}playPrev(e,t){var r=this.getState(),a=r.shuffle,s=r.repeatMode,n=t.getPrev(e,a,s);n&&this.play(n,t)}pause(){var e=this.state,t=e.currentTrackEntity,r=e.playlist,s=e.playedTimeAccumulator,i=null==t?void 0:t.audioTrack;if(i){var o=this.player.currentTime,u=i.duration,c=(0,a.default)({},this.state,{status:"paused",playlist:r,playedTimeAccumulator:s,currentTrackEntity:(0,a.default)({},t,{audioTrack:(0,a.default)({},i,{progress:o/u})})});this.setState(c),this.player.pause();var d={state:c};this.emit(n.PlayerEventTypes.PAUSE_CURRENT_TRACK,d)}}resume(){var e=this.state,t=e.currentTrackEntity,r=e.playlist;(null==t?void 0:t.audioTrack)&&this.resumeTrack(t,r)}resetCurrentTrackState(){var e=this.state,t=e.currentTrackEntity,r=e.playlist,s=e.playedTimeAccumulator,n=null==t?void 0:t.audioTrack;if(n){var i=(0,a.default)({},this.state,{status:"stopped",playlist:r,playedTimeAccumulator:s,currentTrackEntity:(0,a.default)({},t,{audioTrack:(0,a.default)({},n,{progress:0})})});this.setState(i)}}startNewTrack(e,t){var r=this.getState(),s=(0,a.default)({},r,{status:"playing",playlist:t,playedTimeAccumulator:{},currentTrackEntity:e});this.setState(s);var i={state:s};this.emit(n.PlayerEventTypes.START_NEW_TRACK,i);var o=e.audioTrack.url,u=e.audioTrack.duration*e.audioTrack.progress;this.playHTML5Player(o,u)}resumeTrack(e,t){var r,s,i,o,u,c=this.getState(),d=(0,a.default)({},c,{status:"playing",playlist:t,playedTimeAccumulator:c.playedTimeAccumulator,currentTrackEntity:e}),l=null==(r=c.currentTrackEntity)||null==(s=r.audioTrack)?void 0:s.url;this.player.duration!==1/0&&(null==(i=this.state.currentTrackEntity)||null==(o=i.audioTrack)?void 0:o.progress)!==e.audioTrack.progress&&(u=e.audioTrack.duration*e.audioTrack.progress),this.setState(d);var p={state:d};this.emit(n.PlayerEventTypes.RESUME_TRACK,p),this.playHTML5Player(l,u)}repeateCurrentTrack(e,t){this.startNewTrack(e,t)}startNextTrackAutomatically(){var e=this.getState(),t=e.playlist,r=e.currentTrackEntity,s=e.repeatMode,i=e.shuffle,o={state:e};if(t&&r){var u="one"===s?(0,a.default)({},r,{audioTrack:(0,a.default)({},r.audioTrack,{progress:0})}):t.getNext(r,i,s);if(u){var c=(0,a.default)({},e,{status:"playing",playlist:t,playedTimeAccumulator:{},currentTrackEntity:u});this.setState(c),o={state:c},this.emit(n.PlayerEventTypes.START_NEXT_TRACK_AUTOMATICALLY,o);var d=u.audioTrack.url,l=u.audioTrack.duration*u.audioTrack.progress;this.playHTML5Player(d,l)}else this.emit(n.PlayerEventTypes.PLAYLIST_ENDED,o)}else this.emit(n.PlayerEventTypes.PLAYLIST_ENDED,o)}stopCurrentTrackAutomatically(){if(this.state.currentTrackEntity){var e={state:(0,a.default)({},this.state)};this.emit(n.PlayerEventTypes.STOP_CURRENT_TRACK_AUTOMATICALLY,e),this.resetCurrentTrackState(),this.player.duration===1/0&&(this.player.src="")}}stopCurrentTrackBeforeStartingNewTrack(){var e=this.state,t=e.currentTrackEntity,r=e.status,s=null==t?void 0:t.audioTrack;if(s&&"playing"===r){this.player.pause();var i={state:(0,a.default)({},this.state,{status:"stopped"})};this.emit(n.PlayerEventTypes.STOP_CURRENT_TRACK_BEFORE_STARTING_NEW_TRACK,i),this.resetCurrentTrackState()}else s&&"paused"===r&&this.resetCurrentTrackState()}stopCurrentTrackByError(){var e=this.state.currentTrackEntity;if(null==e?void 0:e.audioTrack){this.resetCurrentTrackState();var t={state:this.state};this.emit(n.PlayerEventTypes.STOP_CURRENT_TRACK_BY_ERROR,t)}}stopPlayer(){var e;(null==(e=this.state.currentTrackEntity)?void 0:e.audioTrack)&&(this.pause(),this.resetCurrentTrackState(),this.setState((0,a.default)({},this.state,{currentTrackEntity:void 0,playlist:void 0})))}seek(e){var t=this.getState(),r=t.currentTrackEntity,s=null==r?void 0:r.audioTrack;if(s){var n=(0,a.default)({},t,{currentTrackEntity:(0,a.default)({},r,{audioTrack:(0,a.default)({},s,{progress:e})})});this.player.currentTime=s.duration*e,this.setState(n)}}setState(e){this.state=e,this.player.volume=e.volume/100,this.player.muted=e.mute,this.player.playbackRate=e.playbackRate,this.emit("stateupdated",e)}getState(){return(0,a.default)({},this.state)}forceUpdate(e){var t,r;this.setState(e),this.player.src=(null==(t=e.currentTrackEntity)||null==(r=t.audioTrack)?void 0:r.url)||i}setVolume(e){var t=(0,a.default)({},this.getState(),{mute:!1,volume:e});this.setState(t)}setMute(e){var t=(0,a.default)({},this.getState(),{mute:e});this.setState(t)}setShuffle(e){var t=this.getState(),r=(0,a.default)({},t,{shuffle:e});this.setState(r)}setRepeatMode(e){var t=this.getState(),r=(0,a.default)({},t,{repeatMode:e});this.setState(r)}setPlaybackRate(e){var t=this.getState();this.setState((0,a.default)({},t,{playbackRate:e}))}playHTML5Player(e,t){"number"==typeof t&&(this.player.currentTime=t),e&&this.player.src!==e&&(this.player.src=e),this.player.play().then((()=>{"playing"!==this.getState().status&&this.player.pause(),e&&this.player.src!==e&&this.player.pause()})).catch((()=>{this.stopCurrentTrackByError()}))}}},211541:(e,t,r)=>{"use strict";r.d(t,{PlayerStorage:()=>n,VoicePlayerStorage:()=>i});var a=r(423481),s=r(77509);class n extends a.Storage{getPlaylist(){var e=this.get("reforged_audio_player_playlist");if((0,s.isRestoredConvoAudiosPlaylist)(e))return new s.ConvoAudiosPlaylist(e)}getCurrentTrack(){var e=this.get("reforged_audio_player_track");if((0,s.isConvoAudioTrack)(e))return e}getVolume(){return this.get("reforged_audio_player_volume")}storeVolume(e){this.set("reforged_audio_player_volume",e)}getMute(){return this.get("reforged_audio_player_mute")}storeMute(e){this.set("reforged_audio_player_mute",e)}getShuffle(){return this.get("reforged_audio_player_shuffle")}storeShuffle(e){this.set("reforged_audio_player_shuffle",e)}getRepeatMode(){return this.get("reforged_audio_player_repeat_mode")}storeRepeatMode(e){this.set("reforged_audio_player_repeat_mode",e)}invalidatePlayerStateCache(){var e=this.get("reforged_audio_player_saved")||0;Date.now()-72e5>e&&(this.del("reforged_audio_player_playlist"),this.del("reforged_audio_player_saved"),this.del("reforged_audio_player_track"))}restorePlayerState(){this.invalidatePlayerStateCache();var e=this.getVolume()||100,t=this.getMute()||!1,r=this.getShuffle()||!1,a=this.getRepeatMode()||"none";return{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:this.getCurrentTrack(),playlist:this.getPlaylist(),volume:e,mute:t,shuffle:r,repeatMode:a,playbackRate:1}}storePlayerState(e){var t=e.currentTrackEntity,r=e.playlist,a=e.volume;this.set("reforged_audio_player_saved",Date.now()),this.set("reforged_audio_player_volume",a),t?this.set("reforged_audio_player_track",t):this.del("reforged_audio_player_track"),r?r instanceof s.ConvoAudiosPlaylist&&this.set("reforged_audio_player_playlist",{meta:r.getPlaylistMeta(),list:r.getConvoAudiosList()}):this.del("reforged_audio_player_playlist")}}class i extends a.Storage{getVolume(){return this.get("reforged_voice_player_volume")}storeVolume(e){this.set("reforged_voice_player_volume",e)}getMute(){return this.get("reforged_voice_player_mute")}storeMute(e){this.set("reforged_voice_player_mute",e)}getPlaybackRate(){return this.get("reforged_voice_player_playback_rate")}storePlaybackRate(e){this.set("reforged_voice_player_playback_rate",e)}restorePlayerState(){return{status:"stopped",playedTimeAccumulator:{},volume:this.getVolume()||100,mute:this.getMute()||!1,shuffle:!1,repeatMode:"none",playbackRate:this.getPlaybackRate()||1}}}},535779:(e,t,r)=>{"use strict";r.d(t,{BroadcastChannel:()=>s});var a=r(675648);class s extends a.EventEmitter{constructor(){super(),this.connectionId=void 0,this.connectionId="queue_connection_events_queue78668286",window.addEventListener("storage",(e=>{try{if(e.key===this.connectionId&&e.newValue){var t=JSON.parse(e.newValue),r=null==t?void 0:t.__act;r&&super.emit(r)}}catch(e){}}))}emit(e){var t=this.connectionId,r=JSON.stringify((e=>({__act:e}))(e));window.localStorage.removeItem(t),window.localStorage.setItem(t,r)}emitLocally(e,t){super.emit(e,t)}}},261383:(e,t,r)=>{"use strict";function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return s(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}r.d(t,{ExternalEvents:()=>n});class n{constructor(){this.listeners=[],this.send=(e,t)=>{for(var r,s=a(this.listeners);!(r=s()).done;){(0,r.value)(e,t)}},this.subscribe=e=>(this.listeners.push(e),()=>{this.listeners=this.listeners.filter((t=>t!==e))})}}},308996:(e,t,r)=>{"use strict";r.d(t,{MEAppMediaMediator:()=>s});var a=r(535779);class s{constructor(){this.broadcastChannel=new a.BroadcastChannel,this.player=null,this.voicePlayer=null,this.videoMessagePlayer=null,this.currentMedia=null,this.prevMedia=null,this.destroy=()=>{this.currentMedia=null,this.prevMedia=null,this.player=null,this.voicePlayer=null,this.videoMessagePlayer=null,this.broadcastChannel.unsubscribe("audio_start",this.pauseCurrentMedia),this.broadcastChannel.unsubscribe("video_message_start",this.pauseCurrentMedia),this.broadcastChannel.unsubscribe("stories_video_start",this.pauseCurrentMedia)},this.pauseCurrentMedia=()=>{var e;(null==(e=this.currentMedia)?void 0:e.isPlaying())&&this.currentMedia.handleMediaMediatorPause()},this.handlePlayerOn=e=>{if(this.broadcastChannel.emit("audio_start"),this.player=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.player){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.player):(this.prevMedia=null,this.currentMedia=this.player)}}else this.prevMedia=null,this.currentMedia=this.player},this.handleVoicePlayerOn=e=>{if(this.broadcastChannel.emit("audio_start"),this.voicePlayer=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.voicePlayer){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.voicePlayer):(this.prevMedia=null,this.currentMedia=this.voicePlayer)}}else this.prevMedia=null,this.currentMedia=this.voicePlayer},this.handleVoicePlayerOff=e=>{this.voicePlayer=e,this.currentMedia&&this.currentMedia===this.voicePlayer&&(this.currentMedia=null,this.prevMedia&&(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null))},this.handleVideoMessagePlayerOn=e=>{if(this.broadcastChannel.emit("video_message_start"),this.videoMessagePlayer=e,this.currentMedia){if(this.currentMedia&&this.currentMedia!==this.videoMessagePlayer){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=this.videoMessagePlayer):(this.prevMedia=null,this.currentMedia=this.videoMessagePlayer)}}else this.prevMedia=null,this.currentMedia=this.videoMessagePlayer},this.handleVideoMessagePlayerOff=e=>{this.videoMessagePlayer=e,this.currentMedia&&this.currentMedia===this.videoMessagePlayer&&(this.currentMedia=null,this.prevMedia&&(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null))},this.handleVoiceRecorderOn=()=>{if(this.broadcastChannel.emit("audio_start"),this.currentMedia||this.prevMedia!==this.player)if(this.currentMedia){if(this.currentMedia){this.currentMedia.isPlaying()?(this.currentMedia.handleMediaMediatorPause(),this.prevMedia=this.currentMedia,this.currentMedia=null):(this.prevMedia=null,this.currentMedia=null)}}else this.prevMedia=null,this.currentMedia=null},this.handleVoiceRecorderOff=()=>{this.prevMedia&&this.prevMedia===this.player?(this.prevMedia.handleMediaMediatorResume(),this.currentMedia=this.prevMedia,this.prevMedia=null):(this.currentMedia=null,this.prevMedia=null)},this.broadcastChannel.subscribe("audio_start",this.pauseCurrentMedia),this.broadcastChannel.subscribe("video_message_start",this.pauseCurrentMedia),this.broadcastChannel.subscribe("stories_video_start",this.pauseCurrentMedia)}}},42759:(e,t,r)=>{"use strict";r.d(t,{MEAppPlayer:()=>c,MEAppVoicePlayer:()=>d,MEAppVideoMessagePlayer:()=>l});var a=r(722122),s=r(516013),n=r(401690),i=r(211541),o=r(262448),u=r(616963);class c extends s.Player{constructor(e){super({status:"stopped",playedTimeAccumulator:{},volume:100,mute:!1,shuffle:!1,repeatMode:"none",playbackRate:1}),this.mediaMediator=void 0,this.playerStorage=void 0,this.init=e=>{this.playerStorage=new i.PlayerStorage(u.STORAGE_DB_NAME),this.playerStorage.identify(e);var t=this.playerStorage.restorePlayerState();this.forceUpdate(t)},this.subscribe(o.PlayerEventTypes.START_NEW_TRACK,(e=>{this.playerStorage.storePlayerState((0,a.default)({},e.state,{status:"stopped"}))})),this.subscribe(o.PlayerEventTypes.START_NEXT_TRACK_AUTOMATICALLY,(e=>{this.playerStorage.storePlayerState((0,a.default)({},e.state,{status:"stopped"}))})),this.mediaMediator=e}play(e,t){return this.mediaMediator.handlePlayerOn(this),super.play(e,t)}setVolume(e){super.setVolume(e);var t=this.getState(),r=t.volume,a=t.mute;this.playerStorage.storeVolume(r),this.playerStorage.storeMute(a)}setMute(e){super.setMute(e);var t=this.getState(),r=t.volume,a=t.mute;this.playerStorage.storeVolume(r),this.playerStorage.storeMute(a)}setShuffle(e){super.setShuffle(e);var t=this.getState().shuffle;this.playerStorage.storeShuffle(t)}setRepeatMode(e){super.setRepeatMode(e);var t=this.getState().repeatMode;this.playerStorage.storeRepeatMode(t)}stopPlayer(){super.stopPlayer();var e=this.getState();this.playerStorage.storePlayerState((0,a.default)({},e,{status:"stopped"}))}isPlaying(){return"playing"===this.getState().status}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}}class d extends s.Player{constructor(e){super({status:"stopped",playedTimeAccumulator:{},volume:100,mute:!1,shuffle:!1,repeatMode:"none",playbackRate:1}),this.mediaMediator=void 0,this.playerStorage=void 0,this.init=e=>{this.playerStorage=new i.VoicePlayerStorage(u.STORAGE_DB_NAME),this.playerStorage.identify(e);var t=this.playerStorage.restorePlayerState();this.forceUpdate(t)},this.pause=()=>{super.pause(),this.mediaMediator.handleVoicePlayerOff(this)},this.mediaMediator=e,this.subscribe(o.PlayerEventTypes.PLAYLIST_ENDED,(()=>this.mediaMediator.handleVoicePlayerOff(this)))}setVolume(e){var t,r;super.setVolume(e);var a=this.getState(),s=a.volume,n=a.mute;null==(t=this.playerStorage)||t.storeVolume(s),null==(r=this.playerStorage)||r.storeMute(n)}setMute(e){var t,r;super.setMute(e);var a=this.getState(),s=a.volume,n=a.mute;null==(t=this.playerStorage)||t.storeVolume(s),null==(r=this.playerStorage)||r.storeMute(n)}setPlaybackRate(e){var t;super.setPlaybackRate(e);var r=this.getState().playbackRate;null==(t=this.playerStorage)||t.storePlaybackRate(r)}play(e,t){return this.mediaMediator.handleVoicePlayerOn(this),super.play(e,t)}isPlaying(){return"playing"===this.getState().status}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}}class l extends n.VideoMessagePlayer{constructor(e){super({status:"stopped",settings:{volume:1,playbackRate:1,muted:!1}}),this.mediaMediator=void 0,this.pause=()=>{super.pause(),this.mediaMediator.handleVideoMessagePlayerOff(this)},this.mediaMediator=e}play(e,t){this.mediaMediator.handleVideoMessagePlayerOn(this),super.play(e,t)}resume(){this.mediaMediator.handleVideoMessagePlayerOn(this),super.resume()}stop(){this.mediaMediator.handleVideoMessagePlayerOff(this),super.stop()}destroy(){this.mediaMediator.destroy()}isPlaying(){return"playing"===this.getState().status}handleMediaMediatorResume(){super.resume()}handleMediaMediatorPause(){super.pause()}}},423481:(e,t,r)=>{"use strict";r.d(t,{Storage:()=>i});var a=r(887757),s=r(692137),n=r(891047);class i{constructor(e){var t=this;this.dbName=void 0,this.idbStorage=void 0,this.idbStoreName="storage",this.viewerPeerId=void 0,this.identify=e=>{this.viewerPeerId=e},this.get=e=>{var t=this.mapKey(e);try{var r=localStorage.getItem(t);if(!r)return;return JSON.parse(r,u)}catch(e){return}},this.set=(e,t)=>{var r=this.mapKey(e);try{localStorage.setItem(r,JSON.stringify(t,o))}catch(e){}},this.del=e=>{var t=this.mapKey(e);try{localStorage.removeItem(t)}catch(e){}},this.getIDB=function(){var e=(0,s.default)(a.mark((function e(r){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.mapKey(r),e.next=3,n.get(s,t.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.setIDB=function(){var e=(0,s.default)(a.mark((function e(r,s){var i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.mapKey(r),e.next=3,n.set(i,s,t.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),this.delIDB=function(){var e=(0,s.default)(a.mark((function e(r){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.mapKey(r),e.next=3,n.del(s,t.idbStorage);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.dbName=e,this.idbStorage=window.indexedDB&&n.createStore(e,this.idbStoreName)}mapKey(e){if(!this.viewerPeerId)throw new Error("Перед использованием Storage должен быть идентифицирован!");return`${this.dbName}-${this.viewerPeerId}-${e}`}}function o(e,t){return t instanceof Map?{dataType:"Map",entries:Array.from(t.entries())}:t instanceof Set?{dataType:"Set",values:Array.from(t.values())}:t}function u(e,t){if("object"==typeof t&&null!==t){if("Map"===t.dataType)return new Map(t.entries);if("Set"===t.dataType)return new Set(t.values)}return t}},401690:(e,t,r)=>{"use strict";r.d(t,{VideoMessagePlayer:()=>o});var a=r(722122),s=r(675648),n=r(262448),i={volume:1,playbackRate:1};class o extends s.EventEmitter{constructor(e){super(),this.state=void 0,this.state=e;var t=localStorage.getItem("videomessage_settings");this.state.settings=t?JSON.parse(t):i}setVolume(e){this.setState((0,a.default)({},this.state,{settings:(0,a.default)({},this.state.settings,{muted:!1,volume:e})})),localStorage.setItem("videomessage_settings",JSON.stringify(this.state.settings))}setMuted(e){var t=(0,a.default)({},this.state,{settings:(0,a.default)({},this.state.settings,{muted:e})});this.setState(t)}setPlaybackRate(e){this.setState((0,a.default)({},this.state,{settings:(0,a.default)({},this.state.settings,{playbackRate:e})})),localStorage.setItem("videomessage_settings",JSON.stringify(this.state.settings))}stop(){this.setState((0,a.default)({},this.state,{status:"stopped",currentVideoMessageTrack:void 0}))}play(e,t){this.setState((0,a.default)({},this.state,{status:"playing",convoPeerId:e,currentVideoMessageTrack:t}))}move(e,t){if(void 0===t&&(t=!1),this.state.currentVideoMessageTrack){var r=t?e.getPrev(this.state.currentVideoMessageTrack):e.getNext(this.state.currentVideoMessageTrack),a=e.getPlaylistMeta().convoPeerId;if(r)return this.play(a,r),this.scrollToMessage(),r;this.stop()}}pause(){this.state.currentVideoMessageTrack&&this.setState((0,a.default)({},this.state,{status:"paused"}))}resume(){this.state.currentVideoMessageTrack&&this.setState((0,a.default)({},this.state,{status:"playing"}))}endTrack(e){this.setState((0,a.default)({},this.state,{status:"ended"})),e?this.move(e):this.stop()}setProgress(e){var t=this.state.currentVideoMessageTrack;t&&this.setState((0,a.default)({},this.state,{currentVideoMessageTrack:(0,a.default)({},t,{progress:e})}))}scrollToMessage(){this.state.currentVideoMessageTrack&&this.emit(n.VideoMessagePlayerEventTypes.SCROLL_TO_MESSAGE,this.state.currentVideoMessageTrack.id)}stopCurrentTrackByError(e){var t=this.state.currentVideoMessageTrack;(null==t?void 0:t.id)===e&&this.setState((0,a.default)({},this.state,{status:"stopped",currentVideoMessageTrack:(0,a.default)({},t,{progress:0})}))}setState(e){this.state=e,this.emit(n.VideoMessagePlayerEventTypes.STATE_UPDATED,e)}getState(){return this.state}forceUpdate(e){this.setState(e)}}},737099:(e,t,r)=>{"use strict";r.d(t,{searchConversations:()=>d,searchMessages:()=>p,searchUsersGlobal:()=>v});var a=r(722122),s=r(887757),n=r(692137),i=r(568647),o=r(529122),u=r(664902),c=r(616963);function d(e,t,r,a){return l.apply(this,arguments)}function l(){return(l=(0,n.default)(s.mark((function e(t,r,a,n){var o,u,d,l,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("messages.searchConversations",{q:a,count:c.SEARCH_CONVOS_COUNT,extended:1,group_id:n});case 2:return o=e.sent,u=o.profiles,d=o.groups,l=o.items,p=o.contacts,r({profiles:u,groups:d,conversations:l,contacts:p}),e.abrupt("return",l.reduce(((e,t)=>{var r=(0,i.fromApiConvo)(t);return r&&e.add(r.convo.peerId),e}),new Set));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,t,r,a){return h.apply(this,arguments)}function h(){return(h=(0,n.default)(s.mark((function e(t,r,n,i){var o,d,l,p,h,v,f,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("messages.search",(0,a.default)({},i,{extended:1,count:c.SEARCH_MESSAGES_COUNT}));case 2:return o=e.sent,d=o.items,l=o.count,p=o.conversations,h=o.contacts,v=o.profiles,f=o.groups,n({profiles:v,groups:f,conversations:p,contacts:h}),m=d.reduce(((e,t)=>{var a=(0,u.fromApiMessage)(t).message;return"Normal"===a.kind?e.push(a):r.error(`Сообщение неожиданного типа вернулось из message.search: ${a.kind}`),e}),[]),e.abrupt("return",{results:m,count:l,apiItemsCount:d.length});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e,t,r){return f.apply(this,arguments)}function f(){return(f=(0,n.default)(s.mark((function e(t,r,a){var n,i,u,c;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("users.search",a);case 2:return n=e.sent,i=n.items,u=n.count,r({profiles:i}),c=i.map((e=>o.resolveId(e.id))),e.abrupt("return",{results:c,count:u});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},332024:(e,t,r)=>{"use strict";r.d(t,{useApiFetch:()=>u});var a=r(722122),s=r(717941),n=r(667294),i=r(607815),o=r(51496);function u(){var e=(0,s.useBrowserEnv)().api,t=(0,n.useRef)(new Set);return(0,n.useEffect)((()=>()=>{t.current.forEach((r=>{e.dangerouslyAbort(r),t.current.delete(r)}))}),[e]),(0,n.useCallback)(((r,s,n)=>{var u=i.IApi.resolveTrackId(r,(0,o.nanoid)(5));return t.current.add(u),e.fetch(r,s,(0,a.default)({},n,{trackId:u}))}),[e])}},551327:(e,t,r)=>{"use strict";r.d(t,{Module:()=>u,useModuleKeyBoardHandlers:()=>l,useGlobalKeyBoardHandlers:()=>p});var a=r(701069),s=r(667294),n=r(815684);function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var u={PhotoViewer:"PhotoViewer",Modal:"Modal",SimpleComposer:"SimpleComposer",FCComposer:"FCComposer",FCWindow:"FCWindow",RightPanel:"RightPanel",Composer:"Composer",ConvoMain:"ConvoMain"},c={[u.PhotoViewer]:{priority:1001},[u.Modal]:{priority:1e3,blockGlobalHandlers:!0,blockOtherModules:!0},[u.SimpleComposer]:{priority:902},[u.FCComposer]:{priority:901},[u.FCWindow]:{priority:900},[u.RightPanel]:{priority:500},[u.Composer]:{priority:200},[u.ConvoMain]:{priority:100}};var d=new class{constructor(){this.isSubscribed=!1,this.isGlobalHandlersBlocked=!1,this.globalHandlers=new Map,this.moduleConfig=new Map(Object.entries(c)),this.moduleHandlers=new Map,this.subscribeModuleKeyDown=(e,t)=>{var r;if(a.isDev&&!this.moduleConfig.has(e))throw new Error(`Module ${module} must be in moduleConfig.`);var s=null!=(r=this.moduleHandlers.get(e))?r:new Set;return s.add(t),this.moduleHandlers.set(e,s),this.onModuleHandlersUpdated(),()=>{s.delete(t),0===s.size&&this.moduleHandlers.delete(e),this.onModuleHandlersUpdated()}},this.subscribeGlobalKeyDown=(e,t)=>{var r=this.globalHandlers.has(e);if(a.isDev&&r)throw new Error(`Global keyCombo ${e} is already subscribed. Unsubscribe it first`);return this.globalHandlers.set(e,t),this.updateSubscription(),()=>{this.globalHandlers.delete(e),this.updateSubscription()}},this.addModuleConfig=(e,t)=>{this.moduleConfig.set(e,t)},this.updateSubscription=()=>{var e=this.globalHandlers.size>0||this.moduleHandlers.size>0;e&&!this.isSubscribed&&(document.addEventListener("keydown",this.keyDownHandler),this.isSubscribed=!0),!e&&this.isSubscribed&&(document.removeEventListener("keydown",this.keyDownHandler),this.isSubscribed=!1)},this.onModuleHandlersUpdated=()=>{this.updateGlobalHandlersBlocked(),this.updateSubscription()},this.callModuleSubscription=(e,t)=>{for(var r=[...this.moduleConfig.entries()].sort(((e,t)=>t[1].priority-e[1].priority)).map((e=>e[0])),a=0;a<r.length;a++){var s,n=r[a];if(void 0!==n){var o=this.moduleHandlers.get(n);if(o){for(var u,c=!1,d=t=>{var r=t===e;return r&&(c=!0),r},l=i(Array.from(o).reverse());!(u=l()).done;){if((0,u.value)(d,t),c)break}if(c=c||!!(null==(s=this.moduleConfig.get(n))?void 0:s.blockOtherModules))break}}}},this.callGlobalSubscription=(e,t)=>{if(this.isGlobalHandlersBlocked)t();else{var r=this.globalHandlers.get(e);r&&(!1!==r.autoPreventDefault?(t(),r.handler()):r.handler(t))}},this.updateGlobalHandlersBlocked=()=>{var e=[...this.moduleHandlers.keys()].some((e=>{var t;return null==(t=this.moduleConfig.get(e))?void 0:t.blockGlobalHandlers}));this.isGlobalHandlersBlocked=e},this.keyDownHandler=e=>{if(e instanceof KeyboardEvent){var t=(0,n.getKeyCombo)(e),r=e.preventDefault.bind(e);(0,n.isGlobalKeyCombo)(t)?this.callGlobalSubscription(t,r):(0,n.isModuleKeyCombo)(t)&&this.canCallModuleSubscription()&&this.callModuleSubscription(t,r)}},this.canCallModuleSubscription=()=>{var e=document.activeElement;return null===e||"INPUT"!==e.tagName&&"TEXTAREA"!==e.tagName&&!(e instanceof HTMLElement&&!0===e.isContentEditable)}}};function l(e){var t=e.moduleName,r=e.config;return void 0!==r&&d.addModuleConfig(t,r),{subscribeKeyDown:(0,s.useCallback)((e=>d.subscribeModuleKeyDown(t,e)),[t])}}var p=()=>({subscribeGlobalKeyDown:d.subscribeGlobalKeyDown})},838712:(e,t,r)=>{"use strict";r.d(t,{useTabListNavigation:()=>s});var a=r(667294);function s(){var e=(0,a.useState)(-1),t=e[0],r=e[1],s=(0,a.useRef)(0),n=(0,a.useCallback)((e=>s.current=e),[]),i=(0,a.useRef)(),o=(0,a.useCallback)((e=>i.current=e),[]),u=(0,a.useCallback)((()=>{r(-1)}),[]),c=(0,a.useCallback)(((e,a)=>{if(0!==s.current)switch(e){case"Enter":a(),null==i.current||i.current(t);break;case"ArrowDown":a(),r((e=>e+1<s.current?e+1:0));break;case"ArrowUp":a(),r((e=>e>0?e-1:s.current-1))}}),[t]);return{setTabsCount:n,setSelectHandler:o,indexToSelect:t,onKeyDown:c,resetIndexToSelect:u}}},530311:(e,t,r)=>{"use strict";r.d(t,{useModal:()=>i,useSubModal:()=>o,useModalGroup:()=>u});var a=r(667294),s=r(575730),n=r(610610),i=function(e,t){return void 0===t&&(t="popup"),c({groupId:e,stackName:t})},o=e=>c({groupId:e,isSubModal:!0}),u=()=>{var e=(0,n.useModalContext)(),t=e.createGroup,r=e.closeGroup,s=(0,a.useRef)();s.current||(s.current=t());var i=s.current.data.id,o=(0,a.useCallback)((()=>r(i)),[r,i]);return(0,a.useEffect)((()=>()=>{var e;null==(e=s.current)||e.remove()}),[]),{id:i,closeGroup:o}},c=e=>{var t,r=null!=(t=null==e?void 0:e.stackName)?t:"popup",i=(0,n.useModalContext)(),o=i.createModal,u=i.createGroup,c=i.getModalGroup,l=i.closeModalForced,p=(0,a.useRef)();p.current||(p.current=(null==e?void 0:e.groupId)?{data:c(e.groupId)}:u());var h=(0,a.useRef)();h.current||(h.current=o(p.current.data.id,null==e?void 0:e.isSubModal,(null==e?void 0:e.id)?s.resolveId(e.id):void 0));var v=h.current.id;return(0,a.useEffect)((()=>()=>{var e,t;l(v,r),null==(e=p.current)||null==e.remove||e.remove(),null==(t=h.current)||t.remove()}),[l,v,r]),d(v,r)},d=(e,t)=>{var r=(0,n.useModalContext)(),s=r.openedModals,i=r.openModal,o=r.closeModal,u=r.findIndexInStack,c=(0,a.useCallback)((()=>i(e,t)),[i,e,t]),d=(0,a.useCallback)((()=>o(e,t)),[o,e,t]),l=u(e,t);return(0,a.useMemo)((()=>({isActive:Boolean(s[t].find((t=>t===e))),indexInStack:l,isInStack:null!==l,open:c,close:d})),[d,e,c,s,l,t])}},383965:(e,t,r)=>{"use strict";r.d(t,{useConvoSearch:()=>g,useSearchHandlers:()=>y,useConvoSearchData:()=>k,useMessagesSearchData:()=>_,useUsersGlobalSearchData:()=>w});var a=r(887757),s=r(692137),n=r(722122),i=r(419756),o=r(667294),u=r(717941),c=r(529122),d=r(825759),l=r(737099),p=r(838712),h=r(624893),v=r(766278),f=r(332024),m=r(616963);function g(e){var t=e.onSelect,r=e.searchIndex,a=e.defaultResults,s=(0,p.useTabListNavigation)(),u=s.setTabsCount,c=s.setSelectHandler,d=s.resetIndexToSelect,l=s.onKeyDown,h=s.indexToSelect,v=y(),f=v.query,m=v.setNavigationParams,g=(0,i.default)(v,["query","setNavigationParams"]);(0,o.useEffect)((()=>{m({resetIndexToSelect:d,onKeyDown:l})}),[m,d,l]);var C=k({searchIndex:r,defaultResults:a,query:f}),b=C.results,_=C.isLoading,I=C.isDefault,w=(0,o.useMemo)((()=>{var e;return null!=(e=M(b))?e:[]}),[b]),S=(0,o.useCallback)((e=>{var r=w[e];void 0!==r&&t(r)}),[w,t]);return(0,o.useEffect)((()=>{c(S)}),[S,c]),(0,o.useEffect)((()=>{u(w.length)}),[w,u]),(0,n.default)({query:f},g,{results:b,isLoading:_,isDefault:I,indexToSelect:h})}function y(){var e=(0,o.useRef)(null),t=(0,o.useCallback)((t=>e.current=t),[]),r=(0,o.useState)(""),a=r[0],s=r[1],n=(0,o.useState)(!1),i=n[0],u=n[1],c=(0,o.useCallback)((t=>{var r;s(t),null==(r=e.current)||r.resetIndexToSelect()}),[]),d=(0,o.useCallback)((e=>c(e.target.value)),[c]),l=(0,o.useMemo)((()=>(0,h.onElementKeyDownFactory)(((t,r)=>{var a;if("Escape"===t)r(),c("");null==(a=e.current)||a.onKeyDown(t,r)}))),[c]),p=(0,o.useCallback)((()=>{var t;u(!0),null==(t=e.current)||t.resetIndexToSelect()}),[]),v=(0,o.useCallback)((()=>{var t;u(!1),null==(t=e.current)||t.resetIndexToSelect()}),[]),f=(0,o.useCallback)((()=>{c("")}),[c]),m=(0,o.useRef)(),g=(0,o.useState)(!1),y=g[0],C=g[1];return(0,o.useLayoutEffect)((()=>{i&&C(!1)}),[i]),(0,o.useLayoutEffect)((()=>{C(!a&&!!m.current),m.current=a}),[a]),{onChange:d,onKeyDown:l,onFocus:p,onBlur:v,reset:f,isFocused:i,becameEmpty:y,setNavigationParams:t,query:a,setQuery:c}}var C=new Set;function k(e){var t=e.defaultResults,r=void 0===t?C:t,i=e.searchIndex,p=e.query,h=(0,o.useState)({isLoading:!1,results:r}),g=h[0],y=h[1],k=(0,o.useRef)(!0),b=(0,u.useDebounced)(p,m.SEARCH_DEBOUNCE_MS),_=b.debounced,I=b.debouncedUpdatesCount,w=(0,f.useApiFetch)(),M=(0,u.useOwner)(),S=(0,u.useInsertIntoCache)(),R=0===p.length,E=(0,u.usePeers)();(0,o.useEffect)((()=>{R&&(k.current=!0,y({isLoading:!1,results:r}))}),[R,r]),(0,o.useEffect)((()=>{if(!R){k.current=!1;var e=i?d.search(i,p):new Set;y({isLoading:!0,results:e})}}),[p,R]);var x=(0,o.useRef)(p);x.current=p;var A=(0,o.useCallback)(function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return");case 2:return y((e=>(0,n.default)({},e,{loading:!0}))),e.prev=3,e.next=6,(0,l.searchConversations)(w,S,t,(0,v.getOwnerGroupId)(M.id));case 6:if(r=e.sent,x.current===t){e.next=9;break}return e.abrupt("return");case 9:y((e=>{var t=new Set([...e.results.values()]);return r.forEach((e=>{if(c.isContactPeerId(e)){var r=E.get(e);if("Contact"===(null==r?void 0:r.kind)&&r.userId)return}t.has(e)||t.add(e)})),{isLoading:!1,results:t}})),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),y((e=>(0,n.default)({},e,{loading:!1})));case 15:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}(),[w,S,M.id,E]);(0,o.useEffect)((()=>{A(_)}),[I,_]);var U=g.isLoading,P=g.results;return{results:p&&U&&0===P.size?"loading":p&&!U&&0===P.size?"empty":P,isLoading:U,isDefault:k.current}}var b=[];function _(e){var t=e.query,r=e.date,i=e.peerId,c=0===t.length&&!r,d=(0,u.useBrowserEnv)().logger,p=(0,u.useOwner)(),h=(0,u.useInsertIntoCache)(),m=(0,f.useApiFetch)(),g=(0,o.useState)({isLoading:!1,hasMore:!0,results:b}),y=g[0],C=g[1],k=(0,o.useRef)(0),_=(0,o.useRef)(t);_.current=t;var I=(0,o.useCallback)(function(){var e=(0,s.default)(a.mark((function e(t){var s,o,u,f;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=2;break}return e.abrupt("return");case 2:return C((e=>(0,n.default)({},e,{isLoading:!0}))),e.prev=3,e.next=6,(0,l.searchMessages)(m,d,h,{q:t,peer_id:i,date:r,offset:k.current,group_id:(0,v.getOwnerGroupId)(p.id)});case 6:if(s=e.sent,_.current===t){e.next=9;break}return e.abrupt("return");case 9:o=s.results,u=s.count,f=s.apiItemsCount,k.current+=f,C((e=>({isLoading:!1,hasMore:u>k.current&&f>0,results:[...e.results,...o]}))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),C((e=>(0,n.default)({},e,{isLoading:!1,hasMore:!1})));case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}(),[c,i,r,m,h,d,p.id]),w=y.isLoading,M=y.hasMore,S=y.results,R=(0,o.useCallback)((()=>{M&&!w&&I(t)}),[M,w,I,t]);return(0,o.useLayoutEffect)((()=>{k.current=0,c?C({isLoading:!1,hasMore:!1,results:b}):(C({isLoading:!0,hasMore:!0,results:[]}),I(t))}),[c,t,i,r]),{results:0===S.length&&!w&&!M&&!c?"empty":S,isLoading:w,hasMore:M,loadMore:R}}var I=[];function w(e){var t=e.query,r=0===t.length,i=(0,f.useApiFetch)(),c=!(0,u.useFeatureFlags)().vkm_global_search,d=(0,u.useInsertIntoCache)(),p=(0,o.useState)({isLoading:!1,hasMore:!0,results:I}),h=p[0],v=p[1],m=(0,o.useRef)(0),g=(0,o.useRef)(t);g.current=t;var y=(0,o.useCallback)(function(){var e=(0,s.default)(a.mark((function e(t){var s,o,u;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=2;break}return e.abrupt("return");case 2:return v((e=>(0,n.default)({},e,{isLoading:!0}))),e.prev=3,e.next=6,(0,l.searchUsersGlobal)(i,d,{q:t,offset:m.current,count:20});case 6:if(s=e.sent,g.current===t){e.next=9;break}return e.abrupt("return");case 9:o=s.results,u=s.count,m.current+=20,v((e=>({isLoading:!1,hasMore:u>m.current&&0!==o.length,results:[...e.results,...o]}))),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),v((e=>(0,n.default)({},e,{isLoading:!1,hasMore:!1})));case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t){return e.apply(this,arguments)}}(),[r,i,d]),C=h.isLoading,k=h.hasMore,b=h.results,_=(0,o.useCallback)((()=>{!k||C||c||y(t)}),[k,C,y,t,c]);return(0,o.useLayoutEffect)((()=>{m.current=0,r||c?v({isLoading:!1,hasMore:!1,results:I}):(v({isLoading:!0,hasMore:!0,results:I}),y(t))}),[r,t,c]),{results:0===b.length&&!C&&!k&&!r?"empty":b,isLoading:C,hasMore:k,loadMore:_}}var M=e=>"empty"===e||"loading"===e?null:Array.from(e.values())},654625:(e,t,r)=>{"use strict";r.d(t,{Avatar:()=>h});var a=r(110379),s=r(514665),n=(r(380283),r(667294)),i=r(20700),o=r(717941),u=r(529122),c=r(701069),d=r(612214),l=r(785426);function p(){p=function(e,t){return new r(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function r(e,a,n){var i=new RegExp(e,a);return t.set(i,n||t.get(e)),(0,s.default)(i,r.prototype)}function n(e,r){var a=t.get(r);return Object.keys(a).reduce((function(t,r){return t[r]=e[a[r]],t}),Object.create(null))}return(0,a.default)(r,RegExp),r.prototype.exec=function(t){var r=e.exec.call(this,t);return r&&(r.groups=n(r,this)),r},r.prototype[Symbol.replace]=function(r,a){if("string"==typeof a){var s=t.get(this);return e[Symbol.replace].call(this,r,a.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+s[t]})))}if("function"==typeof a){var i=this;return e[Symbol.replace].call(this,r,(function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(n(e,i)),a.apply(this,e)}))}return e[Symbol.replace].call(this,r,a)},p.apply(this,arguments)}var h=n.memo((function(e){var t=e.peer,r=e.size,a=e.activityIndicator,s=e.withOnline,c=void 0!==s&&s,d=e.withBirthday,h=void 0!==d&&d,f=e.activeCall,m=e.className,g=(0,o.useOnline)(t.id),y=(0,o.usePixelDensity)(),C=function(e,t){if("User"!==e.kind)return"Offline";if(t)switch(e.lastSeen.platform){case"vkme":case"mobile":return"Mobile";case"other":return"Online";default:e.lastSeen.platform;return"Online"}return"Offline"}(t,c&&g),k=!!f,b=h&&function(e){var t;if("User"!==e.kind||!e.bdate)return!1;var r=new Date,a=String(r.getDate()),s=String(r.getMonth()+1),n=(null==(t=p(/([0-9]+)\.([0-9]+)/,{day:1,month:2}).exec(e.bdate))?void 0:t.groups)||{},i=n.day,o=n.month;return i===a&&o===s}(t),_=function(e,t,r){var a;if("Contact"===e.kind)return e.photo50;r&&(t*=2);var s=[{size:50,url:e.photo50},{size:100,url:e.photo100||e.photo50},{size:200,url:e.photo200||e.photo100||e.photo50}];return null==(a=s.find((e=>t<=e.size&&Boolean(e.url))))?void 0:a.url}(t,r,y),I=(0,n.useState)((()=>{if(!_)return!1;var e=new Image;return e.src=_,e.complete||e.width+e.height>0})),w=I[0],M=I[1],S=(0,n.useMemo)((()=>({width:r,height:r})),[r]),R=function(e,t,r){return`mePeerFrame${e}${t}${r?"c":""}`}(C,r,k||b),E=`url(#${R}Mask${t.id})`,x=i("MEAvatar",`MEAvatar--size-${r}`,{"MEAvatar--withActivity":!!a,"MEAvatar--emptyCall":"empty"===f},m);return n.createElement("figure",{style:S,className:x},n.createElement("div",{className:"MEAvatar__imgWrapper",style:{clipPath:E}},n.createElement(l.AvatarNoPhoto,{peer:t,size:r}),_&&n.createElement("img",{className:i("MEAvatar__img",{"MEAvatar__img--ready":w}),alt:u.name(t),src:_,onLoad:()=>M(!0)}),a&&n.createElement("div",{className:"MEAvatar__activityIndicator"},a)),n.createElement(v,{frameType:C}),b&&n.createElement("div",{className:"MEAvatar__upperRightIcon MEAvatar__birthday"},n.createElement("svg",{className:"MEAvatar__upperRightIconSvg"},n.createElement("use",{href:"#meCake10"}))),k&&n.createElement("div",{className:"MEAvatar__upperRightIcon MEAvatar__call"},n.createElement("svg",{className:"MEAvatar__upperRightIconSvg"},n.createElement("use",{href:"#mePhone10"}))),n.createElement("svg",{className:"MEAvatar__svg"},n.createElement("clipPath",{id:R+"Mask"+t.id},n.createElement("use",{href:"#"+R})),n.createElement("use",{href:"#"+R,className:"MEAvatar__shadow",clipPath:E})))}));var v=e=>{var t=e.frameType;switch(t){case"Mobile":return n.createElement("div",{className:"MEAvatar__mobile"},n.createElement(d.default,null));case"Online":return n.createElement("div",{className:"MEAvatar__online"});case"Offline":return null;default:(0,c.exhaustivenessCheck)(t)}}},785426:(e,t,r)=>{"use strict";r.d(t,{AvatarNoPhoto:()=>i,AvatarNoPhotoSimple:()=>o});r(183638);var a=r(667294),s=r(20700),n=r(529122),i=e=>{var t=e.peer,r=e.size,s=e.className;return a.createElement(o,{peerId:t.id,size:r,className:s,text:n.initials(t)})},o=e=>{var t=e.text,r=e.peerId,i=e.size,o=e.className,u=void 0!==r&&n.isContactPeerId(r)?"AvatarNoPhoto--color-contact":`AvatarNoPhoto--color-${Math.abs((null!=r?r:0)%6)}`;return a.createElement("div",{className:s("AvatarNoPhoto",`AvatarNoPhoto--size-${i}`,u,o)},t)}},505081:(e,t,r)=>{"use strict";r.d(t,{FormattedLangKey:()=>u});var a=r(722122),s=r(419756),n=r(667294),i=r(717941),o=r(701069),u=e=>{var t=(0,i.useBrowserEnv)().lang,r=e.className,u=e.langkey,c=(0,s.default)(e,["className","langkey"]);return t.fold(u,(e=>n.createElement(n.Fragment,null,e)),(e=>(o.isDev&&(e=e.map(((e,t)=>"string"==typeof e?n.createElement(n.Fragment,{key:t},e):n.cloneElement(e,(0,a.default)({},e.props,{key:t}))))),n.createElement("span",{className:r},e))),c)}},377101:(e,t,r)=>{"use strict";r.d(t,{ModalBackdrop:()=>i});r(895593);var a=r(667294),s=r(20700),n=r(71772),i=e=>{var t,r=e.isClear,i=e.isBodyScrollDisabled,o=e.onClick,u=e.children,c=s("RE_ModalBackdrop",{"RE_ModalBackdrop--tinted":!r}),d=(0,a.useContext)(n.ModalConfigContext).isFullScreen,l=s("RE_ModalBackdrop__container",d?"RE_ModalBackdrop__container--fullScreen":"RE_ModalBackdrop__container--window");return t=Boolean(i),(0,a.useEffect)((()=>{var e=document.body;if(t){var r=e.getBoundingClientRect(),a=window.innerWidth-(r.left+r.right);if(0!==a){var s=document.createElement("style");return s.innerText="body { overflow-y: hidden !important; }",e.appendChild(s),e.style.borderRight=`${a}px solid transparent`,()=>{e.style.borderRight="",e.removeChild(s)}}}}),[t]),a.createElement("div",{className:c},o&&a.createElement("div",{className:"RE_ModalBackdrop__flesh",onClick:o}),a.createElement("div",{className:l},u))}},589238:(e,t,r)=>{"use strict";r.d(t,{ModalBody:()=>o});r(351667);var a=r(667294),s=r(20700),n=r(804590),i=r(71772),o=e=>{var t=e.children,r=e.withCustomLayout,o=e.withScrollHandling,u=(0,a.useContext)(i.ModalConfigContext).isFullScreen,c=s("RE_ModalBody",{"RE_ModalBody--standard":!r,"RE_ModalBody--scrollable":o,"RE_ModalBody--fullScreen":u}),d=o?n.default:"div";return a.createElement(d,{className:c},t)}},71772:(e,t,r)=>{"use strict";r.d(t,{ModalConfigContext:()=>n,ModalsConfigProvider:()=>i});var a=r(667294),s=r(792109),n=(0,a.createContext)({isFullScreen:!1}),i=e=>{var t=e.children,r=(0,s.useLayoutData)(),i=(0,a.useMemo)((()=>({isFullScreen:"one-column"===r.mode})),[r.mode]);return a.createElement(n.Provider,{value:i},t)}},610937:(e,t,r)=>{"use strict";r.d(t,{ModalFooter:()=>s});r(974580);var a=r(667294),s=e=>{var t=e.buttons,r=e.hint,s=e.children;return a.createElement("footer",{className:"RE_ModalFooter"},r&&a.createElement("div",{className:"RE_ModalFooter__hint"},r),s&&a.createElement("div",{className:"RE_ModalFooter__content"},s),t&&a.createElement("div",{className:"RE_ModalFooter__actions"},t))}},797365:(e,t,r)=>{"use strict";r.d(t,{ModalHeader:()=>o});r(936021);var a=r(667294),s=r(718305),n=r(76109),i=r(20700),o=e=>{var t=e.onClose,r=e.closeLabel,o=e.backLabel,u=e.onBack,c=e.title,d=e.children,l=e.className,p=e.closeClassName;return a.createElement("header",{className:i("RE_ModalHeader",l)},a.createElement("div",{className:"RE_ModalHeader__content"},o&&u&&a.createElement("button",{className:"RE_ModalHeader__back",onClick:u},a.createElement("span",{className:"RE_ModalHeader__backIcon"},a.createElement(s.default,null)),o),c&&a.createElement("h1",{className:"RE_ModalHeader__title"},c),d&&a.createElement("div",{className:"RE_ModalHeader__container"},d)),a.createElement("button",{className:i("RE_ModalHeader__close",p),"aria-label":r,onClick:t},a.createElement(n.default,null)))}},451508:(e,t,r)=>{"use strict";r.d(t,{ModalInterface:()=>d});r(360862);var a=r(667294),s=r(117828),n=r(377101),i=r(799645),o=r(797365),u=r(589238),c=r(610937),d=e=>{var t=e.onClose,r=e.closeLabel,d=e.onBack,l=e.backLabel,p=e.title,h=e.contextClass,v=e.panelClass,f=e.hasClearBackdrop,m=e.isHidden,g=e.portalTarget,y=e.buttons,C=e.withCustomLayout,k=e.children,b=e.footerHint;return a.createElement(s.ModalView,{onEscape:t,contextClass:h,portalTarget:g,isHidden:m},a.createElement(n.ModalBackdrop,{onClick:t,isClear:f},a.createElement(i.ModalPanel,{className:v},a.createElement(o.ModalHeader,{closeLabel:r,onClose:t,backLabel:l,onBack:d,title:p}),a.createElement(u.ModalBody,{withCustomLayout:C},k),y&&a.createElement(c.ModalFooter,{buttons:y,hint:b}))))}},799645:(e,t,r)=>{"use strict";r.d(t,{ModalPanel:()=>i});r(97839);var a=r(667294),s=r(20700),n=r(71772),i=e=>{var t=e.children,r=e.className,i=(0,a.useContext)(n.ModalConfigContext).isFullScreen,o=s("RE_ModalPanel",r,{"RE_ModalPanel--fullScreen":i});return a.createElement("article",{className:o},t)}},117828:(e,t,r)=>{"use strict";r.d(t,{ModalView:()=>u});r(628392);var a=r(667294),s=r(20700),n=r(632644),i=r(202278),o=r(551327),u=e=>{var t=e.children,r=e.isHidden,u=e.onEscape,c=e.contextClass,d=e.portalTarget,l=(0,i.useLayer)(),p=s("RE_ModalView",{"RE_ModalView--hidden":Boolean(r)}),h=(0,o.useModuleKeyBoardHandlers)({moduleName:o.Module.Modal}).subscribeKeyDown,v=(0,a.useCallback)(((e,t)=>{void 0!==u&&e("Escape")&&(t(),u())}),[u]);return(0,a.useEffect)((()=>{if(!r)return h(v)}),[h,v,r]),a.createElement(n.Portal,{portalClassName:c,portalTarget:d||l},a.createElement("div",{className:p},t))}},671737:(e,t,r)=>{"use strict";r.d(t,{OnlineStatus:()=>n});var a=r(667294),s=r(717941),n=a.memo((function(e){var t=e.className,r=e.user,n=(0,s.useBrowserEnv)().lang,i=(0,s.useOnline)(r.id),o=(0,s.useNow)(6e5);if("Contact"===r.kind){if(r.lastSeen&&["today","recently"].includes(r.lastSeen)){var u={today:n.use("global_online_was_today",{sex:"male"}),recently:n.use("global_online_was_recently",{sex:"male"})}[r.lastSeen];return a.createElement("span",{className:t,role:"status"},u)}return null}if(i)return a.createElement("span",{className:t,role:"status"},n.use("global_online",{sex:r.sex}));if(!r.lastSeen.isVisible)return a.createElement("span",{className:t,role:"status"},n.use("global_online_was_recently",{sex:r.sex}));if(!r.lastSeen.at)return null;if(r.lastSeen.isVisible)return a.createElement("span",{className:t,role:"status"},n.formatDate(r.lastSeen.at,{now:o,variant:"time-ago"}));var c,d=864e5,l=6048e5,p=o-r.lastSeen.at;switch(!0){case p<d:c="global_online_was_recently";break;case p<l:c="global_online_was_week";break;case p<24192e5:c="global_online_this_month";break;default:c="global_online_long_ago"}return a.createElement("span",{role:"status",className:t},n.use(c,{sex:r.sex}))}))},860735:(e,t,r)=>{"use strict";r.d(t,{Symbols:()=>s});r(516073);var a=r(667294),s=()=>a.createElement("svg",{className:"Symbols"},a.createElement("defs",null,a.createElement("symbol",{id:"mePhone10"},a.createElement("path",{d:"M6.17 6.8c1.1-1.09 2.32-.5 3.3.33 1.15.97.26 2.7-1.08 2.83-1.82.24-3.72-.63-5.72-2.63-2-2-2.88-3.91-2.63-5.73C.16.27 1.91-.62 2.87.52c.82.98 1.41 2.2.32 3.3-.9.9-.16 1.55.64 2.35s1.45 1.53 2.34.64z"})),a.createElement("symbol",{id:"meExpand"},a.createElement("path",{d:"M15.7688 13.7067L11.906 10L15.7688 6.29326C16.0771 5.99741 16.0771 5.51774 15.7688 5.22189C15.4605 4.92604 14.9606 4.92604 14.6523 5.22189L10.2312 9.46431C9.92292 9.76017 9.92292 10.2398 10.2312 10.5357L14.6523 14.7781C14.9606 15.074 15.4605 15.074 15.7688 14.7781C16.0771 14.4823 16.0771 14.0026 15.7688 13.7067Z"}),a.createElement("path",{d:"M9.76877 13.7067L5.90596 10L9.76877 6.29326C10.0771 5.99741 10.0771 5.51774 9.76877 5.22189C9.46046 4.92604 8.96059 4.92604 8.65228 5.22189L4.23123 9.46431C3.92292 9.76017 3.92292 10.2398 4.23123 10.5357L8.65228 14.7781C8.96059 15.074 9.46046 15.074 9.76877 14.7781C10.0771 14.4823 10.0771 14.0026 9.76877 13.7067Z"})),a.createElement("symbol",{id:"meCake10"},a.createElement("path",{d:"M9.16667 8.07392C8.33947 8.29895 7.41292 8.1867 6.66667 7.73385C5.66596 8.34111 4.33404 8.34111 3.33333 7.73385C2.58708 8.1867 1.66053 8.29895 0.833333 8.07392V9.09126C0.833333 9.59314 1.20643 10 1.66667 10H8.33333C8.79357 10 9.16667 9.59314 9.16667 9.09126V8.07392Z"}),a.createElement("path",{d:"M0 5.00191C0 4.50003 0.373096 4.09317 0.833333 4.09317H9.16667C9.6269 4.09317 10 4.50003 10 5.00191C10 6.36503 9.16667 6.8194 8.33333 6.8194C7.08333 6.8194 6.66667 5.91065 6.66667 5.91065C6.66667 5.91065 6.25 6.8194 5 6.8194C3.75 6.8194 3.33333 5.91065 3.33333 5.91065C3.33333 5.91065 2.91667 6.8194 1.66667 6.8194C0.833333 6.8194 0 6.36503 0 5.00191Z"}),a.createElement("path",{d:"M7.83935 0.0492567C7.87234 -0.0164189 7.96099 -0.0164189 7.99398 0.0492567C8.38334 0.824332 8.75 1.16164 8.75 1.82131C8.75 2.32319 8.3769 2.73005 7.91667 2.73005C7.45643 2.73005 7.08333 2.32319 7.08333 1.82131C7.08333 1.16164 7.44999 0.824332 7.83935 0.0492567Z"}),a.createElement("path",{d:"M2.00602 0.0492567C2.03901 -0.0164189 2.12766 -0.0164189 2.16065 0.0492567C2.55001 0.824332 2.91667 1.16164 2.91667 1.82131C2.91667 2.32319 2.54357 2.73005 2.08333 2.73005C1.6231 2.73005 1.25 2.32319 1.25 1.82131C1.25 1.16164 1.61665 0.824332 2.00602 0.0492567Z"}),a.createElement("path",{d:"M4.92268 0.0492567C4.95568 -0.0164189 5.04432 -0.0164189 5.07732 0.0492567C5.46668 0.824332 5.83333 1.16164 5.83333 1.82131C5.83333 2.32319 5.46024 2.73005 5 2.73005C4.53976 2.73005 4.16667 2.32319 4.16667 1.82131C4.16667 1.16164 4.53332 0.824332 4.92268 0.0492567Z"}))),a.createElement("circle",{id:"mePeerFrameOffline24",cx:"12",cy:"12",r:"12"}),a.createElement("path",{id:"mePeerFrameOnline24",d:"M23.57 15.18A12.02 12.02 0 0012 0a12 12 0 103.18 23.57 6 6 0 018.4-8.4z"}),a.createElement("path",{id:"mePeerFrameMobile24",d:"M14.08 23.82a12 12 0 119.9-12.29 3.98 3.98 0 00-1.98-.53h-4a4 4 0 00-4 4v8c0 .28.03.56.08.82z"}),a.createElement("path",{id:"mePeerFrameMe24",d:"M23.84 13.95a12 12 0 10-9.9 9.9 7 7 0 019.9-9.9z"}),a.createElement("circle",{id:"mePeerFrameOffline32",cx:"16",cy:"16",r:"16"}),a.createElement("path",{id:"mePeerFrameOnline32",d:"M30.72 22.29a16 16 0 10-8.43 8.43 6 6 0 018.43-8.43z"}),a.createElement("path",{id:"mePeerFrameMobile32",d:"M21 31.2a16 16 0 1110.52-11.3A3.98 3.98 0 0029 19h-4a4 4 0 00-4 4v8.2z"}),a.createElement("path",{id:"mePeerFrameMe32",d:"M31.1 21.32a16 16 0 10-9.77 9.77 7 7 0 019.77-9.77z"}),a.createElement("path",{id:"mePeerFrameMe32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C17.8656 32 19.6565 31.6807 21.3213 31.0938C20.4899 29.9426 20 28.5285 20 27C20 24.8923 20.9316 23.0021 22.4054 21.7188C17.0253 20.533 13 15.7366 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651ZM30.2451 20.796C30.5411 20.9512 30.8247 21.1269 31.0938 21.3213C31.2337 20.9244 31.3584 20.5204 31.4672 20.1099C31.0749 20.3614 30.6669 20.5907 30.2451 20.796Z"}),a.createElement("path",{id:"mePeerFrameMobile32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C17.748 32 19.4305 31.7197 21.005 31.2016C21.0017 31.1348 21 31.0676 21 31V23C21 22.4411 21.1146 21.9089 21.3217 21.4257C16.4937 19.8727 13 15.3443 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651Z"}),a.createElement("path",{id:"mePeerFrameOffline32c",d:"M31.47 20.11A12 12 0 0118.16.14a16 16 0 1013.31 19.97z"}),a.createElement("path",{id:"mePeerFrameOnline32c",d:"M18.1533 0.143651C17.449 0.0489165 16.7302 0 16 0C7.16344 0 0 7.16344 0 16C0 24.8366 7.16344 32 16 32C18.2328 32 20.3588 31.5426 22.2893 30.7165C21.4819 29.6945 21 28.4035 21 27C21 24.8726 22.1072 23.0038 23.7767 21.9384C17.7239 21.3256 13 16.2145 13 10C13 5.91761 15.0386 2.31134 18.1533 0.143651ZM28.9655 21.3293C29.6052 21.551 30.1958 21.8779 30.7165 22.2893C31.0169 21.5873 31.2686 20.8594 31.4672 20.1099C30.6899 20.6082 29.8514 21.0192 28.9655 21.3293Z"}),a.createElement("circle",{id:"mePeerFrameOffline40",cx:"20",cy:"20",r:"20"}),a.createElement("path",{id:"mePeerFrameOnline40",d:"M29.29 37.72a20 20 0 118.43-8.43 5.99 5.99 0 10-8.43 8.43z"}),a.createElement("path",{id:"mePeerFrameMobile40",d:"M28.2 38.25a20 20 0 1110.78-11.92A3.99 3.99 0 0036 25h-4a4 4 0 00-4 4v8a4 4 0 00.2 1.25z"}),a.createElement("path",{id:"mePeerFrameMe40",d:"M28.31 38.2a20 20 0 119.89-9.89 7 7 0 10-9.89 9.89z"}),a.createElement("path",{id:"mePeerFrameMe40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 2.97-.65 5.78-1.8 8.31a7 7 0 10-9.89 9.89A20 20 0 1125.38.73 12 12 0 0033 22z"}),a.createElement("path",{id:"mePeerFrameMobile40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 2.21-.36 4.34-1.02 6.33A3.99 3.99 0 0036 25h-4a4 4 0 00-4 4v8a4 4 0 00.2 1.25A20 20 0 1125.38.73 12 12 0 0033 22z"}),a.createElement("path",{id:"mePeerFrameOffline40c",d:"M40 19.75A12 12 0 0125.38.73 20.02 20.02 0 000 20a20 20 0 1040-.25z"}),a.createElement("path",{id:"mePeerFrameOnline40c",d:"M33 22c2.61 0 5.03-.83 7-2.25V20c0 3.35-.83 6.51-2.28 9.29a5.99 5.99 0 10-8.43 8.43A20 20 0 1125.38.74 12 12 0 0033 22z"}),a.createElement("circle",{id:"mePeerFrameOffline44",cx:"22",cy:"22",r:"22"}),a.createElement("path",{id:"mePeerFrameOnline44",d:"M41.21 32.73a22 22 0 10-8.49 8.49 6 6 0 018.49-8.49z"}),a.createElement("path",{id:"mePeerFrameMobile44",d:"M31.13 42.02a22 22 0 1111.1-11.37A4 4 0 0039 29h-4a4 4 0 00-4 4v8c0 .35.05.7.13 1.02z"}),a.createElement("path",{id:"mePeerFrameMe44",d:"M41.7 31.81a22 22 0 10-9.89 9.89 7 7 0 019.89-9.89z"}),a.createElement("path",{id:"mePeerFrameOffline44c",d:"M43.97 20.77A12 12 0 0129.78 1.41a22 22 0 1014.19 19.36z"}),a.createElement("path",{id:"mePeerFrameOnline44c",d:"M29.78 1.41a22 22 0 102.95 39.8 6 6 0 018.49-8.49 21.9 21.9 0 002.75-11.95A12 12 0 0129.78 1.41z"}),a.createElement("path",{id:"mePeerFrameMobile44c",d:"M43.97 20.77A12 12 0 0129.78 1.41a22 22 0 101.35 40.6 4 4 0 01-.13-1.01v-8a4 4 0 014-4h4a4 4 0 013.24 1.65 21.93 21.93 0 001.73-9.88z"}),a.createElement("path",{id:"mePeerFrameMe44c",d:"M29.78 1.41A22 22 0 1031.8 41.7a7 7 0 019.89-9.89 21.91 21.91 0 002.27-11.03A12 12 0 0129.78 1.41z"}),a.createElement("circle",{id:"mePeerFrameOffline46",cx:"23",cy:"23",r:"23"}),a.createElement("path",{id:"mePeerFrameOnline46",d:"M42.94 34.47a23 23 0 10-8.47 8.47 6 6 0 018.47-8.47z"}),a.createElement("path",{id:"mePeerFrameMobile46",d:"M33.06 43.69A23 23 0 1144 32.37 3.99 3.99 0 0041 31h-4a4 4 0 00-4 4v8c0 .24.02.47.06.69z"}),a.createElement("path",{id:"mePeerFrameMe46",d:"M43.43 33.58a23 23 0 10-9.85 9.85 7 7 0 019.85-9.85z"}),a.createElement("path",{id:"mePeerFrameOffline46c",d:"M45.9 20.82A12 12 0 0131.5 1.62a23 23 0 1014.39 19.2z"}),a.createElement("path",{id:"mePeerFrameOnline46c",d:"M31.5 1.63a23 23 0 102.96 41.31 6 6 0 018.47-8.47 22.9 22.9 0 002.97-13.65A12 12 0 0131.5 1.62z"}),a.createElement("path",{id:"mePeerFrameMobile46c",d:"M45.9 20.82A12 12 0 0131.5 1.62a23 23 0 101.55 42.06A4.03 4.03 0 0133 43v-8a4 4 0 014-4h4c1.2 0 2.28.53 3.01 1.37a22.92 22.92 0 001.89-11.55z"}),a.createElement("path",{id:"mePeerFrameMe46c",d:"M31.5 1.63a23 23 0 102.07 41.8 7 7 0 019.85-9.85 22.9 22.9 0 002.48-12.76A12 12 0 0131.5 1.62z"}),a.createElement("circle",{id:"mePeerFrameOffline72",cx:"37",cy:"37",r:"37"}),a.createElement("circle",{id:"mePeerFrameOffline92",cx:"46",cy:"46",r:"46"}),a.createElement("path",{id:"meUsersStack16",d:"M14 2.715A8 8 180 008 0 8 8 180 008 16 8 8 180 0014 13.285 8 8 180 0114 2.715"}),a.createElement("path",{id:"meUsersStack18",d:"M 16 14 A 9 9 90 0 1 9 18 A 9 9 90 0 1 9 0 A 9 9 90 0 1 16 4 A 9 9 90 0 0 16 14"}),a.createElement("path",{id:"meUsersStack24",d:"M22 18.6A12 12 0 0112 24 12 12 0 0112 0 12 12 0 0122 5.4 12 12 0 0022 18.6"}),a.createElement("path",{id:"meUsersStack32",d:"M30 23.8A16 16 0 0116 32 16 16 0 0116 0 16 16 0 0130 8.3 16 16 0 0030 23.8"}),a.createElement("path",{id:"meUsersStack40",d:"M37.5 29.8A20 20 90 0120 40 20 20 90 0120 0 20 20 90 0137.5 10.4 20 20 90 0037.5 29.8"}),a.createElement("path",{id:"meUsersStack44",d:"M41.3 32.7A22 22 90 0122 44 22 22 90 0122 0 22 22 90 0141.3 11.4 22 22 90 0041.3 32.7"}),a.createElement("path",{id:"meUsersStack46",d:"M43.1 34.2A23 23 90 0123 46 23 23 90 0123 0 23 23 90 0143.1 11.9 23 23 90 0043.1 34.2"}))},624893:(e,t,r)=>{"use strict";r.d(t,{onElementKeyDownFactory:()=>s});var a=r(815684),s=function(e,t){return void 0===t&&(t=!1),r=>{var s=(0,a.getKeyCombo)(r);!t&&(0,a.isGlobalKeyCombo)(s)||(0,a.isModuleKeyCombo)(s)&&(r.stopPropagation(),e(s,r.preventDefault.bind(r)))}}},815684:(e,t,r)=>{"use strict";r.d(t,{isModuleKeyCombo:()=>c,isGlobalKeyCombo:()=>l,getKeyCombo:()=>p});var a,s,n=r(277914);!function(e){e.Mod="Mod",e.Alt="Alt",e.Shift="Shift",e.Meta="Meta"}(a||(a={})),function(e){e.ArrowLeft="ArrowLeft",e.ArrowRight="ArrowRight",e.ArrowDown="ArrowDown",e.ArrowUp="ArrowUp",e.Escape="Escape",e.Enter="Enter",e.Backspace="Backspace",e.Tab="Tab",e.Slash="/",e.PageDown="PageDown",e.PageUp="PageUp",e.Home="Home",e.End="End",e.Space="Space"}(s||(s={}));var i,o={" ":s.Space};!function(e){e.F="F"}(i||(i={}));var u=[a.Shift,s.ArrowDown,s.ArrowUp,s.Enter,s.Escape,s.Backspace,`${a.Shift}+${s.Enter}`,`${a.Mod}+${s.Enter}`,s.ArrowLeft,s.ArrowRight,s.Tab,s.Space],c=e=>u.includes(e),d=[`${a.Mod}+${i.F}`,`${a.Mod}+${a.Shift}+${i.F}`,`${a.Mod}+${s.Slash}`],l=e=>d.includes(e),p=e=>{try{var t,r=[];Object.values(a).forEach((t=>{h[t](e)&&r.push(t)}));var n=null!=(t=o[e.key])?t:e.key;return Object.values(s).forEach((e=>n===e&&r.push(e))),Object.values(i).forEach((t=>{n.toUpperCase()!==t?e.code.slice(3)===t&&r.push(t):r.push(t)})),r.join("+")}catch(e){return""}},h={[a.Mod]:e=>n.isMac?e.metaKey:e.ctrlKey,[a.Alt]:e=>e.altKey,[a.Shift]:e=>e.shiftKey,[a.Meta]:e=>n.isMac?e.ctrlKey:e.metaKey}},488085:(e,t,r)=>{"use strict";r.d(t,{empty:()=>o,snakeCaseId:()=>c,getLockId:()=>d,isLoaded:()=>l,push:()=>p,refresh:()=>h,updateCounters:()=>v,sorter:()=>f});var a=r(722122),s=r(10122);function n(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function o(){var e={channelIds:new Set,hasMore:!0,unreadCount:0,totalCount:0,boundary:{channelId:s.resolveId(0),majorSortId:1/0,minorSortId:1/0}};return{all:(0,a.default)({kind:"all"},e),unread:(0,a.default)({kind:"unread"},e),archive:(0,a.default)({kind:"archive",isHidden:!1},e)}}var u={all:"all",unread:"unread",archive:"archived"};function c(e){return u[e]}function d(e){return`filter_${e}`}function l(e){return e.boundary.minorSortId!==1/0&&e.boundary.majorSortId!==1/0}function p(e,t,r,a){for(var i,o=n(r);!(i=o()).done;){var u=i.value;m(e,t,u),h(e,u)}e[t].hasMore=a,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0,channelId:s.resolveId(0)})}function h(e,t){e.all.channelIds.delete(t.id),e.unread.channelIds.delete(t.id),e.archive.channelIds.delete(t.id),t.isMember&&(t.isArchived?g(e.archive,t)&&e.archive.channelIds.add(t.id):(g(e.all,t)&&e.all.channelIds.add(t.id),s.isUnread(t)&&g(e.unread,t)&&e.unread.channelIds.add(t.id)))}function v(e,t){var r=t.unread,a=t.archiveTotal;void 0!==r&&(e.all.unreadCount=r,e.unread.unreadCount=r),void 0!==a&&(e.archive.totalCount=a)}function f(e,t){return e.majorSortId!==t.majorSortId?t.majorSortId-e.majorSortId:t.minorSortId!==e.minorSortId?t.minorSortId-e.minorSortId:e.id-t.id}function m(e,t,r){s.isHidden(r)||(r.majorSortId<e[t].boundary.majorSortId?e[t].boundary={channelId:r.id,majorSortId:r.majorSortId,minorSortId:r.minorSortId}:r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId<e[t].boundary.minorSortId?(e[t].boundary.channelId=r.id,e[t].boundary.minorSortId=r.minorSortId):r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId===e[t].boundary.minorSortId&&(e[t].boundary.channelId=r.id),"all"===t&&m(e,"unread",r))}function g(e,t){return!s.isHidden(t)&&(!(t.majorSortId<e.boundary.majorSortId)&&(t.majorSortId>e.boundary.majorSortId||!(t.minorSortId<e.boundary.minorSortId)&&(t.minorSortId>e.boundary.minorSortId||!(t.id>e.boundary.channelId))))}},630730:(e,t,r)=>{"use strict";r.d(t,{empty:()=>u,snakeCaseId:()=>d,isLoaded:()=>l,getLockId:()=>p,isVisible:()=>h,push:()=>v,refresh:()=>f,updateCounters:()=>m,sorter:()=>g,toggleArchiveVisibility:()=>y,toggleBusinessNotifyVisibility:()=>C});var a=r(722122),s=r(658265),n=r(701069);function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function u(){var e={peerIds:new Set,hasMore:!0,unreadCount:0,unreadUnmutedCount:0,totalCount:0,boundary:{majorSortId:1/0,minorSortId:1/0}};return{all:(0,a.default)({kind:"all"},e),unread:(0,a.default)({kind:"unread",headerNotMutedUnread:0},e),chats:(0,a.default)({kind:"chats"},e),archive:(0,a.default)({kind:"archive",hasMentions:!1,isHidden:!1},e),messageRequest:(0,a.default)({kind:"messageRequest"},e),businessNotify:(0,a.default)({kind:"businessNotify",isHidden:!1},e)}}var c={all:"all",unread:"unread",chats:"chats",messageRequest:"message_request",businessNotify:"business_notify",archive:"archive"};function d(e){return c[e]}function l(e){return e.boundary.majorSortId!==1/0&&e.boundary.minorSortId!==1/0}function p(e){return`filter_${e}`}function h(e){switch(e.kind){case"all":case"unread":case"chats":return!0;case"messageRequest":return e.peerIds.size>0||e.hasMore;case"businessNotify":return!e.isHidden&&(e.totalCount>0||e.unreadCount>0);default:return!e.isHidden&&(e.peerIds.size>0||e.hasMore)}}function v(e,t,r,a){for(var s,n=i(r);!(s=n()).done;){var o=s.value;k(e,t,o),f(e,o)}e[t].hasMore=a,e[t].hasMore||(e[t].boundary={majorSortId:0,minorSortId:0})}function f(e,t){switch(t.kind){case"ChatConvo":case"GroupConvo":case"UserConvo":case"ContactConvo":case"MessageRequestUserConvo":case"MessageRequestChatConvo":case"BusinessNotify":return e.all.peerIds.delete(t.peerId),e.unread.peerIds.delete(t.peerId),e.archive.peerIds.delete(t.peerId),e.messageRequest.peerIds.delete(t.peerId),e.businessNotify.peerIds.delete(t.peerId),s.isBusinessNotify(t)?void(b(e.businessNotify,t)&&e.businessNotify.peerIds.add(t.peerId)):s.isMR(t)?void(s.isPendingMR(t)&&b(e.messageRequest,t)&&e.messageRequest.peerIds.add(t.peerId)):t.isArchived?void(b(e.archive,t)&&e.archive.peerIds.add(t.peerId)):(b(e.all,t)&&e.all.peerIds.add(t.peerId),s.isUnread(t)&&b(e.unread,t)&&e.unread.peerIds.add(t.peerId),void("ChatConvo"===t.kind&&b(e.chats,t)&&e.chats.peerIds.add(t.peerId)));default:return(0,n.exhaustivenessCheck)(t)}}function m(e,t){var r=t.unread,a=t.unreadUnmuted,s=t.headerNotMutedUnread,n=t.archive,i=t.archiveTotal,o=t.archiveMentions,u=t.messageRequests,c=t.businessNotify,d=t.businessNotifyTotal;void 0!==r&&(e.all.unreadCount=r,e.unread.unreadCount=r),void 0!==a&&(e.all.unreadUnmutedCount=a,e.unread.unreadUnmutedCount=a),void 0!==s&&(e.unread.headerNotMutedUnread=s),void 0!==n&&(e.archive.unreadCount=n),void 0!==o&&(e.archive.hasMentions=!!o),void 0!==i&&(e.archive.totalCount=i),void 0!==u&&(e.messageRequest.totalCount=u),void 0!==c&&(e.businessNotify.unreadCount=c),void 0!==d&&(e.businessNotify.totalCount=d)}function g(e,t){if(e.majorSortId!==t.majorSortId)return t.majorSortId-e.majorSortId;var r,a,n=e&&s.head(e),i=t&&s.head(t);return"Queued"===(null==n?void 0:n.kind)||"Queued"===(null==i?void 0:i.kind)?(null!=(r=null==i?void 0:i.sentAt)?r:0)-(null!=(a=null==n?void 0:n.sentAt)?a:0):t.minorSortId-e.minorSortId}function y(e,t){e.archive.isHidden=!t}function C(e,t){e.businessNotify.isHidden=!t}function k(e,t,r){s.isHidden(r)||(r.majorSortId<e[t].boundary.majorSortId?e[t].boundary={majorSortId:r.majorSortId,minorSortId:r.minorSortId}:r.majorSortId===e[t].boundary.majorSortId&&r.minorSortId<e[t].boundary.minorSortId&&(e[t].boundary.minorSortId=r.minorSortId),"all"===t&&(k(e,"unread",r),k(e,"chats",r)))}function b(e,t){return!s.isHidden(t)&&(t.majorSortId>e.boundary.majorSortId||t.majorSortId===e.boundary.majorSortId&&t.minorSortId>=e.boundary.minorSortId)}},857085:(e,t,r)=>{"use strict";r.d(t,{refresh:()=>o,refreshChannels:()=>u,empty:()=>c,isEqual:()=>d,canHavePinnedConvos:()=>l,filterToTab:()=>p,tabToFilter:()=>h,tabToChannelFilter:()=>v});var a=r(701069),s=r(630730),n=r(488085),i=r(811129);function o(e,t){i.refresh(e.folders,t),s.refresh(e.filters,t)}function u(e,t){n.refresh(e.channelFilters,t)}function c(){return{filters:s.empty(),folders:i.empty(),channelFilters:n.empty()}}function d(e,t){if(e.kind!==t.kind)return!1;switch(e.kind){case"filters":return e.filter===t.filter;case"folders":return e.id===t.id;default:(0,a.exhaustivenessCheck)(e)}}function l(e){return"filters"===e.kind}function p(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return}}function h(e){switch(e){case"archive":case"unread":case"businessNotify":case"messageRequest":return e;default:return"all"}}function v(e){switch(e){case"archive":case"unread":return e;default:return"all"}}},465980:(e,t,r)=>{"use strict";r.d(t,{VIEWER_DEFAULT_PUSH_SETTINGS:()=>a,isEdu:()=>s,hasEduAccount:()=>n});var a={userConvo:{isEnabled:!0,withMessageText:!0},chatConvo:{isEnabled:!0,withMessageText:!0},groupConvo:{isEnabled:!0,withMessageText:!0},mention:"every-mention"};function s(e){return"edu"===e}function n(e){return e.accounts.some((e=>s(e.profileType)))}},863347:(e,t,r)=>{"use strict";r.d(t,{fromApiChatMembers:()=>s});var a=r(529122);function s(e){return e.reduce(((e,t)=>{var r=a.resolveId(t.member_id);if(!a.isUserPeerId(r)&&!a.isGroupPeerId(r)&&!a.isContactPeerId(r))return e;var s={isAdmin:Boolean(t.is_admin),canKick:Boolean(t.can_kick),isMessageRequest:Boolean(t.is_message_request),peerId:r};return t.is_message_request&&t.request_date&&(s.requestDate=1e3*t.request_date),e.members.push(s),a.isContactPeerId(r)||(t.is_admin&&e.adminIds.push(r),t.is_owner&&(e.ownerId=r)),e}),{members:[],adminIds:[]})}},374830:(e,t,r)=>{"use strict";r.d(t,{fromApiComment:()=>l});var a=r(722122),s=r(298258),n=r(529122),i=r(897181),o=r(10122),u=r(871183),c=r(335571),d=r(22930);function l(e){var t,r,p,h,v,f={cmid:s.resolveCmid(e.id),postCmid:i.resolveCmid(e.post_id||0),channelId:o.resolveId(e.owner_id||0),canEdit:Boolean(e.can_edit),rootCmid:(null==(t=e.parents_stack)?void 0:t[0])?s.resolveCmid(e.parents_stack[0]):void 0,replies:{count:(null==e||null==(r=e.thread)?void 0:r.count)||0,history:((null==(p=e.thread)?void 0:p.items)||[]).map(l)},sentAt:1e3*e.date};return e.deleted?(0,a.default)({kind:"Deleted"},f):(0,a.default)({kind:"Normal"},f,{chunks:e.text?c.fromServerText(e.text):[],attaches:(0,d.fromApiWallReplyAttach)(e.attachments||[]),likes:{count:(null==(h=e.likes)?void 0:h.count)||0,reactionId:Boolean(null==(v=e.likes)?void 0:v.user_likes)?u.resolveId(0):void 0,availableReactionIds:[],peerIds:new Set},peerId:n.resolveId(e.from_id)})}},208948:(e,t,r)=>{"use strict";r.d(t,{fromApiViewerAccount:()=>s,fromApiViewerProfileInfo:()=>n,fromApiProfileType:()=>i});var a=r(529122);function s(e){var t,r;return{id:a.resolveRealId("User",e.id),profileType:i(e.profile_type),firstName:null!=(t=e.first_name)?t:"",lastName:null!=(r=e.last_name)?r:"",photo:e.photo_100}}function n(e){var t=e.screen_name,r=e.phone,s=e.id,n=e.photo_200,i=e.first_name,o=e.last_name;return{screenName:t,phoneNumber:r,id:a.resolveRealId("User",s),avatarPhoto:n,firstName:i,lastName:o}}function i(e){var t;return null!=(t={0:"normal",2:"edu"}[null!=e?e:0])?t:"normal"}},482025:(e,t,r)=>{"use strict";r.d(t,{Engine:()=>u});var a=r(887757),s=r(722122),n=r(692137),i=r(701069),o=r(616963);class u{constructor(e,t){var r=this;this.logger=void 0,this.request=void 0,this.isWorking=!1,this.empty=()=>({kind:"Buffer",buffer:[]}),this.queued=this.empty(),this.version=void 0,this.connect=e=>{if(!this.isWorking){this.isWorking=!0,this.queued=this.empty();var t=function(){var t=(0,n.default)(a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.isWorking){t.next=18;break}if("Buffer"!==r.queued.kind){t.next=7;break}if(!(r.queued.buffer.reduce(((e,t)=>"Batch"===t.kind?e+t.updates.length:e+1),0)>=1e3)){t.next=7;break}return r.isWorking=!1,r.dispatch({kind:"Failure"}),t.abrupt("return");case 7:return t.prev=7,t.delegateYield(a.mark((function t(){var n,i,o,u;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=`https://${e.server}?version=${r.version}&mode=682`,i=new AbortController,o=setTimeout((()=>i.abort()),3e4),t.next=5,r.request(n,{act:"a_check",key:e.key,ts:e.ts,wait:25},i.signal).finally((()=>clearTimeout(o)));case 5:if(!("failed"in(u=t.sent))){t.next=8;break}throw u;case 8:e.ts=u.ts,e.pts=u.pts,r.dispatch((0,s.default)({kind:"Batch"},u));case 11:case"end":return t.stop()}}),t)}))(),"t0",9);case 9:t.next=16;break;case 11:t.prev=11,t.t1=t.catch(7),r.logger.info("[ENGINE] Error",t.t1),r.isWorking=!1,r.dispatch({kind:"Failure"});case 16:t.next=0;break;case 18:case"end":return t.stop()}}),t,null,[[7,11]])})));return function(){return t.apply(this,arguments)}}();t().catch((e=>{this.isWorking=!1,this.logger.error("[ENGINE] Drain error",e)})),this.logger.info("[ENGINE] Connected")}},this.dispatch=e=>{if("Callback"===this.queued.kind)return this.queued.resolve(e),void(this.queued=this.empty());switch(e.kind){case"Failure":return void this.queued.buffer.push(e);case"Batch":var t=this.queued.buffer[this.queued.buffer.length-1];return void(t&&"Failure"!==t.kind&&t.pts===e.pts?(t.ts=e.ts,t.pts=e.pts,t.updates.push(...e.updates)):this.queued.buffer.push(e));default:(0,i.exhaustivenessCheck)(e)}},this.poll=()=>{if("Callback"===this.queued.kind)return this.queued.reject("Engine.poll вызван повторно до обработки первого вызова!"),new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}));var e=this.queued.buffer.shift();return e?Promise.resolve(e):this.isWorking?new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}})):Promise.reject("Engine.connect еще не был вызван!")},this.isConnected=()=>this.isWorking,this.logger=e,this.request=t,this.version=o.ENGINE_VERSION}}},675648:(e,t,r)=>{"use strict";r.d(t,{EventEmitter:()=>a});class a{constructor(){this.subscriptions={}}subscribe(e,t){var r;Array.isArray(this.subscriptions[e])?null==(r=this.subscriptions[e])||r.push(t):this.subscriptions[e]=[t]}unsubscribe(e,t){var r;Array.isArray(this.subscriptions[e])&&(this.subscriptions[e]=(null==(r=this.subscriptions[e])?void 0:r.filter((e=>e!==t)))||[])}emit(e,t){var r;Array.isArray(this.subscriptions[e])&&(null==(r=this.subscriptions[e])||r.forEach((e=>e(t))))}}},607815:(e,t,r)=>{"use strict";var a;r.d(t,{IApi:()=>a}),function(e){e.resolveTrackId=function(e,t){if(0===t.length)throw new Error("Нельзя отдавать пустую строку в IApi.resolveTrackId");return`${e}-${t}`};class t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,t.prototype)}}e.TimeoutError=t;class r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,r.prototype)}}e.AbortError=r;class a extends Error{constructor(e,t,r){super(t),this.code=void 0,this.payload=void 0,this.code=e,this.payload=r,Object.setPrototypeOf(this,a.prototype)}}e.RequestError=a;class s extends Error{constructor(e){super(String(e[0].error_code)),this.list=void 0,this.list=e.map((e=>({code:e.error_code,message:e.error_msg}))),Object.setPrototypeOf(this,s.prototype)}}e.ExecuteErrors=s}(a||(a={}))},262448:(e,t,r)=>{"use strict";var a,s;r.d(t,{PlayerEventTypes:()=>a,VideoMessagePlayerEventTypes:()=>s}),function(e){e.STATE_UPDATED="stateupdated",e.START_NEW_TRACK="startNewTrack",e.START_NEXT_TRACK="startNextTrack",e.START_PREV_TRACK="startPrevTrack",e.RESUME_TRACK="resumeTrack",e.START_NEXT_TRACK_AUTOMATICALLY="startNextTrackAutomatically",e.STOP_CURRENT_TRACK_AUTOMATICALLY="stopCurrentTrackAutomatically",e.PLAYLIST_ENDED="playlistEnded",e.STOP_CURRENT_TRACK_BEFORE_STARTING_NEW_TRACK="stopCurrentTrackBeforeStartingNewTrack",e.STOP_CURRENT_TRACK_BY_ERROR="stopCurrentTrackByError",e.PAUSE_CURRENT_TRACK="pauseCurrentTrack"}(a||(a={})),function(e){e.SCROLL_TO_MESSAGE="scrollToMessage",e.STATE_UPDATED="stateUpdated"}(s||(s={}))},304439:(e,t,r)=>{"use strict";var a;r.d(t,{IUploader:()=>a}),function(e){class t extends Error{constructor(e){void 0===e&&(e="Aborted"),super(e),Object.setPrototypeOf(this,t.prototype)}}e.AbortError=t;class r extends Error{constructor(e){void 0===e&&(e="Timeout"),super(e),Object.setPrototypeOf(this,r.prototype)}}e.TimeoutError=r}(a||(a={}))},166919:(e,t,r)=>{"use strict";r.d(t,{IMAGE_TYPES:()=>h,VIDEO_TYPES:()=>v,AUDIO_TYPES:()=>f,Uploader:()=>M,areImages:()=>E,areVideos:()=>A,areAudios:()=>P,preloadImage:()=>T,isChannelUpload:()=>j,isConvoUpload:()=>V});var a=r(722122),s=r(887757),n=r(692137),i=r(22930),o=r(304439),u=r(701069),c=r(616963),d=r(529122),l=r(10122),p=r(210746),h=["image/png","image/gif","image/jpeg","image/webp"],v=["video/x-msvideo","video/mp4","video/mpeg","video/3gpp","video/quicktime","video/x-flv","video/x-ms-wmv"],f=["audio/mp3","audio/ogg","audio/wav","audio/mpeg","audio/flac","audio/aac","audio/m4a","audio/mp4","audio/x-m4a"],m=e=>"image"===e.kind,g=e=>"video"===e.kind,y=e=>"audio"===e.kind,C=e=>"doc"===e.kind,k=e=>"owner-photo"===e.kind,b=e=>"chat-photo"===e.kind;class _{constructor(){this.cache=new Map,setInterval((()=>{this.dropCache.call(this)}),6e4)}getUploadServer(e,t){var r=this.cache.get(e);return r?r instanceof Promise?r:this.validateCache(r.timestamp)?Promise.resolve(r.url):(this.cache.delete(e),this.getUploadServer(e,t)):(r=t().then((t=>(this.cache.set(e,{url:t,timestamp:Date.now()}),t))),this.cache.set(e,r),r)}dropCache(){0!==this.cache.size&&Array.from(this.cache.entries()).forEach((e=>{var t=e[0],r=e[1];r instanceof Promise||(this.validateCache(r.timestamp)||this.cache.delete(t))}))}validateCache(e){return Date.now()-e<=5e3}}class I{constructor(e){this.api=void 0,this.emitter=new S,this.requestTimeout=0,this.freeResources=5,this.waiting=[],this.photosUploadUrlCache=new _,this.wallPhotosUploadUrlCache=new _,this.docsUploadUrlCache=new _,this.wallDocsUploadUrlCache=new _,this.lock=()=>0!==this.freeResources&&(this.freeResources=Math.max(this.freeResources-1,0),!0),this.release=()=>{setTimeout((()=>{this.freeResources=Math.min(this.freeResources+1,5);var e=this.waiting.shift();e&&e()}),c.API_RATE_LIMIT_WINDOW+50)},this.api=e}uploadImage(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,o,u,c;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={peer_id:t.viewerId,group_id:t.groupId,upload_v2:0},o=()=>r.api.fetch("photos.getMessagesUploadServer",n).then((e=>e.upload_url)),u=()=>r.photosUploadUrlCache.getUploadServer(JSON.stringify(n),o),(c=new FormData).append("photo",e.file),a.abrupt("return",r.uploadRequest(u,c,e.trackId,(e=>{var t=e.data,a=t.server,s=t.hash,n=t.photo;return r.api.fetch("photos.saveMessagesPhoto",{server:a,hash:s,photo:n}).then((e=>{if(0===e.length||void 0===e[0])throw new Error("Метод photos.saveMessagesPhoto не вернул фотографию");var t=(0,i.fromApiPhoto)(e[0]);if(void 0===t)throw new Error("Не удалось конвертировать фотографию с сервера");return t}))})));case 6:case"end":return a.stop()}}),a)})))()}uploadVideo(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,i,o;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={target:t,preview:1,no_comments:1},i=()=>r.api.fetch("video.save",n).then((e=>{var t=e.upload_url;if(!t)throw new Error("В методе video.save не вернулся upload_url");return t})),(o=new FormData).append("video_file",e.file),a.abrupt("return",r.uploadRequest(i,o,e.trackId,(e=>{var t=e.data,r=t.video_id,a=t.owner_id;return Promise.resolve({kind:"Video",id:r,ownerId:a,image:[{url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAA1JREFUGFdjYGBg+A8AAQQBAHAgZQsAAAAASUVORK5CYII=",width:1,height:1}],views:0})})));case 5:case"end":return a.stop()}}),a)})))()}uploadAudio(e){var t=this;return(0,n.default)(s.mark((function r(){var a,n,o;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={},n=()=>t.api.fetch("audio.getUploadServer",a).then((e=>e.upload_url)),(o=new FormData).append("file",e.file),r.abrupt("return",t.uploadRequest(n,o,e.trackId,(e=>{var r=e.data,a=r.server,s=r.audio,n=r.hash;return t.api.fetch("audio.save",{server:a,audio:s,hash:n}).then((e=>(0,i.fromApiAudio)(e)))})));case 5:case"end":return r.stop()}}),r)})))()}uploadDoc(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,o,u,c;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={type:"doc",peer_id:t.targetPeerId},o=()=>r.api.fetch("docs.getMessagesUploadServer",n).then((e=>e.upload_url)),u=()=>r.docsUploadUrlCache.getUploadServer(JSON.stringify(n),o),(c=new FormData).append("file",e.file),a.abrupt("return",r.uploadRequest(u,c,e.trackId,(e=>{var t=e.data.file;return r.api.fetch("docs.save",{file:t}).then((e=>{if(!e.doc)throw new Error("Метод doc.save не вернул документ");var t=(0,i.fromApiDoc)(e.doc);if(!t)throw new Error("Не удалось конвертировать документ (нет поля url)");return t}))})));case 6:case"end":return a.stop()}}),a)})))()}uploadWallDoc(e,t){var r=this;return(0,n.default)(s.mark((function t(){var a,n,o,u;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={group_id:0},n=()=>r.api.fetch("docs.getWallUploadServer",a).then((e=>e.upload_url)),o=()=>r.wallDocsUploadUrlCache.getUploadServer(JSON.stringify(a),n),(u=new FormData).append("file",e.file),t.abrupt("return",r.uploadRequest(o,u,e.trackId,(e=>{var t=e.data.file;return r.api.fetch("docs.save",{file:t,group_id:0}).then((e=>{if(!e.doc)throw new Error("Метод doc.save не вернул документ");var t=(0,i.fromApiDoc)(e.doc);if(!t)throw new Error("Не удалось конвертировать документ (нет поля url)");return t}))})));case 6:case"end":return t.stop()}}),t)})))()}uploadVoice(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,o,u;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={type:"audio_message",peer_id:t.targetPeerId},o=()=>r.api.fetch("docs.getMessagesUploadServer",n).then((e=>e.upload_url)),(u=new FormData).append("file",e.file),a.abrupt("return",r.uploadRequest(o,u,e.trackId,(e=>{var t=e.data.file;return r.api.fetch("docs.save",{file:t}).then((e=>{if(!e.audio_message)throw new Error("Метод doc.save не вернул аудиосообщение");return(0,i.fromApiVoice)(e.audio_message)}))})));case 5:case"end":return a.stop()}}),a)})))()}uploadChatPhoto(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,i,o,u;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(t.targetPeerId&&d.isChatPeerId(t.targetPeerId)){a.next=2;break}throw new Error("Для обновления аватара чата targetPeerId обязательно должен быть ChatId");case 2:return a.next=4,H(e);case 4:return n=a.sent,i={chat_id:t.targetPeerId-2e9,crop_x:n.x,crop_y:n.y,crop_width:n.width},o=()=>r.api.fetch("photos.getChatUploadServer",i).then((e=>e.upload_url)),(u=new FormData).append("photo",e.file),a.abrupt("return",r.uploadRequest(o,u,e.trackId,(e=>{var a=e.data.response;return r.api.fetch("messages.setChatPhoto",{file:a,user_id:t.viewerId}).then((()=>{}))})));case 10:case"end":return a.stop()}}),a)})))()}uploadOwnerPhoto(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,i,o;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={owner_id:t.viewerId},i=()=>r.api.fetch("photos.getOwnerPhotoUploadServer",n).then((e=>e.upload_url)),(o=new FormData).append("photo",e.file),a.abrupt("return",r.uploadRequest(i,o,e.trackId,(e=>{var a=e.data,s=a.hash,n=a.photo,i=a.server;return r.api.fetch("photos.saveOwnerPhoto",{owner_id:t.viewerId,server:i,hash:s,photo:n}).then((()=>{}))})));case 5:case"end":return a.stop()}}),a)})))()}uploadWallImage(e,t){var r=this;return(0,n.default)(s.mark((function a(){var n,o,u,c;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n={group_id:Math.abs(t.targetPeerId),upload_v2:0},o=()=>r.api.fetch("photos.getWallUploadServer",n).then((e=>e.upload_url)),u=()=>r.wallPhotosUploadUrlCache.getUploadServer(JSON.stringify(n),o),(c=new FormData).append("photo",e.file),a.abrupt("return",r.uploadRequest(u,c,e.trackId,(e=>{var a=e.data,s=a.server,n=a.hash,o=a.photo;return r.api.fetch("photos.saveWallPhoto",{group_id:Math.abs(t.targetPeerId),server:s,hash:n,photo:o}).then((e=>{if(0===e.length||void 0===e[0])throw new Error("Метод photos.saveWallPhoto не вернул фотографию");var t=(0,i.fromApiPhoto)(e[0]);if(void 0===t)throw new Error("Не удалось конвертировать фотографию с сервера");return t}))})));case 6:case"end":return a.stop()}}),a)})))()}convoUpload(e,t){var r=this;return(0,n.default)(s.mark((function a(){return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!m(e)){a.next=2;break}return a.abrupt("return",r.uploadImage(e,t));case 2:if(!g(e)){a.next=4;break}return a.abrupt("return",r.uploadVideo(e,"messages"));case 4:if(!y(e)){a.next=6;break}return a.abrupt("return",r.uploadAudio(e));case 6:if(!C(e)){a.next=8;break}return a.abrupt("return",r.uploadDoc(e,t));case 8:if("voice"!==e.kind){a.next=10;break}return a.abrupt("return",r.uploadVoice(e,t));case 10:if(!b(e)){a.next=12;break}return a.abrupt("return",r.uploadChatPhoto(e,t));case 12:if(!k(e)){a.next=14;break}return a.abrupt("return",r.uploadOwnerPhoto(e,t));case 14:return a.abrupt("return",Promise.reject());case 15:case"end":return a.stop()}}),a)})))()}channelsUpload(e,t){var r=this;return(0,n.default)(s.mark((function a(){return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!m(e)){a.next=2;break}return a.abrupt("return",r.uploadWallImage(e,t));case 2:if(!g(e)){a.next=4;break}return a.abrupt("return",r.uploadVideo(e,"wall"));case 4:if(!y(e)){a.next=6;break}return a.abrupt("return",r.uploadAudio(e));case 6:if(!C(e)){a.next=8;break}return a.abrupt("return",r.uploadWallDoc(e,t));case 8:return a.abrupt("return",Promise.reject());case 9:case"end":return a.stop()}}),a)})))()}upload(e,t){var r=this;return(0,n.default)(s.mark((function a(){return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!B(t)){a.next=2;break}return a.abrupt("return",r.channelsUpload(e,t));case 2:if(!G(t)){a.next=4;break}return a.abrupt("return",r.convoUpload(e,t));case 4:return a.abrupt("return",Promise.reject());case 5:case"end":return a.stop()}}),a)})))()}uploadRequest(e,t,r,a){var i=this,o=r,u=new AbortController,c=function(){var r=(0,n.default)(s.mark((function r(){var n;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e();case 2:return n=r.sent,r.abrupt("return",z(n,t,{signal:u.signal,timeout:i.requestTimeout,headers:{Accept:"application/json, text/plain, */*"},onUploadProgress:e=>{i.emitter.emit(o,{loaded:e.loaded,total:e.total})}}).then((e=>(i.emitter.removeListener(o),a(e)))).then((e=>(i.release(),e))).catch((e=>(i.release(),Promise.reject(e)))));case 4:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return this.lock()?{abort:()=>u.abort(),trackId:r,response:c()}:{abort:()=>u.abort(),trackId:r,response:new Promise(((e,t)=>{this.waiting.push((()=>c().then(e).catch(t)))}))}}trackProgress(e,t){this.emitter.addListener(e,t)}}class w{constructor(){this.attaches=new Map,this.emitter=new S}subscribe(e,t){return this.emitter.addListener(e,t),()=>{this.emitter.removeListener(e)}}get(e){return this.attaches.get(e)}filterMissing(e){return e.filter((e=>!this.attaches.has(e)))}update(e,t){var r=this.attaches.get(e),a="function"==typeof t?t(r):t;a&&(this.attaches.set(e,a),this.emitter.emit(e,a))}remove(e){new Set(e).forEach((e=>{this.attaches.delete(e),this.emitter.removeListener(e)}))}}class M extends I{constructor(){super(...arguments),this.uploads=new Map,this.failedUploads=new Map,this.state=new w}uploadFiles(e,t,r,a){void 0===a&&(a={}),e.forEach((e=>{this.toUploaderFileInfo(e,t).then((e=>{this.doUpload(e,r,a)})).catch((()=>{null==a.onError||a.onError()}))}))}abortUpload(e){var t=this.uploads.get(e);t&&(t.process.abort(),null==t.handlers.onUploadAbort||t.handlers.onUploadAbort(e),this.uploads.delete(e));var r=this.failedUploads.get(e);r&&(null==r.handlers.onUploadAbort||r.handlers.onUploadAbort(e),this.failedUploads.delete(e)),this.state.remove([e])}retryUpload(e){var t=this.failedUploads.get(e);if(t){this.failedUploads.delete(e);var r=t.file,s=t.messengerData,n=t.handlers;this.doUpload(r,s,n),this.state.update(r.trackId,(e=>{if(e)return(0,a.default)({},e,{error:!1,abortable:!1})}))}}getOrphans(e){return this.state.filterMissing(e)}subscribe(e,t){if(0===e.length)return()=>{};t(this.getState(e));var r=e.map((r=>this.state.subscribe(r,(()=>{t(this.getState(e))}))));return t=>{r.forEach((e=>e())),t(e)}}getState(e){if(0===e.length)return{};var t=e.reduce(((e,t)=>{var r=this.state.get(t);return r&&e.push(r),e}),[]);return this.buildOptimisticAttachments(t)}doUpload(e,t,r){var a=e.trackId;null==r.onUploadStart||r.onUploadStart([a]),this.upload(e,t).then((e=>(this.uploads.set(a,{process:e,handlers:r}),this.trackProgress(a,(e=>{var t=e.loaded,s=e.total;return this.updateAttachProgress(a,{loaded:t,total:s,error:!1,abortable:t!==s},r)})),Promise.resolve(e.response).then((e=>{var t=this.modifyUploadedAttach(a,e),s=new Map(t?[[a,t]]:[]);null==r.onUploadFinish||r.onUploadFinish(s),this.state.remove([a])})).catch((e=>e instanceof o.IUploader.AbortError?Promise.resolve():Promise.reject(e))).finally((()=>{this.uploads.delete(a)}))))).catch((s=>{console.error("[UPLOADER] Ошибка загрузки",s),null==r.onError||r.onError(),this.failedUploads.set(a,{file:e,messengerData:t,handlers:r}),this.updateAttachProgress.call(this,a,{loaded:0,total:0,error:!0,abortable:!1},r)}))}toUploaderFileInfo(e,t){var r=t.asFiles,a=t.asVoice,s=t.asChatPhoto,n=t.asOwnerPhoto;if(!(e instanceof File)){if(!a)throw new Error("Загрузить аудиосообщения можно только с флагом asVoice");var i=e.blob,o=e.duration,u=e.waveform,c=new File([i],"voice_recording",{type:"audio/ogg"}),d=M.toFileInfo(c,"voice");return function(e,t,r,a){return Promise.resolve({kind:"OptimisticVoice",id:e.trackId,blob:t,duration:r,waveform:a,loaded:0,total:e.file.size})}(d,i,o,u).then((e=>(this.state.update(d.trackId,e),d)))}var l,p=e;if(s){var h=M.toFileInfo(p,"chat-photo");return Promise.resolve(h)}if(n){var v=M.toFileInfo(p,"owner-photo");return Promise.resolve(v)}if(!r&&R(p)){var f=M.toFileInfo(p,"image");return function(e){return q.apply(this,arguments)}(f).then((e=>(this.state.update(f.trackId,e),f)))}if(!r&&x(p)){var m=M.toFileInfo(p,"video");return function(e){return L.apply(this,arguments)}(m).then((e=>(this.state.update(m.trackId,e),m)))}if(!r&&U(p)){var g=M.toFileInfo(p,"audio");return(l=g,new Promise((e=>{var t=new Audio,r=URL.createObjectURL(l.file);t.addEventListener("loadedmetadata",(()=>{e({kind:"OptimisticAudio",id:l.trackId,duration:t.duration,artist:"",title:l.file.name,loaded:0,total:l.file.size})})),t.src=r}))).then((e=>(this.state.update(g.trackId,e),g)))}var y=M.toFileInfo(p,"doc");return function(e){return D.apply(this,arguments)}(y).then((e=>(this.state.update(y.trackId,e),y)))}modifyUploadedAttach(e,t){if(!t)return null;var r=this.state.get(e),s=t;return"Video"===t.kind&&"OptimisticVideo"===(null==r?void 0:r.kind)&&r&&(s=(0,a.default)({},t,{duration:r.duration,image:[r.image]})),s}updateAttachProgress(e,t,r){var s=r.onUploadProgressUpdate;this.state.update(e,(e=>{if(e){switch(e.kind){case"OptimisticPhoto":null==s||s("photo");break;case"OptimisticVideo":null==s||s("video");break;case"OptimisticDoc":null==s||s("file")}return(0,a.default)({},e,{},t)}}))}buildOptimisticAttachments(e){return e.reduce(((e,t)=>{var r=[],a=[],s=[],n=[];switch(t.kind){case"OptimisticPhoto":r.push(t);break;case"OptimisticVideo":a.push(t);break;case"OptimisticAudio":s.push(t);break;case"OptimisticDoc":n.push(t);break;case"OptimisticVoice":e.voice=t}return r.length&&(e.photos=[...e.photos||[],...r]),a.length&&(e.videos=[...e.videos||[],...a]),s.length&&(e.audios=[...e.audios||[],...s]),n.length&&(e.docs=[...e.docs||[],...n]),e}),{})}static clearOptimisticAttachments(e,t){t.forEach((t=>{if("photos"in e){if(!e.photos)return;var r=(0,u.toNonEmpty)(e.photos.filter((e=>e.id!==t)));r?e.photos=r:delete e.photos}if("videos"in e){if(!e.videos)return;var a=(0,u.toNonEmpty)(e.videos.filter((e=>e.id!==t)));a?e.videos=a:delete e.videos}if("audios"in e){if(!e.audios)return;var s=(0,u.toNonEmpty)(e.audios.filter((e=>e.id!==t)));s?e.audios=s:delete e.audios}if("docs"in e){if(!e.docs)return;var n=(0,u.toNonEmpty)(e.docs.filter((e=>e.id!==t)));n?e.docs=n:delete e.docs}"voice"in e&&delete e.voice}))}static buildAttachments(e){return e.reduce(((e,t)=>(0,p.produce)(e,(r=>{var a,s,n,i,o=null,c=null,d=null,l=null;switch(t.kind){case"Photo":o=(0,u.toNonEmpty)([t]);break;case"Video":c=(0,u.toNonEmpty)([t]);break;case"Audio":d=(0,u.toNonEmpty)([t]);break;case"Doc":l=(0,u.toNonEmpty)([t]);break;case"Voice":r.voice=t}(null==(a=o)?void 0:a.length)&&(r.photos=[...e.photos||[],...o]),(null==(s=c)?void 0:s.length)&&(r.videos=[...e.videos||[],...c]),(null==(n=d)?void 0:n.length)&&(r.audios=[...e.audios||[],...d]),(null==(i=l)?void 0:i.length)&&(r.docs=[...e.docs||[],...l])}))),{})}static hash(){return Math.floor(1e8*Math.random()+1e8).toString(16)}static resolveTrackId(e,t){if(0===t.length)throw new Error("Нельзя отдавать пустую строку в Uploader.resolveTrackId");return`${e}-${t}`}static toFileInfo(e,t){switch(t){case"image":return{kind:"image",trackId:M.resolveTrackId("image",M.hash()),file:e};case"video":return{kind:"video",trackId:M.resolveTrackId("video",M.hash()),file:e};case"audio":return{kind:"audio",trackId:M.resolveTrackId("audio",M.hash()),file:e};case"doc":return{kind:"doc",trackId:M.resolveTrackId("doc",M.hash()),file:e};case"voice":return{kind:"voice",trackId:M.resolveTrackId("voice",M.hash()),file:e};case"chat-photo":return{kind:"chat-photo",trackId:M.resolveTrackId("chat-photo",M.hash()),file:e};case"owner-photo":return{kind:"owner-photo",trackId:M.resolveTrackId("owner-photo",M.hash()),file:e};default:(0,u.exhaustivenessCheck)(t)}}}class S{constructor(){this.map=new Map}addListener(e,t){this.map.set(e,[...this.map.get(e)||[],t])}removeListener(e){this.map.delete(e)}emit(e,t){var r;null==(r=this.map.get(e))||r.forEach((e=>e(t)))}}function R(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&Boolean(e.type&&h.includes(e.type))}function E(e){return e.every(R)}function x(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&Boolean(e.type&&v.includes(e.type))}function A(e){return e.every(x)}function U(e){return!(e instanceof DataTransferItem&&"file"!==e.kind)&&Boolean(e.type&&f.includes(e.type))}function P(e){return e.every(U)}function T(e){var t=URL.createObjectURL(e);return new Promise(((e,r)=>{var a=new Image;a.onload=()=>{e({url:t,width:a.width,height:a.height})},a.onerror=r,a.src=t}))}function O(e){return new Promise(((t,r)=>{var a=document.createElement("video");a.volume=0,a.preload="metadata",a.onloadedmetadata=()=>t(a),a.onerror=r,a.src=e}))}function F(e){return O(URL.createObjectURL(e))}function N(e){function t(e,t){return new Promise(((r,a)=>{e.onseeked=()=>{e.videoWidth&&e.videoHeight||r(void 0);var t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;var a=t.getContext("2d");a?(a.drawImage(e,0,0),r(t.toDataURL("image/jpeg"))):r(void 0)},e.onerror=a,e.currentTime=t}))}return t(e,.5*e.duration).catch(function(){var r=(0,n.default)(s.mark((function r(a){var n,i,o,u;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if("string"!=typeof a){r.next=2;break}return r.abrupt("return",Promise.reject(a));case 2:if((o=null==(n=a.composedPath())?void 0:n[0])instanceof HTMLVideoElement&&4===(null==o||null==(i=o.error)?void 0:i.code)){r.next=5;break}return r.abrupt("return",Promise.reject(a));case 5:return r.next=7,O(e.src);case 7:return u=r.sent,r.abrupt("return",t(u,Math.min(e.duration,1)));case 9:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}function q(){return(q=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t.file);case 2:return r=e.sent,e.abrupt("return",{kind:"OptimisticPhoto",id:t.trackId,image:r,loaded:0,total:t.file.size});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return(L=(0,n.default)(s.mark((function e(t){var r,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F(t.file);case 2:return r=e.sent,e.next=5,N(r);case 5:if(e.t0=e.sent,e.t0){e.next=8;break}e.t0="";case 8:return a=e.t0,e.abrupt("return",{kind:"OptimisticVideo",id:t.trackId,duration:Math.floor(r.duration),loaded:0,total:t.file.size,image:{url:a,width:r.videoWidth,height:r.videoHeight}});case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){return(D=(0,n.default)(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=/\.([0-9a-z]+)$/i.exec(t.file.name),n={kind:"OptimisticDoc",id:t.trackId,title:t.file.name,size:t.file.size,ext:(null==r?void 0:r[1])||"",loaded:0,total:t.file.size},!R(t.file)){e.next=7;break}return e.next=5,T(t.file);case 5:return i=e.sent,e.abrupt("return",(0,a.default)({},n,{image:i}));case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return new Promise((t=>{var r=new Image,a=URL.createObjectURL(e.file);r.onload=()=>{var e=Math.min(r.width,r.height),a=Math.floor((r.width-e)/2),s=Math.floor((r.height-e)/2);t({x:a,y:s,width:e})},r.src=a}))}function B(e){return!!e.targetPeerId&&l.isChannelId(e.targetPeerId)&&!!e.isChannel}function G(e){return!B(e)}function j(e,t){return!!e&&l.isChannelId(e)&&!!t}function V(e,t){return!!e&&!l.isChannelId(e)||!t}function z(e,t,r){return void 0===r&&(r={}),new Promise(((a,s)=>{var n=r,i=n.method,u=void 0===i?"POST":i,c=n.signal,d=n.onUploadProgress,l=n.headers,p=void 0===l?{}:l,h=n.timeout;if(null==c?void 0:c.aborted)return s(new o.IUploader.AbortError);var v=new XMLHttpRequest,f=()=>v.abort();c&&(c.addEventListener("abort",f),v.addEventListener("readystatechange",(()=>{4===v.readyState&&c.removeEventListener("abort",f)}))),v.addEventListener("abort",(()=>{s(new o.IUploader.AbortError)})),v.addEventListener("error",s),v.addEventListener("timeout",(()=>{s(new o.IUploader.TimeoutError)})),v.upload.addEventListener("progress",(e=>{e.lengthComputable&&(null==d||d(e))})),v.addEventListener("loadend",(()=>{var e,t=v.readyState,r=v.status,n=v.responseText;try{e=JSON.parse(n)}catch(e){return s(e)}return 4===t&&200===r?a({data:e}):s(e)})),v.open(u,e,!0),Object.entries(p).forEach((e=>{var t=e[0],r=e[1];v.setRequestHeader(t,r)})),h&&(v.timeout=h),v.send(t)}))}},352781:(e,t,r)=>{"use strict";r.d(t,{handler:()=>n});var a=r(766278),s=r(529122),n=(e,t)=>{var r=t.profiles,n=t.groups,i=t.conversations,o=t.mutualFriends,u=t.contacts;if((0,a.insertConvos)(e,i||[]),(0,a.insertPeers)(e,{apiUsers:r||[],apiGroups:n||[],apiContacts:u||[]}),o){var c=e.peers.get(s.resolveId(o.peerId));c&&s.updateMutualFriends(c,o.hint.map(s.resolveId),o.count)}return[]}},961442:(e,t,r)=>{"use strict";r.d(t,{handler:()=>g});var a=r(887757),s=r(722122),n=r(692137),i=r(766278),o=r(701069),u=r(857085),c=r(488085),d=r(10122),l=r(897181),p=r(529122),h=r(766086),v=r(616963);function f(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return m(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var g=(e,t)=>{switch(t.variant.kind){case"FromChannelEngine":return y(e,t.variant);case"FromChannelEngineWithMissingData":return function(e,t){var r=t.next,a=t.response,s=a[0],n=a[1];s&&(0,i.insertChannels)(e,{apiChannels:s.items||[],apiGroups:s.groups||[],dangerouslyMerge:!0});(n||s)&&(0,i.insertPeers)(e,{apiUsers:[...n||[],...(null==s?void 0:s.profiles)||[]],apiGroups:(null==s?void 0:s.groups)||[],apiContacts:[]});return y(e,{kind:"FromChannelEngine",isRetry:!0,next:r})}(e,t.variant);case"FromChannelEngineApiHistory":return function(e,t){for(var r,a=t.ts,s=t.history,n=t.posts,i=new Map,o=f(n);!(r=o()).done;){var u=r.value,c=i.get(u.channel_id);c||(c=new Map,i.set(u.channel_id,c)),c.set(u.cmid,u)}return y(e,{kind:"FromChannelEngine",next:{kind:"Batch",ts:a,updates:s.reduce(((e,t)=>{switch(t[0]){case 70001:case 70002:var r,a=null==(r=i.get(t[1]))?void 0:r.get(t[2]);return a?(e.push([...t,a]),e):e;default:return e.push(t),e}}),[])}})}(e,t.variant);default:return(0,o.exhaustivenessCheck)(t.variant)}};function y(e,t){var r=t.isRetry,i=t.next;if("Failure"===i.kind){e.channelConn.status="resyncing";var m=e.channelConn.ts;return[function(){var e=(0,n.default)(a.mark((function e(t){var r,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,n=t.channelEngine){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,(0,o.sleep)(1e3);case 5:return e.prev=5,e.next=8,r.fetch("channels.getLongPollHistory",{lp_version:n.version,ts:m,limit:1e3,extended:1},{retries:1/0,timeout:v.CHANNELS_GLPH_TIMEOUT});case 8:i=e.sent,e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(5),e.abrupt("return",{type:"Noop"});case 14:return n.connect((0,s.default)({},i.credentials,{ts:i.new_ts})),e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineApiHistory",ts:i.new_ts,history:i.history,posts:i.messages||[]}});case 16:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t){return e.apply(this,arguments)}}()]}if(!r){var g=function(e,t){var r=new Set,a=new Set;function s(t){switch(t[0]){case 70001:var n,i,o,u,c=t[1],l=t[4],h=d.resolveId(c);if(e.channels.has(h)||r.add(h),null==(n=l.attachments)||null==(i=n[0])||null==(o=i.wall.copy_history)||null==(u=o[0])?void 0:u.from_id){var v=p.resolveId(l.attachments[0].wall.copy_history[0].from_id);if(p.isUserPeerId(v)){a.add(v);break}if(p.isGroupPeerId(v)){r.add(d.resolveId(v));break}}break;case 70002:case 70003:case 70004:case 70010:case 70007:case 70008:break;case 70005:var m=t[1];if(t[2]){var g=d.resolveId(m);r.add(g)}break;case 70009:var y=t[1];if(t[2]){var C=d.resolveId(y);r.add(C)}break;case 70011:for(var k,b=f(t[1]);!(k=b()).done;){s(k.value)}break;default:}}for(var n,i=f(t.updates);!(n=i()).done;){s(n.value)}return{channelIds:r,userIds:a}}(e,i);if(g.channelIds.size>0||g.userIds.size>0)return[function(){var e=(0,n.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetchMany([g.channelIds.size>0&&{method:"channels.getById",params:{channel_ids:Array.from(g.channelIds).join(","),extended:1}},g.userIds.size>0&&{method:"users.get",params:{user_ids:Array.from(g.userIds).map(p.toRealId).join(","),extended:1}}],{retries:1/0});case 4:return s=e.sent,e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:{kind:"FromChannelEngineWithMissingData",next:i,response:s}});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]}e.channelConn.status="running",e.channelConn.ts=i.ts;var y=t=>{switch(t[0]){case 70001:return function(e,t){var r=t[1],a=t[3],s=t[4],n=d.resolveId(r),i=e.channels.get(n);if(!i)return[];d.setSortId(i,{minorSortId:a});for(var o,c=(0,h.fromApiPost)(s),l=c.post,p=f(c.reactions);!(o=p()).done;){var v=o.value;e.reactions.set(v.id,v)}d.appendPost(i,l),u.refreshChannels(e.organisers,i),e.locks.channelsCleanup.has(n)||d.cleanup(i);return[]}(e,t);case 70002:return function(e,t){var r=t[1],a=t[3],s=d.resolveId(r),n=e.channels.get(s);if(!n)return[];for(var i,o=(0,h.fromApiPost)(a),u=o.post,c=f(o.reactions);!(i=c()).done;){var l=i.value;e.reactions.set(l.id,l)}return d.replacePost(n,u),[]}(e,t);case 70003:return function(e,t){var r=t[1],a=t[2],s=t[3],n=d.resolveId(r),i=l.resolveCmid(a),o=e.channels.get(n);if(!o)return[];return d.setSortId(o,{minorSortId:s}),d.deletePost(o,i,!1),[]}(e,t);case 70004:return function(e,t){var r=t[1],a=t[2],s=t[3],n=d.resolveId(r),i=l.resolveCmid(a),o=e.channels.get(n);if(!o)return[];return d.readUntil(o,i,s),[]}(e,t);case 70005:return function(e,t){var r=t[1],a=t[2],s=t[3],n=d.resolveId(r),i=e.channels.get(n);if(!i)return[];return d.setArchived(i,!a),c.updateCounters(e.organisers.channelFilters,{archiveTotal:s}),u.refreshChannels(e.organisers,i),[]}(e,t);case 70007:return function(e,t){var r=t[1],a=t[2],s=d.resolveId(r),n=e.channels.get(s);if(!n)return[];return d.setMuted(n,0!==a),[]}(e,t);case 70008:return function(e,t){var r=t[1];return c.updateCounters(e.organisers.channelFilters,{unread:r}),[]}(e,t);case 70009:return function(e,t){var r=t[1],a=t[2],s=d.resolveId(r),n=e.channels.get(s);if(!n)return[];return d.setMembership(n,Boolean(a)),u.refreshChannels(e.organisers,n),[]}(e,t);case 70010:return function(e,t){var r=t[1],a=t[4],s=d.resolveId(r),n=e.channels.get(s);if(!n)return[];var i=(0,h.fromApiPost)(a).post;"Normal"===i.kind&&d.restorePost(n,i.cmid,i);return[]}(e,t);case 70011:return t[1].flatMap(y);default:return[]}};return[...i.updates.flatMap(y),function(){var e=(0,n.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.channelEngine){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,r.poll();case 5:return e.t0=e.sent,e.t1={kind:"FromChannelEngine",next:e.t0},e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}},663826:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(701069),i=r(488085),o=r(766278),u=(e,t)=>{switch(t.type){case"ChannelsOnboardingDone":return 0===t.pickedChannelsIds.length?(i.push(e.organisers.channelFilters,"all",[],!1),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.next=3,r.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0});case 3:return e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):[function(){var e=(0,s.default)(a.mark((function e(r){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,e.prev=1,e.next=4,s.fetch("channels.unarchive",{channel_ids:t.pickedChannelsIds.join(",")||"",extended:1});case 4:return n=e.sent,e.abrupt("return",{type:"ChannelsOnboardingDone_RequestSucceeded",responseChannels:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"ChannelsOnboardingDone_RequestFailed"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"ChannelsOnboardingDone_RequestSucceeded":var r=(0,o.insertChannels)(e,{apiChannels:t.responseChannels.succeeded||[],apiGroups:t.responseChannels.groups||[]});return i.push(e.organisers.channelFilters,"all",r,!1),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.next=3,r.fetch("account.hideHelpHint",{hint_id:"im:channels_onboarding"},{retries:1/0});case 3:return e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"ChannelsOnboardingDone_RequestFailed":return[];default:(0,n.exhaustivenessCheck)(t)}}},187982:(e,t,r)=>{"use strict";r.d(t,{handler:()=>w});var a=r(722122),s=r(887757),n=r(692137),i=r(766278),o=r(843524),u=r(664902),c=r(857085),d=r(630730),l=r(529122),p=r(658265),h=r(194739),v=r(811129),f=r(98310),m=r(701069),g=r(616963),y=r(568647),C=r(605443),k=r(201548),b=r(607815);function _(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var w=(e,t,r)=>{switch(t.type){case"EngineBatchReceived":var a=t.variant;switch(a.kind){case"FromEngine":return M(r,e,a);case"FromEngineWithMissingData":return function(e,t,r){var a=r.apiConvos,s=r.apiMessages,n=r.apiUsers,o=r.apiGroups,u=r.apiContacts,c=R(s,a);return(0,i.insertConvos)(t,a.map((e=>({conversation:e,last_message:c.messages_legacy.get(e.last_message_id)}))),{dangerouslyMerge:!0}),(0,i.insertPeers)(t,{apiUsers:n,apiGroups:o,apiContacts:u}),M(e,t,{kind:"FromEngine",next:r.skippedBatch},c)}(r,e,a);case"FromApiEngineHistory":return function(e,t,r){var a,o=r.next,u=r.apiMessages,c=r.apiConvos,l=r.apiUsers,p=r.apiGroups,h=r.apiContacts,f=r.apiCounters,m=R(u,c);(0,i.insertConvos)(t,c.map((e=>({conversation:e,last_message:m.messages_legacy.get(e.last_message_id)}))),{dangerouslyMerge:!0}),(0,i.insertPeers)(t,{apiUsers:l,apiGroups:p,apiContacts:h},{dangerouslyOverwrite:!0}),t.activeCallsCount=f.calls||0,d.updateCounters(t.organisers.filters,{unread:f.messages||0,unreadUnmuted:f.messages_unread_unmuted||0,headerNotMutedUnread:0,archive:f.messages_archive_unread||0,archiveMentions:f.messages_archive_mentions_count||0,archiveTotal:f.messages_archive||0,messageRequests:f.message_requests||0}),null==(a=f.messages_folders)||a.forEach((e=>{v.setUnreadCounters(t.organisers.folders,v.resolveId(e.folder_id),e.total_count,e.unmuted_count)}));var g=t.organisers.filters.unread.unreadUnmutedCount;return[...M(e,t,{kind:"FromEngine",next:o},m),function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unread:g}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()]}(r,e,a);default:return(0,m.exhaustivenessCheck)(a)}case"EngineBatchReceived_TypingsTimedOut":var o=t.peerId,u=t.typingType,c=t.timestamp,l=e.typings.get(o);if(!l)return[];var p=l[u];return p?(p.updatedAt<=c&&delete l[u],0===Object.keys(l).length&&e.typings.delete(o),[]):[];case"UpdateMessageRequestsCounter":return[function(){var e=(0,n.default)(s.mark((function e(t){var r,a,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,a=b.IApi.resolveTrackId("account.getCounters","message_requests"),r.dangerouslyAbort(a),e.next=6,r.fetch("account.getCounters",{filter:"message_requests"},{trackId:a});case 6:return n=e.sent,i=n.message_requests,e.abrupt("return",{type:"UpdateMessageRequestsCounter_RequestCompleted",count:null!=i?i:0});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UpdateMessageRequestsCounter_RequestCompleted":return d.updateCounters(e.organisers.filters,{messageRequests:t.count}),[];case"TemporaryHackForResync":case"LoadChatMembers":case"LoadChatInfo":case"UpdateComposerDraftOnMessageDelete":case"ActualizeArchiveMentions":return[];default:return(0,m.exhaustivenessCheck)(t)}};function M(e,t,r,b){var I=r.next;if("Failure"===I.kind){t.convoConn.status="resyncing";var w=t.convoConn.pts,M=t.ownerId;return[function(){var e=(0,n.default)(s.mark((function e(t){var r,n,o,u,c,d,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.api,o=t.engine,u=t.queue,e.next=3,(0,m.sleep)(1e3);case 3:return e.prev=3,e.next=7,n.fetchSeq([{method:"messages.getLongPollHistory",params:{lp_version:o.version,credentials:1,pts:w,msgs_limit:1100,events_limit:1100,last_n:1e3,extended:1,group_id:(0,i.getOwnerGroupId)(M)}},{method:"account.getCounters",params:{filter:"all"}}],{retries:1/0});case 7:l=e.sent,c=l[0],d=l[1],e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(3),e.abrupt("return",{type:"Noop"});case 15:if(!(w<(c.from_pts||0))){e.next=19;break}return u.disconnect(),console.error("Выполняется полный ресинк"),e.abrupt("return",{type:"TemporaryHackForResync"});case 19:if(c.credentials&&c.credentials.pts){e.next=21;break}throw new Error("В ответе getLongPollHistory отсутствуют новые креды!");case 21:return e.next=23,o.connect((0,a.default)({},c.credentials,{pts:c.credentials.pts}));case 23:return e.abrupt("return",{type:"EngineBatchReceived",variant:{kind:"FromApiEngineHistory",apiMessages:(null==(r=c.messages)?void 0:r.items)||[],apiConvos:c.conversations||[],apiUsers:c.profiles||[],apiGroups:c.groups||[],apiContacts:c.contacts||[],apiCounters:d,next:{kind:"Batch",pts:c.credentials.pts,ts:c.credentials.ts,updates:c.history||[]}}});case 24:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}()]}if(!(void 0!==b)&&function(e,t,r){for(var a,s=_(t.updates);!(a=s()).done;){var n=a.value;if(o.IEngine.isIncompleteUpdate(n))return!0;switch(n[0]){case 20:case 21:var i=n[1],c=l.resolveId(i);if(!e.convos.has(c))return!0;break;case 52:var d=n[1],p=n[2],v=n[3],f=l.resolveId(p),m=e.convos.get(f);if(!m)break;switch(d){case o.IEngine.ChatUpdateType.FlagsChanged:case o.IEngine.ChatUpdateType.TitleChanged:case o.IEngine.ChatUpdateType.AvatarChanged:case o.IEngine.ChatUpdateType.BannerChanged:case o.IEngine.ChatUpdateType.MessageRequestChanged:case o.IEngine.ChatUpdateType.MessageRequestCanceled:case o.IEngine.ChatUpdateType.MessageRequestAccepted:case o.IEngine.ChatUpdateType.MessageRequestRejected:case o.IEngine.ChatUpdateType.CallInProgressChanged:case o.IEngine.ChatUpdateType.ContactConverted:case o.IEngine.ChatUpdateType.ContactJoined:case o.IEngine.ChatUpdateType.DescriptionChanged:return!0;case o.IEngine.ChatUpdateType.UserJoined:case o.IEngine.ChatUpdateType.UserLeft:case o.IEngine.ChatUpdateType.UserKicked:var g=l.resolveId(v);if(!e.peers.has(g))return!0;if(d===o.IEngine.ChatUpdateType.UserJoined&&g===e.ownerId)return!0;break;case o.IEngine.ChatUpdateType.Pinned:var y=n[3];if(0===y)break;var C=h.resolveCmid(y);return!m.persisted.has(C);case o.IEngine.ChatUpdateType.CopyFlagChanged:case o.IEngine.ChatUpdateType.AdminGrated:case o.IEngine.ChatUpdateType.AdminKicked:case o.IEngine.ChatUpdateType.KeyboardChanged:case o.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case o.IEngine.ChatUpdateType.DonUnsubscribed:case o.IEngine.ChatUpdateType.DonSubscribed:case o.IEngine.ChatUpdateType.IsNewChange:case o.IEngine.ChatUpdateType.StyleChanged:case o.IEngine.ChatUpdateType.ShortPollReactionsChanged:break;default:}break;case 10013:var k=n[1],b=l.resolveId(k);return e.convos.has(b);case 63:case 64:case 65:case 66:case 67:case 68:case 1:case 2:case 3:case 6:case 7:case 10:case 11:case 12:case 80:case 114:case 115:case 119:case 501:case 502:case 503:case 504:case 505:case 506:case 507:case 508:case 601:case 602:case 10001:case 10002:case 10006:case 10007:break;case 10003:var I=n[2],w=n[3];if(o.IEngine.isIncompleteUpdate(n))break;var M=l.resolveId(w),S=e.convos.get(M);if(!S)break;var R=h.convertFlags(I),A=R.isDeleted,U=R.isSpam;if((A||U)&&S)return!0;break;case 4:case 10004:var P=n[4],T=n[7],O=n[8],F=l.resolveId(P),N=e.convos.get(F);if(!N)return!0;var q=E(N);if(x(O,q))return!0;if(T.has_template)return!0;var L=(0,u.fromEngineMessage)(n,e.ownerId,q).message;if(!e.peers.has(L.peerId)||!e.peers.has(L.authorId))return!0;if(l.isUserPeerId(L.authorId)&&L.peerId===L.authorId&&!e.onlines.has(L.authorId))return!0;break;case 5:case 18:case 10005:case 10018:var D=n[2],H=n[3],B=n[7],G=l.resolveId(H),j=e.convos.get(G);if(!j)break;if(x(B,E(j)))return!0;h.convertFlags(D);if(r.vkm_reactions)return!0;break;case 19:case 10019:return!0;default:}}return!1}(t,I,e))return[S(t.convoConn.pts,I,t.ownerId)];t.convoConn.status="running",t.convoConn.pts=I.pts;var R=I.updates.flatMap((e=>{switch(e[0]){case 1:case 2:case 3:return function(e,t,r){var a=t[0],s=t[1],n=t[2],i=t[3],o=l.resolveId(i),u=h.resolveId(s),c=e.convos.get(o);if(!c)return[];var d=p.findMessageById(c,u);if(!d)return[];return A(e,[{1:10001,2:10002,3:10003}[a],d.cmid,n,i],r)}(t,e,b);case 4:case 5:case 18:case 19:return function(e,t,r){var a,s=t[1],n=null==r?void 0:r.messages_legacy.get(s);switch(t[0]){case 4:if(o.IEngine.isIncompleteUpdate(t)){if(!n)return[];var i=t[2],u=t[3];a=[10004,n.conversation_message_id,i,u,n.peer_id];break}var c=t[2],d=t[3],l=t[4],p=t[5],h=t[6],v=t[7],f=t[8],g=t[9];a=[10004,t[10],c,d,l,p,h,v,f,g,s,t[11]];break;case 5:if(o.IEngine.isIncompleteUpdate(t)){if(!n)return[];var y=t[2];a=[10005,n.conversation_message_id,y,n.peer_id];break}var C=t[2],k=t[3],b=t[4],_=t[5],I=t[6],w=t[7],M=t[8];a=[10005,t[9],C,k,b,_,I,w,M,s,t[10]];break;case 18:if(o.IEngine.isIncompleteUpdate(t)){if(!n)return[];var S=t[2];a=[10018,n.conversation_message_id,S,n.peer_id];break}var R=t[2],E=t[3],x=t[4],A=t[5],P=t[6],T=t[7],O=t[8];a=[10018,t[9],R,E,x,A,P,T,O,s,t[10]];break;case 19:if(!n)return[];a=[10019,n.conversation_message_id,n.peer_id];break;default:(0,m.exhaustivenessCheck)(t)}return U(e,a,r)}(t,e,b);case 6:case 7:return function(e,t,r){var a,s=t[0],n=t[1],i=l.resolveId(n),o=e.convos.get(i);if(!o)return[];var u=null==r?void 0:r.convos.get(n),d=u&&(null==(a=(0,y.fromApiConvo)(u))?void 0:a.convo);if(!d)return[];return 6===s?p.readInUntil(o,d.inReadBy,d.unreadCount):p.readOutUntil(o,d.outReadBy),c.refresh(e.organisers,o),[]}(t,e,b);case 10:case 11:case 12:return function(e,t){var r=t[0],a=t[1],s=t[2],n=l.resolveId(a),i=e.convos.get(n);if(!i)return[];var o={10:"unset",11:"replace",12:"set"}[r];return p.updateFlags(i,o,s),c.refresh(e.organisers,i),[]}(t,e);case 20:return function(e,t){var r=t[1],a=t[2],s=l.resolveId(r),n=e.convos.get(s);if(!n)return[];return p.updateSortId(n,{majorSortId:a}),c.refresh(e.organisers,n),[]}(t,e);case 21:return function(e,t){var r=t[1],a=t[2],i=l.resolveId(r),o=e.convos.get(i);if(!o)return[];p.updateSortId(o,{minorSortId:a}),c.refresh(e.organisers,o);var u=a<=0,d=e.organisers.filters.messageRequest.totalCount>0;if(u&&d)return[(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"UpdateMessageRequestsCounter",peerId:i});case 1:case"end":return e.stop()}}),e)})))];return[]}(t,e);case 52:return function(e,t,r,a){var i=t[1],u=t[2],d=t[3],v=l.resolveId(u),f=e.convos.get(v);if(!f)return[];var m=null==a?void 0:a.convos.get(u),g=m&&(0,y.fromApiConvo)(m);switch(i){case o.IEngine.ChatUpdateType.CopyFlagChanged:case o.IEngine.ChatUpdateType.TitleChanged:case o.IEngine.ChatUpdateType.AvatarChanged:return[];case o.IEngine.ChatUpdateType.FlagsChanged:return"ChatConvo"!==f.kind||"ChatConvo"!==(null==g?void 0:g.convo.kind)||(f.isService=g.convo.isService,f.permissions=g.convo.permissions,f.acl=g.convo.acl,f.inviteLinks=g.convo.inviteLinks),[];case o.IEngine.ChatUpdateType.Pinned:if("ChatConvo"!==f.kind)return[];var C=d,k=h.resolveCmid(C);if(f.pinnedMessage){var b=f.persisted.get(f.pinnedMessage.cmid);"Normal"===(null==b?void 0:b.kind)&&h.unpinMessage(b)}if(e.hiddenPinnedMessages.delete(v),(null==g?void 0:g.convo.kind)===f.kind)return g.convo.pinnedMessage&&p.pinMessage(f,g.convo.pinnedMessage),[];if(0===k)p.unpinMessage(f);else{var _=f.persisted.get(k);"Normal"===(null==_?void 0:_.kind)&&p.pinMessage(f,h.toPinned(_))}return[];case o.IEngine.ChatUpdateType.ContactJoined:return[];case o.IEngine.ChatUpdateType.UserJoined:if("ChatConvo"!==f.kind)return[];var I=l.resolveId(d);if(!l.isUserPeerId(I)&&!l.isGroupPeerId(I))return[];if(f.members){var w={peerId:I,isAdmin:f.adminIds.has(I),canKick:f.adminIds.has(e.viewer.id),isMessageRequest:!1};p.addMembers(f,[w])}return I===e.ownerId?(p.changeUserState(f,"in"),p.allowWrite(f),e.locks.getConversationMembers.add(v),[l.isChatPeerId(v)&&(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:v});case 1:case"end":return e.stop()}}),e)}))),l.isChatPeerId(v)&&(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatInfo",peerId:v});case 1:case"end":return e.stop()}}),e)})))]):[];case o.IEngine.ChatUpdateType.UserLeft:if("ChatConvo"!==f.kind)return[];var M=l.resolveId(d);return l.isUserPeerId(M)||l.isGroupPeerId(M)?(M===e.ownerId&&p.changeUserState(f,"left"),p.removeMember(f,M),[]):[];case o.IEngine.ChatUpdateType.UserKicked:if("ChatConvo"!==f.kind)return[];var S=l.resolveId(d);if(!l.isUserPeerId(S)&&!l.isGroupPeerId(S))break;S===e.ownerId&&(p.changeUserState(f,"kicked"),p.restrictWrite(f,"kicked")),p.removeMember(f,S);break;case o.IEngine.ChatUpdateType.KeyboardChanged:return[];case o.IEngine.ChatUpdateType.CallInProgressChanged:return"ChatConvo"===f.kind&&(null==g?void 0:g.convo.kind)===f.kind&&p.updateActiveCall(f,g.convo.activeCall),[];case o.IEngine.ChatUpdateType.IsNewChange:return p.updateIsNew(f,!!d),[];case o.IEngine.ChatUpdateType.MessageRequestChanged:var R=d;switch(R){case o.IEngine.MRStatus.Accepted:if("MessageRequestChatConvo"!==f.kind&&"MessageRequestUserConvo"!==f.kind||"pending"!==f.MRStatus){c.refresh(e.organisers,f);break}var E=p.fromAcceptedMessageRequest(f,null==g?void 0:g.convo);e.convos.set(v,E),c.refresh(e.organisers,E);break;case o.IEngine.MRStatus.New:var x;(null==g?void 0:g.convo)&&e.convos.set(v,null==g?void 0:g.convo),c.refresh(e.organisers,null!=(x=null==g?void 0:g.convo)?x:f);break;case o.IEngine.MRStatus.Deleted:if("MessageRequestChatConvo"!==f.kind&&"MessageRequestUserConvo"!==f.kind&&"UserConvo"!==f.kind)break;var A=p.fromCancelledMessageRequest(f);e.convos.set(v,A),c.refresh(e.organisers,A);break;case o.IEngine.MRStatus.Rejected:if(p.isRejectedMR(f)){c.refresh(e.organisers,f);break}if("MessageRequestChatConvo"!==f.kind&&"MessageRequestUserConvo"!==f.kind&&"UserConvo"!==f.kind)break;var U=p.fromRejectedMessageRequest(f);e.convos.set(v,U),c.refresh(e.organisers,U);break;default:}return[(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"UpdateMessageRequestsCounter",peerId:v});case 1:case"end":return e.stop()}}),e)})))];case o.IEngine.ChatUpdateType.AdminGrated:var P=l.resolveId(d);return"ChatConvo"!==f.kind||!l.isUserPeerId(P)&&!l.isGroupPeerId(P)||f.adminIds.add(P),[];case o.IEngine.ChatUpdateType.AdminKicked:var T=l.resolveId(d);return"ChatConvo"!==f.kind||!l.isUserPeerId(T)&&!l.isGroupPeerId(T)||f.adminIds.delete(T),[];case o.IEngine.ChatUpdateType.ContactConverted:var O=l.resolveId(d),F=e.convos.get(O),N=e.peers.get(O);return N&&F&&"Contact"===N.kind&&l.isUserPeerId(v)?(l.convertContact(N,v),p.updateSortId(F,{minorSortId:0}),[function(){var e=(0,n.default)(s.mark((function e(t){var r,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.router,"ConvoRoute"===(a=r.currentRoute).kind&&a.peerId===O&&r.replace({kind:"ConvoRoute",entrypoint:"list_all",peerId:v}),e.abrupt("return",{type:"Noop"});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):[];case o.IEngine.ChatUpdateType.BannerChanged:return"UserConvo"!==f.kind||(null==g?void 0:g.convo.kind)!==f.kind||(f.convoBanner=null==g?void 0:g.convo.convoBanner),[];case o.IEngine.ChatUpdateType.DescriptionChanged:return"ChatConvo"!==f.kind||(null==g?void 0:g.convo.kind)!==f.kind||(f.description=g.convo.description),[];case o.IEngine.ChatUpdateType.ShortPollReactionsChanged:return"ChatConvo"!==f.kind||(f.shouldShortPollReactions=Boolean(d)),[];case o.IEngine.ChatUpdateType.BusinessNotifyDataChanged:case o.IEngine.ChatUpdateType.MessageRequestAccepted:case o.IEngine.ChatUpdateType.MessageRequestCanceled:case o.IEngine.ChatUpdateType.MessageRequestRejected:case o.IEngine.ChatUpdateType.DonSubscribed:case o.IEngine.ChatUpdateType.DonUnsubscribed:case o.IEngine.ChatUpdateType.StyleChanged:return[];default:}return[]}(t,e,0,b);case 63:case 64:case 65:case 66:case 67:case 68:return function(e,t){var r=t[0],i=t[1],o=t[2],u=t[3],c=t[4],d=l.resolveId(i),p=new Set(o.map((e=>l.resolveId(e))));if(p.delete(e.viewer.id),!e.convos.get(d))return[];var h={63:"text",64:"voice",65:"photo",66:"video",67:"file",68:"videomessage"}[r],v=(0,a.default)({},e.typings.get(d)||{},{[h]:{peerIds:p,updatedAt:c,totalCount:u}});return e.typings.set(d,v),[function(){var e=(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,m.sleep)(g.TYPING_EXPIRATION_TIME);case 2:return e.abrupt("return",{type:"EngineBatchReceived_TypingsTimedOut",peerId:d,typingType:h,timestamp:c});case 3:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()]}(t,e);case 80:return function(e,t){var r=t[1],a=t[2],i=t[4],o=t[6],u=t[7],c=t[9];return d.updateCounters(e.organisers.filters,{unread:r,headerNotMutedUnread:o,unreadUnmuted:a,archive:u,archiveMentions:c,businessNotify:i}),[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unreadIdle:o,unread:a}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()]}(t,e);case 114:return function(e,t){var r=t[1].peer_id,a=l.resolveId(r),s=e.convos.get(a);if(!s)return[];var n=(0,y.fromLongpollPushSettings)(t);return p.updatePush(s,n),[]}(t,e);case 115:return function(e,t){var r=t[1];return[function(){var e=(0,n.default)(s.mark((function e(t){var a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==(a=t.calls)||a.showIncomingCall(r),e.abrupt("return",{type:"Noop"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(0,e);case 119:return function(e,t){var r=t[1],a=l.resolveId(r.peer_id),i=l.resolveId(r.owner_id),o=e.convos.get(a),u=e.peers.get(a),c=e.peers.get(i),d=o&&u&&c?(0,C.fromApiMessageEvent)(u,c,r):void 0;return[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d&&t.botKeyboard.update(d),e.abrupt("return",{type:"Noop"});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(t,e);case 501:return function(e,t){var r=t[1],a=t[2];return(0,i.insertFolders)(e,[{id:r,name:a}]),[]}(t,e);case 502:return function(e,t){var r=t[1],a=v.resolveId(r);v.deleteFolder(e.organisers.folders,a);for(var s,n=_(e.convos.values());!(s=n()).done;){var i=s.value;p.removeFolder(i,a)}return[]}(t,e);case 503:return function(e,t){var r=t[1],a=t[2],s=v.resolveId(r),n=e.organisers.folders.find((e=>e.id===s));if(!n)return[];return v.setName(n,a),[]}(t,e);case 504:return function(e,t){var r=t[1],a=t.slice(2),s=v.resolveId(r),n=(0,i.getConvosByIds)(e,a);if(!e.organisers.folders.find((e=>e.id===s)))return[];return(0,i.addConvosToFolder)(e,s,n),[]}(t,e);case 505:return function(e,t){var r=t[1],a=t.slice(2),s=v.resolveId(r),n=(0,i.getConvosByIds)(e,a);if(!e.organisers.folders.find((e=>e.id===s)))return[];return(0,i.removeConvosFromFolder)(e,s,n),[]}(t,e);case 506:return function(e,t){var r=t.slice(1);return v.reorderFolders(e.organisers.folders,r.map((e=>v.resolveId(e)))),[]}(t,e);case 507:return function(e,t){for(var r,a=_(t.slice(1));!(r=a()).done;){var s=r.value;if(!(s.length<3)){var n=v.resolveId(s[0]);v.setUnreadCounters(e.organisers.folders,n,s[1],s[2])}}return[]}(t,e);case 508:return function(e,t){var r=t[1],a=v.resolveId(r),s=e.organisers.folders.find((e=>e.id===a));if(!s)return[];return v.replaceFolder(e.organisers.folders,(0,k.fromApiFolder)({id:a,name:s.name})),[]}(t,e);case 601:return function(e,t){var r=t[1],a=t[2],s=t[3],n=e.convos.get(l.resolveId(a));if(!n)return[];var i=n.persisted.get(h.resolveCmid(s));if("Normal"!==(null==i?void 0:i.kind))return[];var o=0,u=[];switch(r){case 1:var c=t[4],d=t[5],p=t.slice(6);h.setCurrentUserReaction(i,f.resolveId(c)),o=d,u=p;break;case 2:case 3:case 4:o=t[4],u=t.slice(5),3===r&&h.setCurrentUserReaction(i,void 0);break;default:return[]}for(var v=[],m=0,g=0;g<o;g++){var y=u[m];if(!y)return[];var C=u.slice(m+1,m+1+y);m+=1+y;var k=C.slice(0,3),b=k[0],_=k[1],I=k[2];if(void 0===b||void 0===_||void 0===I)return[];var w=C.slice(3,3+I).map(l.resolveId);v.push({reactionId:f.resolveId(b),count:_,peerIds:new Set(w)})}return h.setReactions(i,v),[]}(t,e);case 602:return function(e,t){var r=t[1],a=t.slice(2),s=l.resolveId(r),n=e.convos.get(s);if(!n)return[];var i=a[0];if(void 0===i)return[];var o=a.slice(1,i+1).map(h.resolveCmid);return p.replaceUnreadReactions(n,o),[]}(t,e);case 10001:case 10002:case 10003:return A(t,e,b);case 10004:case 10005:case 10018:case 10019:return U(t,e,b);case 10006:case 10007:return function(e,t){var r=t[0],a=t[1],s=t[2],n=t[3],i=l.resolveId(a),o=h.resolveCmid(s),u=e.convos.get(i);if(!u)return[];10006===r?(p.readInUntil(u,o,n),l.isFavorites(u.peerId,e.ownerId)&&p.readOutUntil(u,o)):p.readOutUntil(u,o);return c.refresh(e.organisers,u),[]}(t,e);case 10013:return function(e,t,r){var a=t[1],i=t[2],o=l.resolveId(a),u=h.resolveCmid(i),d=e.convos.get(o);if(!d)return[];if(d.persistedCmid!==u)return[];var p=null==r?void 0:r.convos.get(a),v=p&&(0,y.fromApiConvo)(p);if(!v)return[function(){var e=(0,n.default)(s.mark((function e(r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.logger.error("[EngineBatchReceived]",new Error(`В ${t[0]} отсутствует дозагруженная беседа`)),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));function r(t){return e.apply(this,arguments)}return r}()];e.convos.set(v.convo.peerId,v.convo),v.peer&&e.peers.set(v.peer.id,v.peer);return c.refresh(e.organisers,d),[]}(t,e,b);default:return[]}}));return[function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.engine,e.next=3,r.poll();case 3:return e.t0=e.sent,e.t1={kind:"FromEngine",next:e.t0},e.abrupt("return",{type:"EngineBatchReceived",variant:e.t1});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),...R]}function S(e,t,r){return function(){var a=(0,n.default)(s.mark((function a(n){var o,u,c,d;return s.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return u=n.api,c=n.engine,a.prev=1,a.next=4,u.fetch("messages.getLongPollHistory",{pts:e,lp_version:c.version,extended:1,group_id:(0,i.getOwnerGroupId)(r)},{retries:1/0});case 4:d=a.sent,a.next=10;break;case 7:return a.prev=7,a.t0=a.catch(1),a.abrupt("return",{type:"Noop"});case 10:return a.abrupt("return",{type:"EngineBatchReceived",variant:{kind:"FromEngineWithMissingData",apiConvos:d.conversations||[],apiMessages:(null==(o=d.messages)?void 0:o.items)||[],apiUsers:d.profiles||[],apiGroups:d.groups||[],skippedBatch:t,apiContacts:d.contacts||[]}});case 11:case"end":return a.stop()}}),a,null,[[1,7]])})));return function(e){return a.apply(this,arguments)}}()}function R(e,t){for(var r,a=new Map,s=_(e);!(r=s()).done;){var n=r.value,i=a.get(n.peer_id);i||(i=new Map,a.set(n.peer_id,i)),i.set(n.conversation_message_id,n)}return{messages_legacy:new Map(e.map((e=>[e.id,e]))),messagesByPeerId:a,convos:new Map(t.map((e=>[e.peer.id,e])))}}function E(e){return function(t){var r=e.persisted.get(t);return"Normal"===(null==r?void 0:r.kind)?r:void 0}}function x(e,t){if(e.fwd&&!e.reply)return!0;if(e.reply){var r=JSON.parse(e.reply);if(!t(h.resolveCmid(r.conversation_message_id)))return!0}if(e.geo)return!0;if(e.attachments&&e.attach1_type&&!e.attach2_type)try{var a=JSON.parse(e.attachments);if(Array.isArray(a)&&a[0].type===e.attach1_type)return!1}catch(e){return!0}return!!e.attach1_type}function A(e,t,r){var a=t[0],i=t[1],o=t[2],c=t[3],d=h.resolveCmid(i),v=l.resolveId(c),f=e.convos.get(v);if(!f)return[];var m=h.convertFlags(o);if(10003===a){var g=m.isDeleted,y=m.isSpam;if((g||y)&&i){var C,k=null==r||null==(C=r.messagesByPeerId.get(c))?void 0:C.get(i);if(k){var b=(0,u.fromApiMessage)(k);p.restoreMessage(f,b.message,b.mentions.hasDirect||b.mentions.hasMass)}}}var _={10001:"replace",10002:"set",10003:"unset"}[a],I=f.persisted.get(d);return I?(p.updateMessageFlags(f,I.cmid,_,o),[(0,n.default)(s.mark((function e(){var t,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(10002===a){e.next=2;break}return e.abrupt("return",{type:"Noop"});case 2:if(t=m.isDeleted,r=m.isDeletedForAll,!t&&!r){e.next=5;break}return e.abrupt("return",{type:"UpdateComposerDraftOnMessageDelete",peerId:v,deletedMessagesCmid:[d]});case 5:return e.abrupt("return",{type:"Noop"});case 6:case"end":return e.stop()}}),e)})))]):[]}function U(e,t,r){var a,d,v=t[1];switch(t[0]){case 10004:d=t[4];break;case 10005:case 10018:d=t[3];break;case 10019:d=t[2];break;default:(0,m.exhaustivenessCheck)(t)}var f=l.resolveId(d),g=e.convos.get(f);if(!g)return[];var y,k,b,I=null==r||null==(a=r.messagesByPeerId.get(d))?void 0:a.get(v);if(I){var w,M=(0,u.fromApiMessage)(I);y=M.message,k=M.mentions;var S=null==r||null==(w=r.convos.get(f))?void 0:w.current_keyboard;if(S){var R=(0,C.fromApiKeyboard)(S,f);b="InputKeyboard"===R.kind?{kind:"InputKeyboardUpsertEvent",keyboard:R}:void 0}else b={kind:"InputKeyboardDeleteEvent"}}else{if(o.IEngine.isIncompleteUpdate(t)||10019===t[0])return[];var x=(0,u.fromEngineMessage)(t,e.ownerId,E(g));y=x.message,k=x.mentions,b=x.keyboardEvent}switch(t[0]){case 10004:var A,U=e.typings.get(g.peerId);if(U)for(var P,T=_(i.TypingVariants);!(P=T()).done;){var O=P.value,F=U[O];F&&F.peerIds.has(y.authorId)&&(F.peerIds.delete(y.authorId),F.totalCount--,0===F.totalCount&&delete U[O],0===Object.keys(U).length&&e.typings.delete(g.peerId))}var N=t[3],q=k.hasDirect||k.hasMass;"ChatConvo"===g.kind?p.appendMessage(g,y,N,q,b):p.appendMessage(g,y,N,!1,b),c.refresh(e.organisers,g);var L=q&&g.isArchived;e.locks.convosCleanup.has(g.peerId)||p.cleanup(g),"InputKeyboardUpsertEvent"===(null==(A=b)?void 0:A.kind)&&e.hiddenBotKeyboards.delete(g.peerId);var D,H=h.convertFlags(t[2]),B=p.isMessageUnread(g,y),G=e.viewer.settings,j=G.browserNotifications,V=G.soundNotifications,z=G.push,W=!y.isOut&&!H.noPush&&B&&!p.isMuted(g)&&V&&!y.isSilent,K=null;switch(g.kind){case"UserConvo":K=z.userConvo;break;case"ChatConvo":K=z.chatConvo;break;case"GroupConvo":K=z.groupConvo}switch(!0){case y.isOut:case!B:case"nothing"===g.push.mode||"nothing"===z.mention:case null!==K&&!K.isEnabled:case!j:case H.noPush:D=!1;break;case!p.isMuted(g):D=!0;break;case"direct-mention"===g.push.mode||"direct-mention"===z.mention:D=k.hasDirect;break;case"every-mention"===g.push.mode&&"every-mention"===z.mention:D=q;break;default:D=!0}return[function(){var e=(0,n.default)(s.mark((function e(t){var r,a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.notification,a=t.router,n="ConvoRoute"===a.screenRoute.kind&&a.screenRoute.peerId===f,D&&r.notify({message:y},{mode:n?"idle":"normal"}),W&&r.playSound(),e.abrupt("return",{type:"Noop"});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",L?{type:"ActualizeArchiveMentions",undoHideOnNewMention:!0}:{type:"Noop"});case 1:case"end":return e.stop()}}),e)})))];case 10005:case 10018:case 10019:return p.replaceMessage(g,y,k.hasDirect||k.hasMass),[];default:return(0,m.exhaustivenessCheck)(t)}}},817793:(e,t,r)=>{"use strict";r.d(t,{handler:()=>s});var a=r(766278),s=(e,t)=>((0,a.insertPeers)(e,{apiUsers:t.profile?[t.profile]:[],apiContacts:[t.contact],apiGroups:[]},{dangerouslyOverwrite:!0}),(0,a.insertContacts)(e,[t.contact]),[])},755467:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(722122),s=r(887757),n=r(692137),i=r(701069),o=r(658265),u=r(766278),c=r(568647),d=(e,t)=>{switch(t.type){case"LoadChatInfo":var r=t.peerId,d=(0,u.getOwnerGroupId)(e.ownerId);return e.locks.getConversationInfo.add(r),[function(){var e=(0,n.default)(s.mark((function e(t){var a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.api,e.prev=1,e.next=4,a.fetch("messages.getConversationsById",{peer_ids:r.toString(),group_id:d,extended:0});case 4:return n=e.sent,e.abrupt("return",{type:"LoadChatInfo_RequestComplete",peerId:r,convo:n.items[0],hasFailed:!n.items[0]});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadChatInfo_RequestComplete",peerId:r,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadChatInfo_RequestComplete":var l=t.peerId,p=t.convo,h=t.hasFailed;e.locks.getConversationInfo.delete(l);var v=e.convos.get(l);if("ChatConvo"!==(null==v?void 0:v.kind)||h||!p)return[];var f=(0,c.fromApiConvo)(p);return"ChatConvo"!==(null==f?void 0:f.convo.kind)||(o.updateAcl(v,(0,a.default)({},f.convo.acl)),o.updateMembersCount(v,f.convo.membersCount)),[];default:(0,i.exhaustivenessCheck)(t)}}},585712:(e,t,r)=>{"use strict";r.d(t,{handler:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(658265),o=r(766278),u=r(863347),c=(e,t)=>{switch(t.type){case"LoadChatMembers":var r=t.peerId,c=(0,o.getOwnerGroupId)(e.ownerId);return[function(){var e=(0,s.default)(a.mark((function e(t){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.t0=r,e.next=5,s.fetch("messages.getConversationMembers",{peer_id:r,extended:1,group_id:c},{retries:1});case 5:return e.t1=e.sent,e.abrupt("return",{type:"LoadChatMembers_RequestComplete",peerId:e.t0,response:e.t1,hasFailed:!1});case 9:return e.prev=9,e.t2=e.catch(1),e.abrupt("return",{type:"LoadChatMembers_RequestComplete",peerId:r,hasFailed:!0});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadChatMembers_RequestComplete":var d=t.peerId,l=t.response,p=t.hasFailed;e.locks.getConversationMembers.delete(d);var h=e.convos.get(d);if("ChatConvo"!==(null==h?void 0:h.kind)||p||!l)return[];var v=(0,u.fromApiChatMembers)(l.items),f=v.members,m=v.adminIds,g=v.ownerId;return i.addMembers(h,f),m.forEach((e=>{i.addAdmin(h,e)})),g&&i.setOwner(h,g),(0,o.insertPeers)(e,{apiUsers:l.profiles||[],apiGroups:l.groups||[],apiContacts:l.contacts||[]}),[];default:(0,n.exhaustivenessCheck)(t)}}},810439:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(701069),i=r(766278),o=(e,t)=>{switch(t.type){case"LoadContactList":return e.locks.contactList?[]:(e.locks.contactList=!0,[function(){var e=(0,s.default)(a.mark((function e(r){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,e.prev=1,e.next=4,s.fetch("account.getContactList",{extended:1,offset:t.offset},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"LoadContactList_RequestCompleted",contacts:n.contacts||[],profiles:n.profiles||[],items:n.items||[]});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadContactList_RequestCompleted",contacts:[],profiles:[],items:[]});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"LoadContactList_RequestCompleted":return e.locks.contactList=!1,(0,i.insertContacts)(e,t.contacts),(0,i.insertContactItems)(e,t.items,t.profiles),e.contacts.hasMore=!1,[];default:(0,n.exhaustivenessCheck)(t)}}},337074:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u,getImportantMessageKey:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(664902),o=r(766278),u=(e,t)=>{switch(t.type){case"LoadImportantMessages":var r=20*Math.floor(e.importantMessages.messages.size/20),u=e.ownerId;return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.getImportantMessages",{count:20,offset:r,extended:1,group_id:(0,o.getOwnerGroupId)(u)});case 4:return n=e.sent,e.abrupt("return",{type:"LoadImportantMessages_RequestCompleted",hasFailed:!1,response:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"Noop"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadImportantMessages_RequestCompleted":var d,l,p=t.response,h=p.messages,v=p.profiles,f=p.groups,m=p.conversations;return((null==(d=h.items)?void 0:d.length)||0)<20&&(e.importantMessages.hasMore=!1),(0,o.insertConvos)(e,m||[]),(0,o.insertPeers)(e,{apiUsers:v||[],apiGroups:f||[],apiContacts:[]}),null==(l=h.items)||l.forEach((t=>{var r=(0,i.fromApiMessage)(t).message;"Normal"===r.kind&&e.importantMessages.messages.set(c(r.peerId,r.cmid),r)})),[];case"UserClosedImportantMessages":return e.importantMessages.messages.clear(),e.importantMessages.hasMore=!0,[];default:return(0,n.exhaustivenessCheck)(t)}},c=(e,t)=>`${e}-${t}`},691004:(e,t,r)=>{"use strict";r.d(t,{IMPORTANT_USERS_COUNT:()=>u,handler:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(766278),o=r(568647),u=10,c=(e,t)=>{switch(t.type){case"LoadImportantUsers":if(e.locks.getImportantUsers||null!==e.importantUsers)return[];e.locks.getImportantUsers=!0;var r=(0,i.getOwnerGroupId)(e.ownerId);return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.searchConversations",{q:" ",count:u,extended:1,group_id:r},{retries:2});case 4:return n=e.sent,e.abrupt("return",{type:"LoadImportantUsers_RequestCompleted",hasFailed:!1,response:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadImportantUsers_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"LoadImportantUsers_RequestCompleted":if(e.locks.getImportantUsers=!1,t.hasFailed)return[];var c=t.response,d=c.profiles,l=c.groups,p=c.items,h=c.contacts;(0,i.insertConvos)(e,p),(0,i.insertPeers)(e,{apiUsers:d||[],apiGroups:l||[],apiContacts:h||[]});var v=p.reduce(((e,t)=>{var r=(0,o.fromApiConvo)(t);return r&&e.add(r.convo.peerId),e}),new Set);return e.importantUsers=v,[];default:(0,n.exhaustivenessCheck)(t)}}},209421:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(701069),i=r(466315),o=(e,t)=>{switch(t.type){case"LoadStickers":var r=e.stickers,o=e.locks.loadStickers,u=t.stickerIds.filter((e=>!o.has(e)&&!r.has(e)));return u.length?(e.locks.loadStickers=new Set([...o,...u]),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("store.getStickers",{sticker_ids:u.join()});case 4:return e.t0=e.sent,e.abrupt("return",{type:"LoadStickers_RequestCompleted",response:e.t0});case 8:e.prev=8,e.t1=e.catch(1);case 10:return e.abrupt("return",{type:"LoadStickers_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"LoadStickers_RequestCompleted":var c=t.response;if(t.hasFailed||!c)return[];var d=e.stickers;return c.forEach((e=>{var t=(0,i.fromApiSticker)(e);t&&d.set(t.id,t)})),[];default:(0,n.exhaustivenessCheck)(t)}}},16948:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(722122),n=r(692137),i=r(766278),o=r(616963),u=r(488085),c=r(701069),d=(e,t)=>{switch(t.type){case"MoreChannelsNeeded":var r=t.organiser,d=r.filter,l=u.getLockId(d);if(e.locks.getChannels[l]||!e.organisers.channelFilters[d].hasMore)return[];var p=e.organisers.channelFilters[d].boundary,h=p.minorSortId,v=p.channelId;e.locks.getChannels[l]=!0;var f=o.CHANNELS_PER_PAGE+1,m=u.isLoaded(e.organisers.channelFilters[d])?h:void 0;return[function(){var e=(0,n.default)(a.mark((function e(n){var i,o,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.api,e.prev=1,e.next=4,i.fetch("channels.get",{count:f,offset_minor_sort_id:m,offset_channel_id:v,filter:u.snakeCaseId(r.filter),extended:1},{retries:3});case 4:return c=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!1,response:c,hasMore:((null==(o=c.items)?void 0:o.length)||0)>=f}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"MoreChannelsNeeded_RequestCompleted",hasFailed:!0,hasMore:!1}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"MoreChannelsNeeded_RequestCompleted":var g=t.hasFailed,y=t.organiser,C=t.hasMore,k="";if("channelFilters"===y.kind)k=u.getLockId(y.filter);else(0,c.exhaustivenessCheck)(y.kind);if(e.locks.getChannels[k]=!1,g)return[];var b=t.response;if(b){var _=(0,i.insertChannels)(e,{apiChannels:b.items||[],apiGroups:b.groups||[]});if((0,i.insertPeers)(e,{apiUsers:b.profiles||[],apiGroups:b.groups||[],apiContacts:[]}),"channelFilters"===y.kind)u.push(e.organisers.channelFilters,y.filter,_,C);else(0,c.exhaustivenessCheck)(y.kind)}return[];default:(0,c.exhaustivenessCheck)(t)}}},913309:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(722122),n=r(692137),i=r(766278),o=r(616963),u=r(630730),c=r(701069),d=r(811129),l=(e,t)=>{switch(t.type){case"MoreConvosNeeded":var r,l=t.organiser,p=e.ownerId,h="";switch(l.kind){case"filters":var v=l.filter;if(h=u.getLockId(v),e.locks.getConversations[h]||!e.organisers.filters[v].hasMore)return[];r={start_message_id:u.isLoaded(e.organisers.filters[v])?e.organisers.filters[v].boundary.minorSortId:void 0,filter:u.snakeCaseId(v),extended:1,group_id:(0,i.getOwnerGroupId)(p)};break;case"folders":var f=l.id,m=l.filter;h=d.getLockId(f,m);var g=e.organisers.folders.find((e=>e.id===f));if(!g)throw new Error("Не найдена папка");if(e.locks.getConversations[h]||d.isLoaded(g,m)&&!g[m].hasMore)return[];r={start_message_id:d.isLoaded(g,m)?g[m].boundaryMinorId:void 0,folder_id:g.id,filter:m,extended:1,group_id:(0,i.getOwnerGroupId)(p)};break;default:(0,c.exhaustivenessCheck)(l)}return e.locks.getConversations[h]=!0,[function(){var e=(0,n.default)(a.mark((function e(n){var i,u,c;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.api,e.prev=1,r){e.next=4;break}throw new Error("Нет параметров запроса");case 4:return u=o.CONVOS_PER_PAGE,e.next=7,i.fetch("messages.getConversations",(0,s.default)({},r,{count:u}),{retries:3});case 7:return c=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"MoreConvosNeeded_RequestCompleted",hasFailed:!1,requestedCount:u,hasMore:c.items.length>=u,response:c}));case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"MoreConvosNeeded_RequestCompleted",hasMore:!1,hasFailed:!0}));case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"MoreConvosNeeded_RequestCompleted":var y=t.hasFailed,C=t.organiser,k=t.hasMore,b="";switch(C.kind){case"filters":b=u.getLockId(C.filter);break;case"folders":b=d.getLockId(C.id,C.filter);break;default:(0,c.exhaustivenessCheck)(C)}if(e.locks.getConversations[b]=!1,y)return[];var _=t.response;if(_){var I=(0,i.insertConvos)(e,_.items,{dangerouslyMerge:!0});switch((0,i.insertPeers)(e,{apiUsers:_.profiles||[],apiGroups:_.groups||[],apiContacts:_.contacts||[]}),C.kind){case"filters":u.push(e.organisers.filters,C.filter,I,k);break;case"folders":var w=e.organisers.folders.find((e=>e.id===C.id));if(!w)return[];d.push(e.organisers.folders,C.id,C.filter,I,k);break;default:(0,c.exhaustivenessCheck)(C)}}return[];default:(0,c.exhaustivenessCheck)(t)}}},929090:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(692137),n=r(701069),i=r(194739),o=r(766278),u=r(678555);function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var l=(e,t,r)=>{if(!r.vkm_reactions)return[];switch(t.type){case"PollConvoReactions":var d=t.peerId,l=t.fromCmid,p=t.toCmid,h=e.convos.get(d);if(!h)return[];var v=Array.from(h.persisted.keys()).filter((e=>e>=l&&e<=(null!=p?p:h.persistedCmid))).slice(-100),f=e.ownerId;return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getMessagesReactions",{peer_id:d,cmids:v.join(","),extended:1,group_id:(0,o.getOwnerGroupId)(f)});case 4:return s=e.sent,e.abrupt("return",{type:"PollConvoReactions_RequestSucceed",peerId:d,cmids:v,apiResponse:s});case 8:e.prev=8,e.t0=e.catch(1);case 10:return e.abrupt("return",{type:"Noop"});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"PollConvoReactions_RequestSucceed":var m=t.peerId,g=t.apiResponse,y=t.cmids;(0,o.insertPeers)(e,{apiUsers:g.profiles||[],apiGroups:g.groups||[],apiContacts:g.contacts||[]});var C=e.convos.get(m);if(!C)return[];var k=new Set(g.items.map((e=>i.resolveCmid(e.cmid))));y.filter((e=>!k.has(e))).forEach((e=>{var t=C.persisted.get(i.resolveCmid(e));"Normal"===(null==t?void 0:t.kind)&&0!==t.reactions.size&&i.setReactions(t,[])}));for(var b,_=c(g.items);!(b=_()).done;){var I=b.value,w=I.cmid,M=I.counters,S=C.persisted.get(i.resolveCmid(w));if("Normal"===(null==S?void 0:S.kind)){var R=(0,u.fromApiMessageReactions)(M);i.setReactions(S,Array.from(R.values()))}}return[];default:(0,n.exhaustivenessCheck)(t)}}},218227:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(722122),s=r(887757),n=r(692137),i=r(529122),o=r(369706);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var d=(e,t)=>{var r=t.next;if("Reconnecting"===r.kind)return[function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,e.next=3,r.poll();case 3:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];if("Disconnected"===r.kind){if("manual"===r.reason)return[];var c=e.viewer.id;return[function(){var e=(0,n.default)(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,n=t.api,e.next=3,n.fetch("queue.subscribe",{queue_ids:`onlfriends_${c},accountcounters_${c}`},{retries:1/0});case 3:return i=e.sent,r.connect((0,a.default)({user_id:c},i)),e.next=7,r.poll();case 7:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}for(var d,l=u(r.events);!(d=l()).done;){var p=d.value;switch(p.entity_type){case"online":var h=i.resolveId(p.data.user_id);if(!i.isUserPeerId(h))break;p.data.online?e.onlines.add(h):e.onlines.delete(h);var v=e.peers.get(h);if(!v||"User"!==v.kind)break;i.updateLastSeen(v,{at:1e3*p.data.last_seen,platform:(0,o.convertPlatform)(p.data.platform,p.data.app_id)});break;case"accountcounters":if("calls"===p.data.type)e.activeCallsCount=p.data.count;else p.data.type;break;default:}}return[function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.queue,e.next=3,r.poll();case 3:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}},302917:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(701069),i=r(630730),o=r(766278),u=(e,t)=>{switch(t.type){case"ResetUpdatesCounter":var r=e.ownerId;return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.resetUpdatesCounter",{group_id:(0,o.getOwnerGroupId)(r)});case 4:return n=e.sent,e.abrupt("return",{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"ResetUpdatesCounter_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"ResetUpdatesCounter_RequestCompleted":return t.hasFailed?[]:(i.updateCounters(e.organisers.filters,{headerNotMutedUnread:0}),[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.notification.setCounters({unreadIdle:0}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]);default:(0,n.exhaustivenessCheck)(t)}}},315899:(e,t,r)=>{"use strict";r.d(t,{handler:()=>s});var a=r(701069),s=(e,t,r)=>{if("SetDefaultReactions"===t.type)return t.reactions.forEach((t=>{e.messageReactions.set(t.id,t)})),[];(0,a.exhaustivenessCheck)(t.type)}},679141:(e,t,r)=>{"use strict";r.d(t,{handler:()=>i});var a=r(887757),s=r(692137),n=r(701069),i=(e,t)=>{var r=t.type;switch(r){case"SettingThemeUpdated":e.locks.settings.add("theme");var i=e.viewer.settings.theme;return e.viewer.settings.theme=t.value,[function(){var e=(0,s.default)(a.mark((function e(r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.storage.set("theme",t.value),e.abrupt("return",{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!1,previousValue:i});case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",{type:"SettingThemeUpdated_RequestCompleted",hasFailed:!0,previousValue:i});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()];case"SettingThemeUpdated_RequestCompleted":return e.locks.settings.delete("theme"),t.hasFailed&&(e.viewer.settings.theme=t.previousValue),[];default:(0,n.exhaustivenessCheck)(r)}}},545450:(e,t,r)=>{"use strict";r.d(t,{MAX_RECENT_STICKERS:()=>i,handler:()=>o});var a=r(887757),s=r(692137),n=r(701069),i=32,o=(e,t,r)=>{switch(t.type){case"StickersAddToFavorite":var u=t.stickerId;return e.stickers.has(u)?(e.favoriteStickers=[...e.favoriteStickers.filter((e=>e!==u)),u],[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("store.addStickersToFavorite",{sticker_ids:`${u}`});case 4:return s=e.sent,e.abrupt("return",{type:"StickersAddToFavorite__RequestCompleted",stickerId:u,hasFailed:!Boolean(s)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"StickersAddToFavorite__RequestCompleted",stickerId:u,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"StickersAddToFavorite__RequestCompleted":var c=t.stickerId;return t.hasFailed&&o(e,{type:"StickersRemoveFromFavorite",stickerId:c},r),[];case"StickersRemoveFromFavorite":var d=t.stickerId;return e.stickers.has(d)?(e.favoriteStickers=e.favoriteStickers.filter((e=>e!==d)),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("store.removeStickersFromFavorite",{sticker_ids:`${d}`});case 4:return s=e.sent,e.abrupt("return",{type:"StickersRemoveFromFavorite__RequestCompleted",stickerId:d,hasFailed:!Boolean(s)});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"StickersRemoveFromFavorite__RequestCompleted",stickerId:d,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"StickersRemoveFromFavorite__RequestCompleted":var l=t.stickerId;return t.hasFailed&&o(e,{type:"StickersAddToFavorite",stickerId:l},r),[];case"StickerAddToRecent":var p=t.stickerId;return e.recentStickers=[p,...e.recentStickers.filter((e=>e!==p))].slice(0,i),[];default:return(0,n.exhaustivenessCheck)(t)}}},285610:(e,t,r)=>{"use strict";r.d(t,{handler:()=>i});var a=r(887757),s=r(692137),n=r(701069),i=(e,t)=>{var r=t.type;switch(r){case"UserChangedBrowserNotifications":e.locks.settings.add("browserNotifications");var i=e.viewer.settings.browserNotifications;return e.viewer.settings.browserNotifications=t.value,[function(){var e=(0,s.default)(a.mark((function e(r){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r.storage.set("settings-browser-notifications-on",t.value),e.abrupt("return",{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!1,previousValue:i});case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedBrowserNotifications_RequestCompleted",hasFailed:!0,previousValue:i});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedBrowserNotifications_RequestCompleted":return e.locks.settings.delete("browserNotifications"),t.hasFailed&&(e.viewer.settings.browserNotifications=t.previousValue),[];default:(0,n.exhaustivenessCheck)(r)}}},92727:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(701069),i=r(10122),o=r(857085),u={archive:"archive",unarchive:"unarchive",join:"join",leave:"join",mute:"mute",unmute:"unmute",mark_read:"mark_read"},c={archive:"unarchive",unarchive:"archive",join:"leave",leave:"join",mute:"unmute",unmute:"mute"},d=(e,t,r)=>{var u=t.type;switch(u){case"UserChangedChannel":var p=t.channelId,h=t.userAction,v=l(t.userAction,p);if(e.locks.channelActions.has(v))return[];e.locks.channelActions.add(v);var f,m=e.channels.get(p);if(!m)return[];switch(h){case"archive":i.setArchived(m,!0),o.refreshChannels(e.organisers,m),f=e=>e.fetch("channels.archive",{channel_ids:String(p)}).then((e=>Boolean(e)));break;case"unarchive":i.setArchived(m,!1),o.refreshChannels(e.organisers,m),f=e=>e.fetch("channels.unarchive",{channel_ids:String(p),extended:1}).then((e=>Boolean(e)));break;case"join":i.setMembership(m,!0),o.refreshChannels(e.organisers,m),f=e=>e.fetch("channels.join",{channel_id:p,extended:1}).then((e=>Boolean(e)));break;case"leave":i.setMembership(m,!1),o.refreshChannels(e.organisers,m),f=e=>e.fetch("channels.leave",{channel_id:p});break;case"mute":i.setMuted(m,!0),f=e=>e.fetch("channels.setNotificationMode",{channel_id:p,mode:"disabled"}).then((e=>Boolean(e)));break;case"unmute":i.setMuted(m,!1),f=e=>e.fetch("channels.setNotificationMode",{channel_id:p,mode:"enabled"}).then((e=>Boolean(e)));break;case"mark_read":var g=m.history[m.history.length-1];if(g&&"PostItem"===g.kind){var y=g.post.cmid;m.inReadCmid=y,f=e=>e.fetch("channels.markAsRead",{last_read_cmid:y,channel_id:p})}break;default:(0,n.exhaustivenessCheck)(h)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,s=!1,!f){e.next=7;break}return e.next=6,f(r);case 6:s=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedChannel_RequestCompleted",channelId:p,hasFailed:s,userAction:h});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChannel_RequestCompleted",channelId:p,hasFailed:!0,userAction:h});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChannel_RequestCompleted":var C=t.channelId,k=t.userAction,b=t.hasFailed,_=l(k,C);e.locks.channelActions.delete(_);var I=c[k];return b&&I&&(d(e,{type:"UserChangedChannel",userAction:I,channelId:C},r),e.locks.channelActions.delete(_)),[];default:(0,n.exhaustivenessCheck)(u)}},l=(e,t)=>`${u[e]}-${t.toString()}`},292343:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(722122),i=r(614031),o=r(701069),u=r(210746),c=r(13186),d=(e,t)=>{var r,d=t.channelId,l=null!=(r=e.channelComposerDrafts[d])?r:i.empty(),p=i.empty();switch(t.type){case"UserChangedChannelComposerDraft":switch(t.kind){case"text":var h=t.text,v=t.visibility,f=t.donutDelay,m=t.topic,g=t.date,y=t.sendOptions,C=t.resetSendOptions;p=(0,n.default)({},l,{text:null!=h?h:l.text,visibility:v||l.visibility,donutDelay:f||l.donutDelay,topic:m||l.topic,date:g,sendOptions:y||l.sendOptions,resetSendOptions:C||l.resetSendOptions});break;case"addAttaches":case"removeAttach":case"removeVoice":case"startUploading":case"removeUploads":case"rearrangeAttaches":var k=(0,c.applyAttachmentActions)(l,t);p=(0,n.default)({},l,{},k);break;default:(0,o.exhaustivenessCheck)(t)}break;case"UserClearedChannelComposerDraft":break;default:(0,o.exhaustivenessCheck)(t)}!p.text&&0===Object.keys(p.attaches).length&&0===p.uploadsTrackIds.size&&"all"===p.visibility&&"no_theme"===p.topic&&void 0===p.date&&-1===p.donutDelay&&0===p.sendOptions.selected.length&&0===p.sendOptions.disabled.length&&0===p.resetSendOptions.length?delete e.channelComposerDrafts[d]:e.channelComposerDrafts[d]=p;var b=(0,u.current)(e).channelComposerDrafts;return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("channels-drafts",b),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}},111637:(e,t,r)=>{"use strict";r.d(t,{handler:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(10122),o={delete:"delete",restore:"restore"},u={restore:"delete",delete:"restore"},c=(e,t,r)=>{var o=t.type;switch(o){case"UserChangedChannelPost":var l=t.channelId,p=t.cmid,h=t.userAction,v=d(t.userAction,l,p);if(e.locks.channelPostActions.has(v))return[];e.locks.channelPostActions.add(v);var f=e.channels.get(l);if(!f)return[];var m,g=i.findPostByCmid(f,p);if(!g)return[];switch(h){case"delete":if("Deleted"===g.kind)break;i.deletePost(f,g.cmid,!0),m=e=>e.fetch("wall.delete",{owner_id:l,post_id:p}).then((e=>Boolean(e)));break;case"restore":if("Normal"===g.kind)break;i.restorePost(f,g.cmid),m=e=>e.fetch("wall.restore",{owner_id:l,post_id:p}).then((e=>Boolean(e)));break;default:(0,n.exhaustivenessCheck)(h)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,s=!1,!m){e.next=7;break}return e.next=6,m(r);case 6:s=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedChannelPost_RequestCompleted",channelId:l,cmid:p,hasFailed:s,userAction:h});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChannelPost_RequestCompleted",channelId:l,cmid:p,hasFailed:!0,userAction:h});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChannelPost_RequestCompleted":var y=t.channelId,C=t.cmid,k=t.userAction,b=t.hasFailed,_=d(k,y,C);e.locks.channelPostActions.delete(_);var I=u[k];return b&&I&&(c(e,{type:"UserChangedChannelPost",userAction:I,channelId:y,cmid:C},r),e.locks.channelPostActions.delete(_)),[];default:(0,n.exhaustivenessCheck)(o)}},d=(e,t,r)=>`${o[e]}-${t.toString()}-${r}`},41902:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(701069),i=r(529122),o=r(658265),u=r(228450),c=r(766278),d=(e,t)=>{var r=t.type;switch(r){case"UserChangedChatTitle":var d=t.peerId,l=t.title,p=i.toRealId(d),h=e.peers.get(d),v=e.ownerId;if(!h||"Chat"!==h.kind)return[];var f=h.title;return i.updateChatInfo(h,{title:l}),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.editChat",{chat_id:p,title:l,group_id:(0,c.getOwnerGroupId)(v)},{retries:1});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedChatTitle_RequestCompleted",hasFailed:1!==s,peerId:d,title:1!==s?f:l});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChatTitle_RequestCompleted",hasFailed:!0,peerId:d,title:f});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatTitle_RequestCompleted":var m=t.peerId,g=t.title,y=t.hasFailed,C=e.peers.get(m);return C&&"Chat"===C.kind&&y?(i.updateChatInfo(C,{title:g}),[]):[];case"UserChangedChatDescription":var k=t.peerId,b=t.description,_=i.toRealId(k),I=e.convos.get(k),w=e.ownerId;if(!I||"ChatConvo"!==I.kind&&"GroupConvo"!==I.kind)return[];var M=I.description;return o.setDescription(I,b),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.editChat",{chat_id:_,description:b,group_id:(0,c.getOwnerGroupId)(w)},{retries:1});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedChatDescription_RequestCompleted",hasFailed:1!==s,peerId:k,description:1!==s?M:b});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChatDescription_RequestCompleted",hasFailed:!0,peerId:k,description:M});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatDescription_RequestCompleted":var S=t.peerId,R=t.description,E=t.hasFailed,x=e.convos.get(S);return!x||"ChatConvo"!==x.kind&&"GroupConvo"!==x.kind?[]:E?(o.setDescription(x,R),[]):[];case"UserSetChatPhoto":var A,U,P,T=t.peerId,O=t.photo,F=e.peers.get(T);return F&&"Chat"===F.kind?(i.updateChatInfo(F,{photo50:null==(A=u.preview(O,50,50))?void 0:A.url,photo100:null==(U=u.preview(O,100,100))?void 0:U.url,photo200:null==(P=u.preview(O,200,200))?void 0:P.url}),[]):[];case"UserRemovedChatPhoto":var N=t.peerId,q=e.ownerId,L=i.toRealId(N),D=e.peers.get(N);return D&&"Chat"===D.kind?(i.updateChatInfo(D,{photo50:void 0,photo100:void 0,photo200:void 0}),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.deleteChatPhoto",{chat_id:L,group_id:(0,c.getOwnerGroupId)(q)},{retries:1});case 4:return e.abrupt("return",{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:!1,peerId:N});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserRemovedChatPhoto_RequestCompleted",hasFailed:!0,peerId:N});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()]):[];case"UserRemovedChatPhoto_RequestCompleted":return[];case"UserChangedChatSettings":var H=t.peerId,B=t.isService,G=t.permissions,j=i.toRealId(H),V=e.ownerId;return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.editChat",{chat_id:j,is_service:B?1:0,permissions:JSON.stringify(G),group_id:(0,c.getOwnerGroupId)(V)},{retries:1});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedChatSettings_RequestCompleted",hasFailed:1!==s,permissions:G,peerId:H,isService:B});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedChatSettings_RequestCompleted",hasFailed:!0,permissions:G,peerId:H,isService:B});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatSettings_RequestCompleted":var z=t.peerId,W=t.isService,K=t.permissions;if(t.hasFailed)return[];var $=e.convos.get(z);return $&&"ChatConvo"===$.kind?(o.setChatPermissions($,K,W),[]):[];default:(0,n.exhaustivenessCheck)(r)}}},718112:(e,t,r)=>{"use strict";r.d(t,{handler:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(529122),o=r(658265),u=r(766278),c=(e,t)=>{switch(t.type){case"UserChangedChatMember":var r=t.peerId,c=t.memberId,d=t.userAction;if(!e.convos.get(r))return[];var l=function(e,t){var r=t.userAction,a=t.peerId,s=t.memberId;switch(r){case"promote":return e=>e.api.fetch("messages.setMemberRole",{member_id:s,peer_id:a,role:"admin"});case"demote":return e=>e.api.fetch("messages.setMemberRole",{member_id:s,peer_id:a,role:"member"});case"cancel_invitation":case"remove":return t=>t.api.fetch("messages.removeChatUser",{chat_id:i.toRealId(a),member_id:s,group_id:(0,u.getOwnerGroupId)(e)});default:return(0,n.exhaustivenessCheck)(r)}}(e.ownerId,t);return[function(){var e=(0,s.default)(a.mark((function e(t){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l(t);case 3:return s=e.sent,e.abrupt("return",{type:"UserChangedChatMember_RequestCompleted",hasFailed:1!==s,peerId:r,memberId:c,userAction:d});case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedChatMember_RequestCompleted",hasFailed:!0,peerId:r,memberId:c,userAction:d});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedChatMember_RequestCompleted":var p=t.peerId,h=t.memberId,v=t.userAction,f=t.hasFailed,m=e.convos.get(p);return f||"ChatConvo"!==(null==m?void 0:m.kind)?[]:("cancel_invitation"===v&&o.removeMember(m,h),i.isContactPeerId(h)||("promote"===v&&o.addAdmin(m,h),"demote"===v&&o.removeAdmin(m,h),"remove"===v&&o.removeMember(m,h)),[]);default:return(0,n.exhaustivenessCheck)(t)}}},273765:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(722122),n=r(692137),i=r(701069),o=r(10122),u=r(897181),c=r(298258),d={delete:"delete",restore:"delete"},l=(e,t,r)=>{var d,h=t.type,v=t.channelId,f=t.postCmid,m=t.commentCmid,g=t.replyCmid,y=t.userAction,C=p(y,v,f,g||m),k=e.channels.get(v),b=k&&o.findPostByCmid(k,f),_="Normal"===(null==b?void 0:b.kind)&&u.findCommentByCmid(b,m);if(!_)return[];if(g){var I=c.findReplyByCmid(_,g);if(!I||"Deleted"===I.kind)return[];d=I}else d=_;if(!_)return[];switch(h){case"UserDeleteComment":if(e.locks.commentActions.has(C)||"Normal"!==d.kind)return[];e.locks.commentActions.add(C);var w=c.markDeleted(d);return g?c.replaceReply(_,w):u.replaceComment(b,w),[function(){var e=(0,n.default)(a.mark((function e(r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("wall.deleteComment",{owner_id:v,comment_id:w.cmid});case 4:return i=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"UserDeleteComment_RequestCompleted",hasFailed:!Boolean(i),deletedComment:w}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"UserDeleteComment_RequestCompleted",hasFailed:!0,deletedComment:w}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRestoreComment":if(e.locks.commentActions.has(C)||"MarkedDeleted"!==d.kind)return[];e.locks.commentActions.add(C);var M=c.restoreDeleted(d);return g?c.replaceReply(_,M):u.replaceComment(b,M),[function(){var e=(0,n.default)(a.mark((function e(r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("wall.restoreComment",{owner_id:v,comment_id:M.cmid});case 4:return i=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"UserRestoreComment_RequestCompleted",hasFailed:!Boolean(i)}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"UserRestoreComment_RequestCompleted",hasFailed:!0}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeleteComment_RequestCompleted":case"UserRestoreComment_RequestCompleted":var S=t.hasFailed;return e.locks.commentActions.delete(C),S&&l(e,(0,s.default)({},t,{},"delete"===y?{type:"UserRestoreComment",userAction:"restore"}:{type:"UserDeleteComment",userAction:"delete"}),r),e.locks.commentActions.delete(C),[];default:(0,i.exhaustivenessCheck)(t)}},p=(e,t,r,a)=>`${d[e]}-${t}-${r}-${a}`},13186:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l,applyAttachmentActions:()=>p});var a=r(887757),s=r(692137),n=r(722122),i=r(452990),o=r(194739),u=r(228450),c=r(701069),d=r(210746),l=(e,t)=>{var r,u=t.peerId,l=null!=(r=e.composerDrafts[u])?r:i.empty(),h=i.empty();switch(t.type){case"UserChangedComposerDraft":switch(t.kind){case"text":var v=t.text;h=(0,n.default)({},l,{text:null!=v?v:l.text});break;case"addAttaches":case"removeAttach":case"removeVoice":case"startUploading":case"removeUploads":case"rearrangeAttaches":var f=p(l,t);h=(0,n.default)({},l,{},f);break;case"editing":var m=t.editing;h={editing:m,text:o.toRawText(m),attaches:m.attaches,uploadsTrackIds:l.uploadsTrackIds,forward:m.forwardedMessages&&{kind:"message",items:m.forwardedMessages},reply:m.replyMessage};break;case"forward":var g=t.forward,y=t.isForwardAuthorHidden;h=(0,n.default)({},g&&l.editing?i.empty():l,{reply:void 0,forward:g,isForwardAuthorHidden:null!=y?y:i.DEFAULT_FORWARD_AUTHOR_HIDDEN});break;case"reply":var C=t.reply;h=(0,n.default)({},C&&l.editing?i.empty():l,{forward:void 0,reply:C});break;default:(0,c.exhaustivenessCheck)(t)}break;case"UserClearedComposerDraft":break;case"UpdateComposerDraftOnMessageDelete":var k=l.editing;void 0!==k&&t.deletedMessagesCmid.includes(k.cmid)||(h=l);break;default:(0,c.exhaustivenessCheck)(t)}!(h.text||h.forward||h.reply||h.editing||0!==Object.keys(h.attaches).length||0!==h.uploadsTrackIds.size)?delete e.composerDrafts[u]:e.composerDrafts[u]=h;var b=(0,d.current)(e).composerDrafts;return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("drafts",b),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]};function p(e,t){switch(t.kind){case"addAttaches":var r=t.attaches,a=t.trackIds,s=e.attaches;r&&(s=(0,d.produce)(s,(e=>{u.addAttach(e,r)})));var n=e.uploadsTrackIds;return(null==a?void 0:a.length)&&(n=(0,d.produce)(n,(e=>{a.forEach((t=>{e.delete(t)}))}))),{attaches:s,uploadsTrackIds:n};case"removeAttach":var i=t.attach,o=e.attaches;return i&&(o=(0,d.produce)(o,(e=>{u.removeAttach(e,i)}))),{attaches:o};case"removeVoice":return{attaches:(0,d.produce)(e.attaches,(e=>{e.voice&&delete e.voice}))};case"startUploading":var l=t.trackIds;return{uploadsTrackIds:new Set([...e.uploadsTrackIds,...l])};case"removeUploads":var p=t.trackIds;return{uploadsTrackIds:(0,d.produce)(e.uploadsTrackIds,(e=>{p.forEach((t=>{e.delete(t)}))}))};case"rearrangeAttaches":var h=t.key,v=t.currentPosition,f=t.newPosition,m=e.attaches;return-1!==f&&f!==v&&(m=(0,d.produce)(m,(e=>{u.rearrangeAttaches(e,{currentPosition:v,newPosition:f},h)}))),{attaches:m};default:(0,c.exhaustivenessCheck)(t)}}},213934:(e,t,r)=>{"use strict";r.d(t,{handler:()=>v});var a=r(887757),s=r(692137),n=r(658265),i=r(529122),o=r(857085),u=r(194739),c=r(701069),d=r(210746),l=r(766278),p={mute:"mute",unmute:"mute",mute_until:"mute_until",pin:"pin",unpin:"pin",mark_read:"mark_read",mark_unread:"mark_read",archive:"archive",unarchive:"archive",clear:"clear",leave:"leave",leave_and_clear:"leave_and_clear",show_pinned_message:"show_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"show_bot_keyboard",hide_bot_keyboard:"hide_bot_keyboard",pin_message_for_all:"pin_message_for_all",unpin_message_for_all:"pin_message_for_all",ban:"ban",unban:"unban",return_to_chat:"return_to_chat",business_notify_enable:"business_notify_enable",business_notify_disable:"business_notify_enable"},h={pin:"unpin",unpin:"pin",mark_read:"mark_unread",mark_unread:"mark_read",archive:"unarchive",unarchive:"archive",show_pinned_message:"hide_pinned_message",hide_pinned_message:"show_pinned_message",show_bot_keyboard:"hide_bot_keyboard",hide_bot_keyboard:"show_bot_keyboard"},v=(e,t,r)=>{switch(t.type){case"UserChangedConvo":var p=t.peerId,m=t.userAction,g=e.organisers,y=e.viewer.id,C=f(t.userAction,p);if(e.locks.convoActions.has(C))return[];e.locks.convoActions.add(C);var k,b=e.convos.get(p),_=e.peers.get(p),I=e.ownerId;if(!b||!_)return[];switch(m){case"pin":k=e=>e.fetch("messages.pinConversation",{peer_id:p});break;case"unpin":k=e=>e.fetch("messages.unpinConversation",{peer_id:p});break;case"mark_read":b.isMarkedUnread=!1,k=e=>e.fetch("messages.markAsRead",{peer_id:p,mark_conversation_as_read:1,group_id:(0,l.getOwnerGroupId)(I)});break;case"mark_unread":b.isMarkedUnread=!0,k=e=>e.fetch("messages.markAsUnreadConversation",{peer_id:p,group_id:0});break;case"archive":case"unarchive":b.isArchived="archive"===m,o.refresh(g,b),k=e=>e.fetch("archive"===m?"messages.archiveConversation":"messages.unarchiveConversation",{peer_id:p});break;case"hide_pinned_message":"ChatConvo"===b.kind&&b.pinnedMessage&&e.hiddenPinnedMessages.set(t.peerId,b.pinnedMessage.cmid);break;case"show_pinned_message":e.hiddenPinnedMessages.delete(t.peerId);break;case"hide_bot_keyboard":e.hiddenBotKeyboards.add(t.peerId);break;case"show_bot_keyboard":e.hiddenBotKeyboards.delete(t.peerId);break;case"clear":k=e=>e.fetch("messages.deleteConversation",{peer_id:p,group_id:(0,l.getOwnerGroupId)(I)}).then((e=>{var t=e.last_deleted_id;return Boolean(t)}));break;case"leave":case"leave_and_clear":if("ChatConvo"!==b.kind)break;k=e=>e.fetch("messages.removeChatUser",{chat_id:i.toRealId(p),user_id:y,group_id:(0,l.getOwnerGroupId)(I)});var w=e.peers.get(p);if(!w||"Chat"!==w.kind)break;n.clearChatDataOnLeave(b),i.clearChatDataOnLeave(w);break;case"ban":if(!("User"===_.kind&&"UserConvo"===b.kind||"Group"===_.kind&&"GroupConvo"===b.kind))break;i.updateIsPeerBlacklistedByMe(_,!0),"UserConvo"===b.kind&&n.restrictWrite(b,"peer_blacklisted_by_me"),k=i.isGroupPeerId(I)?e=>e.fetch("groups.ban",{owner_id:p,group_id:(0,l.getOwnerGroupId)(I)}):i.isGroupPeerId(p)?e=>e.fetch("messages.denyMessagesFromGroup",{group_id:i.toRealId(p)}):e=>e.fetch("account.ban",{owner_id:p});break;case"unban":if(!("User"===_.kind&&"UserConvo"===b.kind||"Group"===_.kind&&"GroupConvo"===b.kind))break;i.updateIsPeerBlacklistedByMe(_,!1),"UserConvo"===b.kind&&n.allowWrite(b),k=i.isGroupPeerId(I)?e=>e.fetch("groups.unban",{owner_id:p,group_id:(0,l.getOwnerGroupId)(I)}):i.isGroupPeerId(p)?e=>e.fetch("messages.allowMessagesFromGroup",{group_id:i.toRealId(p)}):e=>e.fetch("account.unban",{owner_id:p});break;case"return_to_chat":k=e=>e.fetch("messages.addChatUser",{chat_id:i.toRealId(p),user_id:y}).then((e=>{var t=e.result;return Boolean(t)}));break;default:(0,c.exhaustivenessCheck)(m)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,s=!1,!k){e.next=7;break}return e.next=6,k(r);case 6:s=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedConvo_RequestCompleted",hasFailed:s,userAction:m,peerId:p});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedConvo_RequestCompleted",hasFailed:!0,userAction:m,peerId:p});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedConvo_RequestCompleted":var M=t.peerId,S=t.userAction,R=t.hasFailed,E=f(S,M);e.locks.convoActions.delete(E);var x=h[S];if(R&&x)return v(e,{type:"UserChangedConvo",userAction:x,peerId:M},r),[];if(R)return[];switch(S){case"clear":case"pin":case"unpin":case"mark_read":case"mark_unread":case"unarchive":case"show_pinned_message":case"hide_pinned_message":case"show_bot_keyboard":case"hide_bot_keyboard":case"ban":case"unban":return[];case"archive":var A=e.convos.get(M);if(!A||"ChatConvo"!==A.kind||!A.unreadMentions.size)return[];var U=u.resolveCmid(Math.max(...A.unreadMentions));return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,(s=r.get("archive-mentions-map"))&&U){e.next=4;break}return e.abrupt("return",{type:"Noop"});case 4:return s[M]=U,r.set("archive-mentions-map",s),e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"leave":var P=e.convos.get(M);return"ChatConvo"===(null==P?void 0:P.kind)&&n.setConvoState(P,"left"),[];case"leave_and_clear":var T=e.convos.get(M);return"ChatConvo"!==(null==T?void 0:T.kind)?[]:(n.setConvoState(T,"left"),v(e,{type:"UserChangedConvo",userAction:"clear",peerId:M},r));case"return_to_chat":var O=e.convos.get(M);return"ChatConvo"===(null==O?void 0:O.kind)&&n.setConvoState(O,"in"),[];default:return(0,c.exhaustivenessCheck)(t)}case"UserChangedMute":var F=t.peerId,N=t.timer,q=t.userAction,L=f(t.userAction,F);if(e.locks.convoActions.has(L))return[];var D,H=e.convos.get(F);if(!H)return[];switch(q){case"mute":H.push={mode:"every-mention",disabledUntil:1/0},D=-1;break;case"unmute":H.push={mode:"everything",disabledUntil:0},D=0;break;case"mute_until":H.push={mode:"every-mention",disabledUntil:Date.now()+1e3*N},D=N;break;default:(0,c.exhaustivenessCheck)(q)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("account.setSilenceMode",{time:D,peer_id:F,sound:"unmute"===q?1:0});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedMute_RequestCompleted",hasFailed:1!==s,userAction:q,peerId:F});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMute_RequestCompleted",hasFailed:!0,userAction:q,peerId:F});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMute_RequestCompleted":var B=t.peerId,G=t.userAction,j=t.hasFailed,V=f(G,B);e.locks.convoActions.delete(V);var z={mute:"unmute",unmute:"mute",mute_until:"unmute"}[G];return j&&z?(v(e,{type:"UserChangedMute",userAction:z,peerId:B,timer:0},r),[]):[];case"UserPinMessage":var W=t.peerId,K=t.cmid,$=t.userAction,Q=f(t.userAction,W);if(e.locks.convoActions.has(Q))return[];e.locks.convoActions.add(Q);var X=e.convos.get(W),Y=e.ownerId;if(!X||"ChatConvo"!==X.kind)return[];var Z=X.pinnedMessage&&(0,d.current)(X.pinnedMessage),J=X.persisted.get(K);return"Normal"===(null==J?void 0:J.kind)&&n.pinMessage(X,u.toPinned(J)),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.pin",{peer_id:W,conversation_message_id:K,group_id:(0,l.getOwnerGroupId)(Y)});case 4:return e.abrupt("return",{type:"UserPinMessage_RequestCompleted",hasFailed:!1,userAction:$,peerId:W,cmid:K});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserPinMessage_RequestCompleted",hasFailed:!0,userAction:$,pinnedMessage:Z,peerId:W,cmid:K});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserPinMessage_RequestCompleted":var ee=t.peerId,te=t.hasFailed,re=t.pinnedMessage,ae=t.userAction,se=f(ae,ee);e.locks.convoActions.delete(se);var ne=e.convos.get(ee);return ne&&"ChatConvo"===ne.kind?(te&&(n.unpinMessage(ne),re&&n.pinMessage(ne,re)),[]):[];case"UserUnpinMessage":var ie=t.peerId,oe=t.userAction,ue=f(t.userAction,ie);if(e.locks.convoActions.has(ue))return[];var ce=e.convos.get(ie),de=e.ownerId;if(!ce||"ChatConvo"!==ce.kind)return[];var le=(0,d.current)(n.unpinMessage(ce));return[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.unpin",{peer_id:ie,group_id:(0,l.getOwnerGroupId)(de)});case 4:return e.abrupt("return",{type:"UserUnpinMessage_RequestCompleted",hasFailed:!1,userAction:oe,peerId:ie});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserUnpinMessage_RequestCompleted",hasFailed:!0,userAction:oe,prevPinnedMessage:le,peerId:ie});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserUnpinMessage_RequestCompleted":var pe=t.peerId,he=t.hasFailed,ve=t.prevPinnedMessage,fe=t.userAction,me=f(fe,pe);e.locks.convoActions.delete(me);var ge=e.convos.get(pe);return ge&&"ChatConvo"===ge.kind?(he&&ve&&n.pinMessage(ge,ve),[]):[];case"UserChangedBusinessNotify":var ye=t.userAction,Ce=t.peerId,ke=f(t.userAction,Ce);if(e.locks.convoActions.has(ke))return[];var be=e.peers.get(Ce);return"Group"!==(null==be?void 0:be.kind)||be.isBlacklistedByMe&&"business_notify_disable"===ye||!be.isBlacklistedByMe&&"business_notify_enable"===ye?[]:(i.updateIsPeerBlacklistedByMe(be,"business_notify_disable"===ye),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("business_notify_disable"===ye?"messages.denyMessagesFromGroup":"messages.allowMessagesFromGroup",{group_id:i.toRealId(Ce)});case 4:return s=e.sent,e.abrupt("return",{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:1!==s,userAction:ye,peerId:Ce});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedBusinessNotify_RequestCompleted",hasFailed:!0,userAction:ye,peerId:Ce});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedBusinessNotify_RequestCompleted":var _e=t.userAction,Ie=t.peerId,we=t.hasFailed,Me=f(_e,Ie);e.locks.convoActions.delete(Me);var Se=e.peers.get(Ie);return"Group"!==(null==Se?void 0:Se.kind)||we&&i.updateIsPeerBlacklistedByMe(Se,!Se.isBlacklistedByMe),[];default:(0,c.exhaustivenessCheck)(t)}},f=(e,t)=>`${p[e]}-${t.toString()}`},348472:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(529122),i=r(701069),o=(e,t)=>{switch(t.type){case"UserChangedFriendship":var r=e.peers.get(t.userId);if("User"!==(null==r?void 0:r.kind)||e.locks.updateFriendshipOrMembership.has(r.id))return[];var o=r.friendship;return n.updateFriendship(r,t.change),o===r.friendship?[]:(e.locks.updateFriendshipOrMembership.add(r.id),[function(){var e=(0,s.default)(a.mark((function e(r){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,n=!1,e.prev=2,e.next=5,s.fetch(`friends.${t.change}`,{user_id:t.userId});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n=!0;case 10:return e.abrupt("return",{type:"UserChangedFriendship_RequestCompleted",userId:t.userId,change:t.change,hasFailed:n});case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedFriendship_RequestCompleted":e.locks.updateFriendshipOrMembership.delete(t.userId);var u=e.peers.get(t.userId);return"User"!==(null==u?void 0:u.kind)||t.hasFailed&&n.updateFriendship(u,{add:"delete",delete:"add"}[t.change]),[];default:return(0,i.exhaustivenessCheck)(t)}}},720689:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(529122),i=r(701069),o=(e,t)=>{switch(t.type){case"UserChangedGroupMembership":var r=e.peers.get(t.groupId);if("Group"!==(null==r?void 0:r.kind)||e.locks.updateFriendshipOrMembership.has(r.id))return[];var o=r.membership;return n.updateMembership(r,t.change),o===r.membership?[]:(e.locks.updateFriendshipOrMembership.add(r.id),[function(){var e=(0,s.default)(a.mark((function e(r){var s,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,n=`groups.${t.change}`,i=!1,e.prev=3,e.next=6,s.fetch(n,{group_id:-t.groupId});case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),i=!0;case 11:return e.abrupt("return",{type:"UserChangedGroupMembership_RequestCompleted",groupId:t.groupId,change:t.change,hasFailed:i});case 12:case"end":return e.stop()}}),e,null,[[3,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedGroupMembership_RequestCompleted":e.locks.updateFriendshipOrMembership.delete(t.groupId);var u=e.peers.get(t.groupId);return"Group"!==(null==u?void 0:u.kind)||t.hasFailed&&n.updateMembership(u,{join:"leave",leave:"join"}[t.change]),[];default:return(0,i.exhaustivenessCheck)(t)}}},64153:(e,t,r)=>{"use strict";r.d(t,{handler:()=>p});var a=r(887757),s=r(692137),n=r(194739),i=r(658265),o=r(701069),u=r(337074),c=r(766278),d={mark_important:"unmark_important",unmark_important:"mark_important"},l={delete:"delete",restore:"restore",mark_important:"mark_important",unmark_important:"mark_important"},p=(e,t,r)=>{switch(t.type){case"UpdateComposerDraftOnMessageDelete":return[];case"UserChangedMessage":for(var l=t.peerId,v=t.userAction,f=t.cmids,m=t.ids,g=0;g<f.length;g+=1){var y=f[g];if(!y)return[];var C=h(v,l,y);if(e.locks.messageActions.has(C))return[];e.locks.messageActions.add(C)}var k,b=e.convos.get(l);switch(v){case"mark_important":case"unmark_important":f.forEach((t=>{if(b){var r=b.persisted.get(t);"Normal"===(null==r?void 0:r.kind)&&(r.isImportant="mark_important"===v)}var a=e.importantMessages.messages.get((0,u.getImportantMessageKey)(l,t));a&&(a.isImportant="mark_important"===v)})),k=e=>e.fetch("messages.markAsImportant",{message_ids:`${m.join(",")}`,important:"mark_important"===v?1:0}).then((e=>Boolean(e[0])));break;default:(0,o.exhaustivenessCheck)(v)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,e.prev=1,s=!1,!k){e.next=7;break}return e.next=6,k(r);case 6:s=!e.sent;case 7:return e.abrupt("return",{type:"UserChangedMessage_RequestCompleted",hasFailed:s,userAction:v,ids:m,cmids:f,peerId:l});case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMessage_RequestCompleted",hasFailed:!0,userAction:v,ids:m,cmids:f,peerId:l});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMessage_RequestCompleted":var _=t.peerId,I=t.userAction,w=t.hasFailed,M=t.cmids,S=t.ids;M.forEach((t=>{var r=h(I,_,t);e.locks.messageActions.delete(r)}));var R=d[I];return w&&R&&p(e,{type:"UserChangedMessage",userAction:R,ids:S,peerId:_,cmids:M},r),[];case"UserDeleteMessage":var E=t.deleteType,x=t.peerId,A=t.userAction,U=t.messages,P=e.ownerId,T=e.convos.get(x);if(!T)return[];for(var O=[],F=0;F<U.length;F+=1){var N=U[F];if(!N||"Normal"!==N.kind)return[];var q=h(A,x,N.cmid);if(e.locks.messageActions.has(q))return[];e.locks.messageActions.add(q);var L=n.markDeleted(N,"spam"===E);O.push(L);var D=i.isCasper(T)||n.isCall(N);switch(E){case"local":case"spam":if(D){i.deleteMessage(T,N.cmid);break}i.replaceMessage(T,L,!1);break;case"for_all":i.deleteMessage(T,N.cmid);break;default:(0,o.exhaustivenessCheck)(E)}}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.delete",{message_ids:U.map((e=>e.id)).join(","),peer_id:x,delete_for_all:"for_all"===E?1:0,spam:"spam"===E?1:0,group_id:(0,c.getOwnerGroupId)(P)});case 4:return n=e.sent,e.abrupt("return",{type:"UserDeleteMessage_RequestCompleted",hasFailed:!Boolean(null==(s=n[0])?void 0:s.response),userAction:A,deleteType:E,peerId:x,messages:U,deletedMessages:O});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserDeleteMessage_RequestCompleted",hasFailed:!0,userAction:A,deleteType:E,peerId:x,messages:U,deletedMessages:O});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeleteFailedMessage":var H=t.peerId,B=t.randomId,G=e.convos.get(H);return G?(i.removeQueued(G,B),[]):[];case"UserDeleteAllFailedMessage":var j=t.peerId,V=e.convos.get(j);return V?(i.allQueuedMessages(V).filter((e=>e.hasFailed)).forEach((e=>{i.removeQueued(V,e.randomId)})),[]):[];case"UserDeleteMessage_RequestCompleted":var z=t.peerId,W=t.userAction,K=t.messages,$=t.hasFailed,Q=t.deletedMessages,X=e.convos.get(z);return $&&X&&Q.forEach((e=>{var t=n.restoreDeleted(e);i.restoreMessage(X,t,!1)})),K.forEach((t=>{var r=t.cmid,a=h(W,z,r);e.locks.messageActions.delete(a)})),[(0,s.default)(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$?{type:"Noop"}:{type:"UpdateComposerDraftOnMessageDelete",peerId:z,deletedMessagesCmid:Q.map((e=>e.cmid))});case 1:case"end":return e.stop()}}),e)})))];case"UserRestoreMessage":var Y=t.peerId,Z=t.userAction,J=t.cmid,ee=t.messageId,te=h(Z,Y,J);if(e.locks.messageActions.has(te))return[];e.locks.messageActions.add(te);var re=e.convos.get(Y);if(!re)return[];var ae=e.ownerId,se=re.persisted.get(J);if(se&&"MarkedDeleted"===se.kind){var ne=n.restoreDeleted(se);i.restoreMessage(re,ne,!1)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.restore",{message_id:ee,group_id:(0,c.getOwnerGroupId)(ae)});case 4:return s=e.sent,e.abrupt("return",{type:"UserRestoreMessage_RequestCompleted",hasFailed:!Boolean(s),userAction:Z,messageId:ee,peerId:Y,cmid:J});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRestoreMessage_RequestCompleted",hasFailed:!0,userAction:Z,messageId:ee,peerId:Y,cmid:J});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRestoreMessage_RequestCompleted":var ie=t.peerId,oe=t.userAction,ue=t.cmid,ce=t.hasFailed,de=h(oe,ie,ue);e.locks.messageActions.delete(de);var le=e.convos.get(ie),pe=null==le?void 0:le.persisted.get(ue);return ce&&le&&pe&&"Normal"===pe.kind&&p(e,{type:"UserDeleteMessage",messages:[pe],deleteType:"local",peerId:ie,userAction:"delete"},r),[];default:(0,o.exhaustivenessCheck)(t)}},h=(e,t,r)=>`${l[e]}-${t.toString()}-${r.toString()}`},621530:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(664902),i=r(701069),o=r(658265),u=(e,t)=>{switch(t.type){case"UserChangedMessageAttachment":return[function(){var e=(0,s.default)(a.mark((function e(r){var s,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,e.prev=1,e.next=4,s.fetch("messages.getByConversationMessageId",{peer_id:t.peerId,conversation_message_ids:t.cmid.toString(),extended:1,group_id:t.groupId||0},{retries:3});case 4:if(n=e.sent,i=n.items[0]){e.next=8;break}return e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0});case 8:return e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!1,peerId:t.peerId,apiMessage:i});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedMessageAttachment_RequestCompleted",hasFailed:!0});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedMessageAttachment_RequestCompleted":if(t.hasFailed)return[];var r=(0,n.fromApiMessage)(t.apiMessage),u=r.message,c=r.mentions,d=e.convos.get(t.peerId);return d?(o.replaceMessage(d,u,c.hasDirect||c.hasMass),[]):[];default:(0,i.exhaustivenessCheck)(t)}}},580412:(e,t,r)=>{"use strict";r.d(t,{handler:()=>c});var a=r(887757),s=r(692137),n=r(701069),i=r(658265),o=r(857085),u=r(210746),c=(e,t)=>{var r=t.type,c=e.viewer.id;switch(r){case"UserAcceptedChatMessageRequest":var d=t.peerId;return e.locks.changeMessageRequest.has(d)?[]:(e.locks.changeMessageRequest.add(d),[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.acceptMessageRequest",{peer_id:d,user_id:c});case 4:return e.abrupt("return",{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:d});case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",{type:"UserAcceptedChatMessageRequest_RequestCompleted",peerId:d});case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserRejectedMessageRequest":var l=t.peerId,p=t.isSpam;if(e.locks.changeMessageRequest.has(l))return[];e.locks.changeMessageRequest.add(l);var h=e.convos.get(l),v=(0,u.current)(h);if(void 0!==h&&("MessageRequestChatConvo"===h.kind||"MessageRequestUserConvo"===h.kind||"UserConvo"===h.kind)){var f=i.fromRejectedMessageRequest(h);e.convos.set(l,f),o.refresh(e.organisers,f)}return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.rejectMessageRequest",{peer_id:l,user_id:c,spam:p?1:0});case 4:return s=e.sent,e.abrupt("return",{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:1!==s,peerId:l,prevConvo:v});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRejectedChatMessageRequest_RequestCompleted",hasFailed:!0,peerId:l,prevConvo:v});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserAcceptedChatMessageRequest_RequestCompleted":var m=t.peerId;return e.locks.changeMessageRequest.delete(m),[];case"UserRejectedChatMessageRequest_RequestCompleted":var g=t.prevConvo,y=t.hasFailed,C=t.peerId;return e.locks.changeMessageRequest.delete(C),y&&void 0!==g&&(e.convos.set(C,g),o.refresh(e.organisers,g)),[];default:(0,n.exhaustivenessCheck)(r)}}},672510:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(701069),i=r(10122),o=r(766086);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var d=(e,t)=>{switch(t.type){case"UserChangedPostAttachment":var r=t.channelId,c=t.cmid;return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("channels.getMessagesById",{channel_id:r,cmids:c.toString(),extended:1},{retries:3});case 4:if(i=e.sent,o=null==(n=i.items)?void 0:n[0]){e.next=8;break}return e.abrupt("return",{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!0});case 8:return e.abrupt("return",{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!1,channelId:r,apiPost:o});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"UserChangedPostAttachment_RequestCompleted",hasFailed:!0});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedPostAttachment_RequestCompleted":if(t.hasFailed)return[];var d=t.apiPost,l=t.channelId,p=e.channels.get(l);if(!p)return[];for(var h,v=(0,o.fromApiPost)(d),f=v.post,m=u(v.reactions);!(h=m()).done;){var g=h.value;e.reactions.set(g.id,g)}return i.replacePost(p,f),[];default:(0,n.exhaustivenessCheck)(t)}}},9062:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(701069),i=r(607815),o=(e,t)=>{var r=t.type;switch(r){case"UserChangedSetting":var i=t.setting;e.locks.settings.add(i);var o=e.viewer.settings[t.setting];return e.viewer.settings[t.setting]=t.value,[function(){var e=(0,s.default)(a.mark((function e(r){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u(r,t.setting,t.value);case 3:return s=e.sent,"transcriptAutoShow"===t.setting&&1===s&&r.stats.logEvent("type_action",{type:"type_settings_changes_item",type_settings_changes_item:{type:"general",name:"voice_transcription_autoshow",value_old:String(Number(o)),value_new:String(Number(t.value)),screen:"im_web_settings"}}),e.abrupt("return",{type:"UserChangedSetting_RequestCompleted",hasFailed:1!==s,setting:t.setting,previousValue:o});case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",{type:"UserChangedSetting_RequestCompleted",hasFailed:!0,setting:t.setting,previousValue:o});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserChangedSetting_RequestCompleted":var c=t.setting;return e.locks.settings.delete(c),t.hasFailed&&(e.viewer.settings[t.setting]=t.previousValue),[];default:(0,n.exhaustivenessCheck)(r)}};function u(e,t,r){var a=e.api,s=e.storage;switch(t){case"ctrSubmit":var o=i.IApi.resolveTrackId("account.setInfo","messages_multiline_input");return a.dangerouslyAbort(o),a.fetch("account.setInfo",{name:"messages_multiline_input",value:String(Number(r))},{trackId:o});case"soundNotifications":return s.set("settings-sound-notifications-on",r),Promise.resolve(1);case"showRecommendations":var u=i.IApi.resolveTrackId("account.setInfo","messages_recommendation_list_hidden");return a.dangerouslyAbort(u),a.fetch("account.setInfo",{name:"messages_recommendation_list_hidden",value:String(Number(!r))},{trackId:u});case"countOnlyNotMuted":var c=i.IApi.resolveTrackId("account.setInfo","show_only_not_muted_messages");return a.dangerouslyAbort(c),a.fetch("account.setInfo",{name:"show_only_not_muted_messages",value:String(Number(r))},{trackId:c});case"autoUnarchive":var d=i.IApi.resolveTrackId("account.setInfo","messages_auto_unarchive");return a.dangerouslyAbort(d),a.fetch("account.setInfo",{name:"messages_auto_unarchive",value:String(Number(r))},{trackId:d});case"transcriptAutoShow":var l=i.IApi.resolveTrackId("account.setInfo","messages_transcript_auto_show");return a.dangerouslyAbort(l),a.fetch("account.setInfo",{name:"messages_transcript_auto_show",value:String(Number(r))},{trackId:l});case"verticalFoldersView":return s.set("folders-view-vertical",r),Promise.resolve(1);case"messageReactionAnimation":return s.set("message-reactions-animation",r),Promise.resolve(1);default:(0,n.exhaustivenessCheck)(t)}}},709856:(e,t,r)=>{"use strict";r.d(t,{handler:()=>c});var a=r(887757),s=r(692137),n=r(811129),i=r(701069),o=r(766278),u=r(607815),c=(e,t)=>{switch(t.type){case"UserCreatedFolder":var r=t.name,c=t.peerIds;return e.locks.newFolder?[]:(e.locks.newFolder=!0,[function(){var e=(0,s.default)(a.mark((function e(t){var s,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.createFolder",{name:r,included_peer_ids:c.join(",")});case 4:return i=e.sent,e.abrupt("return",{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!1,peerIds:c,name:r,folderId:n.resolveId(i.folder_id)});case 8:return e.prev=8,e.t0=e.catch(1),e.t0 instanceof u.IApi.RequestError&&(o=e.t0.code),e.abrupt("return",{type:"UserCreatedFolder_CreateRequestCompleted",hasFailed:!0,name:r,error:o});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserCreatedFolder_CreateRequestCompleted":var d=t.hasFailed;if(e.locks.newFolder=!1,d){if(t.error);else if(i.isDev)throw new Error("Не удалось создать папку");return[]}var l=(0,o.insertFolders)(e,[{id:t.folderId,name:t.name}]),p=(0,o.getConvosByIds)(e,t.peerIds);return(0,o.addConvosToFolder)(e,t.folderId,p),l[0]&&n.setHasMore(l[0],"all",!1),[];default:(0,i.exhaustivenessCheck)(t)}}},238794:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(811129),i=r(658265),o=r(701069);function u(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var d=(e,t)=>{switch(t.type){case"UserDeletedFolder":var r=t.folderId;if(e.locks.deleteFolder.has(r))return[];e.locks.deleteFolder.add(r),n.deleteFolder(e.organisers.folders,r);for(var c,d=u(e.convos.values());!(c=d()).done;){var l=c.value;i.removeFolder(l,r)}return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.deleteFolder",{folder_id:r});case 4:return n=e.sent,e.abrupt("return",{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:1!==n,folderId:r});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserDeletedFolder_DeleteRequestCompleted",hasFailed:!0,folderId:r});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserDeletedFolder_DeleteRequestCompleted":var p=t.hasFailed,h=t.folderId;if(e.locks.deleteFolder.delete(h),p&&o.isDev)throw new Error("Не удалось удалить папку");return[];default:(0,o.exhaustivenessCheck)(t)}}},497859:(e,t,r)=>{"use strict";r.d(t,{handler:()=>h});var a=r(722122),s=r(887757),n=r(692137),i=r(630730),o=r(701069),u=r(210746),c=r(658265),d=r(194739),l=r(529122),p=r(766278),h=(e,t)=>{switch(t.type){case"UserHideFilter":if("archive"===t.kind){var r=(0,u.current)(e),h=r.organisers,f=r.ownerId;return h.filters.archive.hasMore&&(e.locks.hideFilter.archive=!0),[function(){var e=(0,n.default)(s.mark((function e(t){var r,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,h.filters.archive.hasMore){e.next=3;break}return e.abrupt("return",{type:"UserHideFilter_Completed",kind:"archive"});case 3:return e.prev=3,e.next=6,v(h.filters.archive,r,f);case 6:return a=e.sent,e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",hasFailed:!1,response:a,nextAction:{type:"UserHideFilter_Completed",kind:"archive"}});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",hasFailed:!0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()]}return"businessNotify"===t.kind?e.organisers.filters.businessNotify.unreadCount>0?[]:[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("business-notify-manually-hidden",!0),e.abrupt("return",{type:"UserHideFilter_Completed",kind:"businessNotify"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]:"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,o.exhaustivenessCheck)(t.kind);case"LoadArchiveConvos_RequestCompleted":if(t.hasFailed)return[];var m=t.response,g=t.nextAction,y=(0,p.insertConvos)(e,m.items);return(0,p.insertPeers)(e,{apiUsers:m.profiles||[],apiGroups:m.groups||[],apiContacts:m.contacts||[]}),i.push(e.organisers.filters,"archive",y,!1),[(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g);case 1:case"end":return e.stop()}}),e)})))];case"UserHideFilter_Completed":return"archive"===t.kind?(e.locks.hideFilter.archive=!1,i.toggleArchiveVisibility(e.organisers.filters,!1),[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("archive-manually-hidden",!0),e.abrupt("return",{type:"ActualizeArchiveMentions",undoHideOnNewMention:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"businessNotify"===t.kind?(i.toggleBusinessNotifyVisibility(e.organisers.filters,!1),[]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,o.exhaustivenessCheck)(t.kind);case"UserUndoHideFilter":return"archive"===t.kind?(i.toggleArchiveVisibility(e.organisers.filters,!0),[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("archive-manually-hidden",!1),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"businessNotify"===t.kind?(i.toggleBusinessNotifyVisibility(e.organisers.filters,!0),[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("business-notify-manually-hidden",!1),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]):"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,o.exhaustivenessCheck)(t.kind);case"UserActualizeHideFilter":if("archive"===t.kind){var C=(0,u.current)(e.organisers.filters.archive).isHidden;return[function(){var e=(0,n.default)(s.mark((function e(t){var r,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,!(a=r.get("archive-manually-hidden"))||C){e.next=4;break}return e.abrupt("return",{type:"UserHideFilter",kind:"archive"});case 4:if(a||!C){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"archive"});case 6:return e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"ActualizeArchiveMentions",undoHideOnNewMention:!0});case 1:case"end":return e.stop()}}),e)})))]}if("businessNotify"===t.kind){var k=e.organisers.filters.businessNotify.unreadCount,b=e.organisers.filters.businessNotify.isHidden;return[function(){var e=(0,n.default)(s.mark((function e(t){var r,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.storage,!(a=r.get("business-notify-manually-hidden"))||b){e.next=4;break}return e.abrupt("return",{type:"UserHideFilter",kind:"businessNotify"});case 4:if(a||!b){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 6:if(0!==k){e.next=8;break}return e.abrupt("return",{type:"Noop"});case 8:return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}return"all"===t.kind||"unread"===t.kind||"chats"===t.kind||"messageRequest"===t.kind?[]:(0,o.exhaustivenessCheck)(t.kind);case"ActualizeArchiveMentions":if(e.organisers.filters.archive.hasMore){var _=(0,u.current)(e),I=_.organisers,w=_.ownerId;return[function(){var e=(0,n.default)(s.mark((function e(r){var a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.api,e.prev=1,e.next=4,v(I.filters.archive,a,w);case 4:return n=e.sent,e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",hasFailed:!1,response:n,nextAction:{type:"ActualizeArchiveMentions",undoHideOnNewMention:t.undoHideOnNewMention}});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"LoadArchiveConvos_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]}var M=[...e.organisers.filters.archive.peerIds].map((t=>c.safeGet(e.convos,t))).reduce(((e,t)=>{if("ChatConvo"!==t.kind||!t.unreadMentions.size)return e;var r=d.resolveCmid(Math.max(...t.unreadMentions));return(0,a.default)({},e,{[t.peerId]:r})}),{});return[function(){var e=(0,n.default)(s.mark((function e(r){var a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.storage,n=a.get("archive-mentions-map")||{},a.set("archive-mentions-map",M),!Object.entries(M).some((e=>{var t=e[0];return e[1]!==n[l.resolveId(Number(t))]}))||!t.undoHideOnNewMention){e.next=6;break}return e.abrupt("return",{type:"UserUndoHideFilter",kind:"archive"});case 6:return e.abrupt("return",{type:"Noop"});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];default:(0,o.exhaustivenessCheck)(t)}};function v(e,t,r){return t.fetch("messages.getConversations",{filter:"archive",count:e.totalCount,extended:1,group_id:(0,p.getOwnerGroupId)(r)})}},247373:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(701069),i=r(228450),o=r(766278),u=(e,t)=>{switch(t.type){case"UserHitEdit":var r=t.mid,u=t.text,c=t.attaches,d=t.peerId,l=t.keepForwarded,p=t.keepSnippets,h=e.convos.get(d),v=e.ownerId;if(!h)return[];e.locks.edit.add(d);var f=i.ids(c).join(",");return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n,i,h;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,n=!1,e.prev=2,e.next=5,s.fetch("messages.edit",{message_id:r,peer_id:d,message:u,attachment:0===f.length?void 0:f,group_id:(0,o.getOwnerGroupId)(v),keep_forward_messages:l?1:0,keep_snippets:p?1:0,lat:null==(i=c.geo)?void 0:i.coordinates.latitude,long:null==(h=c.geo)?void 0:h.coordinates.longitude});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),n=!0;case 10:return e.abrupt("return",{type:"UserHitEdit_RequestCompleted",peerId:d,hasFailed:n});case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()];case"UserHitEdit_RequestCompleted":var m=t.peerId;t.hasFailed;e.locks.edit.delete(m);e.convos.get(m);return[];default:return(0,n.exhaustivenessCheck)(t)}}},291998:(e,t,r)=>{"use strict";r.d(t,{handler:()=>v});var a=r(887757),s=r(722122),n=r(692137),i=r(210746),o=r(701069),u=r(194739),c=r(658265),d=r(228450),l=r(545450),p=r(766278),h=r(616963),v=(e,t,r)=>{switch(t.type){case"UserHitSend":var a=t.peerId,s=e.convos.get(a);return s?(c.clearAfterGap(s),function(e,t){for(var r=e.text,a=e.attaches,s=e.peerId,n=e.timestamp,i=e.expireTTL,o=e.deleteTTL,c=e.entrypoint,d=e.extra,l=e.reply,p=e.forwarded,v=function(e){var t=e.length;if(t<h.MAX_MESSAGE_SIZE)return[e];for(var r=[],a=0,s=0;s<Math.ceil(t/h.MAX_MESSAGE_SIZE);s++){var n=e.substring(a,a+h.MAX_MESSAGE_SIZE).lastIndexOf(" "),i=-1===n?h.MAX_MESSAGE_SIZE:n,o=t-a<=h.MAX_MESSAGE_SIZE?e.substring(a):e.substring(a,a+i);a+=o.length,r.push(o)}return r.map((e=>e.trim()))}(r),f=function(e){var t=Object.values(e).flat(),r=Object.fromEntries(Object.entries(e).map((e=>{var t=e[0],r=e[1];return Array.isArray(r)?[r[0].kind,t]:[r.kind,t]})));if(t.length<=h.MAX_MESSAGE_ATTACHES)return[e];return t.reduce(((e,t,a)=>{var s,n=Math.floor(a/h.MAX_MESSAGE_ATTACHES),i=r[t.kind];return i?(e[n][i]=(null==(s=e[n][i])?void 0:s.concat(t))||[t],e):e}),Array(Math.ceil(t.length/h.MAX_MESSAGE_ATTACHES)).fill("").map(Object))}(a),m=v.length+f.length-1,g=[],y=0;y<m;y++){var C=v[y]||"",k=f[y-v.length+1]||{},b=u.newQueued({peerId:s,text:C,isOut:!0,sentAt:n+y,authorId:t,attaches:k,expireTTL:i,deleteTTL:o,extra:d,entrypoint:c},0===y?l:void 0,y===m-1?p:void 0);g.push(b)}return g}(t,e.ownerId).flatMap((t=>{var r,a,n,i;c.appendQueuedMessage(s,t);var o=e.locks.sendQueue.get(s.peerId);return o?(o.add(t.randomId),[]):(e.locks.sendQueue.set(s.peerId,new Set([t.randomId])),t.attaches.sticker&&(e.recentStickers=[t.attaches.sticker.id,...e.recentStickers.filter((e=>{var r;return e!==(null==(r=t.attaches.sticker)?void 0:r.id)}))].slice(0,l.MAX_RECENT_STICKERS)),[f(t.peerId,t.randomId,t.text,d.ids(t.attaches),t.extra,t.entrypoint,t.attaches.geo,(0,p.getOwnerGroupId)(e.ownerId),null!=(r=null==(a=t.replyMessage)?void 0:a.id)?r:null,null!=(n=null==(i=t.forwardedMessages)?void 0:i.map((e=>e.id)))?n:null)])}))):[];case"UserHitSend_RequestCompleted":var n,m,g,y,C=t.peerId,k=t.randomId,b=t.hasFailed,_=e.convos.get(C),I=e.ownerId;if(!_)return e.locks.sendQueue.delete(C),[];b&&c.updateSendingFail(_,k,b);var w=e.locks.sendQueue.get(_.peerId);if(!w)return[];w.delete(k);var M=[...w][0];if(!M)return e.locks.sendQueue.delete(C),[];var S=_.queued.get(M);if(!S)return[];var R=(0,i.current)(S);return[f(C,R.randomId,R.text,d.ids(R.attaches),R.extra,R.entrypoint,R.attaches.geo,(0,p.getOwnerGroupId)(I),null!=(n=null==(m=R.replyMessage)?void 0:m.id)?n:null,null!=(g=null==(y=R.forwardedMessages)?void 0:y.map((e=>e.id)))?g:null)];case"UserHitResendFailedMessage":var E,x,A,U,P=t.randomId,T=t.peerId,O=t.entrypoint,F=e.convos.get(T),N=e.ownerId;if(!F)return[];var q=F.queued.get(P);if(!q)return[];c.updateSendingFail(F,P,!1),c.changeQueuedMessageEntrypoint(F,P,O);var L=e.locks.sendQueue.get(F.peerId);if(L)return L.add(q.randomId),[];e.locks.sendQueue.set(F.peerId,new Set([q.randomId]));var D=(0,i.current)(q);return[f(T,D.randomId,D.text,d.ids(D.attaches),D.extra,O,D.attaches.geo,(0,p.getOwnerGroupId)(N),null!=(E=null==(x=D.replyMessage)?void 0:x.id)?E:null,null!=(A=null==(U=D.forwardedMessages)?void 0:U.map((e=>e.id)))?A:null)];case"UserHitResendAllFailedMessages":var H=t.peerId,B=t.entrypoint,G=e.convos.get(H);return G?c.allQueuedMessages(G).filter((e=>e.hasFailed)).flatMap((t=>v(e,{type:"UserHitResendFailedMessage",peerId:H,randomId:t.randomId,entrypoint:B||t.entrypoint},r))):[];case"ResendAllFailedMessages":return Array.from(e.convos.values()).flatMap((t=>v(e,{type:"UserHitResendAllFailedMessages",peerId:t.peerId},r)));case"UserHitSendWidget":var j=t.peerId,V=t.text,z=t.timestamp,W=t.entrypoint,K=t.extra;if(e.convos.get(j))return v(e,{type:"UserHitSend",attaches:{},extra:K,entrypoint:W,text:V,peerId:j,timestamp:z},r);var $=u.newQueued({peerId:j,text:V,isOut:!0,sentAt:z,authorId:e.ownerId,attaches:{},extra:K,entrypoint:W});return[f($.peerId,$.randomId,$.text,d.ids($.attaches),$.extra,$.entrypoint,$.attaches.geo,(0,p.getOwnerGroupId)(e.ownerId),null,null)];default:return(0,o.exhaustivenessCheck)(t)}};function f(e,t,r,i,o,u,c,d,l,p){return function(){var h=(0,n.default)(a.mark((function n(h){var v,f,m,g;return a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return v=h.api,f=!1,m={},o.sticker&&(m.sticker_id=o.sticker.id,m.sticker_referrer=o.sticker.referrer),o.botPayload&&(m.payload=o.botPayload),o.silent&&(m.silent=1),o.expiresIn&&(m.expire_ttl=o.expiresIn),c&&(m.lat=c.coordinates.latitude,m.long=c.coordinates.longitude),a.prev=8,a.next=11,v.fetch("messages.send",(0,s.default)({},m,{peer_id:e,random_id:t,message:r,reply_to:null!=l?l:void 0,forward_messages:null!=(g=null==p?void 0:p.join(","))?g:void 0,attachment:0===i.length?void 0:i.join(","),entrypoint:u,group_id:d}));case 11:a.next=16;break;case 13:a.prev=13,a.t0=a.catch(8),f=!0;case 16:return a.abrupt("return",{type:"UserHitSend_RequestCompleted",peerId:e,randomId:t,hasFailed:f});case 17:case"end":return a.stop()}}),n,null,[[8,13]])})));return function(e){return h.apply(this,arguments)}}()}},66572:(e,t,r)=>{"use strict";r.d(t,{handler:()=>v});var a=r(887757),s=r(722122),n=r(692137),i=r(701069),o=r(10122),u=r(897181),c=r(298258),d=r(529122),l=r(616963),p=r(766278),h={UserChangedLike:"UserChangedLike",UserChangedLike_RequestCompleted:"UserChangedLike",UserLoadedLikes:"UserLoadedLikes",UserLoadedLikes_RequestCompleted:"UserLoadedLikes"},v=(e,t,r)=>{var m,g,y;switch(t.kind){case"comment":var C=t.channelId,k=t.postCmid,b=t.commentCmid,_=t.replyCmid,I=e.channels.get(C),w=I&&o.findPostByCmid(I,k),M="Normal"===(null==w?void 0:w.kind)&&u.findCommentByCmid(w,b);if(!M||"Normal"!==M.kind)break;if(m=M.channelId,_){var S=c.findReplyByCmid(M,_);if(!S||"Normal"!==S.kind)break;y=S,g=S.cmid;break}y=M,g=M.cmid;break;case"post":var R=t.channelId,E=t.postCmid,x=e.channels.get(R),A=x&&o.findPostByCmid(x,E);if(!A||"Normal"!==A.kind)break;m=A.channelId,g=A.cmid,y=A;break;default:(0,i.exhaustivenessCheck)(t)}if(!y||!m||!g)return[];var U=f(h[t.type],t.kind,m,g);switch(t.type){case"UserLoadedLikes":if(e.locks.likeActions.has(U))return[];var P;switch(e.locks.likeActions.add(U),t.kind){case"comment":case"post":P=y.likes.peerIds.size;break;default:(0,i.exhaustivenessCheck)(t)}var T=0===y.likes.peerIds.size?l.LIKE_PEERS_FIRST_LOAD:l.LIKE_PEERS_PER_PAGE;return[function(){var e=(0,n.default)(a.mark((function e(r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch("likes.getList",{type:t.kind,owner_id:m,item_id:g,extended:1,skip_own:1,count:T,offset:P});case 4:return i=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"UserLoadedLikes_RequestCompleted",response:i,hasFailed:!1}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"UserLoadedLikes_RequestCompleted",hasFailed:!0}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserLoadedLikes_RequestCompleted":var O=t.hasFailed,F=t.response;if(e.locks.likeActions.delete(U),O||!F)return[];var N=F.items.filter((e=>"profile"===e.type)),q=F.items.filter((e=>"group"===e.type)),L=F.items.map((e=>d.resolveId(e.id)));switch((0,p.insertPeers)(e,{apiUsers:N,apiGroups:q,apiContacts:[]}),t.kind){case"comment":case"post":L.forEach((e=>{var t;return null==(t=y)?void 0:t.likes.peerIds.add(e)}));break;default:(0,i.exhaustivenessCheck)(t)}return[];case"UserChangedLike":var D=t.reactionId,H=y.likes.reactionId;if(H===D)return[];var B=void 0!==H;return e.locks.likeActions.has(U)?[]:(e.locks.likeActions.add(U),void 0===D?y.likes.count-=1:B||(y.likes.count+=1),y.likes.reactionId=D,[function(){var e=(0,n.default)(a.mark((function e(r){var n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.api,e.prev=1,e.next=4,n.fetch(B&&void 0===D?"likes.delete":"likes.add",{type:t.kind,owner_id:m,item_id:g||0,reaction_id:D});case 4:return i=e.sent,e.abrupt("return",(0,s.default)({},t,{type:"UserChangedLike_RequestCompleted",response:i,hasFailed:!1}));case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",(0,s.default)({},t,{type:"UserChangedLike_RequestCompleted",hasFailed:!0,prevReactionId:H}));case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserChangedLike_RequestCompleted":var G=t.hasFailed,j=t.response,V=t.prevReactionId;return e.locks.likeActions.delete(U),G||!j?(v(e,(0,s.default)({},t,{type:"UserChangedLike",reactionId:V}),r),e.locks.likeActions.delete(U),[]):(y.likes.count=j.likes,[]);default:(0,i.exhaustivenessCheck)(t)}},f=(e,t,r,a)=>`${e}-${t}-${r}-${a}`},312265:(e,t,r)=>{"use strict";r.d(t,{handler:()=>p,getCommentsHistoryLockKey:()=>h});var a=r(887757),s=r(692137),n=r(701069),i=r(10122),o=r(897181),u=r(298258),c=r(766278),d=r(616963),l=r(374830),p=(e,t)=>{switch(t.type){case"UserLoadedCommentsHistory":var r=t.channelId,p=t.postCmid,v=t.startCmid,f=t.commentCmid,m=t.order,g=h(r,p,f);if(e.locks.getPostCommentsHistory.has(g))return[];e.locks.getPostCommentsHistory.add(g);var y=e.channels.get(r);if(!y)return[];var C,k=i.findPostByCmid(y,p);if(!k||"Normal"!==k.kind)return[];if(f&&!o.findCommentByCmid(k,f))return[];switch(m){case"interesting":C="smart";break;case"new":C="desc";break;case"old":C="asc";break;default:(0,n.exhaustivenessCheck)(m)}return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("wall.getComments",{owner_id:r,post_id:p,count:d.COMMENTS_PER_PAGE,sort:C,thread_items_count:d.THREAD_COMMENTS_COUNT,need_likes:1,extended:1,start_comment_id:v,comment_id:f||void 0,offset:v?1:0});case 4:return n=e.sent,e.abrupt("return",{type:"UserLoadedCommentsHistory_RequestSucceed",channelId:r,response:n,postCmid:p,order:m,commentCmid:f});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserLoadedCommentsHistory_RequestFailed",channelId:r,postCmid:p,commentCmid:f,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserLoadedCommentsHistory_RequestSucceed":var b=t.response,_=t.channelId,I=t.postCmid,w=t.commentCmid,M=t.order;e.locks.getPostCommentsHistory.delete(h(_,I,w));var S=e.channels.get(_);if(!S)return[];var R=i.findPostByCmid(S,I);if(!R||"Normal"!==R.kind)return[];var E=b.items.map((e=>(0,l.fromApiComment)(e)));if(M!==R.comments.order&&o.changeCommentsOrder(R,M),w){var x=o.findCommentByCmid(R,w);if(!x)return[];u.insertReplies(x,E),x.replies.count=b.current_level_count||x.replies.count}else o.insertComments(R,E,b.current_level_count||0),R.comments.count=b.count,R.comments.oneLevelCount=b.current_level_count||R.comments.oneLevelCount;return(0,c.insertPeers)(e,{apiUsers:b.profiles||[],apiGroups:b.groups||[],apiContacts:[]}),[];case"UserLoadedCommentsHistory_RequestFailed":var A=t.channelId,U=t.postCmid,P=t.commentCmid;return e.locks.getPostCommentsHistory.delete(h(A,U,P)),[];default:return(0,n.exhaustivenessCheck)(t)}},h=(e,t,r)=>`${e}-${t}-${r||""}`},694212:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(692137),n=r(906978),i=r(10122),o=r(857085),u=r(701069),c=r(607815),d=r(766278),l=(e,t)=>{switch(t.type){case"UserOpenedChannel":var r=t.channelId,l=e.locks.channelsCleanup.get(r)||0;return e.locks.channelsCleanup.set(r,l+1),e.channels.get(r)?[]:[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("channels.getById",{channel_ids:r.toString(),extended:1},{retries:2});case 4:return n=e.sent,e.abrupt("return",{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:r,response:n,hasFailed:!1});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedChannel_ChannelRequestCompleted",channelId:r,hasFailed:!0,errCode:e.t0 instanceof c.IApi.RequestError?e.t0.code:void 0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedChannel_ChannelRequestCompleted":var p=t.hasFailed,h=t.channelId,v=t.response,f=t.errCode;if(p&&f===n.API_ERROR_ACCESS)return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"ChannelRoute",channelId:h,accessDenied:!0}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];if(!v)return[];(0,d.insertChannels)(e,{apiChannels:v.items||[],apiGroups:v.groups||[]});var m=e.channels.get(h);if(!m){if(u.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"ChannelsListRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}return m.isMember&&o.refreshChannels(e.organisers,m),[];case"UserClosedChannel":var g=t.channelId,y=e.locks.channelsCleanup.get(g);if(y&&y>1)return e.locks.channelsCleanup.set(g,y-1),[];var C=e.channels.get(g);return C?(i.cleanup(C),[]):[];default:return(0,u.exhaustivenessCheck)(t)}}},339183:(e,t,r)=>{"use strict";r.d(t,{handler:()=>h});var a=r(887757),s=r(692137),n=r(766278),i=r(664902),o=r(529122),u=r(658265),c=r(857085),d=r(616963),l=r(701069),p=r(466315),h=(e,t,r)=>{switch(t.type){case"LoadChatMembers":return[];case"UserOpenedConvo":var f=t.peerId,m=t.cmid,g=e.convos.get(f),y=e.locks.convosCleanup.get(f)||0;e.locks.convosCleanup.set(f,y+1);var C=(0,n.getOwnerGroupId)(e.ownerId);return g?h(e,{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:f,cmid:m,hasFailed:!1},r):[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getConversationsById",{peer_ids:f.toString(),group_id:C,extended:1},{retries:3});case 4:return s=e.sent,e.abrupt("return",{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:f,cmid:m,hasFailed:!1,profiles:s.profiles,groups:s.groups,conversations:s.items,contacts:s.contacts});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvo_ConvoRequestCompleted",peerId:f,hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedConvo_ConvoRequestCompleted":var k=t.peerId,b=t.conversations,_=t.profiles,I=t.cmid,w=t.groups,M=t.contacts;if(t.hasFailed){if(l.isDev)throw new Error("Не удалось загрузить диалог");return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}(0,n.insertConvos)(e,b||[]),(0,n.insertPeers)(e,{apiUsers:_||[],apiGroups:w||[],apiContacts:M||[]});var S=e.convos.get(k);if(!S){if(l.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,s.default)(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var R=S.isMarkedUnread&&0===S.unreadCount;R&&u.markRead(S),c.refresh(e.organisers,S);var E="ChatConvo"===S.kind&&void 0===S.members&&u.canReadMembers(S)&&!e.locks.getConversationMembers.has(k);E&&e.locks.getConversationMembers.add(k);var x=void 0!==I&&!u.canShowAround(S,I),A=x||(r.vkm_convo_new_history_load?!u.canShowAround(S,S.inReadBy):u.length(S).persisted<d.MESSAGES_PER_PAGE)&&S.hasMore&&!e.locks.getHistory.has(S.peerId);A&&e.locks.getHistory.add(S.peerId);var U=Object.values(r.me_sticker_packs).flat(),P=S.unreadCount>0,T=!e.locks.getStickerPacks;T&&(e.locks.getStickerPacks=!0);var O=(0,n.getOwnerGroupId)(e.ownerId);return[E&&o.isChatPeerId(k)&&function(){var e=(0,s.default)(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:k});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T&&function(){var e=(0,s.default)(a.mark((function e(t){var s,n,i,o,u,c,d,l,p,h;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,n=t.storage,e.prev=1,i={retries:10},e.next=5,Promise.all([s.fetch("store.getProducts",{type:"stickers",filters:"active",extended:1},i),v({api:s,storage:n,featureFlags:r})]);case 5:return o=e.sent,u=o[0],c=o[1],e.next=10,s.fetchMany([{method:"store.getFavoriteStickers",params:{}},{method:"messages.getRecentStickers",params:{group_id:O}},U.length>0&&{method:"store.getStickers",params:{sticker_ids:U.join()}}],{retries:10});case 10:return d=e.sent,l=d[0],p=d[1],h=d[2],e.abrupt("return",{type:"UserOpenedConvo_StickersLoadRequestSucceed",favoriteStickersResponse:l,recentStickersResponse:p,stickerPacksResponse:u,helloStickersResponse:h,stickersKeywordsResponse:c});case 17:return e.prev=17,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvo_StickersLoadRequestFailed"});case 20:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t){return e.apply(this,arguments)}}(),R&&function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.markAsRead",{peer_id:k,mark_conversation_as_read:1,group_id:O});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"Noop"});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}(),A&&function(){var e=(0,s.default)(a.mark((function e(t){var r,s,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.api,e.t0=!0,e.next=e.t0===x?4:e.t0===P?7:10;break;case 4:return s=d.MESSAGES_PER_PAGE,n=-(Math.floor(d.MESSAGES_PER_PAGE/2)-1),e.abrupt("break",12);case 7:return s=Math.floor(1.25*d.MESSAGES_PER_PAGE),n=-d.MESSAGES_PER_PAGE,e.abrupt("break",12);case 10:s=d.MESSAGES_PER_PAGE,n=0;case 12:return e.prev=12,e.next=15,r.fetch("messages.getHistory",{peer_id:k,start_cmid:x?I:-1,count:s,offset:n,extended:1,group_id:O},{retries:5,timeout:2e4});case 15:return i=e.sent,e.abrupt("return",{type:"UserOpenedConvo_HistoryRequestSucceed",peerId:k,hasMore:x||i.items.length>=s+n,response:i});case 19:return e.prev=19,e.t1=e.catch(12),e.abrupt("return",{type:"UserOpenedConvo_HistoryRequestFailed",peerId:k});case 22:case"end":return e.stop()}}),e,null,[[12,19]])})));return function(t){return e.apply(this,arguments)}}()];case"UserClosedConvo":if((y=e.locks.convosCleanup.get(t.peerId))&&y>1)return e.locks.convosCleanup.set(t.peerId,y-1),[];e.locks.convosCleanup.delete(t.peerId);var F=e.convos.get(t.peerId);return F?(u.cleanup(F),[]):[];case"UserOpenedConvo_HistoryRequestSucceed":var N=t.peerId,q=t.response,L=t.hasMore;e.locks.getHistory.delete(N);var D=e.convos.get(N);if(!D)return[];var H=q.items.map((e=>(0,i.fromApiMessage)(e).message));return u.insertMessages(D,H,L),(0,n.insertPeers)(e,{apiUsers:q.profiles||[],apiGroups:q.groups||[],apiContacts:[]}),[];case"UserOpenedConvo_HistoryRequestFailed":return e.locks.getHistory.delete(t.peerId),[];case"UserOpenedConvo_StickersLoadRequestSucceed":var B,G,j,V=t.stickerPacksResponse,z=t.helloStickersResponse,W=t.favoriteStickersResponse,K=t.recentStickersResponse,$=t.stickersKeywordsResponse,Q=new Map;null==(B=V.items)||B.forEach((t=>{var r=(0,p.fromApiStickerPack)(t);if(r){var a=r.stickerPack,s=r.stickers;Q.set(a.id,a),s.forEach((t=>{e.stickers.set(t.id,t)}))}})),e.stickerPacks=Q,e.stickersKeywords=(0,p.fromApiStickersKeywords)($);var X=t=>{var r=(0,p.fromApiSticker)(t);if(r)return e.stickers.set(r.id,r),r.id};return null==z||z.forEach(X),e.favoriteStickers=[],null==(G=W.items)||G.forEach((t=>{var r=X(t);r&&e.favoriteStickers.push(r)})),e.recentStickers=[],null==(j=K.items)||j.forEach((t=>{var r=X(t);r&&e.recentStickers.push(r)})),[function(){var e=(0,s.default)(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.sleep)(d.STICKERS_REFRESH_INTERVAL);case 2:return e.abrupt("return",{type:"UserOpenedConvo_StickersRefreshThrottleTimedOut"});case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()];case"UserOpenedConvo_StickersRefreshThrottleTimedOut":case"UserOpenedConvo_StickersLoadRequestFailed":return e.locks.getStickerPacks=!1,[];default:return(0,l.exhaustivenessCheck)(t)}};function v(e){return f.apply(this,arguments)}function f(){return(f=(0,s.default)(a.mark((function e(t){var r,s,n,i,o,u,c,d;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,s=t.storage,n=t.featureFlags,e.next=3,s.getIDB("stickers-keywords");case 3:if(i=e.sent,o=Math.round((new Date).getTime()/1e3),u=86400,!(c=i&&i.expiresAt>o)){e.next=11;break}e.t0=i.response,e.next=14;break;case 11:return e.next=13,r.fetch("store.getStickersKeywords",{need_stickers:0,all_products:n.vkm_send_promoted_stickers?1:0},{retries:3});case 13:e.t0=e.sent;case 14:if(d=e.t0,c){e.next=18;break}return e.next=18,s.setIDB("stickers-keywords",{response:d,expiresAt:o+u}).catch((()=>{}));case 18:return e.abrupt("return",d);case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},261041:(e,t,r)=>{"use strict";r.d(t,{handler:()=>p});var a=r(722122),s=r(887757),n=r(692137),i=r(529122),o=r(10122),u=r(701069),c=r(766278),d=r(658265),l=r(38099),p=(e,t,r)=>{switch(t.type){case"LoadChatMembers":return[];case"UserOpenedConvoProfile":var h=t.peerId,v=t.isLinkWithHistory,f=e.convos.get(h),m="edu"===e.viewer.profileType,g=o.isChannelId(h),y=o.resolveId(h),C=g?e.channels.get(y):null,k=e.ownerId;return!f||r.vkm_convo_profile&&g&&!C?[function(){var e=(0,n.default)(s.mark((function e(t){var a,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.api,e.prev=1,f){e.next=6;break}return e.next=5,a.fetch("messages.getConversationsById",{peer_ids:h.toString(),extended:1,group_id:(0,c.getOwnerGroupId)(k)},{retries:3});case 5:n=e.sent;case 6:if(!r.vkm_convo_profile||!g||C||m){e.next=10;break}return e.next=9,a.fetch("channels.getById",{channel_ids:y.toString(),extended:1},{retries:2});case 9:i=e.sent;case 10:return e.abrupt("return",{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:h,hasFailed:!1,convoResponse:n,channelResponse:i,isLinkWithHistory:v});case 13:return e.prev=13,e.t0=e.catch(1),e.abrupt("return",{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:h,hasFailed:!0,isLinkWithHistory:v});case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}()]:p(e,{type:"UserOpenedConvoProfile_ConvoRequestCompleted",peerId:h,hasFailed:!1,isLinkWithHistory:v},r);case"UserOpenedConvoProfile_ConvoRequestCompleted":var b=t.peerId,_=t.channelId,I=t.convoResponse,w=t.channelResponse,M=t.hasFailed,S=t.isLinkWithHistory,R=e.ownerId;if(M){if(u.isDev)throw new Error("Не удалось загрузить диалог");return[(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"Noop"});case 1:case"end":return e.stop()}}),e)})))]}I&&((0,c.insertConvos)(e,I.items||[]),(0,c.insertPeers)(e,{apiUsers:I.profiles||[],apiGroups:I.groups||[],apiContacts:I.contacts||[]})),w&&((0,c.insertChannels)(e,{apiChannels:w.items||[],apiGroups:w.groups||[]}),(0,c.insertPeers)(e,{apiUsers:w.profiles||[],apiGroups:w.groups||[],apiContacts:[]}));var E=e.convos.get(b);if(!E){if(u.isDev)throw new Error("Диалог не был найден");return[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}if(_)if(!e.channels.get(_)){if(u.isDev)throw new Error("Канал не был найден");return[function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.router.replace({kind:"MainRoute"}),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]}var x="ChatConvo"===E.kind&&void 0===E.members&&d.canReadMembers(E)&&!e.locks.getConversationMembers.has(b);x&&e.locks.getConversationMembers.add(b);var A="ChatConvo"===E.kind&&E.acl.canSeeInviteLink;return[x&&i.isChatPeerId(b)&&function(){var e=(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadChatMembers",peerId:b});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A&&i.isChatPeerId(b)&&function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.t0=b,e.t1=S,e.next=6,r.fetch("messages.getInviteLink",{peer_id:b,visible_messages_count:S?l.VISIBLE_MESSAGES_COUNT:0,reset:0,group_id:(0,c.getOwnerGroupId)(R)},{retries:1});case 6:return e.t2=e.sent,e.abrupt("return",{type:"UserOpenedConvoProfile_InviteLinksCompleted",peerId:e.t0,isLinkWithHistory:e.t1,response:e.t2});case 10:e.prev=10,e.t3=e.catch(1);case 12:return e.abrupt("return",{type:"Noop"});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()];case"UserOpenedConvoProfile_InviteLinksCompleted":var U=t.peerId,P=t.response.link,T=t.isLinkWithHistory,O=e.convos.get(U);return O&&"ChatConvo"===O.kind&&P?(d.replaceInviteLinks(O,(0,a.default)({},O.inviteLinks,{},T?{withHistory:P}:{noHistory:P})),[]):[];default:(0,u.exhaustivenessCheck)(t)}}},33742:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(194739),i=r(701069),o=r(766278),u=(e,t)=>{switch(t.type){case"UserPlayedMessage":var r=t.cmid,u=t.peerId,c=e.convos.get(u),d=null==c?void 0:c.persisted.get(r),l=e.ownerId;return"Normal"===(null==d?void 0:d.kind)&&n.canChangeMessagePlayedStatus(d)?[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.markAsPlayed",{peer_id:u,cmid:r,group_id:(0,o.getOwnerGroupId)(l)},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"UserPlayedMessage_RequestCompleted",hasFailed:1!==n,cmid:r,peerId:u});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserPlayedMessage_RequestCompleted",hasFailed:!0,cmid:r,peerId:u});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]:[];case"UserPlayedMessage_RequestCompleted":if(!t.hasFailed){var p=t.cmid,h=t.peerId,v=e.convos.get(h),f=null==v?void 0:v.persisted.get(p);if("Normal"!==(null==f?void 0:f.kind)||!n.canChangeMessagePlayedStatus(f))return[];f.isPlayed=!0}return[];default:(0,i.exhaustivenessCheck)(t)}}},134015:(e,t,r)=>{"use strict";r.d(t,{handler:()=>s});var a=r(701069),s=(e,t)=>{if("UserProfileInfo_Update"===t.type){var r=t.user,s=t.profileInfo;return s&&(e.viewer.profileInfo=s),r&&e.peers.set(r.id,r),[]}(0,a.exhaustivenessCheck)(t.type)}},362758:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(811129),i=r(701069),o=r(607815),u=(e,t)=>{switch(t.type){case"UserReorderedFolders":var r=t.order;return e.locks.reorderFolders?[]:(e.locks.reorderFolders=!0,n.reorderFolders(e.organisers.folders,r),[function(){var e=(0,s.default)(a.mark((function e(t){var s,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.reorderFolders",{folder_ids:r.join(",")});case 4:return n=e.sent,e.abrupt("return",{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:1!==n,order:r});case 8:return e.prev=8,e.t0=e.catch(1),e.t0 instanceof o.IApi.RequestError&&(i=e.t0.code),e.abrupt("return",{type:"UserReorderedFolders_ReorderRequestCompleted",hasFailed:!0,error:i,order:r});case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()]);case"UserReorderedFolders_ReorderRequestCompleted":var u=t.hasFailed;if(e.locks.reorderFolders=!1,u){if(t.error);else if(i.isDev)throw new Error("Не удалось изменить порядок папок");return[]}return[];default:(0,i.exhaustivenessCheck)(t)}}},38099:(e,t,r)=>{"use strict";r.d(t,{VISIBLE_MESSAGES_COUNT:()=>c,handler:()=>d});var a=r(722122),s=r(887757),n=r(692137),i=r(701069),o=r(658265),u=r(766278),c=250,d=(e,t)=>{switch(t.type){case"UserRequestChatInvitationLink":var r=t.peerId,d=t.isLinkWithHistory,l=e.ownerId;return[function(){var e=(0,n.default)(s.mark((function e(t){var a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.api,e.prev=1,e.next=4,a.fetch("messages.getInviteLink",{peer_id:r,reset:0,visible_messages_count:d?c:0,group_id:(0,u.getOwnerGroupId)(l)},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!n.link,link:n.link,isLinkWithHistory:d,peerId:r});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserRequestChatInvitationLink_RequestCompleted",hasFailed:!0,isLinkWithHistory:d,peerId:r});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserRequestChatInvitationLink_RequestCompleted":var p=t.peerId,h=t.link,v=t.isLinkWithHistory,f=t.hasFailed,m=e.convos.get(p);return!f&&m&&"ChatConvo"===m.kind&&h?(o.replaceInviteLinks(m,(0,a.default)({},m.inviteLinks,{},v?{withHistory:h}:{noHistory:h})),[]):[];case"UserResetChatInvitationLink":var g=t.peerId,y=e.ownerId;return[function(){var e=(0,n.default)(s.mark((function e(t){var r,a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getInviteLink",{peer_id:g,reset:1,visible_messages_count:c,group_id:(0,u.getOwnerGroupId)(y)},{retries:1});case 4:return a=e.sent,e.next=7,r.fetch("messages.getInviteLink",{peer_id:g,reset:0,visible_messages_count:0,group_id:(0,u.getOwnerGroupId)(y)},{retries:1});case 7:return n=e.sent,e.abrupt("return",{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!a.link||!n.link,links:{withHistory:a.link,noHistory:n.link},peerId:g});case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",{type:"UserResetChatInvitationLink_RequestCompleted",hasFailed:!0,peerId:g,links:{}});case 14:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()];case"UserResetChatInvitationLink_RequestCompleted":var C=t.peerId,k=t.links,b=t.hasFailed,_=e.convos.get(C);return b||"ChatConvo"!==(null==_?void 0:_.kind)?[]:k.noHistory&&k.withHistory?(o.replaceInviteLinks(_,k),[]):[];default:return(0,i.exhaustivenessCheck)(t)}}},303087:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(692137),n=r(701069),i=r(616963),o=r(10122),u=r(897181),c=r(766086),d=r(766278),l=(e,t)=>{switch(t.type){case"UserScrolledChannelHistory":var r=t.channelId,l=t.direction,p=t.startCmid,h=t.possibleSkipped,v=e.channels.get(r);if(!v)return[];if(e.locks.getChannelHistory.has(r))return[];e.locks.getChannelHistory.add(r);var f,m=Math.min(i.POSTS_PER_PAGE,h||i.POSTS_PER_PAGE)+2;switch(l){case"backward":f=0;break;case"forward":f=1-m;break;case"around":m=i.POSTS_PER_PAGE,f=-Math.floor(m/2),v.inReadCmid===p&&(f=Math.max(-v.unreadCount,f));break;default:(0,n.exhaustivenessCheck)(l)}return[function(){var e=(0,s.default)(a.mark((function e(t){var s,i,o;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("channels.getHistory",{channel_id:r,start_cmid:Math.max(p,1),count:m,offset:f,extended:1},{retries:5});case 4:i=e.sent,e.t0=l,e.next="backward"===e.t0?8:"around"===e.t0||"forward"===e.t0?10:12;break;case 8:return o=m===i.items.length,e.abrupt("break",13);case 10:return o=!0,e.abrupt("break",13);case 12:(0,n.exhaustivenessCheck)(l);case 13:return e.abrupt("return",{type:"UserScrolledChannelHistory_RequestSucceed",channelId:r,response:i,hasMore:o});case 16:return e.prev=16,e.t1=e.catch(1),e.abrupt("return",{type:"UserScrolledChannelHistory_RequestFailed",channelId:r});case 19:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}()];case"UserScrolledChannelHistory_RequestSucceed":var g=t.channelId,y=t.response,C=t.hasMore;e.locks.getChannelHistory.delete(g);var k=e.channels.get(g);if(!k)return[];var b=[];return y.items.reverse().forEach(((t,r,a)=>{var s=(0,c.fromApiPost)(t),n=s.post;s.reactions.forEach((t=>{e.reactions.set(t.id,t)})),0===r&&n.cmid>1&&C&&b.push({kind:"GapItem",fromCmid:u.resolveCmid(1),toCmid:u.resolveCmid(n.cmid-1)}),b.push({kind:"PostItem",post:n});var i=k.history[k.history.length-1];if(r===a.length-1&&i){var o="GapItem"===i.kind?i.toCmid:i.post.cmid;n.cmid<o&&b.push({kind:"GapItem",fromCmid:u.resolveCmid(n.cmid+1),toCmid:u.resolveCmid(o-("GapItem"===i.kind?0:1))})}})),o.insertPosts(k,b),(0,d.insertPeers)(e,{apiUsers:y.profiles||[],apiGroups:y.groups||[],apiContacts:[]}),[];case"UserScrolledChannelHistory_RequestFailed":var _=t.channelId;return e.locks.getChannelHistory.delete(_),[];default:return(0,n.exhaustivenessCheck)(t)}}},448669:(e,t,r)=>{"use strict";r.d(t,{handler:()=>d});var a=r(887757),s=r(692137),n=r(701069),i=r(616963),o=r(658265),u=r(664902),c=r(766278),d=(e,t)=>{switch(t.type){case"UserScrolledConvoHistory":var r=t.peerId,d=t.direction,l=e.ownerId,p=e.convos.get(r);if(!p)return[];if("end"===d)return o.cleanup(p),[];if(e.locks.getHistory.has(r))return[];if("forward"===d&&!o.hasGap(p))return[];if("backward"===d&&!p.hasMore)return[];e.locks.getHistory.add(t.peerId);var h=i.MESSAGES_PER_PAGE;switch(d){case"forward":var v=p.afterGapCmid,f=-h;return[function(){var e=(0,s.default)(a.mark((function e(t){var s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.t0=r,e.next=5,s.fetch("messages.getHistory",{peer_id:r,start_cmid:v,count:h,offset:f,extended:1,group_id:(0,c.getOwnerGroupId)(l)},{retries:5});case 5:return e.t1=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:e.t0,response:e.t1});case 9:return e.prev=9,e.t2=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:r});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}()];case"backward":var m=Math.min(...p.persisted.keys());m=Number.isFinite(m)?m:-1;return[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.getHistory",{peer_id:r,start_cmid:m,count:h,offset:0,extended:1,group_id:(0,c.getOwnerGroupId)(l)},{retries:5});case 4:return n=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:r,hasMore:n.items.length>=h+0,response:n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:r});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];default:return(0,n.exhaustivenessCheck)(d)}case"UserScrolledConvoHistoryToMessage":var g=t.peerId,y=t.cmid,C=e.convos.get(g),k=e.ownerId;if(!C)return[];if(o.isCmidInIterator(C,y))return[];o.clearAfterGap(C),e.locks.getHistory.add(t.peerId);var b=-(Math.floor(i.MESSAGES_PER_PAGE/2)-1),_=i.MESSAGES_PER_PAGE;return[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.getHistory",{peer_id:g,start_cmid:y,count:_,offset:b,extended:1,group_id:(0,c.getOwnerGroupId)(k)},{retries:5});case 4:return s=e.sent,e.abrupt("return",{type:"UserScrolledConvoHistory_RequestSucceed",peerId:g,hasMore:!0,response:s});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserScrolledConvoHistory_RequestFailed",peerId:g});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserScrolledConvoHistory_RequestSucceed":var I=t.peerId,w=t.response,M=t.hasMore;e.locks.getHistory.delete(I);var S=e.convos.get(I);if(!S)return[];var R=w.items.map((e=>(0,u.fromApiMessage)(e).message));return o.insertMessages(S,R,M),(0,c.insertPeers)(e,{apiUsers:w.profiles||[],apiGroups:w.groups||[],apiContacts:[]}),[];case"UserScrolledConvoHistory_RequestFailed":return e.locks.getHistory.delete(t.peerId),[];default:return(0,n.exhaustivenessCheck)(t)}}},607288:(e,t,r)=>{"use strict";r.d(t,{handler:()=>i});var a=r(887757),s=r(692137),n=r(701069),i=(e,t)=>{switch(t.type){case"UserSeenHelpHint":return e.helpHints.delete(t.hintId),[function(){var e=(0,s.default)(a.mark((function e(r){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.api,e.prev=1,e.next=4,s.fetch("account.hideHelpHint",{hint_id:t.hintId},{retries:1});case 4:return n=e.sent,e.abrupt("return",{type:"UserSeenHelpHint_RequestCompleted",hasFailed:1!==n});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserSeenHelpHint_RequestCompleted",hasFailed:!0});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserSeenHelpHint_RequestCompleted":return[];default:(0,n.exhaustivenessCheck)(t)}}},284267:(e,t,r)=>{"use strict";r.d(t,{handler:()=>l});var a=r(887757),s=r(692137),n=r(701069),i=r(658265),o=r(857085),u=r(766278);function c(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var l=(e,t,r)=>{switch(t.type){case"UserSeenMessage":var d=t.cmid,h=t.peerId,v=e.convos.get(h);if(!v)return[];var f=v.persisted.get(d);if(!f)return[];var m=v.inReadBy,g=v.unreadReactions.has(d);f.isOut||i.readInUntil(v,d),i.readReactions(v,d),o.refresh(e.organisers,v);var y=e.readQueues.get(h);return y?(y.inReadBy=v.inReadBy,g&&y.reactions.add(d),[]):(e.readQueues.set(h,{inReadBy:v.inReadBy,reactions:g?new Set([d]):new Set}),[p(h,m)]);case"UserSeenMessage_ThrottleTimedOut":var C=t.peerId,k=t.prevInReadBy;if(!e.convos.get(C))return e.readQueues.delete(C),[];var b=e.readQueues.get(C);if(!b)return[];for(var _,I=[],w=c(b.reactions);!(_=w()).done;){var M=_.value;if(I.push(M),b.reactions.delete(M),100===I.length)break}var S=b.inReadBy,R=e.ownerId,E=k<S,x=!1!==r.vkm_reactions&&I.length>0;return E||x?[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetchMany([E&&{method:"messages.markAsRead",params:{peer_id:C,up_to_cmid:S,mark_conversation_as_read:1,group_id:(0,u.getOwnerGroupId)(R)}},x&&{method:"messages.markReactionsAsRead",params:{peer_id:C,cmids:I.join(","),group_id:(0,u.getOwnerGroupId)(R)}}]);case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"UserSeenMessage_RequestCompleted",peerId:C,readUntilCmid:S});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()]:l(e,{type:"UserSeenMessage_RequestCompleted",peerId:C,readUntilCmid:S},r);case"UserSeenMessage_RequestCompleted":var A=t.peerId,U=t.readUntilCmid;if(!e.convos.get(A))return[];var P=e.readQueues.get(A);return P?P.inReadBy<=U&&0===P.reactions.size?(e.readQueues.delete(A),[]):[p(A,U)]:[];default:return(0,n.exhaustivenessCheck)(t)}};function p(e,t){return function(){var r=(0,s.default)(a.mark((function r(){return a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,(0,n.sleep)(500);case 2:return r.abrupt("return",{type:"UserSeenMessage_ThrottleTimedOut",prevInReadBy:t,peerId:e});case 3:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()}},390713:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(701069),i=r(857085),o=r(10122),u=(e,t)=>{switch(t.type){case"UserSeenPost":var r=t.cmid,u=t.channelId,d=e.channels.get(u);if(!d)return[];if(r<=d.inReadCmid)return[];o.readUntil(d,r),i.refreshChannels(e.organisers,d);var l=e.channelReadQueues.has(u);return e.channelReadQueues.set(u,d.inReadCmid),l?[]:[c(u)];case"UserSeenPost_ThrottleTimedOut":var p=t.channelId,h=e.channelReadQueues.get(p);return h?[function(){var e=(0,s.default)(a.mark((function e(t){var r;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("channels.markAsRead",{channel_id:p,last_read_cmid:h});case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return e.abrupt("return",{type:"UserSeenPost_RequestCompleted",channelId:p,readUntilCmid:h});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()]:[];case"UserSeenPost_RequestCompleted":var v=t.channelId,f=t.readUntilCmid,m=e.channelReadQueues.get(v);return m?f>=m?(e.channelReadQueues.delete(v),[]):[c(v)]:[];default:return(0,n.exhaustivenessCheck)(t)}};function c(e){return function(){var t=(0,s.default)(a.mark((function t(){return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,n.sleep)(300);case 2:return t.abrupt("return",{type:"UserSeenPost_ThrottleTimedOut",channelId:e});case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}},414894:(e,t,r)=>{"use strict";r.d(t,{handler:()=>o});var a=r(887757),s=r(692137),n=r(701069),i=r(766278),o=(e,t)=>{switch(t.type){case"UserSetMessageReaction":var r=t.peerId,o=t.cmid,c=t.reactionId,d=e.convos.get(r);if(!d)return[];var l=d.persisted.get(o);if(!l||"Normal"!==l.kind)return[];var p=l.reactionId,h=e.ownerId;return u(l,c,e.ownerId),[function(){var e=(0,s.default)(a.mark((function e(t){var s,n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.api,e.prev=1,e.next=4,s.fetch("messages.sendReaction",{cmid:o,peer_id:r,reaction_id:c,group_id:(0,i.getOwnerGroupId)(h)});case 4:return n=e.sent,e.abrupt("return",{type:"UserSetMessageReaction_RequestCompleted",hasFailed:1!==n,cmid:o,peerId:r,reactionId:c,prevReactionId:p});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserSetMessageReaction_RequestCompleted",hasFailed:!0,cmid:o,peerId:r,reactionId:c,prevReactionId:p});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserSetMessageReaction_RequestCompleted":var v=t.hasFailed,f=t.peerId,m=t.cmid,g=t.prevReactionId;if(!v)return[];var y=e.convos.get(f);if(!y)return[];var C=y.persisted.get(m);return C&&"Normal"===C.kind?(u(C,g,e.ownerId),[]):[];case"UserUnsetMessageReaction":var k=t.peerId,b=t.cmid,_=e.convos.get(k);if(!_)return[];var I=_.persisted.get(b);if(!I||"Normal"!==I.kind||!I.reactionId)return[];var w=I.reactionId,M=e.ownerId;return u(I,void 0,e.ownerId),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,e.prev=1,e.next=4,r.fetch("messages.deleteReaction",{cmid:b,peer_id:k,group_id:(0,i.getOwnerGroupId)(M)});case 4:return s=e.sent,e.abrupt("return",{type:"UserUnsetMessageReaction_RequestCompleted",hasFailed:1!==s,cmid:b,peerId:k,reactionId:w});case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",{type:"UserUnsetMessageReaction_RequestCompleted",hasFailed:!0,cmid:b,peerId:k,reactionId:w});case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()];case"UserUnsetMessageReaction_RequestCompleted":var S=t.hasFailed,R=t.peerId,E=t.cmid,x=t.reactionId;if(!S)return[];var A=e.convos.get(R);if(!A)return[];var U=A.persisted.get(E);return U&&"Normal"===U.kind?(u(U,x,e.ownerId),[]):[];default:(0,n.exhaustivenessCheck)(t)}};function u(e,t,r){var a=e.reactionId;if(e.reactionId=t,a){var s=e.reactions.get(a);if(!s&&n.isDev)throw new Error("Реакция не найдена в списке реакций сообщения");s&&(s.count<=1?e.reactions.delete(a):(s.count-=1,s.peerIds.delete(r)))}if(t){var i=e.reactions.get(t);i?(i.count+=1,i.peerIds=new Set([r,...i.peerIds])):e.reactions.set(t,{reactionId:t,count:1,peerIds:new Set([r])})}}},260299:(e,t,r)=>{"use strict";r.d(t,{handler:()=>u});var a=r(887757),s=r(692137),n=r(811129),i=r(701069),o=r(766278),u=(e,t)=>{switch(t.type){case"UserUpdatedFolder":var r=t.folderId,a=t.name,s=t.addPeerIds,u=t.removePeerIds;if(e.locks.updateFolder.has(r))return[];if(function(e,t){if(new Set([...e].filter((e=>t.has(e)))).size)return!0;return!1}(s,u))throw new Error("Peer id не может одновременно находиться в списке на добавление и на удаление");e.locks.updateFolder.add(r);var d=e.organisers.folders.find((e=>e.id===r));if(!d)return[];var l=(0,o.getConvosByIds)(e,Array.from(u)),p=(0,o.getConvosByIds)(e,Array.from(s));return a&&n.setName(d,a),(0,o.removeConvosFromFolder)(e,d.id,l),(0,o.addConvosToFolder)(e,d.id,p),[c(r,a,s,u)];case"UserUpdatedFolder_UpdateRequestCompleted":var h=t.hasFailed,v=t.folderId;if(e.locks.updateFolder.delete(v),h&&i.isDev)throw new Error("Не удалось изменить папку");return[];default:(0,i.exhaustivenessCheck)(t)}};function c(e,t,r,n){return function(){var i=(0,s.default)(a.mark((function s(i){var o,u,c,d;return a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return o=i.api,u=!1,c={folder_id:e},t&&(c.name=t),r.size&&(c.add_included_peer_ids=[...r].join(",")),n.size&&(c.remove_included_peer_ids=[...n].join(",")),a.prev=6,a.next=9,o.fetch("messages.updateFolder",c);case 9:d=a.sent,u=1!==d,a.next=16;break;case 13:a.prev=13,a.t0=a.catch(6),u=!0;case 16:return a.abrupt("return",{type:"UserUpdatedFolder_UpdateRequestCompleted",hasFailed:u,folderId:e,addPeerIds:r,removePeerIds:n,name:t});case 17:case"end":return a.stop()}}),s,null,[[6,13]])})));return function(e){return i.apply(this,arguments)}}()}},955187:(e,t,r)=>{"use strict";r.d(t,{handler:()=>i});var a=r(887757),s=r(692137),n=r(701069),i=(e,t,r)=>{switch(t.type){case"VideoMessageShapesGetById":var i,o=t.shapeId;return e.locks.getVideoMessageShapesById.has(o)||((null==(i=e.videoMessageShapes)?void 0:i.has(o))||!r.vkm_video_messages_shapes)?[]:(e.locks.getVideoMessageShapesById.add(o),[function(){var e=(0,s.default)(a.mark((function e(t){var r,s,n,i;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,s=t.storage,(n=s.get("videomessage-shapes"))&&(n.expiresAt=0),e.prev=3,e.next=6,r.fetch("messages.getVideoMessageShapesByIds",{ids:o.toString()});case 6:return i=e.sent,e.abrupt("return",{type:"VideoMessageShapesGetById__RequestCompleted",shapeId:o,response:i,hasFailed:!Boolean(i)});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{type:"VideoMessageShapesGetById__RequestCompleted",shapeId:o,response:null,hasFailed:!0});case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()]);case"VideoMessageShapesGetById__RequestCompleted":var u,c=t.response,d=t.shapeId;if(e.locks.getVideoMessageShapesById.delete(d),!c)return[];var l=c.shapes.reduce(((e,t)=>(e.set(t.id,t.raw_path),e)),new Map);return e.videoMessageShapes=new Map([...null!=(u=e.videoMessageShapes)?u:[],...l]),[];default:return(0,n.exhaustivenessCheck)(t)}}},959139:(e,t,r)=>{"use strict";r.d(t,{createStore:()=>u});var a=r(897297),s=r(701069),n=r(788200);function i(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var a=0;return function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function u(e,t,r,o,u,d){void 0===r&&(r=n.initial);var l=!1,p=s.isDev&&(0,a.devTools)(),h=[],v=r(t,o,u,d),f=v[0],m=v[1];p&&p.init(f);var g=r=>{if(!l)throw new Error("Стор еще не был активирован. Нужно вызвать store.start().");var a=(0,n.reducer)(f,r,t),s=a[0],o=a[1];p&&p.send(r,s);var u=f!==s;if(f=s,c(g,o,e),u)for(var d,v=i(h);!(d=v()).done;){(0,d.value)(s)}};return{start:()=>{l||(l=!0,c(g,m,e))},dispatch:g,subscribe:e=>(h.push(e),()=>{h=h.filter((t=>t!==e))}),featureFlags:t,getState:()=>f}}function c(e,t,r){0!==t.length&&setTimeout((()=>{for(var a,s=i(t);!(a=s()).done;){var n=a.value;"function"==typeof n&&n(r).then(e).catch((e=>{r.logger.error("Необработанная ошибка редьюсера",e)}))}}))}},897297:(e,t,r)=>{"use strict";function a(){return"undefined"!=typeof window&&"__REDUX_DEVTOOLS_EXTENSION__"in window?window.__REDUX_DEVTOOLS_EXTENSION__.connect({serialize:{options:{map:!0,set:!0}}}):null}r.d(t,{devTools:()=>a})},788200:(e,t,r)=>{"use strict";r.d(t,{initial:()=>Ee,reducer:()=>xe});var a=r(722122),s=r(887757),n=r(692137),i=r(210746),o=r(766278),u=r(701069),c=r(857085),d=r(630730),l=r(811129),p=r(488085),h=r(658265),v=r(529122),f=r(194739),m=r(452990),g=r(614031),y=r(10122),C=r(897181),k=r(825759),b=r(465980),_=r(369706),I=r(616963),w=r(208948),M=r(291998),S=r(247373),R=r(284267),E=r(448669),x=r(339183),A=r(187982),U=r(961442),P=r(9062),T=r(679141),O=r(348472),F=r(720689),N=r(913309),q=r(16948),L=r(352781),D=r(218227),H=r(33742),B=r(607288),G=r(213934),j=r(64153),V=r(810439),z=r(580412),W=r(497859),K=r(41902),$=r(261041),Q=r(337074),X=r(709856),Y=r(260299),Z=r(238794),J=r(362758),ee=r(545450),te=r(303087),re=r(694212),ae=r(718112),se=r(38099),ne=r(585712),ie=r(755467),oe=r(92727),ue=r(111637),ce=r(390713),de=r(691004),le=r(134015),pe=r(312265),he=r(663826),ve=r(13186),fe=r(302917),me=r(621530),ge=r(66572),ye=r(273765),Ce=r(285610),ke=r(955187),be=r(672510),_e=r(209421),Ie=r(414894),we=r(929090),Me=r(292343),Se=r(817793),Re=r(315899),Ee=(e,t,r,a)=>{var i=v.resolveId(t),o=r?v.resolveId(r):void 0;if(!v.isUserPeerId(i))throw Error("Viewer может быть только пользователем");if(void 0!==o&&!v.isUserPeerId(o)&&!v.isGroupPeerId(o))throw Error("Owner может быть только пользователем или группой");var u=(0,w.fromApiProfileType)(a);return[{convoConn:{status:"loading",pts:0},channelConn:{status:"running",ts:0},viewer:{id:i,profileType:u,settings:{ctrSubmit:!1,soundNotifications:!0,browserNotifications:!1,showRecommendations:!0,countOnlyNotMuted:!1,autoUnarchive:!0,transcriptAutoShow:!0,theme:"system",verticalFoldersView:!1,messageReactionAnimation:!0,businessNotify:!1,push:b.VIEWER_DEFAULT_PUSH_SETTINGS,teacherVerification:!1},profileInfo:{id:i},accounts:[]},ownerId:v.resolveId(),organisers:c.empty(),channels:new Map([[y.resolveId(0),{kind:"Channel",id:y.resolveId(0),name:"",activity:"",adminLevel:0,isVerified:!1,photos:{},inReadCmid:C.resolveCmid(0),unreadCount:0,isArchived:!1,isMuted:!1,notificationsDisabledUntil:0,majorSortId:0,minorSortId:0,membersCount:0,isMember:!1,canSendDonut:!1,pending:{},locks:{loading:!1,cleanUp:0},history:[]}]]),convos:new Map([[v.resolveId(),{kind:"UserConvo",peerId:v.resolveId(),unreadCount:0,majorSortId:0,minorSortId:0,inReadBy:f.resolveCmid(0),outReadBy:f.resolveCmid(0),isNew:!1,folderIds:new Set,isMarkedUnread:!1,isArchived:!1,canWrite:{allowed:!1,reason:"unknown"},push:{mode:"everything",disabledUntil:0},persistedCmid:f.resolveCmid(),persisted:new Map,queuedId:f.resolveRandomId(),queued:new Map,afterGapCmid:f.resolveCmid(),unreadExpireables:new Set,unreadReactions:new Set,hasMore:!1,entrypoint:null}]]),composerDrafts:{},channelComposerDrafts:{},readQueues:new Map,channelReadQueues:new Map,peers:new Map([[v.resolveId(),{kind:"User",id:v.resolveId(),firstName:"...",firstNameGen:"...",firstNameAcc:"...",lastName:"...",lastNameGen:"...",lastNameAcc:"...",sex:"unknown",lastSeen:{isVisible:!1,platform:"other"},isVerified:!1,canCall:!0,followersCount:0,canChangeFriendship:!1,canMessage:!1,friendship:"unfamiliar",isBlacklisted:!1,isBlacklistedByMe:!1,isDeactivated:!1,canInviteToChats:!1}]]),onlines:new Set,typings:new Map,convosSearchIndex:k.create(),locks:{getConversations:{all:!1,unread:!1,archive:!1,messageRequest:!1},getChannels:{all:!1,unread:!1},hideFilter:{all:!1,unread:!1,chats:!1,archive:!1,messageRequest:!1,businessNotify:!1},getHistory:new Set,getConversationMembers:new Set,getConversationInfo:new Set,sendQueue:new Map,edit:new Set,convosCleanup:new Map,channelsCleanup:new Map,updateFriendshipOrMembership:new Set,convoActions:new Set,messageActions:new Set,channelActions:new Set,channelPostActions:new Set,settings:new Set,contactList:!1,newFolder:!1,deleteFolder:new Set,updateFolder:new Set,reorderFolders:!1,getChannelHistory:new Set,changeMessageRequest:new Set,getStickerPacks:!1,getImportantUsers:!1,getPostCommentsHistory:new Set,likeActions:new Set,commentActions:new Set,getVideoMessageShapesById:new Set,loadStickers:new Set},hiddenPinnedMessages:new Map,helpHints:new Set,stickerPacks:new Map,stickers:new Map,favoriteStickers:[],recentStickers:[],stickersKeywords:{},contacts:{items:new Map,contacts:new Map,hasMore:!0},importantMessages:{messages:new Map,hasMore:!0},hiddenBotKeyboards:new Set,reactions:new Map,messageReactions:new Map,importantUsers:null,videoMessageShapes:null,activeCallsCount:0},[()=>Promise.resolve({type:"InitialData",ownerId:o}),function(){var t=(0,n.default)(s.mark((function t(r){var a,n,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.api,n=r.storage,e.vkm_video_messages_shapes){t.next=3;break}return t.abrupt("return",{type:"Noop"});case 3:return n.identify(i),t.next=6,Pe({api:a,storage:n});case 6:return o=t.sent,t.abrupt("return",{type:"LoadVideoMessageShapes_RequestCompleted",videoMessageShapes:o});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()]]};function xe(e,t,r){if("TemporaryHackForResync"===t.type)return Ee(r,e.viewer.id,e.ownerId,"edu"===e.viewer.profileType?2:0);var a,o=(0,i.createDraft)(e);switch(t.type){case"Noop":a=[];break;case"InitialData":case"InitialData_RequestCompleted":case"InitialData_ChannelsReadyForUse":a=Ae(o,t,r);break;case"LoadVideoMessageShapes_RequestCompleted":a=Ue(o,t,r);break;case"EngineBatchReceived":case"EngineBatchReceived_TypingsTimedOut":case"UpdateMessageRequestsCounter":case"UpdateMessageRequestsCounter_RequestCompleted":a=A.handler(o,t,r);break;case"ChannelEngineBatchReceived":a=U.handler(o,t,r);break;case"QueueBatchReceived":a=D.handler(o,t,r);break;case"MoreConvosNeeded":case"MoreConvosNeeded_RequestCompleted":a=N.handler(o,t,r);break;case"MoreChannelsNeeded":case"MoreChannelsNeeded_RequestCompleted":a=q.handler(o,t,r);break;case"CacheUpdateReceived":a=L.handler(o,t,r);break;case"UserScrolledConvoHistory":case"UserScrolledConvoHistoryToMessage":case"UserScrolledConvoHistory_RequestSucceed":case"UserScrolledConvoHistory_RequestFailed":a=E.handler(o,t,r);break;case"UserSeenMessage":case"UserSeenMessage_ThrottleTimedOut":case"UserSeenMessage_RequestCompleted":a=R.handler(o,t,r);break;case"UserHitSend":case"UserHitSend_RequestCompleted":case"UserHitResendAllFailedMessages":case"ResendAllFailedMessages":case"UserHitResendFailedMessage":case"UserHitSendWidget":a=M.handler(o,t,r);break;case"UserHitEdit":case"UserHitEdit_RequestCompleted":a=S.handler(o,t,r);break;case"UserOpenedConvo":case"UserClosedConvo":case"UserOpenedConvo_ConvoRequestCompleted":case"UserOpenedConvo_HistoryRequestSucceed":case"UserOpenedConvo_HistoryRequestFailed":case"UserOpenedConvo_StickersLoadRequestSucceed":case"UserOpenedConvo_StickersLoadRequestFailed":case"UserOpenedConvo_StickersRefreshThrottleTimedOut":a=x.handler(o,t,r);break;case"LoadStickers":case"LoadStickers_RequestCompleted":a=_e.handler(o,t,r);break;case"UserChangedFriendship":case"UserChangedFriendship_RequestCompleted":a=O.handler(o,t,r);break;case"UserChangedGroupMembership":case"UserChangedGroupMembership_RequestCompleted":a=F.handler(o,t,r);break;case"UserChangedSetting":case"UserChangedSetting_RequestCompleted":a=P.handler(o,t,r);break;case"SettingThemeUpdated":case"SettingThemeUpdated_RequestCompleted":a=T.handler(o,t,r);break;case"UserPlayedMessage":case"UserPlayedMessage_RequestCompleted":a=H.handler(o,t,r);break;case"UserSeenHelpHint":case"UserSeenHelpHint_RequestCompleted":a=B.handler(o,t,r);break;case"UserChangedConvo":case"UserChangedConvo_RequestCompleted":case"UserPinMessage":case"UserPinMessage_RequestCompleted":case"UserUnpinMessage":case"UserUnpinMessage_RequestCompleted":case"UserChangedMute":case"UserChangedMute_RequestCompleted":case"UserChangedBusinessNotify":case"UserChangedBusinessNotify_RequestCompleted":a=G.handler(o,t,r);break;case"UserChangedMessage":case"UserChangedMessage_RequestCompleted":case"UserDeleteMessage":case"UserDeleteMessage_RequestCompleted":case"UserDeleteFailedMessage":case"UserDeleteAllFailedMessage":case"UserRestoreMessage":case"UserRestoreMessage_RequestCompleted":a=j.handler(o,t,r);break;case"LoadContactList":case"LoadContactList_RequestCompleted":a=V.handler(o,t,r);break;case"UserHideFilter":case"UserHideFilter_Completed":case"UserUndoHideFilter":case"ActualizeArchiveMentions":case"LoadArchiveConvos_RequestCompleted":case"UserActualizeHideFilter":a=W.handler(o,t,r);break;case"UserAcceptedChatMessageRequest":case"UserRejectedMessageRequest":case"UserAcceptedChatMessageRequest_RequestCompleted":case"UserRejectedChatMessageRequest_RequestCompleted":a=z.handler(o,t,r);break;case"UserChangedChatTitle":case"UserChangedChatDescription":case"UserChangedChatTitle_RequestCompleted":case"UserChangedChatDescription_RequestCompleted":case"UserRemovedChatPhoto":case"UserSetChatPhoto":case"UserRemovedChatPhoto_RequestCompleted":case"UserChangedChatSettings":case"UserChangedChatSettings_RequestCompleted":a=K.handler(o,t,r);break;case"UserOpenedConvoProfile":case"UserOpenedConvoProfile_ConvoRequestCompleted":case"UserOpenedConvoProfile_InviteLinksCompleted":a=$.handler(o,t,r);break;case"LoadImportantMessages":case"LoadImportantMessages_RequestCompleted":case"UserClosedImportantMessages":a=Q.handler(o,t,r);break;case"UserCreatedFolder":case"UserCreatedFolder_CreateRequestCompleted":a=X.handler(o,t,r);break;case"UserUpdatedFolder":case"UserUpdatedFolder_UpdateRequestCompleted":a=Y.handler(o,t,r);break;case"UserDeletedFolder":case"UserDeletedFolder_DeleteRequestCompleted":a=Z.handler(o,t,r);break;case"UserReorderedFolders":case"UserReorderedFolders_ReorderRequestCompleted":a=J.handler(o,t,r);break;case"StickersAddToFavorite":case"StickersAddToFavorite__RequestCompleted":case"StickersRemoveFromFavorite":case"StickersRemoveFromFavorite__RequestCompleted":case"StickerAddToRecent":a=ee.handler(o,t,r);break;case"UserScrolledChannelHistory":case"UserScrolledChannelHistory_RequestSucceed":case"UserScrolledChannelHistory_RequestFailed":a=te.handler(o,t,r);break;case"UserOpenedChannel":case"UserClosedChannel":case"UserOpenedChannel_ChannelRequestCompleted":a=re.handler(o,t,r);break;case"UserChangedChatMember":case"UserChangedChatMember_RequestCompleted":a=ae.handler(o,t,r);break;case"UserRequestChatInvitationLink":case"UserRequestChatInvitationLink_RequestCompleted":case"UserResetChatInvitationLink":case"UserResetChatInvitationLink_RequestCompleted":a=se.handler(o,t,r);break;case"LoadChatMembers":case"LoadChatMembers_RequestComplete":a=ne.handler(o,t,r);break;case"LoadChatInfo":case"LoadChatInfo_RequestComplete":a=ie.handler(o,t,r);break;case"UserChangedChannel":case"UserChangedChannel_RequestCompleted":a=oe.handler(o,t,r);break;case"UserChangedChannelPost":case"UserChangedChannelPost_RequestCompleted":a=ue.handler(o,t,r);break;case"UserSeenPost":case"UserSeenPost_ThrottleTimedOut":case"UserSeenPost_RequestCompleted":a=ce.handler(o,t,r);break;case"LoadImportantUsers":case"LoadImportantUsers_RequestCompleted":a=de.handler(o,t,r);break;case"UserLoadedCommentsHistory":case"UserLoadedCommentsHistory_RequestSucceed":case"UserLoadedCommentsHistory_RequestFailed":a=pe.handler(o,t,r);break;case"ChannelsOnboardingDone":case"ChannelsOnboardingDone_RequestSucceeded":case"ChannelsOnboardingDone_RequestFailed":a=he.handler(o,t,r);break;case"UserChangedComposerDraft":case"UserClearedComposerDraft":case"UpdateComposerDraftOnMessageDelete":a=ve.handler(o,t,r);break;case"ResetUpdatesCounter":case"ResetUpdatesCounter_RequestCompleted":a=fe.handler(o,t,r);break;case"UserProfileInfo_Update":a=le.handler(o,t,r);break;case"UserChangedMessageAttachment":case"UserChangedMessageAttachment_RequestCompleted":a=me.handler(o,t,r);break;case"UserDeleteComment":case"UserDeleteComment_RequestCompleted":case"UserRestoreComment":case"UserRestoreComment_RequestCompleted":a=ye.handler(o,t,r);break;case"UserLoadedLikes":case"UserLoadedLikes_RequestCompleted":case"UserChangedLike":case"UserChangedLike_RequestCompleted":a=ge.handler(o,t,r);break;case"UserChangedBrowserNotifications":case"UserChangedBrowserNotifications_RequestCompleted":a=Ce.handler(o,t,r);break;case"UserSetMessageReaction":case"UserSetMessageReaction_RequestCompleted":case"UserUnsetMessageReaction":case"UserUnsetMessageReaction_RequestCompleted":a=Ie.handler(o,t,r);break;case"ImportContact":a=Se.handler(o,t,r);break;case"VideoMessageShapesGetById":case"VideoMessageShapesGetById__RequestCompleted":a=ke.handler(o,t,r);break;case"UserChangedPostAttachment":case"UserChangedPostAttachment_RequestCompleted":a=be.handler(o,t,r);break;case"PollConvoReactions":case"PollConvoReactions_RequestSucceed":a=we.handler(o,t,r);break;case"UserChangedChannelComposerDraft":case"UserClearedChannelComposerDraft":a=Me.handler(o,t,r);break;case"SetDefaultReactions":a=Re.handler(o,t,r);break;default:(0,u.exhaustivenessCheck)(t)}o.convos.set(v.resolveId(),h.safeGet(e.convos,v.resolveId())),o.peers.set(v.resolveId(),v.safeGet(e.peers,v.resolveId())),o.channels.set(y.resolveId(0),y.safeGet(e.channels,y.resolveId(0)));var c=(0,i.finishDraft)(o);if(e.hiddenPinnedMessages!==c.hiddenPinnedMessages&&a.push(function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("hidden-pinned-messages",Array.from(c.hiddenPinnedMessages.entries()).reduce(((e,t)=>{var r=t[0],a=t[1];return e[r]=a,e}),{})),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.hiddenBotKeyboards!==c.hiddenBotKeyboards&&a.push(function(){var e=(0,n.default)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.storage.set("hidden-bot-keyboards",c.hiddenBotKeyboards),e.abrupt("return",{type:"Noop"});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c.organisers.filters.businessNotify.isHidden&&"Noop"!==t.type&&"UserUndoHideFilter"!==t.type&&"visible"===document.visibilityState){var d=c.organisers.filters.businessNotify.unreadCount;a.push((0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==d){e.next=2;break}return e.abrupt("return",{type:"Noop"});case 2:return e.abrupt("return",{type:"UserUndoHideFilter",kind:"businessNotify"});case 3:case"end":return e.stop()}}),e)}))))}return[c,a]}var Ae=(e,t,r)=>{switch(t.type){case"InitialData":var i=t.ownerId,h=i?(0,o.getOwnerGroupId)(i):0,y=e.viewer.id;return 0===y?[]:[function(){var e=(0,n.default)(s.mark((function e(t){var r,a,n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=t.storage).identify(y),n=null!=(r=a.get("theme"))?r:"system",e.abrupt("return",{type:"SettingThemeUpdated",value:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,n.default)(s.mark((function e(t){var r,n,i,o,u,c,d,l,p,v,f,C,k,_,w,M,S,R,E,x,A,U,P,T,O,F,N,q,L;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=t.engine,f=t.api,C=t.storage,k=t.player,_=t.voicePlayer,e.next=3,f.fetch("messages.getLongPollServer",{need_pts:1,lp_version:v.version,group_id:h},{retries:1/0,usePrefetch:!0});case 3:if((w=e.sent).pts){e.next=6;break}throw new Error("Отсутствует pts");case 6:return v.connect((0,a.default)({},w,{pts:w.pts})),e.next=9,f.fetchMany([{method:"messages.getConversations",params:{count:I.CONVOS_PER_PAGE,group_id:h,extended:1}},{method:"messages.getConversationsById",params:{peer_ids:y.toString(),group_id:h,extended:1}},{method:"messages.getFolders",params:{}},{method:"users.get",params:{}},0!==h&&{method:"groups.getById",params:{group_ids:String(h)}},{method:"account.getCounters",params:{filter:"all"}},{method:"account.getInfo",params:{fields:["messages_recommendation_list_hidden","show_only_not_muted_messages","messages_multiline_input","messages_auto_unarchive","messages_transcript_auto_show","business_notify","messages_show_banner_teacher_verification"].join(",")}},{method:"account.getHelpHints",params:{categories:"im"}},{method:"account.getMulti",params:{fields:"profile_type,photo_100"}},{method:"account.getProfileInfo",params:{}}],{retries:1/0,timeout:2e4,usePrefetch:!0});case 9:if(M=e.sent,S=M[0],R=M[1],E=M[2],x=M[3],A=M[4],U=M[5],P=M[6],T=M[7],O=M[8],F=M[9],N=null==A||null==(r=A.groups)?void 0:r[0],q=x[0]){e.next=24;break}throw new Error("Не удалось получить текущего пользователя");case 24:return C.identify(y),k.init(y),_.init(y),L={type:"InitialData_RequestCompleted",responseViewer:q,responseMultiAccount:O,responseGroup:N,responseConvos:S,responseProfileInfo:F,responseViewerConvo:R,hasMoreConvos:S.items.length>=I.CONVOS_PER_PAGE,folders:E,activeCallsCount:U.calls||0,unreadCount:{messages:U.messages||0,messagesUnmuted:U.messages_unread_unmuted||0,archive:U.messages_archive_unread||0,archiveMentions:U.messages_archive_mentions_count||0,archiveTotal:U.messages_archive||0,messageRequest:U.message_requests||0,businessNotify:U.business_notify||0,businessNotifyTotal:U.business_notify_all||0,channelsTotal:(null==(n=U.channels)?void 0:n.total_count)||0,folders:U.messages_folders||[]},convoLp:{pts:w.pts},hiddenPinnedMessages:C.get("hidden-pinned-messages"),hiddenBotKeyboards:C.get("hidden-bot-keyboards"),archiveManuallyHidden:!!C.get("archive-manually-hidden"),composerDrafts:m.validateRequiredFields(C.get("drafts")||{}),channelComposerDrafts:g.validateRequiredFields(C.get("channels-drafts")||{}),businessNotifyManuallyHidden:!!C.get("business-notify-manually-hidden"),userSettings:{ctrSubmit:Boolean(P.messages_multiline_input),soundNotifications:null==(i=C.get("settings-sound-notifications-on"))||i,browserNotifications:null!=(o=C.get("settings-browser-notifications-on"))&&o,showRecommendations:!Boolean(P.messages_recommendation_list_hidden),countOnlyNotMuted:Boolean(P.show_only_not_muted_messages),autoUnarchive:Boolean(P.messages_auto_unarchive),transcriptAutoShow:Boolean(P.messages_transcript_auto_show),theme:null!=(u=C.get("theme"))?u:"system",verticalFoldersView:null!=(c=C.get("folders-view-vertical"))&&c,messageReactionAnimation:null==(d=C.get("message-reactions-animation"))||d,businessNotify:Boolean(P.business_notify_enabled),push:b.VIEWER_DEFAULT_PUSH_SETTINGS,teacherVerification:Boolean("1"===(null==(l=P.settings)||null==(p=l.find((e=>"messages_show_banner_teacher_verification"===e.name)))?void 0:p.value))},helpHints:T.items.reduce(((e,t)=>(e.add(t.id),e)),new Set)},e.abrupt("return",L);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];case"InitialData_RequestCompleted":var C;e.convoConn={status:"running",pts:t.convoLp.pts},e.activeCallsCount=t.activeCallsCount,e.hiddenPinnedMessages=new Map(Object.entries(t.hiddenPinnedMessages||{}).map((e=>{var t=e[0],r=e[1];return[v.resolveId(parseInt(t)),f.resolveCmid(r)]}))),e.hiddenBotKeyboards=t.hiddenBotKeyboards||new Set,e.composerDrafts=t.composerDrafts,e.channelComposerDrafts=t.channelComposerDrafts;var k=(0,o.insertConvos)(e,t.responseConvos.items);(0,o.insertConvos)(e,t.responseViewerConvo.items),e.organisers.filters.archive.isHidden=!!t.archiveManuallyHidden,e.organisers.filters.businessNotify.isHidden=!!t.businessNotifyManuallyHidden,d.push(e.organisers.filters,"all",k,t.hasMoreConvos),0===t.unreadCount.archiveTotal&&d.push(e.organisers.filters,"archive",[],!1),0===t.unreadCount.messageRequest&&d.push(e.organisers.filters,"messageRequest",[],!1),d.updateCounters(e.organisers.filters,{unread:t.unreadCount.messages,unreadUnmuted:t.unreadCount.messagesUnmuted,headerNotMutedUnread:0,archive:t.unreadCount.archive,archiveMentions:t.unreadCount.archiveMentions,archiveTotal:t.unreadCount.archiveTotal,messageRequests:t.unreadCount.messageRequest,businessNotify:t.unreadCount.businessNotify,businessNotifyTotal:t.unreadCount.businessNotifyTotal}),(0,o.insertFolders)(e,t.folders.items),null==(C=t.unreadCount.folders)||C.forEach((t=>{l.setUnreadCounters(e.organisers.folders,l.resolveId(t.folder_id),t.total_count,t.unmuted_count)})),p.updateCounters(e.organisers.channelFilters,{unread:t.unreadCount.channelsTotal,archiveTotal:0}),(0,o.insertPeers)(e,{apiUsers:[...t.responseConvos.profiles||[]],apiGroups:[...t.responseConvos.groups||[]],apiContacts:[...t.responseConvos.contacts||[]]}),e.viewer.profileInfo=(0,w.fromApiViewerProfileInfo)(t.responseProfileInfo);var M=(0,_.fromApiUser)(t.responseViewer).user;e.peers.set(M.id,M),e.viewer.id=M.id,e.viewer.accounts=t.responseMultiAccount.items.map(w.fromApiViewerAccount);var S=t.responseGroup?(0,_.fromApiGroup)(t.responseGroup):void 0;return S&&e.peers.set(S.id,S),e.ownerId=S?S.id:M.id,t.userSettings&&(e.viewer.settings=t.userSettings),e.helpHints=t.helpHints,e.convoConn.status="running",[function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.engine,e.next=3,r.poll();case 3:return e.t0=e.sent,e.t1={kind:"FromEngine",next:e.t0},e.abrupt("return",{type:"EngineBatchReceived",variant:e.t1});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,n.default)(s.mark((function e(t){var r,n,i;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.api,n=t.queue,e.next=3,r.fetch("queue.subscribe",{queue_ids:`onlfriends_${M.id},accountcounters_${M.id}`},{retries:1/0});case 3:return i=e.sent,n.connect((0,a.default)({user_id:M.id},i)),e.next=7,n.poll();case 7:return e.t0=e.sent,e.abrupt("return",{type:"QueueBatchReceived",next:e.t0});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,n.default)(s.mark((function e(){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{type:"LoadImportantUsers"});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,n.default)(s.mark((function e(t){var a,n,i,o,d,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.api,n=t.channelEngine,i=t.router,n&&r.me_channels){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.prev=3,e.next=6,a.fetchSeq([{method:"channels.getLongPollServer",params:{}},{method:"channels.get",params:{count:I.CHANNELS_PER_PAGE,filter:(0,u.getChannelFilterForAPI)(c.tabToChannelFilter(i.currentRoute.tab)),extended:1}}],{retries:1/0});case 6:return o=e.sent,d=o[0],l=o[1],n.connect(d),e.abrupt("return",{type:"InitialData_ChannelsReadyForUse",channelLpTS:d.ts,channelsGetResponse:l});case 13:return e.prev=13,e.t0=e.catch(3),e.abrupt("return",{type:"Noop"});case 16:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t){return e.apply(this,arguments)}}()];case"InitialData_ChannelsReadyForUse":var R,E,x;e.channelConn={status:"running",ts:t.channelLpTS};var A=(0,o.insertChannels)(e,{apiChannels:t.channelsGetResponse.items||[],apiGroups:t.channelsGetResponse.groups||[]}),U=((null==(R=t.channelsGetResponse.items)?void 0:R.length)||0)>=I.CHANNELS_PER_PAGE;return p.push(e.organisers.channelFilters,"all",A,U),(0,o.insertPeers)(e,{apiUsers:[...(null==(E=t.channelsGetResponse)?void 0:E.profiles)||[]],apiGroups:[...(null==(x=t.channelsGetResponse)?void 0:x.groups)||[]],apiContacts:[]}),[function(){var e=(0,n.default)(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.channelEngine){e.next=3;break}return e.abrupt("return",{type:"Noop"});case 3:return e.next=5,r.poll();case 5:return e.t0=e.sent,e.t1={kind:"FromChannelEngine",next:e.t0},e.abrupt("return",{type:"ChannelEngineBatchReceived",variant:e.t1});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()];default:return[]}},Ue=(e,t)=>{var r,a;return"LoadVideoMessageShapes_RequestCompleted"===t.type?(e.videoMessageShapes=null!=(r=null==(a=t.videoMessageShapes)?void 0:a.shapes.reduce(((e,t)=>{var r=t.id,a=t.raw_path;return e.set(r,a),e}),new Map))?r:new Map,[]):[]};function Pe(e){return Te.apply(this,arguments)}function Te(){return(Te=(0,n.default)(s.mark((function e(t){var r,n,i,o,u,c,d,l,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.api,n=t.storage,i=n.get("videomessage-shapes"),o=Math.round((new Date).getTime()/1e3),u=86400,c=i&&i.expiresAt>o,d=null,!c){e.next=10;break}d=i.response,e.next=18;break;case 10:return e.prev=10,e.next=13,r.fetch("messages.getVideoMessageShapes",{client_version:null!=(l=null==i?void 0:i.response.version)?l:0},{retries:3});case 13:d=e.sent,e.next=18;break;case 16:e.prev=16,e.t0=e.catch(10);case 18:return p=d?(0,a.default)({},d,{shapes:[...(null==i?void 0:i.response.shapes)||[],...d.shapes]}):null,!c&&p&&n.set("videomessage-shapes",{response:p,expiresAt:o+u}),e.abrupt("return",p);case 21:case"end":return e.stop()}}),e,null,[[10,16]])})))).apply(this,arguments)}},184290:(e,t,r)=>{"use strict";r.d(t,{initConfig:()=>s});var a=r(210746);function s(){(0,a.enableMapSet)(),(0,a.setAutoFreeze)(!1)}},931807:e=>{var t=!("undefined"==typeof window||!window.document||!window.document.createElement);e.exports=t},905876:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=r(556169).default.Symbol},858746:(e,t,r)=>{"use strict";r.d(t,{default:()=>o});var a=r(905876),s=r(818948),n=r(873636),i=a.default?a.default.toStringTag:void 0;const o=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?(0,s.default)(e):(0,n.default)(e)}},147408:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var a=r(151257),s=/^\s+/;const n=function(e){return e?e.slice(0,(0,a.default)(e)+1).replace(s,""):e}},748277:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a="object"==typeof global&&global&&global.Object===Object&&global},818948:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(905876),s=Object.prototype,n=s.hasOwnProperty,i=s.toString,o=a.default?a.default.toStringTag:void 0;const u=function(e){var t=n.call(e,o),r=e[o];try{e[o]=void 0;var a=!0}catch(e){}var s=i.call(e);return a&&(t?e[o]=r:delete e[o]),s}},873636:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=Object.prototype.toString;const s=function(e){return a.call(e)}},556169:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var a=r(748277),s="object"==typeof self&&self&&self.Object===Object&&self;const n=a.default||s||Function("return this")()},151257:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=/\s/;const s=function(e){for(var t=e.length;t--&&a.test(e.charAt(t)););return t}},290808:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(589122),s=r(459641),n=r(147422),i=Math.max,o=Math.min;const u=function(e,t,r){var u,c,d,l,p,h,v=0,f=!1,m=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var r=u,a=c;return u=c=void 0,v=t,l=e.apply(a,r)}function C(e){return v=e,p=setTimeout(b,t),f?y(e):l}function k(e){var r=e-h;return void 0===h||r>=t||r<0||m&&e-v>=d}function b(){var e=(0,s.default)();if(k(e))return _(e);p=setTimeout(b,function(e){var r=t-(e-h);return m?o(r,d-(e-v)):r}(e))}function _(e){return p=void 0,g&&u?y(e):(u=c=void 0,l)}function I(){var e=(0,s.default)(),r=k(e);if(u=arguments,c=this,h=e,r){if(void 0===p)return C(h);if(m)return clearTimeout(p),p=setTimeout(b,t),y(h)}return void 0===p&&(p=setTimeout(b,t)),l}return t=(0,n.default)(t)||0,(0,a.default)(r)&&(f=!!r.leading,d=(m="maxWait"in r)?i((0,n.default)(r.maxWait)||0,t):d,g="trailing"in r?!!r.trailing:g),I.cancel=function(){void 0!==p&&clearTimeout(p),v=0,u=h=c=p=void 0},I.flush=function(){return void 0===p?l:_((0,s.default)())},I}},589122:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},623195:(e,t,r)=>{"use strict";r.d(t,{default:()=>a});const a=function(e){return null!=e&&"object"==typeof e}},197828:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var a=r(858746),s=r(623195);const n=function(e){return"symbol"==typeof e||(0,s.default)(e)&&"[object Symbol]"==(0,a.default)(e)}},459641:(e,t,r)=>{"use strict";r.d(t,{default:()=>s});var a=r(556169);const s=function(){return a.default.Date.now()}},858848:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var a=r(290808),s=r(589122);const n=function(e,t,r){var n=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return(0,s.default)(r)&&(n="leading"in r?!!r.leading:n,i="trailing"in r?!!r.trailing:i),(0,a.default)(e,t,{leading:n,maxWait:t,trailing:i})}},147422:(e,t,r)=>{"use strict";r.d(t,{default:()=>d});var a=r(147408),s=r(589122),n=r(197828),i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,u=/^0o[0-7]+$/i,c=parseInt;const d=function(e){if("number"==typeof e)return e;if((0,n.default)(e))return NaN;if((0,s.default)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=(0,s.default)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=(0,a.default)(e);var r=o.test(e);return r||u.test(e)?c(e.slice(2),r?2:8):i.test(e)?NaN:+e}},130845:(e,t,r)=>{"use strict";r.d(t,{default:()=>n});var a=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function s(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(s=e[r],n=t[r],!(s===n||a(s)&&a(n)))return!1;var s,n;return!0}const n=function(e,t){var r;void 0===t&&(t=s);var a,n=[],i=!1;return function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return i&&r===this&&t(s,n)||(a=e.apply(this,s),i=!0,r=this,n=s),a}}},968641:()=>{},380283:()=>{},183638:()=>{},895593:()=>{},351667:()=>{},974580:()=>{},936021:()=>{},360862:()=>{},97839:()=>{},628392:()=>{},516073:()=>{},29354:()=>{},274061:(e,t,r)=>{"use strict";r.d(t,{FixedSizeList:()=>b,VariableSizeList:()=>k});var a=r(722122),s=r(663349),n=r(841788),i=r(130845),o=r(667294),u=(r(419756),"object"==typeof performance&&"function"==typeof performance.now?function(){return performance.now()}:function(){return Date.now()});function c(e){cancelAnimationFrame(e.id)}function d(e,t){var r=u();var a={id:requestAnimationFrame((function s(){u()-r>=t?e.call(null):a.id=requestAnimationFrame(s)}))};return a}var l=null;function p(e){if(void 0===e&&(e=!1),null===l||e){var t=document.createElement("div"),r=t.style;r.width="50px",r.height="50px",r.overflow="scroll",r.direction="rtl";var a=document.createElement("div"),s=a.style;return s.width="100px",s.height="100px",t.appendChild(a),document.body.appendChild(t),t.scrollLeft>0?l="positive-descending":(t.scrollLeft=1,l=0===t.scrollLeft?"negative":"positive-ascending"),document.body.removeChild(t),l}return l}var h=function(e,t){return e};function v(e){var t,r=e.getItemOffset,u=e.getEstimatedTotalSize,l=e.getItemSize,v=e.getOffsetForIndexAndAlignment,m=e.getStartIndexForOffset,g=e.getStopIndexForStartIndex,y=e.initInstanceProps,C=e.shouldResetStyleCacheOnItemSizeChange,k=e.validateProps;return t=function(e){function t(t){var a;return(a=e.call(this,t)||this)._instanceProps=y(a.props,(0,s.default)(a)),a._outerRef=void 0,a._resetIsScrollingTimeoutId=null,a.state={instance:(0,s.default)(a),isScrolling:!1,scrollDirection:"forward",scrollOffset:"number"==typeof a.props.initialScrollOffset?a.props.initialScrollOffset:0,scrollUpdateWasRequested:!1},a._callOnItemsRendered=void 0,a._callOnItemsRendered=(0,i.default)((function(e,t,r,s){return a.props.onItemsRendered({overscanStartIndex:e,overscanStopIndex:t,visibleStartIndex:r,visibleStopIndex:s})})),a._callOnScroll=void 0,a._callOnScroll=(0,i.default)((function(e,t,r){return a.props.onScroll({scrollDirection:e,scrollOffset:t,scrollUpdateWasRequested:r})})),a._getItemStyle=void 0,a._getItemStyle=function(e){var t,s=a.props,n=s.direction,i=s.itemSize,o=s.layout,u=a._getItemStyleCache(C&&i,C&&o,C&&n);if(u.hasOwnProperty(e))t=u[e];else{var c=r(a.props,e,a._instanceProps),d=l(a.props,e,a._instanceProps),p="horizontal"===n||"horizontal"===o,h="rtl"===n,v=p?c:0;u[e]=t={position:"absolute",left:h?void 0:v,right:h?v:void 0,top:p?0:c,height:p?"100%":d,width:p?d:"100%"}}return t},a._getItemStyleCache=void 0,a._getItemStyleCache=(0,i.default)((function(e,t,r){return{}})),a._onScrollHorizontal=function(e){var t=e.currentTarget,r=t.clientWidth,s=t.scrollLeft,n=t.scrollWidth;a.setState((function(e){if(e.scrollOffset===s)return null;var t=a.props.direction,i=s;if("rtl"===t)switch(p()){case"negative":i=-s;break;case"positive-descending":i=n-r-s}return i=Math.max(0,Math.min(i,n-r)),{isScrolling:!0,scrollDirection:e.scrollOffset<s?"forward":"backward",scrollOffset:i,scrollUpdateWasRequested:!1}}),a._resetIsScrollingDebounced)},a._onScrollVertical=function(e){var t=e.currentTarget,r=t.clientHeight,s=t.scrollHeight,n=t.scrollTop;a.setState((function(e){if(e.scrollOffset===n)return null;var t=Math.max(0,Math.min(n,s-r));return{isScrolling:!0,scrollDirection:e.scrollOffset<t?"forward":"backward",scrollOffset:t,scrollUpdateWasRequested:!1}}),a._resetIsScrollingDebounced)},a._outerRefSetter=function(e){var t=a.props.outerRef;a._outerRef=e,"function"==typeof t?t(e):null!=t&&"object"==typeof t&&t.hasOwnProperty("current")&&(t.current=e)},a._resetIsScrollingDebounced=function(){null!==a._resetIsScrollingTimeoutId&&c(a._resetIsScrollingTimeoutId),a._resetIsScrollingTimeoutId=d(a._resetIsScrolling,150)},a._resetIsScrolling=function(){a._resetIsScrollingTimeoutId=null,a.setState({isScrolling:!1},(function(){a._getItemStyleCache(-1,null)}))},a}(0,n.default)(t,e),t.getDerivedStateFromProps=function(e,t){return f(e,t),k(e),null};var b=t.prototype;return b.scrollTo=function(e){e=Math.max(0,e),this.setState((function(t){return t.scrollOffset===e?null:{scrollDirection:t.scrollOffset<e?"forward":"backward",scrollOffset:e,scrollUpdateWasRequested:!0}}),this._resetIsScrollingDebounced)},b.scrollToItem=function(e,t){void 0===t&&(t="auto");var r=this.props.itemCount,a=this.state.scrollOffset;e=Math.max(0,Math.min(e,r-1)),this.scrollTo(v(this.props,e,t,a,this._instanceProps))},b.componentDidMount=function(){var e=this.props,t=e.direction,r=e.initialScrollOffset,a=e.layout;if("number"==typeof r&&null!=this._outerRef){var s=this._outerRef;"horizontal"===t||"horizontal"===a?s.scrollLeft=r:s.scrollTop=r}this._callPropsCallbacks()},b.componentDidUpdate=function(){var e=this.props,t=e.direction,r=e.layout,a=this.state,s=a.scrollOffset;if(a.scrollUpdateWasRequested&&null!=this._outerRef){var n=this._outerRef;if("horizontal"===t||"horizontal"===r)if("rtl"===t)switch(p()){case"negative":n.scrollLeft=-s;break;case"positive-ascending":n.scrollLeft=s;break;default:var i=n.clientWidth,o=n.scrollWidth;n.scrollLeft=o-i-s}else n.scrollLeft=s;else n.scrollTop=s}this._callPropsCallbacks()},b.componentWillUnmount=function(){null!==this._resetIsScrollingTimeoutId&&c(this._resetIsScrollingTimeoutId)},b.render=function(){var e=this.props,t=e.children,r=e.className,s=e.direction,n=e.height,i=e.innerRef,c=e.innerElementType,d=e.innerTagName,l=e.itemCount,p=e.itemData,v=e.itemKey,f=void 0===v?h:v,m=e.layout,g=e.outerElementType,y=e.outerTagName,C=e.style,k=e.useIsScrolling,b=e.width,_=this.state.isScrolling,I="horizontal"===s||"horizontal"===m,w=I?this._onScrollHorizontal:this._onScrollVertical,M=this._getRangeToRender(),S=M[0],R=M[1],E=[];if(l>0)for(var x=S;x<=R;x++)E.push((0,o.createElement)(t,{data:p,key:f(x,p),index:x,isScrolling:k?_:void 0,style:this._getItemStyle(x)}));var A=u(this.props,this._instanceProps);return(0,o.createElement)(g||y||"div",{className:r,onScroll:w,ref:this._outerRefSetter,style:(0,a.default)({position:"relative",height:n,width:b,overflow:"auto",WebkitOverflowScrolling:"touch",willChange:"transform",direction:s},C)},(0,o.createElement)(c||d||"div",{children:E,ref:i,style:{height:I?"100%":A,pointerEvents:_?"none":void 0,width:I?A:"100%"}}))},b._callPropsCallbacks=function(){if("function"==typeof this.props.onItemsRendered&&this.props.itemCount>0){var e=this._getRangeToRender(),t=e[0],r=e[1],a=e[2],s=e[3];this._callOnItemsRendered(t,r,a,s)}if("function"==typeof this.props.onScroll){var n=this.state,i=n.scrollDirection,o=n.scrollOffset,u=n.scrollUpdateWasRequested;this._callOnScroll(i,o,u)}},b._getRangeToRender=function(){var e=this.props,t=e.itemCount,r=e.overscanCount,a=this.state,s=a.isScrolling,n=a.scrollDirection,i=a.scrollOffset;if(0===t)return[0,0,0,0];var o=m(this.props,i,this._instanceProps),u=g(this.props,o,i,this._instanceProps),c=s&&"backward"!==n?1:Math.max(1,r),d=s&&"forward"!==n?1:Math.max(1,r);return[Math.max(0,o-c),Math.max(0,Math.min(t-1,u+d)),o,u]},t}(o.PureComponent),t.defaultProps={direction:"ltr",itemData:void 0,layout:"vertical",overscanCount:2,useIsScrolling:!1},t}var f=function(e,t){e.children,e.direction,e.height,e.layout,e.innerTagName,e.outerTagName,e.width,t.instance},m=function(e,t,r){var a=e.itemSize,s=r.itemMetadataMap,n=r.lastMeasuredIndex;if(t>n){var i=0;if(n>=0){var o=s[n];i=o.offset+o.size}for(var u=n+1;u<=t;u++){var c=a(u);s[u]={offset:i,size:c},i+=c}r.lastMeasuredIndex=t}return s[t]},g=function(e,t,r,a,s){for(;a<=r;){var n=a+Math.floor((r-a)/2),i=m(e,n,t).offset;if(i===s)return n;i<s?a=n+1:i>s&&(r=n-1)}return a>0?a-1:0},y=function(e,t,r,a){for(var s=e.itemCount,n=1;r<s&&m(e,r,t).offset<a;)r+=n,n*=2;return g(e,t,Math.min(r,s-1),Math.floor(r/2),a)},C=function(e,t){var r=e.itemCount,a=t.itemMetadataMap,s=t.estimatedItemSize,n=t.lastMeasuredIndex,i=0;if(n>=r&&(n=r-1),n>=0){var o=a[n];i=o.offset+o.size}return i+(r-n-1)*s},k=v({getItemOffset:function(e,t,r){return m(e,t,r).offset},getItemSize:function(e,t,r){return r.itemMetadataMap[t].size},getEstimatedTotalSize:C,getOffsetForIndexAndAlignment:function(e,t,r,a,s){var n=e.direction,i=e.height,o=e.layout,u=e.width,c="horizontal"===n||"horizontal"===o?u:i,d=m(e,t,s),l=C(e,s),p=Math.max(0,Math.min(l-c,d.offset)),h=Math.max(0,d.offset-c+d.size);switch("smart"===r&&(r=a>=h-c&&a<=p+c?"auto":"center"),r){case"start":return p;case"end":return h;case"center":return Math.round(h+(p-h)/2);default:return a>=h&&a<=p?a:a<h?h:p}},getStartIndexForOffset:function(e,t,r){return function(e,t,r){var a=t.itemMetadataMap,s=t.lastMeasuredIndex;return(s>0?a[s].offset:0)>=r?g(e,t,s,0,r):y(e,t,Math.max(0,s),r)}(e,r,t)},getStopIndexForStartIndex:function(e,t,r,a){for(var s=e.direction,n=e.height,i=e.itemCount,o=e.layout,u=e.width,c="horizontal"===s||"horizontal"===o?u:n,d=m(e,t,a),l=r+c,p=d.offset+d.size,h=t;h<i-1&&p<l;)h++,p+=m(e,h,a).size;return h},initInstanceProps:function(e,t){var r={itemMetadataMap:{},estimatedItemSize:e.estimatedItemSize||50,lastMeasuredIndex:-1};return t.resetAfterIndex=function(e,a){void 0===a&&(a=!0),r.lastMeasuredIndex=Math.min(r.lastMeasuredIndex,e-1),t._getItemStyleCache(-1),a&&t.forceUpdate()},r},shouldResetStyleCacheOnItemSizeChange:!1,validateProps:function(e){e.itemSize}}),b=v({getItemOffset:function(e,t){return t*e.itemSize},getItemSize:function(e,t){return e.itemSize},getEstimatedTotalSize:function(e){var t=e.itemCount;return e.itemSize*t},getOffsetForIndexAndAlignment:function(e,t,r,a){var s=e.direction,n=e.height,i=e.itemCount,o=e.itemSize,u=e.layout,c=e.width,d="horizontal"===s||"horizontal"===u?c:n,l=Math.max(0,i*o-d),p=Math.min(l,t*o),h=Math.max(0,t*o-d+o);switch("smart"===r&&(r=a>=h-d&&a<=p+d?"auto":"center"),r){case"start":return p;case"end":return h;case"center":var v=Math.round(h+(p-h)/2);return v<Math.ceil(d/2)?0:v>l+Math.floor(d/2)?l:v;default:return a>=h&&a<=p?a:a<h?h:p}},getStartIndexForOffset:function(e,t){var r=e.itemCount,a=e.itemSize;return Math.max(0,Math.min(r-1,Math.floor(t/a)))},getStopIndexForStartIndex:function(e,t,r){var a=e.direction,s=e.height,n=e.itemCount,i=e.itemSize,o=e.layout,u=e.width,c=t*i,d="horizontal"===a||"horizontal"===o?u:s,l=Math.ceil((d+r-c)/i);return Math.max(0,Math.min(n-1,t+l-1))},initInstanceProps:function(e){},shouldResetStyleCacheOnItemSizeChange:!0,validateProps:function(e){e.itemSize}})},39352:(e,t,r)=>{"use strict";r.d(t,{default:()=>y});var a=r(896156),s=r(306610),n=r(5991),i=r(858848),o=r(290808),u=r(931807),c=r.n(u),d=null,l=null;function p(){if(null===d){if("undefined"==typeof document)return d=0;var e=document.body,t=document.createElement("div");t.classList.add("simplebar-hide-scrollbar"),e.appendChild(t);var r=t.getBoundingClientRect().right;e.removeChild(t),d=r}return d}function h(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView?e.ownerDocument.defaultView:window}function v(e){return e&&e.ownerDocument?e.ownerDocument:document}function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}c()&&window.addEventListener("resize",(function(){l!==window.devicePixelRatio&&(l=window.devicePixelRatio,d=null)}));var g=function(){function e(t){var r=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.default)(this,e),this.onScroll=function(){var e=h(r.el);r.scrollXTicking||(e.requestAnimationFrame(r.scrollX),r.scrollXTicking=!0),r.scrollYTicking||(e.requestAnimationFrame(r.scrollY),r.scrollYTicking=!0),r.isScrolling||(r.isScrolling=!0,r.el.classList.add(r.classNames.scrolling)),r.onStopScrolling()},this.scrollX=function(){r.axis.x.isOverflowing&&r.positionScrollbar("x"),r.scrollXTicking=!1},this.scrollY=function(){r.axis.y.isOverflowing&&r.positionScrollbar("y"),r.scrollYTicking=!1},this.onStopScrolling=function(){r.el.classList.remove(r.classNames.scrolling),r.isScrolling=!1},this.onMouseEnter=function(){r.isMouseEntering||(r.el.classList.add(r.classNames.mouseEntered),r.isMouseEntering=!0),r.onMouseEntered()},this.onMouseEntered=function(){r.el.classList.remove(r.classNames.mouseEntered),r.isMouseEntering=!1},this.onMouseMove=function(e){r.mouseX=e.clientX,r.mouseY=e.clientY,(r.axis.x.isOverflowing||r.axis.x.forceVisible)&&r.onMouseMoveForAxis("x"),(r.axis.y.isOverflowing||r.axis.y.forceVisible)&&r.onMouseMoveForAxis("y")},this.onMouseLeave=function(){r.onMouseMove.cancel(),(r.axis.x.isOverflowing||r.axis.x.forceVisible)&&r.onMouseLeaveForAxis("x"),(r.axis.y.isOverflowing||r.axis.y.forceVisible)&&r.onMouseLeaveForAxis("y"),r.mouseX=-1,r.mouseY=-1},this.onWindowResize=function(){r.scrollbarWidth=e.getScrollbarWidth(),r.hideNativeScrollbar()},this.onPointerEvent=function(e){var t,a;r.axis.x.track.rect=r.axis.x.track.el.getBoundingClientRect(),r.axis.y.track.rect=r.axis.y.track.el.getBoundingClientRect(),(r.axis.x.isOverflowing||r.axis.x.forceVisible)&&(t=r.isWithinBounds(r.axis.x.track.rect)),(r.axis.y.isOverflowing||r.axis.y.forceVisible)&&(a=r.isWithinBounds(r.axis.y.track.rect)),(t||a)&&(e.stopPropagation(),"pointerdown"===e.type&&"touch"!==e.pointerType&&(t&&(r.axis.x.scrollbar.rect=r.axis.x.scrollbar.el.getBoundingClientRect(),r.isWithinBounds(r.axis.x.scrollbar.rect)?r.onDragStart(e,"x"):r.onTrackClick(e,"x")),a&&(r.axis.y.scrollbar.rect=r.axis.y.scrollbar.el.getBoundingClientRect(),r.isWithinBounds(r.axis.y.scrollbar.rect)?r.onDragStart(e,"y"):r.onTrackClick(e,"y"))))},this.drag=function(t){var a=r.axis[r.draggedAxis].track,s=a.rect[r.axis[r.draggedAxis].sizeAttr],n=r.axis[r.draggedAxis].scrollbar,i=r.contentWrapperEl[r.axis[r.draggedAxis].scrollSizeAttr],o=parseInt(r.elStyles[r.axis[r.draggedAxis].sizeAttr],10);t.preventDefault(),t.stopPropagation();var u=(("y"===r.draggedAxis?t.pageY:t.pageX)-a.rect[r.axis[r.draggedAxis].offsetAttr]-r.axis[r.draggedAxis].dragOffset)/(s-n.size)*(i-o);"x"===r.draggedAxis&&(u=r.isRtl&&e.getRtlHelpers().isScrollOriginAtZero?u-(s+n.size):u),r.contentWrapperEl[r.axis[r.draggedAxis].scrollOffsetAttr]=u},this.onEndDrag=function(e){var t=v(r.el),a=h(r.el);e.preventDefault(),e.stopPropagation(),r.el.classList.remove(r.classNames.dragging),t.removeEventListener("mousemove",r.drag,!0),t.removeEventListener("mouseup",r.onEndDrag,!0),r.removePreventClickId=a.setTimeout((function(){t.removeEventListener("click",r.preventClick,!0),t.removeEventListener("dblclick",r.preventClick,!0),r.removePreventClickId=null}))},this.preventClick=function(e){e.preventDefault(),e.stopPropagation()},this.el=t,this.minScrollbarWidth=20,this.stopScrollDelay=175,this.options=m(m({},e.defaultOptions),a),this.classNames=m({contentEl:"simplebar-content",contentWrapper:"simplebar-content-wrapper",offset:"simplebar-offset",mask:"simplebar-mask",wrapper:"simplebar-wrapper",placeholder:"simplebar-placeholder",scrollbar:"simplebar-scrollbar",track:"simplebar-track",heightAutoObserverWrapperEl:"simplebar-height-auto-observer-wrapper",heightAutoObserverEl:"simplebar-height-auto-observer",visible:"simplebar-visible",horizontal:"simplebar-horizontal",vertical:"simplebar-vertical",hover:"simplebar-hover",dragging:"simplebar-dragging",scrolling:"simplebar-scrolling",scrollable:"simplebar-scrollable",mouseEntered:"simplebar-mouse-entered"},this.options.classNames),this.axis={x:{scrollOffsetAttr:"scrollLeft",sizeAttr:"width",scrollSizeAttr:"scrollWidth",offsetSizeAttr:"offsetWidth",offsetAttr:"left",overflowAttr:"overflowX",dragOffset:0,isOverflowing:!0,isVisible:!1,forceVisible:!1,track:{},scrollbar:{}},y:{scrollOffsetAttr:"scrollTop",sizeAttr:"height",scrollSizeAttr:"scrollHeight",offsetSizeAttr:"offsetHeight",offsetAttr:"top",overflowAttr:"overflowY",dragOffset:0,isOverflowing:!0,isVisible:!1,forceVisible:!1,track:{},scrollbar:{}}},this.removePreventClickId=null,this.isScrolling=!1,this.isMouseEntering=!1,e.instances.has(this.el)||(a.classNames&&console.warn("simplebar: classNames option is deprecated. Please override the styles with CSS instead."),a.autoHide&&console.warn("simplebar: autoHide option is deprecated. Please use CSS instead: '.simplebar-scrollbar::before { opacity: 0.5 };' for autoHide: false"),this.onMouseMove=(0,i.default)(this.onMouseMove,64),this.onWindowResize=(0,o.default)(this.onWindowResize,64,{leading:!0}),this.onStopScrolling=(0,o.default)(this.onStopScrolling,this.stopScrollDelay),this.onMouseEntered=(0,o.default)(this.onMouseEntered,this.stopScrollDelay),this.init())}return(0,n.default)(e,[{key:"init",value:function(){e.instances.set(this.el,this),c()&&(this.initDOM(),this.rtlHelpers=e.getRtlHelpers(),this.scrollbarWidth=e.getScrollbarWidth(),this.recalculate(),this.initListeners())}},{key:"initDOM",value:function(){var e=this;if(Array.prototype.filter.call(this.el.children,(function(t){return t.classList.contains(e.classNames.wrapper)})).length)this.wrapperEl=this.el.querySelector(".".concat(this.classNames.wrapper)),this.contentWrapperEl=this.options.scrollableNode||this.el.querySelector(".".concat(this.classNames.contentWrapper)),this.contentEl=this.options.contentNode||this.el.querySelector(".".concat(this.classNames.contentEl)),this.offsetEl=this.el.querySelector(".".concat(this.classNames.offset)),this.maskEl=this.el.querySelector(".".concat(this.classNames.mask)),this.placeholderEl=this.findChild(this.wrapperEl,".".concat(this.classNames.placeholder)),this.heightAutoObserverWrapperEl=this.el.querySelector(".".concat(this.classNames.heightAutoObserverWrapperEl)),this.heightAutoObserverEl=this.el.querySelector(".".concat(this.classNames.heightAutoObserverEl)),this.axis.x.track.el=this.findChild(this.el,".".concat(this.classNames.track,".").concat(this.classNames.horizontal)),this.axis.y.track.el=this.findChild(this.el,".".concat(this.classNames.track,".").concat(this.classNames.vertical));else{for(this.wrapperEl=document.createElement("div"),this.contentWrapperEl=document.createElement("div"),this.offsetEl=document.createElement("div"),this.maskEl=document.createElement("div"),this.contentEl=document.createElement("div"),this.placeholderEl=document.createElement("div"),this.heightAutoObserverWrapperEl=document.createElement("div"),this.heightAutoObserverEl=document.createElement("div"),this.wrapperEl.classList.add(this.classNames.wrapper),this.contentWrapperEl.classList.add(this.classNames.contentWrapper),this.offsetEl.classList.add(this.classNames.offset),this.maskEl.classList.add(this.classNames.mask),this.contentEl.classList.add(this.classNames.contentEl),this.placeholderEl.classList.add(this.classNames.placeholder),this.heightAutoObserverWrapperEl.classList.add(this.classNames.heightAutoObserverWrapperEl),this.heightAutoObserverEl.classList.add(this.classNames.heightAutoObserverEl);this.el.firstChild;)this.contentEl.appendChild(this.el.firstChild);this.contentWrapperEl.appendChild(this.contentEl),this.offsetEl.appendChild(this.contentWrapperEl),this.maskEl.appendChild(this.offsetEl),this.heightAutoObserverWrapperEl.appendChild(this.heightAutoObserverEl),this.wrapperEl.appendChild(this.heightAutoObserverWrapperEl),this.wrapperEl.appendChild(this.maskEl),this.wrapperEl.appendChild(this.placeholderEl),this.el.appendChild(this.wrapperEl)}if(!this.axis.x.track.el||!this.axis.y.track.el){var t=document.createElement("div"),r=document.createElement("div");t.classList.add(this.classNames.track),r.classList.add(this.classNames.scrollbar),t.appendChild(r),this.axis.x.track.el=t.cloneNode(!0),this.axis.x.track.el.classList.add(this.classNames.horizontal),this.axis.y.track.el=t.cloneNode(!0),this.axis.y.track.el.classList.add(this.classNames.vertical),this.el.appendChild(this.axis.x.track.el),this.el.appendChild(this.axis.y.track.el)}this.axis.x.scrollbar.el=this.axis.x.track.el.querySelector(".".concat(this.classNames.scrollbar)),this.axis.y.scrollbar.el=this.axis.y.track.el.querySelector(".".concat(this.classNames.scrollbar)),this.options.autoHide||(this.axis.x.scrollbar.el.classList.add(this.classNames.visible),this.axis.y.scrollbar.el.classList.add(this.classNames.visible)),this.el.setAttribute("data-simplebar","init")}},{key:"initListeners",value:function(){var e=this,t=h(this.el);if(this.el.addEventListener("mouseenter",this.onMouseEnter),this.el.addEventListener("pointerdown",this.onPointerEvent,!0),this.el.addEventListener("mousemove",this.onMouseMove),this.el.addEventListener("mouseleave",this.onMouseLeave),this.contentWrapperEl.addEventListener("scroll",this.onScroll),t.addEventListener("resize",this.onWindowResize),window.ResizeObserver){var r=!1,a=t.ResizeObserver||ResizeObserver;this.resizeObserver=new a((function(){r&&t.requestAnimationFrame((function(){e.recalculate()}))})),this.resizeObserver.observe(this.el),this.resizeObserver.observe(this.contentEl),t.requestAnimationFrame((function(){r=!0}))}this.mutationObserver=new t.MutationObserver((function(){t.requestAnimationFrame((function(){e.recalculate()}))})),this.mutationObserver.observe(this.contentEl,{childList:!0,subtree:!0,characterData:!0})}},{key:"recalculate",value:function(){var e=h(this.el);this.elStyles=e.getComputedStyle(this.el),this.isRtl="rtl"===this.elStyles.direction;var t=this.contentEl.offsetWidth,r=this.heightAutoObserverEl.offsetHeight<=1,a=this.heightAutoObserverEl.offsetWidth<=1||t>0,s=this.contentWrapperEl.offsetWidth,n=this.elStyles.overflowX,i=this.elStyles.overflowY;this.contentEl.style.padding="".concat(this.elStyles.paddingTop," ").concat(this.elStyles.paddingRight," ").concat(this.elStyles.paddingBottom," ").concat(this.elStyles.paddingLeft),this.wrapperEl.style.margin="-".concat(this.elStyles.paddingTop," -").concat(this.elStyles.paddingRight," -").concat(this.elStyles.paddingBottom," -").concat(this.elStyles.paddingLeft);var o=this.contentEl.scrollHeight,u=this.contentEl.scrollWidth;this.contentWrapperEl.style.height=r?"auto":"100%",this.placeholderEl.style.width=a?"".concat(t||u,"px"):"auto",this.placeholderEl.style.height="".concat(o,"px");var c=this.contentWrapperEl.offsetHeight;this.axis.x.isOverflowing=0!==t&&u>t,this.axis.y.isOverflowing=o>c,this.axis.x.isOverflowing="hidden"!==n&&this.axis.x.isOverflowing,this.axis.y.isOverflowing="hidden"!==i&&this.axis.y.isOverflowing,this.axis.x.forceVisible="x"===this.options.forceVisible||!0===this.options.forceVisible,this.axis.y.forceVisible="y"===this.options.forceVisible||!0===this.options.forceVisible,this.hideNativeScrollbar();var d=this.axis.x.isOverflowing?this.scrollbarWidth:0,l=this.axis.y.isOverflowing?this.scrollbarWidth:0;this.axis.x.isOverflowing=this.axis.x.isOverflowing&&u>s-l,this.axis.y.isOverflowing=this.axis.y.isOverflowing&&o>c-d,this.axis.x.scrollbar.size=this.getScrollbarSize("x"),this.axis.y.scrollbar.size=this.getScrollbarSize("y"),this.axis.x.scrollbar.el.style.width="".concat(this.axis.x.scrollbar.size,"px"),this.axis.y.scrollbar.el.style.height="".concat(this.axis.y.scrollbar.size,"px"),this.positionScrollbar("x"),this.positionScrollbar("y"),this.toggleTrackVisibility("x"),this.toggleTrackVisibility("y")}},{key:"getScrollbarSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";if(!this.axis[e].isOverflowing)return 0;var t,r=this.contentEl[this.axis[e].scrollSizeAttr],a=this.axis[e].track.el[this.axis[e].offsetSizeAttr],s=a/r;return t=Math.max(~~(s*a),this.options.scrollbarMinSize),this.options.scrollbarMaxSize&&(t=Math.min(t,this.options.scrollbarMaxSize)),t}},{key:"positionScrollbar",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";if(this.axis[t].isOverflowing){var r=this.contentWrapperEl[this.axis[t].scrollSizeAttr],a=this.axis[t].track.el[this.axis[t].offsetSizeAttr],s=parseInt(this.elStyles[this.axis[t].sizeAttr],10),n=this.axis[t].scrollbar,i=this.contentWrapperEl[this.axis[t].scrollOffsetAttr],o=(i="x"===t&&this.isRtl&&e.getRtlHelpers().isScrollOriginAtZero?-i:i)/(r-s),u=~~((a-n.size)*o);u="x"===t&&this.isRtl&&e.getRtlHelpers().isScrollingToNegative?-u+(a-n.size):u,n.el.style.transform="x"===t?"translate3d(".concat(u,"px, 0, 0)"):"translate3d(0, ".concat(u,"px, 0)")}}},{key:"toggleTrackVisibility",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y",t=this.axis[e].track.el,r=this.axis[e].scrollbar.el;this.axis[e].isOverflowing||this.axis[e].forceVisible?(t.style.visibility="visible",this.contentWrapperEl.style[this.axis[e].overflowAttr]="scroll",this.el.classList.add("".concat(this.classNames.scrollable,"-").concat(e))):(t.style.visibility="hidden",this.contentWrapperEl.style[this.axis[e].overflowAttr]="hidden",this.el.classList.remove("".concat(this.classNames.scrollable,"-").concat(e))),this.axis[e].isOverflowing?r.style.display="block":r.style.display="none"}},{key:"hideNativeScrollbar",value:function(){this.offsetEl.style[this.isRtl?"left":"right"]=this.axis.y.isOverflowing||this.axis.y.forceVisible?"-".concat(this.scrollbarWidth,"px"):0,this.offsetEl.style.bottom=this.axis.x.isOverflowing||this.axis.x.forceVisible?"-".concat(this.scrollbarWidth,"px"):0}},{key:"onMouseMoveForAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";this.axis[e].track.rect=this.axis[e].track.el.getBoundingClientRect(),this.axis[e].scrollbar.rect=this.axis[e].scrollbar.el.getBoundingClientRect();var t=this.isWithinBounds(this.axis[e].scrollbar.rect);t?this.axis[e].scrollbar.el.classList.add(this.classNames.hover):this.axis[e].scrollbar.el.classList.remove(this.classNames.hover),this.isWithinBounds(this.axis[e].track.rect)?this.axis[e].track.el.classList.add(this.classNames.hover):this.axis[e].track.el.classList.remove(this.classNames.hover)}},{key:"onMouseLeaveForAxis",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";this.axis[e].track.el.classList.remove(this.classNames.hover),this.axis[e].scrollbar.el.classList.remove(this.classNames.hover)}},{key:"onDragStart",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y",r=v(this.el),a=h(this.el),s=this.axis[t].scrollbar,n="y"===t?e.pageY:e.pageX;this.axis[t].dragOffset=n-s.rect[this.axis[t].offsetAttr],this.draggedAxis=t,this.el.classList.add(this.classNames.dragging),r.addEventListener("mousemove",this.drag,!0),r.addEventListener("mouseup",this.onEndDrag,!0),null===this.removePreventClickId?(r.addEventListener("click",this.preventClick,!0),r.addEventListener("dblclick",this.preventClick,!0)):(a.clearTimeout(this.removePreventClickId),this.removePreventClickId=null)}},{key:"onTrackClick",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";if(this.options.clickOnTrack){e.preventDefault();var a=h(this.el);this.axis[r].scrollbar.rect=this.axis[r].scrollbar.el.getBoundingClientRect();var s=this.axis[r].scrollbar,n=s.rect[this.axis[r].offsetAttr],i=parseInt(this.elStyles[this.axis[r].sizeAttr],10),o=this.contentWrapperEl[this.axis[r].scrollOffsetAttr],u="y"===r?this.mouseY-n:this.mouseX-n,c=u<0?-1:1,d=-1===c?o-i:o+i,l=40,p=function e(){-1===c?o>d&&(o-=l,t.contentWrapperEl[t.axis[r].scrollOffsetAttr]=o,a.requestAnimationFrame(e)):o<d&&(o+=l,t.contentWrapperEl[t.axis[r].scrollOffsetAttr]=o,a.requestAnimationFrame(e))};p()}}},{key:"getContentElement",value:function(){return this.contentEl}},{key:"getScrollElement",value:function(){return this.contentWrapperEl}},{key:"removeListeners",value:function(){var e=h(this.el);this.el.removeEventListener("mouseenter",this.onMouseEnter),this.el.removeEventListener("pointerdown",this.onPointerEvent,!0),this.el.removeEventListener("mousemove",this.onMouseMove),this.el.removeEventListener("mouseleave",this.onMouseLeave),this.contentWrapperEl&&this.contentWrapperEl.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onWindowResize),this.mutationObserver&&this.mutationObserver.disconnect(),this.resizeObserver&&this.resizeObserver.disconnect(),this.onMouseMove.cancel(),this.onWindowResize.cancel(),this.onStopScrolling.cancel(),this.onMouseEntered.cancel()}},{key:"unMount",value:function(){this.removeListeners(),e.instances.delete(this.el)}},{key:"isWithinBounds",value:function(e){return this.mouseX>=e.left&&this.mouseX<=e.left+e.width&&this.mouseY>=e.top&&this.mouseY<=e.top+e.height}},{key:"findChild",value:function(e,t){var r=e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector;return Array.prototype.filter.call(e.children,(function(e){return r.call(e,t)}))[0]}}],[{key:"getRtlHelpers",value:function(){if(e.rtlHelpers)return e.rtlHelpers;var t=document.createElement("div");t.innerHTML='<div class="simplebar-dummy-scrollbar-size"><div></div></div>';var r=t.firstElementChild,a=r.firstElementChild;document.body.appendChild(r),r.scrollLeft=0;var s=e.getOffset(r),n=e.getOffset(a);r.scrollLeft=-999;var i=e.getOffset(a);return document.body.removeChild(r),e.rtlHelpers={isScrollOriginAtZero:s.left!==n.left,isScrollingToNegative:n.left!==i.left},e.rtlHelpers}},{key:"getScrollbarWidth",value:function(){try{return"none"===getComputedStyle(this.contentWrapperEl,"::-webkit-scrollbar").display||"scrollbarWidth"in document.documentElement.style||"-ms-overflow-style"in document.documentElement.style?0:p()}catch(e){return p()}}},{key:"getOffset",value:function(e){var t=e.getBoundingClientRect(),r=v(e),a=h(e);return{top:t.top+(a.pageYOffset||r.documentElement.scrollTop),left:t.left+(a.pageXOffset||r.documentElement.scrollLeft)}}}]),e}();g.defaultOptions={autoHide:!0,forceVisible:!1,clickOnTrack:!0,scrollbarMinSize:25,scrollbarMaxSize:0},g.instances=new WeakMap;const y=g},804590:(e,t,r)=>{"use strict";r.d(t,{default:()=>h});var a=r(722122),s=r(896156),n=r(781253),i=r(667294),o=r(45697),u=r.n(o),c=r(39352);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=i.forwardRef((function(e,t){var r=e.children,s=e.scrollableNodeProps,o=void 0===s?{}:s,u=(0,n.default)(e,["children","scrollableNodeProps"]),d=(0,i.useRef)(),p=(0,i.useRef)(),h=(0,i.useRef)(),v={},f={};return Object.keys(u).forEach((function(e){Object.prototype.hasOwnProperty.call(c.default.defaultOptions,e)?v[e]=u[e]:f[e]=u[e]})),(0,i.useEffect)((function(){var e;return d.current=o.ref?o.ref.current:d.current,p.current&&(e=new c.default(p.current,l(l(l({},v),d&&{scrollableNode:d.current}),h.current&&{contentNode:h.current})),t&&(t.current=e)),function(){e.unMount(),e=null}}),[]),i.createElement("div",(0,a.default)({ref:p,"data-simplebar":!0},f),i.createElement("div",{className:"simplebar-wrapper"},i.createElement("div",{className:"simplebar-height-auto-observer-wrapper"},i.createElement("div",{className:"simplebar-height-auto-observer"})),i.createElement("div",{className:"simplebar-mask"},i.createElement("div",{className:"simplebar-offset"},"function"==typeof r?r({scrollableNodeRef:d,contentNodeRef:h}):i.createElement("div",(0,a.default)({},o,{className:"simplebar-content-wrapper".concat(o.className?" ".concat(o.className):"")}),i.createElement("div",{className:"simplebar-content"},r)))),i.createElement("div",{className:"simplebar-placeholder"})),i.createElement("div",{className:"simplebar-track simplebar-horizontal"},i.createElement("div",{className:"simplebar-scrollbar"})),i.createElement("div",{className:"simplebar-track simplebar-vertical"},i.createElement("div",{className:"simplebar-scrollbar"})))}));p.displayName="SimpleBar",p.propTypes={children:u().oneOfType([u().node,u().func]),scrollableNodeProps:u().object};const h=p},906978:(e,t,r)=>{"use strict";r.d(t,{API_ERROR_UNKNOWN:()=>a,API_ERROR_AUTH:()=>s,API_ERROR_CAPTCHA:()=>n,API_ERROR_ACCESS:()=>i,API_ERROR_AUTH_VALIDATION:()=>o,API_ERROR_PARAM:()=>u,API_ERROR_LIMITS:()=>c,API_ERROR_MESSAGES_CHAT_USER_NO_ACCESS:()=>d,API_ERROR_MESSAGES_CHAT_NOT_ADMIN:()=>l,API_ERROR_MESSAGES_GROUP_PEER_ACCESS:()=>p,API_ERROR_MESSAGES_CONTACT_NOT_FOUND:()=>h,API_ERROR_MESSAGES_MESSAGE_REQUEST_ALREADY_SENT:()=>v,API_ERROR_MESSAGES_CHAT_DISABLED:()=>f,API_ERROR_MESSAGES_CHAT_UNSUPPORTED:()=>m,API_ERROR_MESSAGES_MEMBER_ACCESS_TO_GROUP_DENIED:()=>g,API_ERROR_MESSAGES_CHAT_MEMBER_NOT_STAFF:()=>y});const a=1,s=5,n=14,i=15,o=17,u=100,c=103,d=917,l=925,p=932,h=936,v=939,f=945,m=946,g=947,y=967}}]);try{stManager.done("dist/3bad6e117063d3681bf4f60574b483cc.dfe4ffe470b5f201f9c0.js")}catch(e){}