/*! For license information please see imn.32e7da6e30c04b337ffe.js.LICENSE.txt */
(()=>{var __webpack_modules__={520797:e=>{e.exports={im_img_prebody:'<div class="im-prebody"> <img alt="" src="%photo%" /> </div>',im_admin_link:' (<a href="%href%" class="_im_admin_name" target="_blank">%name%</a>)',im_right_menu_tpl:'<a id="ui_rmenu_peer_%peer%" href="%href%" class="_im_peer_tab ui_rmenu_item %cls%" %attrs%>\n  %extra%<span class="ui_rmenu_item_label "><span class="ui_rmenu_label-text">%label%</span></span>\n</a>',im_right_menu_sep:'<div class="ui_rmenu_sep"></div>',im_right_menu_ct:'<div class="ui_rmenu_extra_label"><span class="ui_rmenu_count _im_r_ct _im_r_badge">%count%</span> <button type="button" class="im-right-menu--close _im_r_cl"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button></div>',im_dialogs_link_img:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank"><div class="im_grid">%photo%</div></a>',sImDialogImRowPhoto:'<div class="im_grid">%photo%</div>',im_dialogs_link:'<a href="%href%" class="_im_peer_target _online_reader" target="_blank">%photo%</a>',im_peer_photo:'<div class="nim-peer %online_class% %modifier_class%"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo"> %owner_photo% </div> </div> </div>',im_peer_photo_nft:'<div class="nim-peer %modifier_class%"> %user_photo% %user_icon%</div>',sImContactAvatar:' <div class="ContactAvatar ContactAvatar--%size% %classes%">%name%</div>',sImUserAvatar:' <div class="ImUserAvatar _online %online_class% %classes%"> <img src="%src%" class="ImUserAvatar__img" alt=""> </div>',sImUserNftAvatar:' <div class="ImUserAvatar"> <div class="ImUserAvatar__img" alt=""> <span\nclass="AvatarRich AvatarRich--sz-48 AvatarRich--shadow AvatarRich--nft" style="width: 48px; height: 48px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 3px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%src% class="AvatarRich__img"\n/> <div class="AvatarRich__badge AvatarRich__badge--shadow">%online%</div> </span> </div> </div>',sImDrawNftOnline:' <div class="AvatarRich__badgeIcon--online"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M10 6a4 4 0 1 1-8 0 4 4 0 0 1 8 0z" fill="currentColor"/></svg> </div>',sImDrawNftOnlineMobile:' <div class="AvatarRich__badgeIcon--onlineMobile"> <svg xmlns="http://www.w3.org/2000/svg" width="8" height="12" fill="none" viewBox="0 0 8 12"><path fill="currentColor" d="M5.99 0C7.1 0 8 .9 8 2.01v7.98C8 11.1 7.1 12 5.99 12H2.01C.9 12 0 11.1 0 9.99V2.01C0 .9.9 0 2.01 0h3.98Zm0 3H2a.5.5 0 0 0-.5.5v5c0 .28.23.5.5.5h4a.5.5 0 0 0 .5-.5v-5A.5.5 0 0 0 6 3Z"/></svg> </div>',im_owner_item:'<a href="%link%" class="olist_item_wrap%cls%" id="olist_item_wrap%owner_id%" >\n  <div class="olist_item clear_fix">\n    <div class="olist_item_photo_wrap %img_cls%">\n      <img class="olist_item_photo" src="%photo%"/>\n    </div>\n    <div class="olist_item_name">%name%</div>\n    <div class="olist_checkbox"></div>\n  </div>\n</a>',im_simple_name:function(){return'<div class="im-page--title %more_cls%"> <span class="im-page--title-main" title="%name_attr%" %ads_union%> <span class="im-page--title-main-in"> <a href="%href%" target="_blank" class="im-page--title-main-inner _im_page_peer_name">%name%</a> <span class="im-page--title-main-verified _im_chat_verified"></span> <span class="im-page--title-main-donut _im_chat_donut"></span> </span> </span> <span class="im-page--title-meta _im_page_peer_online">%online%</span> <span class="im-page--title-status _im_page_status"></span> <button class="im-page--title-reconnect _im_page_reconnect">'+getLang("mail_network_reconnect")+"</button> %more_children%</div>"},im_simple_link:'<a href="%href%" class="_im_header_link" target="_blank">%content%</a>',im_selected_messages:'<span class="im-page--selected-messages-count">%label%</span> <button aria-label="%tip%" type="button" class="im-page--selected-messages-remove"></button>',sImSimpleNameBusinessNotifyLabel:'<span class="im-page--title-main-business-notify _im_chat_business_notify">%text%</span>',im_topic:"<div class='im-topic %cls%'>%topic%</div>",im_stack_date:' <a href="%link%" class="_im_mess_link" >%date%</a>',im_dialogs_none:'<li data-list-id="002300" class="im-page--dialogs-empty"> <div class="im-page--dialogs-empty--icon">%icon%</div> %msg%</li>',im_dialogs_active_folder_button:'<li class="im-page--dialogs-folder-button %class_name%" data-list-id="all"> <button class="im-page--dialogs-folder-button--back _im_dialog_folder_back"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.53 4.22a.75.75 0 0 1 0 1.06L7.8 10l4.72 4.72a.75.75 0 1 1-1.06 1.06l-5.25-5.25a.75.75 0 0 1 0-1.06l5.25-5.25a.75.75 0 0 1 1.05 0z" fill="currentColor"/></svg></button> <span class="im-page--dialogs-folder-button--text">%msg%</span> %actions%</li>',im_dialogs_active_folder_button_actions:'<button type="button" class="im-page--dialogs-folder-button--actions _im_dialog_folder_actions" data-folder="%folder%"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M9.53 6.42a.75.75 0 0 1 .94 0l5.25 4.25a.75.75 0 1 1-.94 1.16L10 7.96l-4.78 3.87a.75.75 0 1 1-.94-1.16z" fill="currentColor"/></svg></button>',im_dialogs_message_requests_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-message-requests-button _im_toggle_mr_tab" data-list-id="message_request_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8 2C4.44 2 1.5 4.52 1.5 7.75c0 1.09.34 2.12.95 3.02-.09.4-.36 1.04-.82 1.87a1.08 1.08 0 0 0 .46 1.49c.17.08.36.12.54.12A5.5 5.5 0 0 0 6 13.23a7.4 7.4 0 0 0 2 .28c3.56 0 6.5-2.52 6.5-5.76C14.5 4.52 11.56 2 8 2Zm0 1.5c-2.92 0-5 2.02-5 4.25 0 .8.25 1.55.73 2.22l.13.19a.75.75 0 0 1 .13.57l-.04.23a7.08 7.08 0 0 1-.65 1.74c.87-.1 1.44-.36 1.8-.66l.23-.21a.75.75 0 0 1 .7-.15l.31.1c.52.15 1.08.23 1.66.23 2.92 0 5-2.02 5-4.26 0-2.23-2.08-4.25-5-4.25Zm8.16 5.07a.75.75 0 1 1 1.18-.91A5.46 5.46 0 0 1 18.5 11a5.42 5.42 0 0 1-.91 3.01c.08.41.34 1.05.78 1.9a1.09 1.09 0 0 1-.99 1.59 5.18 5.18 0 0 1-3.23-1.01 6.8 6.8 0 0 1-1.9.27 6.73 6.73 0 0 1-2.57-.5.75.75 0 0 1 .57-1.39 5.22 5.22 0 0 0 2 .39 5.3 5.3 0 0 0 1.57-.24l.3-.09a.75.75 0 0 1 .71.16l.23.2c.33.3.85.54 1.66.65a7.34 7.34 0 0 1-.63-1.74l-.04-.23a.75.75 0 0 1 .12-.55l.13-.19A3.92 3.92 0 0 0 17 11c0-.9-.3-1.73-.84-2.43Z"/></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> </li>',im_dialogs_message_requests_notice:'<li class="im-page--dialogs-message-requests-notice-w" data-list-id="message_request_notice"> <div class="im-page--dialogs-message-requests-notice BannerInfo BannerInfo--noMargin"> %msg% </div> </li>',im_dialogs_business_notify_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-business-notify-button _im_toggle_business_notify_tab %class_name%" data-list-id="business_notify_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="work_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="work_outline_20__Icons-20/work_outline_20"><g id="work_outline_20__work_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M10.8 2c1.11 0 1.51.12 1.92.33.4.22.73.54.95.95.2.38.31.76.33 1.71v.51h1.36c1.04 0 1.45.12 1.86.33.4.22.73.54.95.95.21.4.33.82.33 1.86v1.8c0 .89-.1 1.21-.27 1.54-.17.31-.41.57-.73.74v1.53a3.25 3.25 0 0 1-3.07 3.24l-.18.01h-8.5a3.25 3.25 0 0 1-3.24-3.07l-.01-.18v-1.53l-.13-.08c-.26-.17-.46-.4-.6-.66-.16-.3-.26-.6-.27-1.35v-2c0-1.03.12-1.44.33-1.85.22-.4.54-.73.95-.95.38-.2.76-.31 1.64-.33H6v-.3c0-1.11.12-1.51.33-1.92.22-.4.54-.73.95-.95.38-.2.76-.31 1.71-.33h1.8ZM16 13H4v1.25c0 .92.7 1.67 1.6 1.74l.15.01h8.5c.92 0 1.67-.7 1.74-1.6l.01-.15V13Zm-.47-6H4.47l-.31.01c-.36.02-.52.06-.67.15a.77.77 0 0 0-.33.33c-.1.2-.15.39-.16.98V10.82c.01.2.03.3.06.38l.03.07c.03.06.08.1.14.14l.07.03c.11.04.28.06.76.06h11.88c.48 0 .65-.02.76-.06l.07-.03c.06-.03.1-.08.14-.14l.03-.07c.04-.11.06-.28.06-.76v-1.8c0-.72-.04-.94-.16-1.15a.77.77 0 0 0-.33-.33c-.2-.1-.39-.15-.98-.16Zm-4.56-3.5H8.72c-.33.02-.5.05-.63.1l-.1.06a.77.77 0 0 0-.33.33l-.05.1c-.07.17-.1.4-.1.94l-.01.47h5v-.78a1.82 1.82 0 0 0-.1-.63l-.06-.1a.77.77 0 0 0-.33-.33l-.1-.05a2.6 2.6 0 0 0-.94-.1Z" id="work_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions=""><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',sImBusinessNotifyDisableBoxContent:'<div class="im_bussiness_notify_disable_box"> <div class="im_bussiness_notify_disable_box_text"> %text% </div> </div>',im_dialogs_archives_button:'<li class="im-page--dialogs-folder-button im-page--dialogs-archives-button _im_toggle_archives_tab %class_name%" data-list-id="archive_button_go"> <span class="im-page--dialogs-folder-button--icon"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M7 10.75c0-.41.34-.75.75-.75h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1-.75-.75z"/><path clip-rule="evenodd" d="M14.58 2H5.42c-.53 0-.98 0-1.34.03-.38.03-.74.1-1.08.27-.52.26-.94.68-1.2 1.2-.17.34-.24.7-.27 1.08-.03.36-.03.8-.03 1.34v.42c.02.13.05.3.14.48a1.25 1.25 0 0 0 1.02.67L3 7.5v4.98c0 .81 0 1.47.04 2 .05.55.14 1.03.37 1.47.36.7.93 1.28 1.64 1.64.44.23.92.32 1.47.37.53.04 1.19.04 2 .04h2.96c.81 0 1.47 0 2-.04a3.84 3.84 0 0 0 1.47-.37c.7-.36 1.28-.93 1.64-1.64.23-.44.32-.92.37-1.47.04-.53.04-1.19.04-2V7.5h.34c.13-.02.3-.05.48-.14a1.25 1.25 0 0 0 .67-1.02l.01-.37v-.05c0-.53 0-.98-.03-1.34-.03-.38-.1-.74-.27-1.08A2.75 2.75 0 0 0 17 2.3a2.8 2.8 0 0 0-1.08-.27C15.56 2 15.12 2 14.58 2zm.92 5.5h-11v4.95c0 .85 0 1.45.04 1.9.04.46.1.72.2.92.22.42.57.77.99.98.2.1.46.17.91.21.46.04 1.06.04 1.91.04h2.9c.85 0 1.45 0 1.9-.04.46-.04.72-.1.92-.2.42-.22.77-.57.98-.99.1-.2.17-.46.21-.91.04-.46.04-1.06.04-1.91zM17 6v-.05c0-.57 0-.96-.02-1.25a1.36 1.36 0 0 0-.12-.52 1.25 1.25 0 0 0-.54-.54c-.1-.05-.23-.1-.52-.12-.3-.02-.68-.02-1.25-.02h-9.1c-.57 0-.96 0-1.25.02-.29.03-.43.07-.52.12-.23.12-.42.3-.54.54-.05.1-.1.23-.12.52C3 5 3 5.38 3 5.95V6z" fill-rule="evenodd"/></g></svg></span> <span class="im-page--dialogs-folder-button--text">%msg%</span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--mentions" data-mentions="%mentions%"><svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg></span> <span class="im-page--dialogs-folder-button-badge im-page--dialogs-folder-button--counter">%counter%</span> <button class="im-page--dialogs-folder-button--hide _im_dialog_folder_button_hide"><svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.72 4.72c.3-.3.77-.3 1.06 0L10 8.94l4.22-4.22a.75.75 0 1 1 1.06 1.06L11.06 10l4.22 4.22a.75.75 0 1 1-1.06 1.06L10 11.06l-4.22 4.22a.75.75 0 0 1-1.06-1.06L8.94 10 4.72 5.78a.75.75 0 0 1 0-1.06z" fill="currentColor" fill-rule="evenodd"/></svg></button> </li>',im_dialogs_archive_notice:'<li class="im-page--dialogs-archive-notice-w _im_archive_notice" data-list-id="archive_notice"> <div class="im-page--dialogs-archive-notice"> <span class="im-page--dialogs-archive-notice--title">%title%</span> <span class="im-page--dialogs-archive-notice--text">%text%</span> <button class="im-page--dialogs-archive-notice--close _im_archive_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_dialogs_archive_notice_button:'<button class="im-page--dialogs-archive-notice--button _im_archive_notice_settings">%text%</button>',im_dialogs_new_ui_notice:'<li class="im-page--dialogs-new-ui-notice-w _im_new_ui_notice" data-list-id="new_ui_notice"> <div class="im-page--dialogs-new-ui-notice"> <span class="im-page--dialogs-new-ui-notice--title">%title%</span> <span class="im-page--dialogs-new-ui-notice--text">%text%</span> <button class="im-page--dialogs-new-ui-notice--close _im_new_ui_notice_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button> </div> </li>',im_filter:'<a class="im-page--dialogs-filter %cls%">%filter%</a>',im_drow_prebody:'<span class="nim-dialog--who">%prebody% </span> <span class="nim-dialog--inner-text">%body%</span>',im_attach_mess:' <div class="im-fwd"> <span class="im-fwd--title"> <span class="im-fwd--title-name">%title%</span> <span class="im-fwd--date">%date%</span> </span> <span class="im-fwd--close _im_fwd_close"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> <div rel="button" tab-index="0" type="button" class="im-fwd--messages _im_will_fwd">%messages%</div> </div>',im_preloader:'<div class="im-preloader %cls%"> %preloader%</div>',im_service_row:'<ul class="ui_clean_list"> <li class="im-mess im-mess_srv _im_mess _im_mess_srv _im_mess_%message_id%" data-msgid="%message_id%" data-from="%from_id%" data-ts="%date%"> <div class="im-mess--text">%text%</div> </li> </ul>',im_chat_members:'<button type="button" class="_im_chat_members im-page--members">%name%</button>',im_vkcomgroup_members:'<span class="im-page--members im-page--members--nohover">%name%</span>',im_mess_stack:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peerId%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <a target="_blank" href="%href%"><span\nclass="AvatarRich AvatarRich--sz-36 AvatarRich--shadow AvatarRich--nft" style="width: 36px; height: 36px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% alt="%name%" class="AvatarRich__img"\n/> </span></a> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_name:'<a href="%link%" class="im-mess-stack--lnk%class%" title="" target="_blank">%name%</a>',im_mess_stack_nft:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peer_id%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <a target="_blank" href="%href%"><span\nclass="AvatarRich AvatarRich--sz-36 AvatarRich--shadow AvatarRich--nft" style="width: 36px; height: 36px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% alt="%name%" class="AvatarRich__img"\n/> </span></a> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_mess_stack_no_nft:'<div class="im-mess-stack _im_mess_stack %cls%" data-peer="%peer_id%" data-admin="%admin%"> <div class="im-mess-stack--photo"> <div class="nim-peer nim-peer_small fl_l"> <div class="nim-peer--photo-w"><div class="nim-peer--photo"><a target="_blank" class="im_grid" href="%href%"><img alt="%name%" src="%photo%" /></a></div></div> </div> </div> <div class="im-mess-stack--content"> <div class="im-mess-stack--info"> <div class="im-mess-stack--pname"> %stack_name% <span class="im-mess-stack--tools">%messageMeta%</span> </div> </div> <ul class="ui_clean_list im-mess-stack--mess _im_stack_messages"> %messages% </ul> </div> </div>',im_message_media:'<div class="_im_msg_%type%%messageId%" class="wall_module">%attaches%</div>%text%',im_dialog_media:'<span class="nim-dialog--preview nim-dialog--preview-attach">%name%</span>',im_dialog_deleted_media:function(){return'  <span class="nim-dialog--preview nim-dialog--preview-deleted-attach">\n    '+getLang("mail_attach_deleted")+"\n  </span>"},im_attachment_deleted:'<span class="im-mess--del-attach">%text%</span>',im_typing:'<div class="im-page--typing _im_typing"> <div class="im-activity %cls%"><div class="pr im-activity--icon"><div class="pr_bt"></div><div class="pr_bt"></div><div class="pr_bt"></div></div><span class="_im_typing_name">&nbsp;</span></div> </div>',ctrl_submit_hint:function(){return'<div class="reply_submit_hint_wrap" >\n  <div class="reply_submit_hint_title">'+getLang("wall_reply_submit_settings")+'</div>\n  <div class="reply_submit_hint_opts" id="">\n    <div class="radiobtn %enter_on% _im_submit_btn" data-val="0" onclick="radiobtn(this, 0, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_1")+'</div></div>\n    <div class="radiobtn %ctrl_on% _im_submit_btn" data-val="1" onclick="radiobtn(this, 1, \'im_submit\'); "><div class="radiobtn_label">'+getLang("wall_reply_submit_settings_2")+"</div></div>\n  </div>\n</div>"},im_day_bar:'<h5 class="im-page--history-new-bar im-page--history-new-bar_days _im_bar_date %day_class%" data-date="%date%"><span>%day%</span></h5>',im_mess_bar:function(){return'<h4 class="im-page--history-new-bar _im_unread_bar_row"><span>'+getLang("mail_new_unread_msgs")+"</span></h4>"},im_replied_message:'<div class="im-replied"> <div class="im-replied--photo-wrapper"></div> <div class="im-replied--content"> <div class="im-replied--author"> <span class="im-replied--author-link">%authorName%</span> </div> <div class="im-replied--text">%text%</div> </div> </div>',im_drow:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"><div class="nim-peer--photo _im_dialog_photo">%photo%</div></div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_classic:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <div class="nim-peer--photo-w"><div class="nim-peer--photo _im_dialog_photo">%photo%</div></div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_nft:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <span\nclass="AvatarRich AvatarRich--sz-46 AvatarRich--shadow AvatarRich--nft" style="width: 46px; height: 46px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% alt="%tab_name%" class="AvatarRich__img"\n/> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_nft_classic:function(){return'<li data-list-id="%peer%" class="nim-dialog _im_dialog _im_dialog_%peer% %is_unread% %is_unread_out% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer %is_online% _im_peer_online"> <span\nclass="AvatarRich AvatarRich--sz-50 AvatarRich--shadow AvatarRich--nft" style="width: 50px; height: 50px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 3px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% alt="%tab_name%" class="AvatarRich__img"\n/> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <div class="nim-dialog--date_wrapper"> <button type="button" class="nim-dialog--star _im_dialog_star"></button> <div class="nim-dialog--date _im_dialog_date">%date%</div> </div> %actions% <button type="button" class="nim-dialog--markre _im_dialog_markre"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.78 4.72a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 0 1-1.06 0l-2.5-2.5a.75.75 0 0 1 1.06-1.06l1.97 1.97 5.47-5.47a.75.75 0 0 1 1.06 0zm4.25 0a.75.75 0 0 1 0 1.06l-6 6a.75.75 0 1 1-1.06-1.06l6-6a.75.75 0 0 1 1.06 0z" fill="currentColor"/></svg></button> <div class="_im_dialog_title" title="%title%"> <div class="nim-dialog--name" > <span class="nim-dialog--name-w _im_dialog_name_w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--verfifed _im_dialog_verified"><svg fill="none" height="16" viewBox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg"><path d="M4.5 9.59 2.96 8.04a1 1 0 0 0-1.42 1.42L3.8 11.7a1 1 0 0 0 1.42 0l5.25-5.25a1 1 0 0 0-1.42-1.42z" fill="currentColor"/></svg></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'" role="img" ></span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--mute"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.69 5.5 11 11.8v1.7c0 .3-.23.47-.49.5l-3.63-3.5H4a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h.69Zm.77-2.85 2.2 2.19L10.5 2.5c.27.02.49.2.49.48v5.2l2.6 2.6a.75.75 0 0 1-1.06 1.06L4.4 3.71a.75.75 0 0 1 1.06-1.06Z"/></svg></span> <div class="nim-dialog--peer-tags _im_dialog_peer_tags PeerTags"></div> </div> <div class="nim-dialog--text-preview"> <span class="nim-dialog--preview _dialog_body" tabindex="0">%body%</span> <span class="nim-dialog--typing _im_dialog_typing"></span><span class="nim-dialog--typer-el"></span> </div> </div> <div class="nim-dialog--pinned-conversation" role="img"></div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <label class="blind_label _im_unread_blind_label">%unread_message_string%</label> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <div class="nim-peer--photo-w"> <div class="nim-peer--photo _im_dialog_photo"> %photo% </div> </div> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_conversation_search_nft_row:function(){return'<li data-list-id="%peer%" class="nim-dialog nim-conversation-search-row _im_dialog _im_dialog_%peer% %is_unread% %is_selected% %more%" data-peer="%peer%" data-msgid="%msg_id%"> <div class="nim-dialog--photo"> <div class="nim-peer nim-peer_search %is_online% _im_peer_online"> <span\nclass="AvatarRich AvatarRich--sz-34 AvatarRich--shadow AvatarRich--nft" style="width: 34px; height: 34px; border-radius: unset; --avatar-rich-stroke-width: 2px; --avatar-rich-nft-frame-width: 2px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% class="AvatarRich__img"\n/> </span> </div> </div> <div class="nim-dialog--content"> <div class="nim-dialog--cw"> <span role="link" class="blind_label" aria-label="'+getLang("mail_im_to_multidialog")+': %tab_name%"></span> <button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button> <div class="nim-dialog--name"> <span class="nim-dialog--name-w" aria-hidden="true"> %user_link% </span> <span class="nim-dialog--donut _im_dialog_donut"></span> <span class="nim-dialog--casper _im_dialog_casper" aria-label="'+getLang("mail_casper_chat_label")+'"></span> </div> <div class="nim-dialog--unread_container"> <div class="nim-dialog--unread-badge_reaction nim-dialog--unread-badge" aria-label="'+getLang("mail_reactions_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M2.8.22a.32.32 0 0 0-.6 0l-.25.73a1.6 1.6 0 0 1-1 1l-.73.25a.32.32 0 0 0 0 .6l.73.25c.47.15.85.53 1 1l.25.73a.32.32 0 0 0 .6 0l.25-.73a1.6 1.6 0 0 1 1-1l.73-.25a.32.32 0 0 0 0-.6l-.73-.24a1.6 1.6 0 0 1-1-1.01L2.8.22Zm3.64 3.25c-.26.75-.6 1.5-1.04 1.93a5.3 5.3 0 0 1-1.93 1.03 12.31 12.31 0 0 1-.77.24c-.27.08-.27.58 0 .66a15.19 15.19 0 0 1 .77.23c.75.26 1.5.6 1.94 1.04a5.3 5.3 0 0 1 1.03 1.93 12.45 12.45 0 0 1 .23.77c.08.27.58.27.66 0a14.93 14.93 0 0 1 .23-.77c.26-.75.6-1.5 1.04-1.93a5.3 5.3 0 0 1 1.93-1.03 12.45 12.45 0 0 1 .77-.24c.27-.08.27-.58 0-.66a15.08 15.08 0 0 1-.77-.23c-.75-.26-1.5-.6-1.93-1.03a5.3 5.3 0 0 1-1.03-1.94 12.12 12.12 0 0 1-.24-.77c-.08-.27-.58-.27-.66 0a15.19 15.19 0 0 1-.23.77Z" clip-rule="evenodd"/></svg> </div> <div class="nim-dialog--unread-badge_mention nim-dialog--unread-badge" aria-label="'+getLang("mail_mention_badge_label")+'" role="img"> <svg height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M0 0h12v12H0z"/><path d="M6.17 11c.76 0 1.44-.1 1.89-.25.37-.12.5-.28.5-.49 0-.2-.15-.34-.4-.34-.06 0-.14 0-.23.03-.55.13-.98.21-1.58.21-2.62 0-4.4-1.5-4.4-4.09 0-2.5 1.65-4.24 4.15-4.24 2.18 0 3.95 1.31 3.95 3.73 0 1.25-.47 2.13-1.15 2.13-.44 0-.68-.23-.68-.64V4.08c0-.33-.2-.54-.52-.54s-.53.2-.53.54v.3h-.06c-.25-.53-.82-.84-1.49-.84-1.22 0-2.08 1.01-2.08 2.49 0 1.5.86 2.53 2.12 2.53.71 0 1.26-.34 1.53-.96h.06c.11.61.69.96 1.45.96 1.42 0 2.3-1.28 2.3-3.07C11 2.75 8.95 1 6.11 1 3.09 1 1 2.98 1 6.04 1 9.15 3.16 11 6.17 11zm-.3-3.37c-.75 0-1.2-.6-1.2-1.6 0-.98.46-1.57 1.2-1.57.78 0 1.27.61 1.27 1.57 0 .98-.5 1.6-1.26 1.6z" fill="currentColor" fill-rule="nonzero"/></g></svg> </div> <div class="nim-dialog--unread-badge_bomb nim-dialog--unread-badge" aria-label="'+getLang("mail_expiring_message_badge_label")+'" role="img"> <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="currentColor" viewBox="0 0 12 12"><path d="M7.84 1.49a.6.6 0 0 0-1.18.22l.15.8a.6.6 0 0 0 1.18-.22l-.15-.8Zm2.38.29a.6.6 0 0 1 0 .84l-.6.6a.6.6 0 0 1-.84-.84l.6-.6a.6.6 0 0 1 .84 0Z"/><path fill-rule="evenodd" d="M7.82 4.17a.6.6 0 0 1 0 .85l-.46.47a3.5 3.5 0 1 1-.84-.85l.45-.46a.6.6 0 0 1 .85 0ZM6.8 7.5a2.3 2.3 0 1 1-4.6 0 2.3 2.3 0 0 1 4.6 0Zm4.19-2.64a.6.6 0 0 1-.7.48l-.8-.15a.6.6 0 0 1 .22-1.18l.8.15a.6.6 0 0 1 .48.7Z"/></svg> </div> <div class="nim-dialog--unread _im_dialog_unread_ct" aria-hidden="true">%unread%</div> </div> </div> </div> </li>'},im_drow_actions_menu:'<button type="button" class="nim-dialog--actions _im_dialog_actions" data-peer="%peer_id%"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M13 6.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Zm-5 0a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"/></svg></button>',im_drow_close_button:'<button type="button" class="nim-dialog--close _im_dialog_close" data-peer="%peer_id%"><svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg></button>',im_page_inline_menu:'<ul class="im-page--inline-menu-list"> %actions%</ul>',im_page_inline_menu_item:'<li class="im-page--inline-menu--list-item"> <button class="im-page--inline-menu--button %class_name%" data-action="%action%"> <div class="im-page--inline-menu--button-icon">%icon%</div> <span class="im-page--inline-menu--button-text">%name%</span> </button> </li>',im_delete_actions:function(){return'<span class="nim-dialog--who">%text%</span> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="restore" type="button">'+getLang("mail_restore")+'</button> <button class="nim-dialog--daction ui_bullet _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="spam" type="button">'+getLang("mail_im_mark_spam")+'</button> <button class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction" data-sid=%spam_id% data-peer="%peer%" data-action="block" type="button">'+getLang("mail_user_black_list")+"</button>"},im_chat_change_topic:function(){return'<div class="im_change_topic_wrap clear_fix"> <div class="im_change_topic_label fl_l ta_r">'+getLang("mail_chat_topic_change_label")+'</div> <div class="im_change_topic_labeled fl_l"> <input class="text _im_chat_topic_change_input" value="%value%"/> </div> </div>'},im_msg_row:function(){return'<li class="im-mess %cls% _im_mess_noa _im_mess_%msg_id%" aria-hidden="%aria_hidden%" data-ts="%ts%" data-msgid="%msg_id%" data-cmid="%cmid%" data-peer="%from_id%"> <div class="im-mess--text wall_module _im_log_body">%text%</div> <span tabindex="0" role="link" aria-label="'+getLang("mail_select_message")+'" class="blind_label im-mess--blind-select _im_mess_blind_label_select"></span> <span class="blind_label im-mess--blind-read _im_mess_blind_unread_marker" %unread_params%></span> <span class="im-mess--marker _im_mess_marker" %marker_params%></span> <span class="im-mess--reactions _im_mess_reactions">%reactions%</span> </li>'},sImHistoryRowActions:function(){return'<div class="im-mess--actions"> <span role="link" aria-label="'+getLang("mail_im_set_reaction")+'" class="im-mess--reaction _im_mess_reaction"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.89 4.72a7.42 7.42 0 0 1-1.45 2.72c-.6.6-1.67 1.09-2.72 1.45a16.94 16.94 0 0 1-.8.25l-.27.08c-.39.1-.39.81 0 .92a21.17 21.17 0 0 1 1.07.33c1.05.36 2.11.84 2.72 1.45.6.6 1.09 1.67 1.45 2.72a16.94 16.94 0 0 1 .25.8l.08.27c.1.38.81.38.92 0a22.86 22.86 0 0 1 .27-.88 16.4 16.4 0 0 1 .06-.2c.36-1.04.84-2.1 1.45-2.71.6-.6 1.67-1.09 2.72-1.45a16.39 16.39 0 0 1 .8-.25l.27-.08c.39-.1.39-.82 0-.92a21.17 21.17 0 0 1-1.07-.33 7.44 7.44 0 0 1-2.72-1.45 7.44 7.44 0 0 1-1.45-2.72 16.4 16.4 0 0 1-.25-.8 22.85 22.85 0 0 1-.08-.27c-.1-.39-.81-.39-.92 0a21.17 21.17 0 0 1-.33 1.07ZM3.53.28a.4.4 0 0 0-.76 0l-.3.91a2 2 0 0 1-1.28 1.27l-.92.3a.4.4 0 0 0 0 .77l.92.3a2 2 0 0 1 1.27 1.28l.3.92a.4.4 0 0 0 .77 0l.3-.92a2 2 0 0 1 1.28-1.27l.91-.3a.4.4 0 0 0 0-.77l-.91-.3a2 2 0 0 1-1.27-1.28L3.53.28Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_mark_forward")+'" class="im-mess--forward _im_mess_forward"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_reply")+'" class="im-mess--reply _im_mess_reply"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M7.11 2.36a1.63 1.63 0 0 1 2.65 1.27v1.4c1.57.4 2.84 1.2 3.74 2.35a7.78 7.78 0 0 1 1.5 4.87.75.75 0 0 1-.46.7.75.75 0 0 1-.83-.18 6.23 6.23 0 0 0-1.96-1.48 5.8 5.8 0 0 0-2-.45v1.53a1.63 1.63 0 0 1-2.64 1.27L1.62 9.28a1.63 1.63 0 0 1 0-2.56l5.5-4.36Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_im_edit")+'" class="im-mess--edit _im_mess_edit"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m9.49 3.95 2.56 2.56-6.14 6.14a4.82 4.82 0 0 1-2 1.2l-2.1.64a.24.24 0 0 1-.3-.3l.64-2.1a4.82 4.82 0 0 1 1.2-2L9.5 3.95Zm3.67-2.13 1.02 1.02c.4.4.42 1.03.08 1.45l-1.17 1.18-2.56-2.56 1.1-1.1c.42-.42 1.1-.42 1.53 0Z"/></svg></span> <span role="link" aria-label="'+getLang("mail_important_message")+'" class="im-mess--fav _im_mess_fav"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="m5.75 3.87-.43 1c-.03.06-.04.1-.07.12a.23.23 0 0 1-.07.06c-.03.02-.07.02-.15.03l-.62.1c-1.77.24-2.65.37-3.02.78a1.53 1.53 0 0 0-.37 1.32c.11.55.81 1.1 2.2 2.22l.24.2c.06.05.1.07.11.1a.23.23 0 0 1 .04.1l-.02.15-.07.38c-.39 2.06-.58 3.09-.28 3.59a1.53 1.53 0 0 0 1.24.73c.59.02 1.4-.65 3-1.99l.28-.22c.08-.08.12-.11.17-.12a.23.23 0 0 1 .13 0c.05.01.09.04.17.11l.28.24c1.6 1.33 2.41 2 3 1.98a1.53 1.53 0 0 0 1.24-.73c.3-.5.11-1.53-.28-3.6l-.07-.37a.51.51 0 0 1-.02-.15.23.23 0 0 1 .04-.1l.11-.1.24-.2c1.39-1.11 2.09-1.67 2.2-2.22a1.53 1.53 0 0 0-.37-1.32c-.37-.41-1.25-.54-3.02-.79l-.62-.09c-.08 0-.12-.01-.15-.03a.23.23 0 0 1-.07-.06c-.03-.02-.04-.06-.07-.13l-.43-1c-.71-1.63-1.06-2.45-1.56-2.7a1.52 1.52 0 0 0-1.37 0c-.5.25-.85 1.07-1.56 2.7Z"/></svg></span> </div> <div class="im-mess--check fl_l"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zM6 7.94a.75.75 0 1 0-1 1.12l1.46 1.3c.44.38 1.1.33 1.49-.1l.04-.05 2.9-3.75a.75.75 0 1 0-1.19-.92L7.1 8.91 6 7.94z"/></svg></div>'},im_wrap_mobile:'<b class="mob_onl %class%" %attrs% onmouseover="mobileOnlineTip(this, {%params%})"></b>',im_pinned_message:'<div class="im-page-pinned _im_pinned_message"> <button class="im-page-pinned--hide _im_pin_hide"></button> <div class="im-page-pinned--meta"> <a href="%link%" target="_blank" class="im-page-pinned--name">%name%</a> <span class="im-page-pinned--date">%date%</span> </div> <div class="im-page-pinned--content">%content%</div> </div>',im_pinned_message_media:'<span class="im-page-pinned--media">%text%</span>',im_pinned_message_media_bar:'<div class="im-page-pinned--media-bar">\n  <div class="im-page-pinned--media-bar_progress" style="width: %percent%%;"></div>\n</div>',im_pinned_message_deleted_media:function(){return'  <span class="im-page-pinned--deleted-media">'+getLang("mail_attach_deleted")+"</span>"},im_pinned_messages_promo:'<div class="im-page--mess-actions-promo-content">%content%</div>',im_retry_link:function(){return'<button class="im-page--retry _im_retry_media">'+getLang("mail_retry")+"</button>"},sImLblWasEdited:function(){return" <span class='im-mess--lbl-was-edited _im_edit_time' data-time='%update_time%'>"+getLang("mail_was_edited_short")+"</span>"},sImLblWasSourceInfo:function(){return" <span class='im-mess--lbl-was-edited _im_page_info' data-info='%source%'>"+getLang("mail_was_source_short")+"</span>"},im_top_banner:'<div class="im-top-banner %classes%">\n  %icon%\n  <div class="im-top-banner--text">%text%</div>\n  <div class="im-top-banner--buttons">%buttons%</div>\n</div>',im_top_banner_icon:'<div class="im-top-banner--icon">\n  <img src="%icon%" alt=""/>\n</div>',im_top_banner_button_link:'<a href="%link%" target="_blank" class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small">%text%</a>',im_top_banner_button:'<button class="_im_top_banner_button im-top-banner--button %css_class% flat_button button_small" data-payload="%callback_data%">%text%</button>',im_top_banner_hide_btn:'<button class="im-top-banner--button im-top-banner--button_hide _im_top_banner_hide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></button>',im_calls_link:'<button class="im_srv_lnk_light _fc_call_link">%text%</button>',sImPeerMuteUnmute:'<button class="_im_peer_mute_unmute im-chat-input-block-control im-chat-input-block-control--with-icon im-chat-input-block-control--%type%">%text%</button>',sImPeerAcceptOrRejectMessageRequest:function(){return"<p>"+getLang("mail_message_request_user_notice")+'</p> <p> <button type="button" class="flat_button %cls_accept%">'+getLang("mail_message_request_accept")+'</button> <button type="button" class="flat_button secondary %cls_reject%">'+getLang("mail_message_request_reject")+"</button> </p>"},sImPeerReturnToChat:'<button class="_im_peer_return_to_chat im-chat-input-block-control">%text%</button>',sImCallSnippet:function(){return'<article class="CallSnippet %classes%" %attributes% tabindex="0" aria-label="'+getLang("me_start_call")+'" role="button" > <div class="CallSnippet__users">%user_list%</div> <div class="CallSnippet__content"> <h3 class="CallSnippet__title">%title%</h3> <div class="CallSnippet__desc">%description%</div> </div> %button%</article>'},sImMessageKeyboard:'<div class="MessageKeyboard">%content%</div>',sImMessageKeyboardRow:'<div class="MessageKeyboard__row">%content%</div>',sImMessageKeyboardButton:'<%tagName% class="FlatButton FlatButton--%appearance% FlatButton--size-s MessageKeyboard__button MessageKeyboard__button--%modifier% _im_mess_btn" %attributes%> <span class="FlatButton__in"> <span class="FlatButton__content">%label%</span> </span> </%tagName%>',sImBomb:'<span class="im-mess-stack--bomb %classnames%"></span>',sImEmptyCasper:function(){return' <div class="im-page--casper-empty"> <div class="im-page--casper-empty__icon"><svg width="56" height="56" viewBox="0 0 56 56" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M33.57 34.52c.6.65.57 1.67-.1 2.27-3 2.73-6.35 2.73-9.33 1.1-.74-.4-1.28-.8-1.61-1.1-.67-.6-.7-1.62-.1-2.27a1.66 1.66 0 0 1 2.19-.2l.13.1c.15.14.5.4.97.66 1.86 1.01 3.7 1.01 5.53-.65.67-.6 1.7-.56 2.32.09ZM19.5 22a3.5 3.5 0 1 1 0 7 3.5 3.5 0 0 1 0-7ZM28 4c5.83 0 10.75 2.06 15.26 6.27A20.86 20.86 0 0 1 50 25.05l-.02 20.82c-.07 2.55-1.9 4.56-4.5 4.56-.59-.02-1.3-.12-2.24-.5l-1.92-.81a7.89 7.89 0 0 0-3.08-.81h-.15c-.42.04-.83.24-1.97 1.03l-1.75 1.25C32.16 52.16 30.03 52.93 28 53c-2.04 0-3.83-.69-6-2.18l-1.94-1.37-.55-.38a3.93 3.93 0 0 0-1.48-.74l-.25-.02c-.86 0-1.73.24-3.08.8l-1.93.82c-.8.32-1.22.44-1.7.48l-.55.02c-2.5 0-4.32-1.96-4.5-4.43L6 25.5c0-5.72 2.43-11.2 6.76-15.23C17.16 6.16 22.38 4.11 28 4Zm.02 3-.43.02c-4.78.2-9.12 2.02-12.79 5.44A17.85 17.85 0 0 0 9 25.07v.42l.02 20.37.01.1c.12.86.65 1.4 1.35 1.47h.11l.38-.01h.03c.09-.02.21-.06.44-.15l.26-.1 1.94-.82c1.6-.67 2.76-1 3.98-1.04h.46l.26.03.25.02c.98.15 1.67.51 3.04 1.46l.27.18 1.9 1.35c1.65 1.13 2.83 1.6 4.08 1.65h.16l.23-.01a8.85 8.85 0 0 0 4.14-1.62l.32-.22 1.78-1.27c1.7-1.18 2.52-1.57 3.83-1.57a10 10 0 0 1 3.9.9l.34.14 1.88.8c.51.2.85.27 1.13.28.82 0 1.39-.54 1.48-1.4v-.16L47 25.12a17.86 17.86 0 0 0-5.8-12.66C37.35 8.85 33.28 7.1 28.45 7h-.42Zm11.46 17.85c.6.52.7 1.46.2 2.1-.46.6-1.27.72-1.87.3l-.12-.09-.15-.13c-.9-.7-1.8-.66-2.74-.18l-.28.16-.13.09-.2.15c-.6.42-1.4.3-1.87-.3-.5-.64-.4-1.58.2-2.1.22-.2.57-.44 1.04-.68a5 5 0 0 1 5.92.68Z" fill="currentColor"/></svg></div> '+getLang("mail_im_empty_casper_chat")+" </div>"},sImExpiredMessagePlaceholder:' <div class="im-expired-message _im_expired_message " data-last-msgid="%id_classes%" data-count="%count%"> <a href="/im?w=expired_messages" target="_blank" class="im-expired-message--in"> <span class="im-expired-message--inner">%text%</span> </a> </div>',sImGiftLabel:' <span class="im-mess-stack--gift">%content%</span>',sImMoneyTransferLabel:' <span class="im-mess-stack--money-transfer">%content%</span>',sUiActionsMenuSeparator:'<div class="ui_actions_menu_sep"></div>',sImUiActionMenuItem:'<a tabindex="0" role="link" class="ui_actions_menu_item im-action im-action_%icon% %classes%" data-action="%action%"> %name%</a>',sImPeerTagsItem:' <div class="PeerTagsItem _im_dialog_peer_tag" data-id="%tag_id%" style="background-color: %color%;">%name%</div>',sImPeerTagsAdTag:function(){return' <div class="PeerTagsItem PeerTagsItem--adTag %extra_class%"> <a href="%url%" target="_blank" class="PeerTagsItem__adTagLink"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </a> <button onclick="return showFastBox(\''+getLang("mail_ad_tag_no_access_box_title")+"', '"+getLang("mail_ad_tag_no_access_box_text")+'\');" class="PeerTagsItem__adTagAlert"> <span class="PeerTagsItem__adTagText">%ad_tag_text%</span> </button> </div>'},sImPeerTagsExtra:' <div class="PeerTagsItem PeerTagsItem--extra _im_peer_tags_extra">%text%</div>',sImPeerTagsExtraTooltipItem:' <div class="PeerTagsExtraTooltipItem"> <span class="PeerTagsExtraTooltipItem__color" style="background-color: %color%"></span> <span class="PeerTagsExtraTooltipItem__name">%name%</span> </div>',sImPeerTagsFilterItem:'<div class="PeerTagsFilterItem"> <input class="PeerTagsFilterItem__checkbox _im_peer_tags_filter_checkbox" type="checkbox" id="peer_tag_%tag_id%" %checked%> <label class="PeerTagsFilterItem__label" for="peer_tag_%tag_id%"> <span class="PeerTagsFilterItem__checkboxOff"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.05 2.53C4.79 2.13 5.52 2 7.13 2h5.74c1.61 0 2.34.14 3.08.53.65.35 1.17.87 1.52 1.52.4.74.53 1.47.53 3.08v5.74c0 1.61-.14 2.34-.53 3.08a3.64 3.64 0 0 1-1.52 1.52c-.74.4-1.47.53-3.08.53H7.13c-1.61 0-2.34-.14-3.08-.53a3.64 3.64 0 0 1-1.52-1.52c-.4-.74-.53-1.47-.53-3.08V7.13c0-1.61.14-2.34.53-3.08.35-.65.87-1.17 1.52-1.52Zm3.08.97c-1.53 0-1.96.14-2.38.36-.38.2-.69.5-.9.9-.21.4-.35.84-.35 2.37v5.74c0 1.53.14 1.96.36 2.38.2.38.5.69.9.9.4.21.84.35 2.37.35h5.74c1.53 0 1.96-.14 2.38-.36.38-.2.69-.5.9-.9.21-.4.35-.84.35-2.37V7.13c0-1.53-.14-1.96-.36-2.38-.2-.38-.5-.69-.9-.9-.4-.21-.84-.35-2.37-.35H7.13Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__checkboxOn"> <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.44 4.18C2 5.04 2 6.16 2 8.4v3.2c0 2.24 0 3.36.44 4.22a4 4 0 0 0 1.74 1.74c.86.44 1.98.44 4.22.44h3.2c2.24 0 3.36 0 4.22-.44a4 4 0 0 0 1.74-1.74c.44-.86.44-1.98.44-4.22V8.4c0-2.24 0-3.36-.44-4.22a4 4 0 0 0-1.74-1.74C14.96 2 13.84 2 11.6 2H8.4c-2.24 0-3.36 0-4.22.44a4 4 0 0 0-1.74 1.74Zm12.2 3.8a.9.9 0 1 0-1.28-1.27L8.7 11.38 6.64 9.33a.9.9 0 0 0-1.28 1.27l2.7 2.69a.9.9 0 0 0 1.27 0l5.3-5.3Z" fill="currentColor"/></svg> </span> <span class="PeerTagsFilterItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterItem__name">%name%</span> <span class="PeerTagsFilterItem__count">%count%</span> </label> </div>',sImPeerTagsFilterPaneItem:'<div class="PeerTagsFilterPaneItem _im_peer_tags_filter_pane_item" data-id="%tag_id%"> <span class="PeerTagsFilterPaneItem__color" style="background-color: %color%"></span> <span class="PeerTagsFilterPaneItem__name">%name%</span> <span class="PeerTagsFilterPaneItem__remove"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" d="M12.74 3.26a.9.9 0 0 1 0 1.28L9.27 8l3.47 3.46a.9.9 0 0 1 .08 1.18l-.08.1a.9.9 0 0 1-1.28 0L8 9.27l-3.46 3.47a.9.9 0 0 1-1.28-1.28L6.73 8 3.26 4.54a.9.9 0 0 1-.08-1.18l.08-.1a.9.9 0 0 1 1.28 0L8 6.73l3.46-3.47a.9.9 0 0 1 1.28 0Z"/></svg></span> </div>',sImCallUser:'<img src="%url%" alt="%name%" class="CallUsers__user">',sImCallUsers:'<div class="CallUsers"> <svg xmlns="http://www.w3.org/2000/svg" class="CallUsers__hidden"> <defs> <clipPath id="user-frame"> <path d="M12 0a12 12 0 11-7.97 20.97C5.89 18.47 7 15.37 7 12c0-3.36-1.1-6.47-2.97-8.97A11.95 11.95 0 0112 0z"/> </clipPath> </defs> </svg> <figure class="CallUsers__list"> %users% </figure> </div>',sImCallBannerContent:'<article class="CallBanner %cls%"> <div class="CallBanner__users">%user_list%</div> <div class="CallBanner__content"> <h3 class="CallBanner__title">%title%</h3> <div class="CallBanner__desc">%desc%</div> </div> </article>',sImCallBannerButton:function(){return'<button class="FlatButton FlatButton--secondary FlatButton--size-s _im_call_banner_join_btn _im_top_banner_button" type="button" data-link="%call_link%" >\n  <span class="FlatButton__in FlatButton__in--noPointerEvents">\n    \n    <span class="FlatButton__content">'+getLang("mail_join_chat")+"</span>\n    \n  </span>\n</button>"},sImAudioMsgPlayerASRToggle:' <button onclick="return AudioMessagePlayer.toggleTranscript(this, event);" class="audio-msg-track--transcriptToggle _msg_asr_toggle" > <span class="audio-msg-track--transcriptToggleShow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M1.89 12.11c.46 0 .73-.23.9-.8L3.22 10h3.05l.45 1.33c.15.55.42.78.92.78.51 0 .88-.34.88-.83a1.56 1.56 0 0 0-.11-.56L6.1 4.42c-.25-.69-.66-1-1.36-1-.66 0-1.08.32-1.33 1.01l-2.3 6.29a1.82 1.82 0 0 0-.12.56c0 .5.34.83.9.83ZM3.6 8.63l1.1-3.47h.04l1.12 3.46H3.61Zm7.62 3.47c.78 0 1.57-.4 1.92-1.06h.03v.32c.04.5.36.76.82.76.49 0 .83-.29.83-.86V7.68c0-1.26-1.04-2.1-2.66-2.1-1.3 0-2.3.47-2.6 1.22a.9.9 0 0 0-.09.38c0 .39.3.66.72.66a.86.86 0 0 0 .68-.32c.38-.49.7-.66 1.22-.66.64 0 1.05.34 1.05.93v.41l-1.58.1c-1.57.1-2.45.75-2.45 1.9 0 1.13.91 1.9 2.1 1.9Zm.56-1.24c-.58 0-.96-.29-.96-.76 0-.44.36-.73 1-.78l1.32-.08v.46c0 .68-.61 1.16-1.36 1.16Z"/></svg></span> <span class="audio-msg-track--transcriptToggleHide"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="12" fill="currentColor" viewBox="0 0 16 12"><path d="M4.45 8.31a.9.9 0 0 1-1.1-1.42l4.1-3.2a.9.9 0 0 1 1.1 0l4.1 3.2a.9.9 0 1 1-1.1 1.42L8 5.54 4.45 8.31Z"/></svg></span> </button>',sImCarousel:'<div class="Carousel _im_carousel" data-scroll-count="%scroll_count%"> <button class="Carousel__control Carousel__control--prev Carousel__control--hidden _im_carousel_control _im_carousel_control_left %controls_class%" data-direction="-1"><svg fill="none" height="16" viewBox="0 0 12 16" width="12" xmlns="http://www.w3.org/2000/svg"><path d="m4.77 8 3.37 3.36a.9.9 0 1 1-1.28 1.28l-4-4a.9.9 0 0 1 0-1.28l4-4a.9.9 0 1 1 1.28 1.28z" fill="currentColor"/></svg></button> <button class="Carousel__control Carousel__control--next _im_carousel_control _im_carousel_control_right %controls_class%" data-direction="1"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" fill="none" viewBox="0 0 12 16"><path fill="currentColor" d="M7.23 8 3.86 4.64a.9.9 0 0 1 1.28-1.28l4 4a.9.9 0 0 1 0 1.28l-4 4a.9.9 0 0 1-1.28-1.28L7.23 8Z"/></svg></button> <div class="Carousel__viewport _im_carousel_viewport"> <div class="Carousel__layer _im_carousel_layer"> %content% </div> </div> </div>',sImBotCarousel:'<div class="BotCarousel _im_bot_carousel _im_bot_carousel_%msg_id%"> %content%</div>',sImBotCarouselSlide:'<div class="BotCarousel__slide" data-index="%index%">%content%</div>',sImBotCarouselSlideTitle:'<div class="BotCarousel__slideTitle">%content%</div>',sImBotCarouselSlideDescription:'<div class="BotCarousel__slideDescription">%content%</div>',sImBotCarouselSlideContent:'<div class="BotCarousel__slideContent">%content%</div>',sImBotCarouselSlideLinkWrapper:'<a href="%url%" class="BotCarousel__slideLinkWrapper" target="_blank" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhotoLinkWrapper:'<a href="#" class="BotCarousel__slideLinkWrapper" onclick="return showPhoto(\'%photo_id%\', \'mail%msg_id%\', {}, event)" rel="nofollow noopener noreferrer">%content%</a>',sImBotCarouselSlidePhoto:"<img class=\"BotCarousel__slideImage\" src='%url%' alt='%alt%' />",sImBotCarouselSlideButtons:'<div class="BotCarousel__slideButtons">%content%</div>',sImBotCarouselSlideButton:'<%tag_name% class="FlatButton FlatButton--%appearance% FlatButton--size-m FlatButton--wide BotCarousel__slideButton BotCarousel__slideButton--%modifier% _im_mess_btn" %attributes%> <span class="FlatButton__in"> <span class="FlatButton__content">%label%</span> </span> </%tag_name%>',sImConvoRecommendListUser:'<li class="ConvoRecommendList__item"> <a href="%link%" class="ConvoRecommendList__button _im_dialog _convoRecommendUser" data-peer="%id%" data-position="%position%" data-trackcode="%track_code%"> <div class="ConvoRecommendList__avatar"> %photo% <button class="ConvoRecommendList__removeItem _convoRecommendUserRemove" aria-label="%remove_label%"> <svg fill="none" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M3.53 2.46a.75.75 0 0 0-1.07 1.07L4.94 6 2.46 8.47a.75.75 0 1 0 1.07 1.07L6 7.06l2.47 2.48a.75.75 0 0 0 1.07-1.07L7.06 6l2.48-2.47a.75.75 0 1 0-1.07-1.07L6 4.94z" fill="currentColor"/></svg> </button> </div> <span class="ConvoRecommendList__name">%name%</span> </a> </li>',sImConvoRecommendListButton:'<li class="ConvoRecommendList__item"> <%tag_name% %attributes% class="ConvoRecommendList__button %classes%"> <span class="ConvoRecommendList__avatar ConvoRecommendList__icon" aria-hidden="true"> %icon% </span> <span class="ConvoRecommendList__name">%title%</span> </%tag_name%> </li>',sImConvoRecommendList:'<ul class="ConvoRecommendList" data-list-id="recommend_list"> %list_content%</ul>',sImEmptyDialogStub:' <div class="EmptyDialogStub %classes%"> <div class="EmptyDialogStub__main"> <div class="EmptyDialogStub__avatar">%avatar%</div> <div class="EmptyDialogStub__name">%name%</div> <div class="EmptyDialogStub__savedAs">%saved_as%</div> <div class="EmptyDialogStub__description">%stub_text%</div> </div> %secondary_block% </div> <div class="_im_stickers_panel_placeholder"></div>',sImEmptyDialogStubUserInfo:function(){return' <div class="EmptyDialogStub__secondary"> <div class="EmptyDialogStub__additional"> <div class="EmptyDialogStub__additionalIcon">%additional_icon%</div> %additional_info% </div> %mutual_friends% <div class="EmptyDialogStub__actions"> <a class="FlatButton FlatButton--secondary FlatButton--size-m" draggable="false" href="%profile_href%" > <span class="FlatButton__in"> <span class="FlatButton__content">'+getLang("mail_view_profile")+"</span> </span> </a> %subscribe_button% </div> </div>"},sImEmptyDialogStubSubscribeButton:'<button class="FlatButton FlatButton--primary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubUnsubscribeButton:'<button class="FlatButton FlatButton--secondary FlatButton--size-m _im_subscribe_button" type="button" >\n  <span class="FlatButton__in">\n    \n    <span class="FlatButton__content">%button_text%</span>\n    \n  </span>\n</button>',sImEmptyDialogStubMutualFriends:' <div class="EmptyDialogStub__mutualFriends"> <div class="EmptyDialogStub__mutualFriendsPhotos">%friends%</div> <div class="EmptyDialogStub__mutualFriendsCount">%text%</div> </div>',sImEmptyDialogStubMutualFriend:' <img src="%src%" class="EmptyDialogStub__mutualFriendPhoto" alt="%name%" />',sImEmptyDialogStickers:'<div class="EmptyDialogStickers"> %content%</div>',sImEmptyDialogSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImEmptyDialogAnimatedSticker:'<a id="emoji_sticker_item0_%set_id%_%sticker_id%" data-pack-id="%set_id%" data-sticker-id="%sticker_id%" class="EmptyDialogStickers__item" onclick="Emoji.stickerHintClick(%opt_id%, %sticker_id%, \'%sticker_url%\', this)" onmouseover="Emoji.stickerHintOver(this)" onmouseout="Emoji.stickerHintOut(this)" onmouseenter="StickersAnimation.loadAndPlaySticker(this);" data-animation-path="%animation_url%"\n> <img class="EmptyDialogStickers__image sticker_img" src="%sticker_url%"> </a>',sImDialogImRowAvatarRichSkinPhoto:'<span\nclass="AvatarRich AvatarRich--sz-%size% AvatarRich--shadow AvatarRich--nft" style="width: %size%px; height: %size%px; border-radius: unset; --avatar-rich-stroke-width: 1px; --avatar-rich-nft-frame-width: 2px "> <svg class="AvatarRich__heptagonUnderlay" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M 15.0864 1.656 A 5.6496 5.6496 90 0 1 20.544 0.192 l 18.3504 4.9152 a 5.6496 5.6496 90 0 1 3.9936 3.9936 l 4.9152 18.3504 a 5.6496 5.6496 90 0 1 -1.464 5.4576 L 32.9136 46.344 a 5.6496 5.6496 90 0 1 -5.4576 1.464 l -18.3504 -4.9152 a 5.6496 5.6496 90 0 1 -3.9936 -3.9936 L 0.192 20.544 a 5.6496 5.6496 90 0 1 1.464 -5.4576 L 15.0864 1.656 Z" fill="url(#avatar_hept_underlay_fill)"/></svg> <div class="AvatarRich__background"></div> <img src=%photo% class="AvatarRich__img"\n/> </span>',sImReactionsPanel:' <div class="MessageReactionsPanel _im_reaction_panel" id="reaction-panel"> %reactions% </div>',sImReactionsPanelItem:' <div class="MessageReactionsPanel__reaction %selected% _im_reactions_panel_item" data-id="%id%" %style%> <img src="%icon%" alt="%name%"> </div>',sImMessageReactions:' <div class="MessageReactions %selected% _im_message_reaction" data-id="%id%"> <div class="MessageReactions__icon"> <img src="%icon%" alt="%name%" title="%name%"> </div> <div class="MessageReactions__peers">%peers%</div> <div class="MessageReactions__counter">%count%</div> </div>',sImMessageReactionsPeer:'    <img class="MessageReactions__peer" data-id="%peer_id%" src="%src%" title="%name%">'}},102523:(e,t,a)=>{"use strict";a.d(t,{default:()=>s});const s=(0,a(28178).makeIcon)("Icon24List","list_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="list_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5Zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5Zm0 12a1.5 1.5 0 1 0-.001 2.999A1.5 1.5 0 0 0 4 16.5ZM21 18a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1Zm0-6a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1ZM8 7h12a1 1 0 0 0 0-2H8a1 1 0 1 0 0 2Z" /></g></symbol>',24,24,!1,void 0)},139632:(e,t,a)=>{"use strict";a.d(t,{default:()=>s});const s=()=>{let e=[];onmessage=t=>{"encode"===t.data[0]?function(t){let a=t.length,s=new Uint8Array(2*a);for(let e=0;e<a;e++){let a=2*e,i=t[e];i>1?i=1:i<-1&&(i=-1),i*=32768,s[a]=i,s[a+1]=i>>8}e.push(s)}(t.data[1]):"dump"===t.data[0]&&function(t){let a=e.length?e[0].length:0,s=e.length*a,i=new Uint8Array(44+s),n=new DataView(i.buffer);n.setUint32(0,1380533830,!1),n.setUint32(4,36+s,!0),n.setUint32(8,1463899717,!1),n.setUint32(12,1718449184,!1),n.setUint32(16,16,!0),n.setUint16(20,1,!0),n.setUint16(22,1,!0),n.setUint32(24,t,!0),n.setUint32(28,2*t,!0),n.setUint16(32,2,!0),n.setUint16(34,16,!0),n.setUint32(36,1684108385,!1),n.setUint32(40,s,!0);for(let t=0;t<e.length;t++)i.set(e[t],t*a+44);e=[],postMessage(i.buffer,[i.buffer])}(t.data[1])}}},360542:(e,t,a)=>{"use strict";a.d(t,{ContactListApp:()=>u});var s=a(667294),i=a(550675),n=a(832842),r=a(792109),o=a(860735),l=a(529122),d=a(86894),c=a(367075),u=e=>{var t=e.store,a=e.env,u=e.onSelect,_=(0,s.useState)(t.getState()),g=_[0],m=_[1];(0,s.useEffect)((()=>t.subscribe(m)),[t]);var p=l.safeGet(g.peers,g.viewer.id),h=g.contacts,v=h.items,f=h.contacts,b=h.hasMore;return s.createElement(c.ErrorBoundary,{fallbackRender:()=>null,onError:e=>a.logger.error("[ContactListApp] Error",e)},s.createElement("div",{className:"ContactListApp MEConfig vkui__root"},s.createElement(o.Symbols,null),s.createElement(i.Provider,{env:a,state:g,dispatch:t.dispatch,featureFlags:t.featureFlags,owner:p},s.createElement(d.ConfigProvider,{platform:d.Platform.VKCOM,scheme:"inherit"},s.createElement(d.AdaptivityProvider,null,s.createElement(r.LayoutDataProvider,{value:{mode:"two-column"}},s.createElement(d.AppRoot,{noLegacyClasses:!0,mode:"partial",disablePortal:!0},s.createElement(n.ContactList,{items:v,contacts:f,hasMore:b,onSelect:u}))))))))}},601156:(e,t,a)=>{"use strict";a.d(t,{SettingsApp:()=>d});a(968641),a(29354),a(279262);var s=a(667294),i=a(110246),n=a(86894),r=a(550675),o=a(529122),l=a(367075),d=e=>{var t=e.store,a=e.env,d=e.set,c=(0,s.useState)(t.getState()),u=c[0],_=c[1];(0,s.useEffect)((()=>t.subscribe(_)),[t]);var g=0===u.convoConn.pts,m=o.safeGet(u.peers,u.viewer.id);return s.createElement(l.ErrorBoundary,{fallbackRender:()=>null,onError:e=>a.logger.error("[SettingsApp] Error",e)},s.createElement("div",{className:"SettingsApp vkui__root"},s.createElement(r.Provider,{env:a,state:u,dispatch:t.dispatch,featureFlags:t.featureFlags,owner:m},s.createElement(n.ConfigProvider,{platform:n.Platform.VKCOM,scheme:"inherit"},s.createElement(n.AdaptivityProvider,null,s.createElement(i.Settings,{isLoading:g,set:d}))))))}},431976:(e,t,a)=>{"use strict";function s(){return{icon:'<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path d="M10.1 1.78c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17C9.15 3.33 9 3.6 9 4a1 1 0 0 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/><path clip-rule="evenodd" d="M17.29 11.7c-.22.3-.49.53-.79.7v.68c0 .53 0 .98-.03 1.34-.03.38-.1.74-.27 1.08-.26.52-.68.94-1.2 1.2-.34.17-.7.24-1.08.27-.36.03-.8.03-1.34.03H7.42c-.53 0-.98 0-1.34-.03-.38-.03-.74-.1-1.08-.27a2.75 2.75 0 0 1-1.2-1.2 2.8 2.8 0 0 1-.27-1.08c-.03-.36-.03-.8-.03-1.34v-.69a2.5 2.5 0 0 1-.79-.69A4.45 4.45 0 0 1 2 9h.75H2v-.02a1.42 1.42 0 0 1 0-.12 2.44 2.44 0 0 1 .4-1.14C2.83 7.05 3.64 6.5 5 6.5h10c1.36 0 2.17.55 2.6 1.22a2.58 2.58 0 0 1 .4 1.26v.01c0 1.08-.2 2.02-.71 2.71zM3.5 9.01c0 .92.18 1.48.41 1.79.2.27.52.45 1.09.45.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.46 0 .78-.22 1.1-.53l.23-.25.02-.02.23-.25c.08-.08.2-.18.33-.27.13-.08.34-.18.59-.18s.46.1.6.18c.13.09.24.19.32.27l.23.25.02.02.24.25c.31.31.63.53 1.09.53.57 0 .88-.18 1.09-.45.23-.31.4-.87.41-1.79v-.02c0-.02 0-.06-.02-.1-.02-.1-.06-.24-.14-.36C16.2 8.33 15.89 8 15 8H5c-.9 0-1.2.33-1.34.53a1.08 1.08 0 0 0-.16.48zM17.25 9H18zm-4.4 2.78c.43.44 1.11.97 2.15.97v.3c0 .57 0 .96-.02 1.25-.03.29-.07.43-.12.52-.12.23-.3.42-.54.54-.1.05-.23.1-.52.12-.3.02-.68.02-1.25.02h-5.1c-.57 0-.96 0-1.25-.02a1.36 1.36 0 0 1-.52-.12 1.25 1.25 0 0 1-.54-.54c-.05-.1-.1-.23-.12-.52C5 14 5 13.62 5 13.05v-.3c1.04 0 1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3c.44.44 1.12.97 2.16.97s1.72-.53 2.16-.97l.28-.3.06-.07.06.07.28.3z" fill-rule="evenodd"/><path d="M6.4 1.78c.03-.09.17-.09.2 0 .2.54.4.9.55 1.17.2.38.35.64.35 1.05a1 1 0 0 1-2 0c0-.41.14-.67.35-1.05.16-.28.35-.63.55-1.17zm7.2 0c-.03-.09-.17-.09-.2 0-.2.54-.4.9-.55 1.17-.2.38-.35.64-.35 1.05a1 1 0 1 0 2 0c0-.41-.14-.67-.35-1.05-.16-.28-.35-.63-.55-1.17z"/></g></svg>',name:"cake_outline_20"}}a.d(t,{getIcon20CakeOutline:()=>s})},355664:(e,t,a)=>{"use strict";function s(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="education_outline_20__Page-2" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="education_outline_20__education_outline_20"><path id="education_outline_20__Bounds" d="M0 0h20v20H0z"/><path d="M17.5 9.06 16 9.9V13c0 2.8-2.72 5-6 5s-6-2.2-6-5V9.89l-2.35-1.3a1.25 1.25 0 0 1 0-2.19L9.4 2.15c.37-.2.83-.2 1.2 0l7.75 4.25c.42.24.66.68.65 1.13v5.22a.75.75 0 1 1-1.5 0V9.06Zm-3 1.65-3.9 2.14c-.37.2-.83.2-1.2 0L5.5 10.7V13c0 1.9 1.98 3.5 4.5 3.5s4.5-1.6 4.5-3.5v-2.3ZM10 3.54 2.77 7.5 10 11.46l7.23-3.96L10 3.54Z" id="education_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"education_outline_20"}}a.d(t,{getIcon20EducationOutline:()=>s})},734481:(e,t,a)=>{"use strict";function s(){return{icon:'<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g id="home_outline_20__Icons" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="home_outline_20__Icons-20/home_outline_20"><g id="home_outline_20__home_outline_20"><path opacity=".4" d="M0 0h20v20H0z"/><path d="M3 11h-.04l-.18-.01A2.04 2.04 0 0 1 1.67 7.4L8.2 1.8a2.75 2.75 0 0 1 3.58 0l6.54 5.6A2.04 2.04 0 0 1 17 11v4.25c0 1.24-1 2.25-2.25 2.25h-2.8a.95.95 0 0 1-.95-.95V13.5a1 1 0 0 0-2 0v3.05c0 .52-.43.95-.95.95h-2.8c-1.24 0-2.25-1-2.25-2.25V11Zm11.75 5c.41 0 .75-.34.75-.75v-4.9c0-.47.38-.85.85-.85H17a.54.54 0 0 0 .35-.96l-6.54-5.6c-.46-.4-1.16-.4-1.62 0l-6.54 5.6a.54.54 0 0 0-.06.77c.09.1.21.17.31.18l.1.01h.65c.47 0 .85.38.85.85v4.9c0 .41.34.75.75.75H7.5v-2.5a2.5 2.5 0 1 1 5 0V16h2.25Z" id="home_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></g></svg>',name:"home_outline_20"}}a.d(t,{getIcon20HomeOutline:()=>s})},886659:(e,t,a)=>{"use strict";function s(){return{icon:'<svg width="56" height="56" viewBox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><g id="archive_outline_56__Icons-56/archive_outline_56" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="archive_outline_56__archive_outline_56"><path d="M0 0h56v56H0z"/><path d="M44.5 18c.83 0 1.5.67 1.5 1.5v21a7.5 7.5 0 0 1-7.5 7.5h-21a7.5 7.5 0 0 1-7.5-7.5v-21c0-.83.67-1.5 1.5-1.5h33ZM43 21H13v19.5a4.5 4.5 0 0 0 4.5 4.5h21a4.5 4.5 0 0 0 4.5-4.5V21Zm-21.5 9h13a1.5 1.5 0 0 0 0-3h-13a1.5 1.5 0 0 0 0 3Zm-9-22h31a6.5 6.5 0 0 1 6.5 6.5v4a2.5 2.5 0 0 1-2.5 2.5h-39A2.5 2.5 0 0 1 6 18.5v-4A6.5 6.5 0 0 1 12.5 8ZM47 18v-3.5a3.5 3.5 0 0 0-3.5-3.5h-31A3.5 3.5 0 0 0 9 14.5V18h38Z" id="archive_outline_56__Icon-Color" fill="currentColor" fill-rule="nonzero"/></g></g></svg>',name:"archive_outline_56"}}a.d(t,{getIcon56ArchiveOutline:()=>s})},618387:(e,t,a)=>{"use strict";a.d(t,{random:()=>i});var s=a(733164);function i(){try{if(window.crypto){var e=new Int32Array(1);return crypto.getRandomValues(e),Math.abs(e.reduce(((e,t)=>e+t)))}}catch(e){}return(0,s.intval)((0,s.rand)(0,2147483647).toFixed(0))}},389931:(e,t,a)=>{"use strict";a.d(t,{screenfull:()=>s});var s=function(){var e=function(){for(var e,t,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=0,i=a.length,n={};s<i;s++)if((e=a[s])&&e[1]in document){for(s=0,t=e.length;s<t;s++)n[a[0][s]]=e[s];return n}return!1}(),t={request:function(t){var a=e.requestFullscreen;(t=t||document.documentElement)[a]()},exit:function(){document[e.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},raw:e};return!!e&&(Object.defineProperties(t,{isFullscreen:{get:function(){return Boolean(document[e.fullscreenElement])}},element:{enumerable:!0,get:function(){return document[e.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return Boolean(document[e.fullscreenEnabled])}}}),t)}()},305096:(e,t,a)=>{"use strict";function s(e,t){var a,s,i=!1;return function n(){if(i)return a=arguments,void(s=this);e.apply(this,arguments),i=!0,setTimeout((function(){i=!1,a&&(n.apply(s,a),a=s=null)}),t)}}a.d(t,{throttle:()=>s})},681307:(e,t,a)=>{"use strict";a.d(t,{MarusiaMediaRecorder:()=>l});var s,i,n=a(139632),r=window.AudioContext||window.webkitAudioContext;function o(e){var t=new Event("error");return t.data=new Error("Wrong state for "+e),t}class l{constructor(e,t){var a,s,i;this.stream=e,this.state="inactive",this.onAudioProcessHandler=t,this.em=document.createDocumentFragment(),this.encoder=(a=l.encoder,s=a.toString().replace(/^(\(\)\s*=>|function\s*\(\))\s*{/,"").replace(/}$/,""),i=new Blob([s]),new Worker(URL.createObjectURL(i)));var n=this;this.encoder.addEventListener("message",(e=>{var t=new Event("dataavailable");t.data=new Blob([e.data],{type:n.mimeType}),n.em.dispatchEvent(t),"inactive"===n.state&&n.em.dispatchEvent(new Event("stop"))}))}start(e){if("inactive"!==this.state)return this.em.dispatchEvent(o("start"));this.state="recording",s||(s=new r),this.clone=this.stream.clone(),this.input=s.createMediaStreamSource(this.clone),this.analyser=s.createAnalyser(),i||(i=s.createScriptProcessor(2048,1,1)),this.input.connect(this.analyser),this.analyser.connect(i),i.connect(s.destination);var t=this;t.encoder.postMessage(["init",s.sampleRate]),i.onaudioprocess=e=>{"recording"===t.state&&(this.onAudioProcessHandler(this.analyser),t.encoder.postMessage(["encode",e.inputBuffer.getChannelData(0)]))},this.input.connect(i),i.connect(s.destination),this.em.dispatchEvent(new Event("start")),e&&(this.slicing=setInterval((()=>{"recording"===t.state&&t.requestData()}),e))}stop(){return"inactive"===this.state?this.em.dispatchEvent(o("stop")):(this.requestData(),this.state="inactive",this.clone.getTracks().forEach((e=>{e.stop()})),this.encoder.terminate(),clearInterval(this.slicing))}pause(){return"recording"!==this.state?this.em.dispatchEvent(o("pause")):(this.state="paused",this.em.dispatchEvent(new Event("pause")))}resume(){return"paused"!==this.state?this.em.dispatchEvent(o("resume")):(this.state="recording",this.em.dispatchEvent(new Event("resume")))}requestData(){return"inactive"===this.state?this.em.dispatchEvent(o("requestData")):this.encoder.postMessage(["dump",s.sampleRate])}addEventListener(){this.em.addEventListener(...arguments)}removeEventListener(){this.em.removeEventListener(...arguments)}dispatchEvent(){this.em.dispatchEvent(...arguments)}}l.prototype.mimeType="audio/wav",l.isTypeSupported=e=>l.prototype.mimeType===e,l.notSupported=!navigator.mediaDevices||!r,l.encoder=n.default},652817:(e,t,a)=>{"use strict";function s(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.MediaDevices&&window.MediaDevices.getUserMedia;e&&!navigator.mediaDevices&&(navigator.mediaDevices=navigator.mediaDevices||{}),navigator.mediaDevices&&(navigator.mediaDevices.getUserMedia||(navigator.mediaDevices.getUserMedia=function(t){return new Promise((function(a,s){e?e.call(navigator,t,a,s):s(new Error("NotSupported"))}))}),navigator.mediaDevices.enumerateDevices||(navigator.mediaDevices.enumerateDevices=function(){return new Promise((function(e,t){if(MediaStreamTrack&&MediaStreamTrack.getSources){var a={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(t){e(t.map((function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}})))}))}t(new Error("NotSupported"))}))})),window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&(window.AudioContext.prototype.createScriptProcessor=window.AudioContext.prototype.createScriptProcessor||window.AudioContext.prototype.createJavaScriptNode)}a.d(t,{initFailBack:()=>s})},236742:(e,t,a)=>{"use strict";a.d(t,{Stickers:()=>l});var s=a(511417),i=a(70162),n=a(961540),r={},o=(e,t,a,s)=>{delete r[t],1===s?Emoji.favorite.addFavoriteSticker(e,t,a):-1===s&&Emoji.favorite.deleteFavoriteSticker(e,t,a)};var l={toggleFavorite:function(e,t,a){if(t&&t.stopPropagation(),!e.classList.contains("on")&&((s=Emoji.stickers[Emoji.TAB_FAVORITE_STICKERS].stickers)&&!(s.length<Emoji.favoriteLimit)))return function(){if(!Emoji.favoriteLimitNoticed){var e=(0,i.langStr)(getLang("purchases_stickers_favorite_limit_notice"),"%s",Emoji.favoriteLimit);setTimeout(window.showFastBox(getLang("global_error"),e).hide,3e3),ajax.post("stickers.php",{act:"favorite_limit_noticed",value:1}),Emoji.favoriteLimitNoticed=!0}}(),!1;var s,n=e.getAttribute("data-sticker-id"),l=e.getAttribute("data-hash");return!(!n||!l)&&(!r[n]&&(r[n]=1,e.classList.toggle("on"),void ajax.post("/stickers.php",{act:"toggle_favorite",sticker_id:n,hash:l},{onDone:o.pbind(a,n,e)})))},getStickerUrl:function(e,t){var a=String(t);if(s.colorScheme.isDarkScheme()&&(a=a.replace(/b$/,"")+"b"),window.Emoji){var i,r,o,l=null==(i=Emoji.stickersById)||null==(r=i[e])||null==(o=r.sticker[Emoji.STICKER_FIELD_IMAGES])?void 0:o[a];if(l)return l}var d={id:e,size:a};if((0,n.isMvk)()){if(window.stickers_cache){var c=window.stickers_cache.getStickerImage(e,a);if(c)return c}return window.store.stickers&&window.rs(window.store.stickers.url_template,{id:e,size:a})}return window.getTemplate("stickers_sticker_url",d)}}},163810:(e,t,a)=>{"use strict";a.d(t,{default:()=>u});var s=a(785893),i=a(667294),n=a(554846),r=a(125672),o=a(659397),l=a(284863),d=a(548391);class c extends i.Component{static getButtonWidth(e){return`calc(100% / ${e} - 10px)`}render(){var e=this.props,t=e.store,a=e.send,i=(0,l.getCurrentKeyboard)(t);return i&&i.buttons?(0,s.jsx)("div",{className:(0,o.classNames)("Keyboard",{"Keyboard--hidden":i.hide}),children:(0,s.jsx)(n.Scroll,{className:"Keyboard__scrollWrapper",children:(0,s.jsx)("div",{className:"Keyboard__container",children:i.buttons.map(((e,n)=>(0,s.jsx)("div",{className:"Keyboard__row",children:e.map(((n,r)=>(0,s.jsx)("div",{className:"Keyboard__button",style:{width:c.getButtonWidth(e.length)},children:(0,s.jsx)(d.BotButton,{button:n,sendMessage:a,keyboardAuthorId:i.author_id,store:t})},`cell-${r}`)))},`row-${n}`)))})})}):null}}const u=(0,r.connect)(c)},219053:(e,t,a)=>{"use strict";a.d(t,{default:()=>_});var s=a(785893),i=a(667294),n=a(554846),r=a(70162),o=a(125672),l=a(91574),d=a(483295),c=a(102523);class u extends i.Component{constructor(){super(...arguments),this.elementOnClick=(e,t)=>{t.preventDefault(),t.stopPropagation(),this.props.applyTemplate(e),this.toggleDropdown(!1)},this.toggleDropdown=e=>{this.setState({isShowDropDown:e})},this.state={isShowDropDown:!1}}render(){var e=this.props,t=e.getTemplates,a=e.showSettingsPopup,i=e.showCreatingTemplatePopup,o=e.isNeededRendering,u=this.state.isShowDropDown;if(!o())return null;var _=t();return(0,s.jsxs)("div",{className:"TemplatesDropDown",onMouseOver:this.toggleDropdown.bind(this,!0),onMouseOut:this.toggleDropdown.bind(this,!1),children:[(0,s.jsx)("div",{className:(0,d.classNames)("TemplatesDropDown__wrapper",{"TemplatesDropDown__wrapper--show":u}),"aria-hidden":u,children:(0,s.jsx)("div",{className:"TemplatesDropDown__container",children:(0,s.jsx)(n.Scroll,{className:"TemplatesDropDown__scroll-wrapper",children:(0,s.jsxs)("div",{children:[" ",(0,s.jsxs)("header",{className:"TemplatesDropDown__header",children:[(0,s.jsx)("h2",{className:"TemplatesDropDown__title",children:r.getLang("mail_community_templates")}),(0,s.jsx)("a",{role:"button",className:"TemplatesDropDown__setting-button",onClick:a,children:r.getLang("mail_settings_configure")})]}),_.length?(0,s.jsx)("ul",{className:"TemplatesDropDown__list",children:_.map((e=>(0,s.jsxs)("li",{className:"TemplatesDropDown__item",onMouseDown:this.elementOnClick.bind(null,e.id),children:[(0,s.jsx)("h3",{className:"TemplatesDropDown__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,s.jsx)("div",{className:"TemplatesDropDown__item-content",dangerouslySetInnerHTML:{__html:e.text}})]},e.id)))}):(0,s.jsxs)("div",{className:"TemplatesDropDown__not-found-container",children:[(0,s.jsx)("span",{children:r.getLang("mail_community_templates_not_found")}),(0,s.jsx)(l.default,{onClick:i,children:r.getLang("mail_add_community_template")})]})]})})})}),(0,s.jsx)("button",{className:"TemplatesDropDown__icon",children:(0,s.jsx)(c.default,{})})]})}}const _=(0,o.connect)(u)},944194:(e,t,a)=>{"use strict";a.r(t),a.d(t,{MAIN:()=>h,EDIT:()=>v,default:()=>b});var s=a(785893),i=a(667294),n=a(70162),r=a(508414),o=a(125672),l=a(288420),d=a(554846),c=a(91574),u=a(110237),_=a(354897),g=a(384032),m=a(659397),p=a(146143),h="main",v="edit";class f extends i.Component{constructor(){super(...arguments),this.setEditableMessage=e=>{var t=e.id,a=e.name,s=e.text;return new Promise((e=>this.setState({editableMessage:{id:t,name:a,text:s}},e)))},this.onChangeEditableMessage=(e,t)=>this.setEditableMessage(Object.assign({},this.state.editableMessage,{[e]:(0,m.escape)(t)})),this.deleteTemplate=e=>Promise.resolve().then((()=>this.state.section!==h?this.go(h):Promise.resolve())).then((()=>this.props.store.set(g.deleteTemplate.bind(null,e)))).catch((()=>{(0,p.showFastBox)(n.getLang("mail_error"),n.getLang("mail_community_templates_delete_error"))})),this.saveTemplate=e=>{e.preventDefault();var t=this.state.editableMessage,a=t.name,s=t.text;a.length>200||a.length<2||a.length>2e3||s.length<5?(0,p.showFastBox)(n.getLang("mail_error"),n.getLang("mail_form_is_filled_in_incorrectly")):this.props.saveTemplate(t).catch((()=>{(0,p.showFastBox)(n.getLang("mail_error"),n.getLang("mail_community_templates_save_error"))})).then((()=>this.go(h)))},this.addHint=(e,t)=>{t.preventDefault();var a=this.state.editableMessage,s=a.id,i=void 0===s?null:s,n=a.name,r=a.text;return(0,u.setHTML)(this.textarea,`{${e.id}}`),this.setEditableMessage({id:i,name:n,text:`${r}{${e.id}} `})},this.getTextAreaRef=e=>{this.textarea=(e||{}).container},this.state={section:this.props.section,editableMessage:{id:null,name:"",text:""}}}go(e,t){var a=void 0===t?{}:t,s=a.id,i=void 0===s?null:s,n=a.name,r=void 0===n?"":n,o=a.text,l=void 0===o?"":o;return new Promise((t=>{this.state.section!==e?this.setState({section:e,editableMessage:{id:i,name:r,text:l}},(()=>{this.props.popup.updateBoxCoords(),t()})):t()}))}render(){var e=this.props,t=e.getTemplates,a=e.closePopup,o=this.state,g=o.section,m=o.editableMessage,p=t();return(0,s.jsxs)("section",{className:"TemplatesSettings",children:[(0,s.jsx)(r.default,{title:(0,s.jsxs)("span",{className:"TemplatesSettings__title",children:[g===h&&n.getLang("mail_community_templates"),g===v&&n.getLang("mail_add_community_template")]}),onCloseClick:a}),(0,s.jsxs)("main",{className:"TemplatesSettings__content",children:[g===h&&(p.length?(0,s.jsx)(d.Scroll,{className:"TemplatesSettings__scroll-wrapper",children:(0,s.jsx)("div",{className:"TemplatesSettings__list",children:p.map((e=>(0,s.jsxs)("section",{className:"TemplatesSettings__item",children:[(0,s.jsx)("h3",{className:"TemplatesSettings__item-name",dangerouslySetInnerHTML:{__html:e.name}}),(0,s.jsx)("div",{className:"TemplatesSettings__item-content",dangerouslySetInnerHTML:{__html:e.text}}),(0,s.jsxs)("div",{className:"TemplatesSettings__buttons-row",children:[(0,s.jsx)(c.default,{onClick:()=>this.go(v,e),className:"TemplatesSettings__item-button",children:n.getLang("mail_settings_edit")}),(0,s.jsxs)("span",{className:"TemplatesSettings__buttons-splitter","aria-hidden":"true",children:[" ","·"," "]}),(0,s.jsx)(c.default,{onClick:this.deleteTemplate.bind(null,e.id),className:"TemplatesSettings__item-button",children:n.getLang("mail_delete")})]})]},e.id)))})}):(0,s.jsxs)("div",{className:"TemplatesSettings__not-found-container",children:[(0,s.jsx)("span",{children:n.getLang("mail_community_templates_not_found")}),(0,s.jsx)(c.default,{onClick:()=>this.go(v),children:n.getLang("mail_add_community_template")})]})),g===v&&(0,s.jsxs)("form",{className:"TemplatesSettings__form",id:"create_template_form",onSubmit:this.saveTemplate,children:[(0,s.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,s.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"name",children:[n.getLang("mail_name"),":"]}),(0,s.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,s.jsx)(u.default,{id:"name",type:"text",initialValue:m.name,className:"TemplatesSettings__input",onChange:this.onChangeEditableMessage.bind(null,"name")}),(0,s.jsx)("span",{className:"TemplatesSettings__notice",children:n.getLang("mail_community_templates_input_size").replace("{min}",2).replace("{max}","200")})]})]}),(0,s.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,s.jsxs)("label",{className:"TemplatesSettings__label",htmlFor:"text",children:[n.getLang("mail_text"),":"]}),(0,s.jsxs)("div",{className:"TemplatesSettings__input-container",children:[(0,s.jsx)(u.WithEmoji,{title:n.getLang("global_emoji_hint"),children:(0,s.jsx)(u.default,{id:"text",name:"text",isMultiLine:!0,ref:this.getTextAreaRef,initialValue:m.text,className:"TemplatesSettings__textarea",onChange:this.onChangeEditableMessage.bind(null,"text")})}),(0,s.jsx)("span",{className:"TemplatesSettings__notice",children:n.getLang("mail_community_templates_input_size").replace("{min}",5).replace("{max}","2 000")})]})]}),(0,s.jsxs)("div",{className:"TemplatesSettings__form-row",children:[(0,s.jsxs)("label",{className:"TemplatesSettings__label",children:[n.getLang("mail_hints"),":"]}),(0,s.jsx)("div",{className:"TemplatesSettings__input-container",children:(0,_.default)().map((e=>(0,s.jsx)(l.default,{type:"button",onMouseDown:this.addHint.bind(null,e),appearance:"secondary",className:"TemplatesSettings__hint",children:e.label},e.id)))})]})]})]}),(0,s.jsxs)("footer",{className:"TemplatesSettings__footer",children:[g===h&&(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)(c.default,{onClick:()=>this.go(v),children:n.getLang("mail_add_community_template")}),(0,s.jsx)(l.default,{onClick:a,children:n.getLang("mail_close")})]}),g===v&&(0,s.jsxs)(i.Fragment,{children:[(0,s.jsx)("div",{children:m.id&&(0,s.jsx)(c.default,{onClick:this.deleteTemplate.bind(null,m.id),children:n.getLang("mail_delete_community_template")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.default,{appearance:"tertiary",onClick:()=>this.go(h),children:n.getLang("mail_cancel")}),(0,s.jsx)(l.default,{onClick:this.saveTemplate,form:"create_template_form",type:"submit",children:n.getLang("mail_save")})]})]})]})]})}}f.defaultProps={section:h};const b=(0,o.connect)(f)},354897:(e,t,a)=>{"use strict";a.d(t,{default:()=>r});var s=a(238283),i=a(70162),n=a(993421);const r=()=>[{id:"user name",label:i.getLang("mail_community_templates_hint_name"),process:e=>(0,s.oCacheGet)(e,(0,n.getPeer)(e)).first_name},{id:"user surname",label:i.getLang("mail_community_templates_hint_last_name"),process(e){var t=(0,s.oCacheGet)(e,(0,n.getPeer)(e));return t.name.replace(t.first_name,"").trim()}},{id:"admin name",label:i.getLang("mail_community_templates_hint_your_name"),process:e=>(0,s.oCacheGet)(e,vk.id).first_name},{id:"admin surname",label:i.getLang("mail_community_templates_hint_your_last_name"),process(e){var t=(0,s.oCacheGet)(e,vk.id);return t.name.replace(t.first_name,"").trim()}},{id:"community",label:i.getLang("mail_community_templates_hint_community"),process:e=>(0,s.oCacheGet)(e,e.get().id).name},{id:"greeting",label:i.getLang("mail_community_templates_hint_greeting"),process(e){var t=(new Date).getHours();return t>=3&&t<12?i.getLang("mail_greeting_good_morning"):t>=12&&t<17?i.getLang("mail_greeting_good_afternoon"):t>=17&&t<=23?i.getLang("mail_greeting_good_evening"):i.getLang("mail_greeting_good_night")}}]},630910:(e,t,a)=>{"use strict";a.d(t,{handleEventChatUpdated:()=>u});var s=a(661711),i=a(284863),n=a(384032),r=a(879346),o=a(663825),l=a(407381);function d(e,t){return-1===(e?e.indexOf(t):0)&&(e.push(t),!0)}function c(e,t){var a=e?e.indexOf(t):-1;return-1!==a&&(e.splice(a,1),!0)}function u(e,t,a,u,m,p){var h=(0,i.getTab)(e,t),v=u===vk.id;switch(a){case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED:case o.MAIL_CHAT_UPDATE_TYPE_ADMIN_KICKED:return a===o.MAIL_CHAT_UPDATE_TYPE_ADMIN_GRANTED?d(h.adminIds,u):c(h.adminIds,u),e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{_(e,t,m),g(e,t,m,p)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_FLAGS_CHANGED:return h.data.flags=u,e.set((e=>(0,n.setCallAvailability)(t,e))).then((()=>{_(e,t,m),g(e,t,m,p)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_PINNED:delete h.pinHideId,cur.imDb.update(r.PIN_HIDDEN_ID_OP,[h.peerId,void 0]);var f=h&&h.pinned&&(0,s.parserMessage)(h.pinned).messageId;return m.removeUnpinnedMessageEditable(e,f),!1;case o.MAIL_CHAT_UPDATE_TYPE_USER_JOINED:return function(e,t,a){if((0,s.isTabLoaded)(a.get(),e)){var r=(0,i.getTab)(a,e);d(r.memberIds,t)&&r.membersCount++,-1===r.data.active.indexOf(t)&&r.data.active.push(t),t===vk.id&&(r.data.kicked=0,r.data.closed=0)}return a.set((a=>(0,n.loadChatMember)({[e]:[t]},a)))}(t,u,e).then((()=>{if(v&&e.get().peer===t)return e.set((e=>(0,n.getPinnedMessage)(t,e)))})).then((()=>g(e,t,m,p))).then((()=>{if(v&&e.get().peer===t)return Promise.all([e.set((e=>(0,n.getPeerActiveCallData)(t,e))),e.set((e=>(0,n.loadKeyboard)(t,e)))])})).then((()=>(e.get().peer===t&&h.callInProgress&&(m.updateBanner(e),m.updateHeader(e)),m.fixKeyboard()))).then((()=>{if(v)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})).then((()=>(0,n.syncMessageReactStatus)(e,t))),!0;case o.MAIL_CHAT_UPDATE_TYPE_USER_LEFT:case o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED:return function(e,t,a,r,o){if((0,s.isTabLoaded)(r.get(),e)){var l=(0,i.getTab)(r,e);c(l.memberIds,t)&&l.membersCount--,l.data.active=l.data.active.filter((e=>e!==t)),t===vk.id&&(a?l.data.kicked=1:l.data.closed=1,r.set((t=>(0,n.removePeerActiveCallData)(e,t))))}return t===vk.id&&r.get().peer===e?(o.cancelEditing(),r.set((t=>(0,n.unpinMessageOptimistic)(e,t)))):Promise.resolve()}(t,u,a===o.MAIL_CHAT_UPDATE_TYPE_USER_KICKED,e,m).then((()=>g(e,t,m,p))).then((()=>(0,n.syncMessageReactStatus)(e,t))).then((()=>{if(v)return e.set((e=>(0,n.syncMessagesEditableStatus)(e,t)))})),e.get().id!==u&&((0,i.getKeyboard)(e,t)||{}).author_id!==u||e.set((e=>(0,n.deleteKeyboard)(t,e))).then((()=>m.fixKeyboard())),!0;case o.MAIL_CHAT_UPDATE_TYPE_BANNER_CHANGED:return e.set((e=>(0,n.loadBanner)(t,e))).then((()=>m.updateBanner(e))),!0;case o.MAIL_CHAT_UPDATE_TYPE_KEYBOARD_CHANGED:case o.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:return!0;case o.MAIL_CHAT_UPDATE_TYPE_CALL_IN_PROGRESS_CHANGED:var b=u?e=>(0,n.getPeerActiveCallData)(t,e):e=>(0,n.removePeerActiveCallData)(t,e);return e.set(b).then((()=>{e.get().peer===t&&(m.updateBanner(e),m.updateHeader(e)),p.updateDialog(t,e),_(e,t,m)})),!0;case o.MAIL_CHAT_UPDATE_TYPE_IS_NEW_CHANGED:return e.set((e=>(0,l.setConvoIsNew)(t,u,e))),!0;default:return!1}}function _(e,t,a){e.get().peer===t&&((0,n.setActions)(e.get()),a.updateActions(e))}function g(e,t,a,s){e.get().peer===t&&((0,n.setActions)(e.get()),a.updateChat(e,t),s.updateDialog(t,e))}},770776:(e,t,a)=>{"use strict";a.d(t,{mount:()=>y});var s=a(722122),i=a(712439),n=a(608021),r=a(342269),o=a(873589),l=a(368752),d=a(661711),c=a(384032),u=a(900249),_=a(955647);function g(e,t,a,s){var i=e instanceof Array?e:(0,o.geByClass)("_im_bar_date",e),n=t.contHeight();u.default.onNewMessagesChunk();var l=i.reduce(((e,t)=>(e[(0,o.domData)(t,"date")]=[t.offsetTop+10,n,t],e)),{}),d=!a&&s.barMap?s.barMap:{};return s.barMap=(0,r.extend)(d,l),s.barMapKeys=Object.keys(s.barMap).sort(),Promise.resolve(s)}function m(e,t){return t.barMapKeys.forEach((a=>{t.barMap[a][0]-=e})),Promise.resolve(t)}function p(e,t,a,s,i){var n=e.get().barMap[t],r=(0,d.isClassicInterface)(i)?68:20;return a-(n[0]+a-n[1])+s-r}function h(e,t,a,s){return s.barTransition=s.barMap[t][2],a>0?((0,o.addClass)(s.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,o.addClass)(e,"im-page--date-bar-transition-inverse")):a<0&&((0,o.removeClass)(s.barMap[t][2],"im-page--date-bar-transition-inverse"),(0,o.removeClass)(e,"im-page--date-bar-transition-inverse")),(0,o.addClass)(s.barMap[t][2],"im-page--date-bar-transition"),(0,o.addClass)(e,"im-page--date-bar-transition"),Promise.resolve(s)}function v(e,t){return t.barTransition&&((0,o.removeClass)(t.barTransition,"im-page--date-bar-transition"),t.barTransition=null),(0,o.removeClass)(e,"im-page--date-bar-transition"),Promise.resolve(t)}function f(e,t,a,s,i){var n,r,l=e.get(),d=a-t;l.barMapKeys.forEach((t=>{var o=p(e,t,a,s,i);if(o>=d){var l=n?p(e,n,a,s,i):a;n=l>o?t:n}else if(o<d){var c=r?p(e,r,a,s,i):0;r=o>c?t:r}}));var c={};return[[r,"prev"],[n,"cur"]].forEach((t=>{var n=t[0],r=t[1];n&&(c[r+"Bar"]=function(e,t){var a=e.get().barMap[t][2];return{text:a.textContent,date:(0,o.domData)(a,"date")}}(e,n),c[r+"Left"]=p(e,n,a,s,i)-d)})),c}function b(e,t,a,s,i){var l=e.get(),u=(0,c.isEverythingLoaded)(l),g=t.get(),m=i.scrollTop(),p=g.lastTop?g.lastTop-m:0;g.lastTop=m;var b=(0,_.isPinnedMessageVisibleInTab)(l,l.peer)?(0,d.getPinnedMessageHeight)(e):0,y=(0,c.isSearchingInplace)(l.peer,l)&&l.tabs[l.peer]&&l.tabs[l.peer].top_banner?50:0,w=((0,d.isClassicInterface)(e)?68+b+y:0)-16,C=f(t,m,i.contHeight(),w,e),E=C.prevBar,S=C.curBar,T=C.prevLeft,I="translateY(0px)",M=!1,k=!1,A=!1;S||u||(S=function(e){var t=(0,o.geByClass1)("_im_mess",e),a=(0,o.domData)(t,"ts");return t&&a?{text:(0,n.getShortDate)((0,r.intval)(a),!1,!0,n.getLang("months_of","raw")),date:a}:null}(s)),S?M=S:k=!0,E&&S&&T>-32&&T<0&&(A=!0,k=!1,M=S,I=`translateY(${-32-T}px)`),M&&function(e,t){(0,o.domData)(e,"ts")!==t.date&&(e.innerHTML=t.text,(0,o.domData)(e,"ts",t.date),e.style.visibility="visible")}(a,M),A?t.set(h.bind(null,a,E.date,p)):t.set(v.bind(null,a)),I&&(a.style.transform=I),(0,o.toggleClass)(a,"im-page--top-date-bar_no-b",k)}function y(e,t){var a=(0,o.geByClass1)("_im_top_date_bar",t),n={lastTop:!1,barMap:{},barMapKeys:[],isDisabled:!1},r=(0,i.default)(n),d=null,c=null,u=null,_=(0,l.debounce)((e=>{var a=r.get();Object.keys(a).length&&!a.isDisabled&&r.set(g.bind(null,t,e,!1))}),500);return{reset(s){r.get().isDisabled||r.set(g.bind(null,t,s,!0)).then(b(e,r,a,t,s))},disable(){r.setState((0,s.default)({},n,{isDisabled:!0}))},enable(){r.setState({isDisabled:!1})},heightIncreased(e,t){r.get().isDisabled||(_(t),r.set(m.bind(null,e)))},parseMore(s,i){r.get().isDisabled||r.set(g.bind(null,s,i,!1)).then((()=>{b(e,r,a,t,i)}))},toggle(e){r.get().isDisabled&&e||a.classList.toggle("im-page--top-date-bar--hidden",!e)},show(){r.get().isDisabled||(c=Date.now(),u||((0,o.addClass)(t,"im-page--top-date-bar_visible"),u=setInterval((function(){Date.now()-c>2e3&&((0,o.removeClass)(t,"im-page--top-date-bar_visible"),clearInterval(u),u=null)}),100)))},update(s){r.get().isDisabled||(d&&(clearTimeout(d),d=null),d=setTimeout((function(){b(e,r,a,t,s)}),300),b(e,r,a,t,s))},unmount(){d&&(clearTimeout(d),d=null),u&&(clearInterval(u),u=null),r.unmount()}}}},265988:(e,t,a)=>{"use strict";a.d(t,{mount:()=>de});var s=a(785893),i=a(384032),n=a(733164),r=a(810890),o=a(226323),l=a(152278),d=a(342269),c=a(501389),u=a(873589),_=a(284863),g=(a(667294),a(973935)),m=a(136256),p=a(359284),h=a(508414),v=a(704103),f=a(661711),b=a(54233),y=a(610124),w=a(712439),C=a(645523),E=a(67328),S=a(146143),T=a(290846),I=a(70162),M=a(511492),k=a(179203),A=a(827749),L=a(124041),P="_im_dialogs_creation_name",R="_im_create_select",D="_im_create_avatar",x="_im_confirm_creation",O="_im_avatar_img",B=["im-creation--item_hovered"],N="olist_item_wrap_on",F=33554432,U=F;function H(e){!function(e){var t=e.querySelector("._im_creation_settings_modal_wrap"),a=j.bind(null,t);g.render((0,s.jsxs)(p.default,{onClose:a,className:"im-creation--modal-settings",children:[(0,s.jsx)(h.default,{title:I.getLang("mail_chat_creation_settings"),onCloseClick:a}),(0,s.jsx)(m.ChatSettingsOptions,{flags:U,back:a,isChatCreation:!0,onSave:q,afterSave:G.bind(null,t),onCancel:a})]}),t)}(e)}function j(e){e&&g.unmountComponentAtNode(e)}function q(e){return U=e,Promise.resolve()}function G(e){j(e)}function V(e){return(0,T.showTooltip)(e,{text:I.getLang("mail_chat_creation_settings_icon_tooltip"),black:1,center:!0,zIndex:1e3,shift:[0,10]})}function K(e,t,a,s,n,o){(0,i.toggleConversation)(!1),(0,u.removeClass)(t,"im-create_shown"),(0,u.removeClass)(t,"im-create_photo-attached"),setTimeout(Y.bind(null,t,!1),100),Q(o).map((e=>(0,u.geByClass1)("_im_dialog"+e))).forEach((e=>{(0,u.removeClass)(e,N)})),a().createCanceled(e),n.resetSelection(),"add_member"===e.get().creationType&&e.set(i.setCreationType.bind(null,"chat",[])),e.set(i.presetAvatar.bind(null,!1));var l=(0,u.geByClass1)(O,t);$(e,o,t),uiSearch.reset((0,u.geByClass1)(P,t)),uiSearch.reset((0,u.geByClass1)(R,t)),l&&l.parentNode.removeChild(l),$(e,o,t),(0,r.cancelStackFilter)("im_search");var d=0===e.get().peer?"search":"default";e.get().longpoll.push([(0,C.transitionEvent)(d)]),(0,u.attr)(t,"aria-hidden","true")}function W(e,t,a){return t&&(a.current_create_peer_ids={},a.current_create_peers=[]),a.current_create_peer_ids||(a.current_create_peer_ids={}),a.current_create_peers||(a.current_create_peers=[]),e.forEach((e=>{e.then((e=>{e=e.filter((e=>!a.current_create_peer_ids[e.peerId])),a.current_create_peer_ids=e.reduce(((e,t)=>(e[t.peerId]=!0,e)),a.current_create_peer_ids),a.current_create_peers=a.current_create_peers.concat(e)}))})),Promise.resolve(a)}function Y(e,t){(0,u.toggleClass)(e,"im-create_material",t)}function $(e,t,a){var s=(0,u.geByClass1)(x,a),i=t.get().selection.length,n="add_member"===e.get().creationType,r=uiSearch.getFieldEl((0,u.geByClass1)(P,a)),o=i>0,l=(r?r.value.trim():"").length>0,d=!o&&(n||!l),c=n?1===i?I.getLang("mail_append_chat"):I.getLang("mail_im_create_chat_with"):l||i>1?I.getLang("mail_im_create_chat"):I.getLang("mail_im_go_to_dialog");L.FlatButton.setLabel(s,c),L.FlatButton.setDisabled(s,d)}function z(e,t,a,s,i,n,r){if(r){var o,l=(0,d.intval)((0,u.domData)(r,"list-id")),c=Q(n),_=(0,d.trim)(r.textContent),g=(0,u.geByClass1)(R,t),m=(0,u.getSize)(g)[1];(0,d.inArray)(l,c)?(o=s.removeSelection(l,_),(0,u.removeClass)(r,N)):(o=s.addSelection(l,_),(0,u.addClass)(r,N)),o.then((()=>{var e=m-(0,u.getSize)(g)[1],t=i.scrollTop();i.scrollTop(t-e)})),$(e,n,t);var p=(0,u.geByClass1)(R,t);uiSearch.reset(p)}}function Z(e,t){var a=Q(e),s=["_im_dialog","_im_dialog"+t.peerId,"im-creation--item"],i=[];return t.online&&i.push("online"),mobPlatforms[t.online]&&i.push("mobile"),(0,d.inArray)(t.peerId,a)&&s.push(N),(0,d.getTemplate)("im_owner_item",{owner_id:t.peerId,cls:" "+s.join(" "),photo:t.photo,name:t.name,link:t.href,img_cls:i.join(" ")})}function X(e){return(0,_.getSearchText)(e)||!1}function Q(e){return e.get().selection.map((e=>e.id))}function J(e,t,a){return e.then((e=>e.filter((e=>e.is_friend&&!(0,d.inArray)(e.peerId,a.get().creationFilter)))))}function ee(e,t,a,s,n){var r,o,l=(0,u.geByClass1)(R,e),d=(0,i.searchLocalHints)(s,t.get()),c=a.hoverFirstElement.bind(a,B,re(t));t.get().creation_shown_all=!1,a.reset(),a.pipe(J(d,0,t),s),a.toTop(),s?(o=(0,i.searchTopConv)(s,t.get()),r=(0,i.searchHintsIndex)(s,[],"friends",t.get()),a.pipe(J(r,0,t),s).then(c),a.pipe(J(o,0,t),s).then(c)):(r=Promise.resolve([]),o=Promise.resolve([])),t.set(W.bind(null,[d,o,r],!0)),uiSearch.showProgress(l),Promise.all([d,r,o]).then((()=>uiSearch.hideProgress(l)))}function te(e,t,a,s){var r=2e9+Math.round((0,n.rand)(1e6,2e6));cur.recieveCropResult=a=>{cur.recieveCropResult=!1,(0,c.curBox)()&&(0,c.curBox)().hide(),e.set(i.presetAvatar.bind(null,a)),(0,i.getOwnerPhoto)(a,r).then((e=>{(0,u.geByClass1)(D,t).appendChild((0,u.ce)("img",{className:"im-chat-placeholder--img _im_avatar_img",src:e}))})),(0,u.addClass)(t,"im-create_photo-attached")},Page.ownerPhoto(r)}function ae(e,t){(0,u.geByClass1)(D,t).innerHTML="",e.set(i.presetAvatar.bind(null,!1)),(0,u.removeClass)(t,"im-create_photo-attached")}function se(e,t,a,s,i,n){Q(t).map((e=>(0,u.geByClass1)("_im_dialog"+e))).forEach((e=>(0,u.removeClass)(e,N))),t.reset(),ee(a,e,s,!1,Q(t)),i.resetSelection(),K(e,a,n,0,i,t)}function ie(e,t,a,s,n,r,l){var d=Q(t),c=e.get(),g=(0,u.geByClass1)(x,a),m=uiSearch.getFieldEl((0,u.geByClass1)(P,a)).value,p="add_member"===e.get().creationType,h=!p&&(m.length||d.length>1),v=(0,u.geByClass1)("_im_creation_show_history_input",a).checked;if(p)return e.set(i.addNewMember.bind(null,c.peer,d,v)).catch((e=>(0,S.showFastBox)(I.getLang("global_error"),e))),K(e,a,r,0,n,t);if(L.FlatButton.lock(g),!h)return f(d[0]);function f(i){U=F,se(e,t,a,s,n,r),function(e,t,a,s,i,n){K(e,t,a,0,i,n),e.get().longpoll.push([(0,C.changePeer)(s,!1,!1,!1,"create_conversation")])}(e,a,r,i,n,t),L.FlatButton.unlock(g),(0,_.isSearching)(e)?r().cancelSearch(e):r().restoreDialogs(e),(0,A.collectChatCreateStats)(i,"create_chat__create_new")}e.set((e=>(0,k.createChatAction)(e,c.next_chat_avatar,d,m,U))).then((()=>f(c.next_peer))).catch((e=>{L.FlatButton.unlock(g),(0,o.topMsg)(I.getLang("global_unknown_error"),2,"#FFB4A3")}))}function ne(e,t){return(0,T.showTooltip)(e,{text:I.getLang("mail_cancel"),black:1,zIndex:1e3,shift:[3,-2],appendCls:"js-im-page"})}function re(e,t){var a=t&&t.get().selection.length;return{top:-1,bottom:(0,f.isClassicInterface)(e)?a>0?69:0:-1}}function oe(e,t,a){$(e,t,a)}function le(e,t,a,s,i,n,o,l){return{show(t,n){void 0===n&&(n=[]),t.setState({shown:!0}),Y(e,!0),(0,r.cancelStackPush)("im_create",o),(0,u.addClass)(e,"im-create_shown");var l=s.get().selection.reduce(((e,t)=>(e[t.id]=!0,e)),{});n&&n.forEach((t=>{if(!l[t[0]]){var a=e.querySelector(`._im_dialog${t[0]}`);i.addSelection(t[0],t[1]),a&&!a.classList.contains(N)&&a.classList.add(N)}})),function(e,t,a,s){(0,u.toggleClass)(e,"im-create_chat","chat"===s.get().creationType),(0,u.toggleClass)(e,"im-create_invite","add_member"===s.get().creationType);var i="chat"===s.get().creationType?I.getLang("mail_im_group_dialog"):I.getLang("mail_im_friends_tab"),n=(0,u.geByClass1)("_im_create_title",e);(0,u.val)(n,i),L.FlatButton.setLabel((0,u.geByClass1)(x,e),"add_member"===s.get().creationType?I.getLang("mail_im_create_chat_with"):I.getLang("mail_im_create_chat")),ee(e,s,t,!1,a.get().selection.map((e=>e.id)))}(e,a,s,t),setTimeout((()=>{t.get().longpoll.push([(0,C.transitionEvent)("create")]),(0,u.attr)(e,"aria-hidden","false"),i.focus()}),1)},focusSearch(e){i.focus()},confirmCreate(e){l()},hide(a){a.get().shown=!1,K(a,e,t,0,i,s)},scroll(e){a.scrollPage(e,!0)},updateScroll(){a.updateScroll()},selectElement(t){z(t,e,0,i,a,s,a.getHoveredElement())},hoverPrevElement(e){a.hoverPrevElement(B,null,re(e,s))},hoverNextElement(e){a.hoverNextElement(B,null,re(e,s))},unmount(){(0,y.destroyModule)(n),a.unmount(),i.unmount(),(0,r.cancelStackFilter)("im_create"),cur.recieveCropResult=void 0}}}function de(e,t,a){var s=(0,w.default)({selection:[]}),n=(0,u.geByClass1)("_im_create_list",e),r=(0,u.geByClass1)(R,e),o=(0,M.debouncedPromise)((function(a){return function(e,t,a,s){var i=s.get(),n=X(i);i.selection.map((e=>e.id)),a.unhoverElements(B),e.get().creationQuery=n,ee(t,e,a,n)}(t,e,_,a)}),300),c=(0,b.mount)(r,s,(()=>({selectionDeleted(a,s){$(t,a,e),(0,u.removeClass)((0,u.geByClass1)("_im_dialog"+s),N)},onChange:e=>o(e).catch((e=>{if("debounce"!==e)throw e}))}))),_=(0,v.mount)(n,(0,w.default)({offset:0,limit:100,elements:[],elCls:"_im_dialog"}),(()=>({idFn:e=>(0,d.intval)(e.peerId),hoverableFn:e=>(0,u.hasClass)(e,"_im_dialog"),renderFn:Z.bind(null,s),more(e,a){var n;return t.get().shown?(t.get().creation_shown_all||!1!==X(s)?n=Promise.resolve([]):(t.get().creation_shown_all=!0,n=(0,i.searchTopConv)(X(s),t.get())),t.set(W.bind(null,[n],!1)),J(n,X(s),t)):Promise.resolve(!1)},onClick(a,i){(0,l.checkEvent)(a)||(z(t,e,0,c,_,s,i),(0,l.cancelEvent)(a))}})));t.get().creationQuery=!1,t.get().creationType="chat";var g=K.bind(null,t,e,a,"cross",c,s),m=te.bind(null,t,e),p=ae.bind(null,t,e),h=se.bind(null,t,s,e,_,c,a),f=ie.bind(null,t,s,e,_,c,a),C=oe.bind(null,t,s,e),S=H.bind(null,e),T=(0,u.geByClass1)("_im_create_cancel",e),I=(0,u.geByClass1)(P,e),k=(0,u.geByClass1)("_im_creation_settings",e),A=I.querySelector(".ui_search_reset"),L=(0,y.createModule)({handlers:(t,a)=>{t(T,"click",g),t(T,"mouseover",ne.bind(null,T)),t((0,u.geByClass1)(D,e),"click",m),t((0,u.geByClass1)("_im_create_remove_avatar",e),"click",p),t((0,u.geByClass1)("_im_cancel_creation",e),"click",h),t(I,"change",C),t(I,"input",C),t(I,"paste",C),t(A,"click",C),t((0,u.geByClass1)(x,e),"click",f),t(k,"click",S),t(k,"mouseenter",V.bind(null,k)),t(e,"mouseover",(0,E.throttle)(_.unhoverElements.bind(_,B),100))}});return le(e,a,_,s,c,L,g,f)}},362398:(e,t,a)=>{"use strict";a.d(t,{mount:()=>at});var s=a(722122),i=a(384032),n=a(810890),r=a(733164),o=a(608021),l=a(501389),d=a(342269),c=a(152278),u=a(661711),_=a(284863),g=a(43229),m=a(306151),p=a(72572),h=a(891326),v=a(712439),f=a(67328),b=a(704103),y=a(663825),w=a(610124),C=a(327125),E=a(238283),S=a(459554),T=a(290846),I=a(375053),M=a(645523),k=a(826338),A=a(923876),L=a(840060),P=a(682886),R=a(993421),D=a(827749),x=a(407381),O=a(179288),B=a(364368),N=a(240367),F=a(517920),U=a(506770),H=a(886659),j=a(578843),q=a(475234),G=a(917791),V=a(754204),K=a(57757),W=a(873589),Y=a(163612),$=a(659397),z=a(649846),Z=a(857833),X=a(844142),Q="_im_dialog",J="_im_peer_target",ee="_im_dialog_star",te="_im_dialog_actions",ae="_im_dialog_close",se="_im_dialog_actions_item",ie="nim-dialog_inline-menu_visible",ne=["_im_dialog_selected","nim-dialog_selected"],re=["_im_dialog_hovered","nim-dialog_hovered"],oe="_im_dialog_peer_tags",le="_convoRecommendUser",de="_convoRecommendUserRemove",ce="_convoRecommendAction",ue="ConvoRecommendList--fadeIn",_e="ConvoRecommendList--fadeOut",ge="_im_dialog_folder_button_hide",me="im-page--dialogs-folder-button_hidden",pe="_im_dialog_folder_actions",he="_im_dialog_folder_actions_item",ve="_im_dialog_folder_back";function fe(e,t,a){(0,W.removeClass)(t.parentNode,"im-page--dialogs_with-mess");var s=a.getCurrentElements().filter((e=>e.message));a.toTop(),a.reset(),(0,C.statlogsProbValueEvent)(.01,"im_search_stat",1,"search_messages_only"),s.length>0?(s=[{type:"sep_messages"}].concat(s),e.setState({searchOnlyMessages:!0})):s=[Ue()],a.pipeReplace(Promise.resolve(s))}function be(e){return(0,W.hasClass)(e,"_im_search")}function ye(e){if((0,_.isSearching)(e)&&e.get().searchAllLoaded||(0,_.isRecentSearchesActive)(e))return Promise.resolve([]);if(e.get().dialog_search_going||(0,u.isClassicInterface)(e)&&0!==e.get().peer)return Promise.resolve(!1);if((0,_.isSearching)(e))return(0,i.searchMessages)((0,_.getSearchText)(e),e.get()).then((e=>{var t=e[0];return Fe(e[1],t)}));var t=e.get().active_tab,a=e.get().dialog_tabs_all;return![h.FOLDER_MESSAGE_REQUEST,h.FOLDER_PEER_TAGS,O.FOLDER_BUSINESS_NOTIFY,O.FOLDER_ARCHIVE].includes(t)&&a[h.FOLDER_ALL]&&!(0,u.isReversedDialogs)(e)||a[t]?Promise.resolve(et(e)):e.set(i.loadDialogs).then(et)}function we(e,t,a,s,n,r){var o,l;if(!(null==n||null==(o=n.target)||null==o.closest?void 0:o.closest("._im_dialog_actions"))){var d=parseInt((0,W.domData)(r,"peer"),10),g=(0,_.getTab)(a,d),m=(0,W.hasClass)(r,"_im_sugg_"+d),p=r.classList.contains("ConvoRecommendList__button");if(g||m||p){var h=(0,W.gpeByClass)(J,n.target)&&(0,c.checkEvent)(n),v=(0,u.isCommunityInterface)(a)&&(0,W.gpeByClass)(oe,n.target),f=!!(null==(l=n.target)?void 0:l.closest("._convoRecommendUserRemove"));if(!(h||v||f)){var b=a.get(),y=be(r),w=parseInt((0,W.domData)(r,"msgid"),10);if(g&&(0,_.tabIsMessageRequestToChat)(g))return e().showChatInvitationBox(a,d),(0,c.cancelEvent)(n);var C=`list_${b.active_tab}`;if((0,_.isSearching)(a)&&(C="conversations_search"),(0,_.isRecentSearchesActive)(a)&&(C="recent_searches"),m&&(C="popular_suggestions"),p&&(C="list_all_suggestions"),y&&(C="message_search"),g&&(0,c.checkEvent)(n))return window.open(function(e,t,a,s){void 0===s&&(s=!1);var i=(0,u.getBaseLink)(e),n=()=>`${i}?sel=${(0,u.convertPeerToUrl)(t.peerId)}${s&&a?"&msgid="+a:""}`;if(s)return n();if(X.Ranges.isUserIdTransitional(t.peerId)||X.Ranges.isGroupId(t.peerId))return(0,u.isClassicInterface)(e)?n():t.href;return n()}(a,g,w,y));if(s.saveScroll("list"),e().deselectAllMessages(a),y&&b.msgid!==w)b.longpoll.push([(0,M.changePeer)(d,w,!1,!1,C)]);else if(d!==b.peer){b.longpoll.push([(0,M.changePeer)(d,!1,!0,!0,C)]);var E=(0,_.isSearching)(a);E&&!(0,W.hasClass)(r,"_dont_add_recent")&&(0,i.saveRecentSearchPeer)(d,cur.imDb),E&&g&&!(0,u.isClassicInterface)(a)&&setTimeout((()=>{var e=g.message?g.message.messageId:g.peerId;s.scrollToElement(e.toString(),!0,0,"center")}),100)}else d===b.peer&&e().goToHistoryEnd();(0,k.isMarusiaPeer)(d)&&(Z.marusiaStats.logChatOpen(z.navigationStat.getModule()),ajax.post("al_marusia.php",{act:"send_event",event:"chatopen"})),(0,c.cancelEvent)(n)}}}}function Ce(e,t,a,s){var i,n="string"==typeof a.photo&&""!==a.photo,r=X.Ranges.isContactId(t),o=a.tab||a.name,l=r?(0,u.prepareContactName)(o):o;if(X.Ranges.isChatOrChannelPeer(t)&&!n)i=(0,u.renderPhotosFromTab)(e,a,s);else{if(r&&!n){var c=(0,u.getUserInitials)(o),g=(0,_.isSearching)(e)&&!a.message?34:s?50:46;i=(0,d.getTemplate)("sImContactAvatar",{name:c,size:g,classes:"nim-peer--contact-avatar"})}else i=(0,A.isDialogWithYourself)(e.get().id,t)?a.is_nft_photo?O.FAVORITES_ICON_URL:`<img src="${O.FAVORITES_ICON_URL}" alt="">`:a.is_nft_photo?a.photo.trim():`<img src="${a.photo}" alt="">`;s&&!a.is_nft_photo&&(i=(0,d.getTemplate)("im_dialogs_link_img",{href:a.href||a.link,photo:i}))}return{photo:i,userLink:`<span class="_im_dialog_link">${l}</span>`}}function Ee(e,t,a,s){return a?"":s?(0,d.getTemplate)("im_img_prebody",{photo:t}):e+":"}function Se(e,t,a){if(!(a&y.FLAG_OUTBOUND))return!1;if((0,u.isSelfMessage)(t.peerId,e.get().gid))return!1;if(X.Ranges.isChatOrChannelPeer(t.peerId)&&t.data&&t.data.closed)return!1;if(t.unread)return!1;if((0,U.partConfigEnabled)("me_web_read_by_cmid")){var s=Pe(t);return!!s.local||s.chat_local_id>t.out_up_to_cmid}return!!t.lastmsg&&t.lastmsg>t.out_up_to}function Te(e){var t=Pe(e);return!!(e.unread>0&&t)||!!(0,_.isTabMarkedUnread)(e)}function Ie(e){return(0,S.isUnreadWithExpiring)(e)&&!(0,S.isUnreadWithMentions)(e)}function Me(e,t,a,s){void 0===a&&(a=null),void 0===s&&(s={});var i=a||Pe(t),n=Ce(e,t.peerId,t,(0,u.isClassicInterface)(e)),l=n.photo,c=n.userLink;if(!i)return function(e,t,a,s,i){void 0===i&&(i={});var n=[];(0,u.isClassicInterface)(s)&&n.push("nim-dialog_classic"),(0,_.isRecentSearchesActive)(s)&&n.push("nim-dialog_recent"),e.is_recommended_peer||n.push("nim-dialog_empty"),i.search&&n.push("_im_search");var r=(0,d.getTemplate)("im_drow_close_button",{peer_id:e.peerId});return(0,d.getTemplate)(`im_drow${e.is_nft_photo?"_nft":""}${(0,u.isClassicInterface)(s)?"_classic":""}`,{peer:e.peerId,msg_id:"",photo:t,user_link:a,date:"",body:"",unread:"",more:n.join(" "),is_star:"",unread_message_string:"",is_online:(0,f.onlinePlatformClass)(e.online),is_unread:"",is_unread_out:"",is_selected:e.peerId==s.get().peer?"nim-dialog_selected _im_dialog_selected":"",actions:r})}(t,l,c,e,s);var m=i.flags,p=(0,u.isFvkcomgroup)(e,t.peerId),h=(0,S.tabIsMessageRequest)(t),v=(0,_.tabIsMessageRequestToChat)(t),b=(0,_.isCasperChat)(e,t.peerId),w=Le(t,e,a),C=(0,_.isCommunityChat)(e,t.peerId),E=t.major_sort_id,T=[];s.search&&T.push("_im_search","nim-dialog_search"),(0,d.inArray)(t.peerId,e.get().mutedPeers)&&T.push("nim-dialog_muted"),t.verified&&T.push("nim-dialog_verified"),!t.verified&&t.verified_by_other_services&&T.push("nim-dialog_verified_by_other_services"),t.isDonutChat&&T.push("nim-dialog_donut"),b&&T.push("nim-dialog_casper"),(0,_.isRecentSearchesActive)(e)&&T.push("nim-dialog_recent"),!(0,g.isMessageEmpty)(i)||b||t.is_recommended_peer||T.push("nim-dialog_empty"),(0,u.isClassicInterface)(e)&&T.push("nim-dialog_classic"),t.folders&y.FOLDER_IMPORTANT&&T.push("nim-dialog_starred"),!s.search&&(0,u.isUnrespond)(e,t.peerId,t)&&T.push("nim-dialog_unrespond"),(p||C)&&e.get().gid&&T.push("nim-dialog_deny-remove"),(0,S.isUnreadWithMentions)(t)&&T.push("nim-dialog_unread-mentions"),(0,S.hasUnreadReactionsBadge)(e,t.peerId)&&T.push("nim-dialog_unread-reactions"),Ie(t)&&T.push("nim-dialog_unread-expiring"),t.callInProgress&&T.push("nim-dialog_active-call"),t.callInProgress&&t.callInProgress.participants.count<1&&T.push("nim-dialog_active-call-empty"),(0,k.isPinnedSortId)(E)&&T.push("nim-dialog_pinned");var I=(0,_.tabIsMessageRequestToChat)(t)?t.mr&&t.mr.request_date:i.date,M=e.get().timeshift,A=I?(0,o.getShortDateOrTime)(I,M,!0,o.getLang("months_sm_of","raw")):"",L=!Se(e,t,m)||v||(0,_.isSearching)(e)?"":"nim-dialog_unread-out",P=t.unread>0?o.getLang("mail_im_new_messages",t.unread):"",R=X.Ranges.isContactId(t.peerId)?(0,u.prepareContactName)(t.tab):t.tab,D=t.is_recommended_peer&&!t.activity&&!t.lastmsg,x=(0,u.isCommunityInterface)(e)||h||D?"im_drow_close_button":"im_drow_actions_menu",O=(0,d.getTemplate)(x,{peer_id:t.peerId});return(0,d.getTemplate)(`im_drow${t.is_nft_photo?"_nft":""}${(0,u.isClassicInterface)(e)?"_classic":""}`,{peer:t.peerId,msg_id:i.messageId||"",photo:l,user_link:c,date:A,body:w,unread_message_string:P,tab_name:(0,r.stripHTML)(R),unread:(0,u.simplifyCounter)(t.unread),more:T.join(" "),is_online:(0,f.onlinePlatformClass)(t.online),is_unread:Te(t)?"nim-dialog_unread":"",is_unread_out:L,is_selected:s.noselect||v||t.peerId!=e.get().peer?"":"nim-dialog_selected _im_dialog_selected",actions:O,title:(0,U.partConfigEnabled)("mail_dialog_preview_title")?w.replace(/\<[^>]*\>/g,""):""})}function ke(e,t,a,s,i){if(!t.deletedDialog)if((0,W.hasClass)(e,"nim-conversation-search-row"))Ae(e,t,a);else{var n=a.get(),r=Pe(t),l=r.flags,c=Le(t,a),m=Ce(a,t.peerId,t,(0,u.isClassicInterface)(a)),p=m.photo,h=m.userLink,v=a.get().timeshift,b=r.date?(0,o.getShortDateOrTime)(r.date,v,!0,o.getLang("months_sm_of","raw")):"";if(qe(e,t),(0,U.partConfigEnabled)("mail_dialog_preview_title")){var w=Le(t,a,null,!0).replace(/<[^>]*>/g,"");(0,W.attr)((0,W.geByClass1)("_im_dialog_title",e),"title",(0,$.decodeHTMLEntities)(w))}(0,W.val)((0,W.geByClass1)("_dialog_body",e),c),(0,W.val)((0,W.geByClass1)("_im_dialog_date",e),b),(0,W.val)((0,W.geByClass1)("_im_dialog_unread_ct",e),(0,u.simplifyCounter)(t.unread));var C=(0,W.geByClass1)("_im_dialog_link",e);C&&(0,W.val)(C.parentNode,h);var E=(0,W.geByClass1)("_im_dialog_photo",e);E&&E.innerHTML!==p&&(0,W.val)(E,p),n.is_peer_profile_enabled&&(n.peer||$e(e,a));var T=(0,_.isCasperChat)(a,t.peerId);(0,W.toggleClass)(e,"nim-dialog_verified",!!t.verified),(0,W.toggleClass)(e,"nim-dialog_verified_by_other_services",!t.verified&&!!t.verified_by_other_services),(0,W.toggleClass)(e,"nim-dialog_casper",T),(0,W.toggleClass)(e,"nim-dialog_muted",(0,d.inArray)(t.peerId,a.get().mutedPeers)),(0,W.toggleClass)(e,"nim-dialog_unrespond",(0,u.isUnrespond)(a,t.peerId,t)),(0,W.toggleClass)(e,"nim-dialog_classic",(0,u.isClassicInterface)(a)),(0,W.toggleClass)(e,"nim-dialog_unread",Te(t)),(0,W.toggleClass)(e,"nim-dialog_unread-mentions",(0,S.isUnreadWithMentions)(t)),(0,W.toggleClass)(e,"nim-dialog_unread-reactions",(0,S.hasUnreadReactionsBadge)(a,t.peerId)),(0,W.toggleClass)(e,"nim-dialog_unread-expiring",Ie(t)),(0,W.toggleClass)(e,"nim-dialog_active-call",!!t.callInProgress),(0,W.toggleClass)(e,"nim-dialog_active-call-empty",!!t.callInProgress&&t.callInProgress.participants.count<1),(0,W.toggleClass)(e,"nim-dialog_pinned",(0,k.isPinnedSortId)(t.major_sort_id)),(0,W.toggleClass)(e,"nim-dialog_deny-remove",a.get().gid>0&&((0,u.isFvkcomgroup)(a,t.peerId)||(0,_.isCommunityChat)(a,t.peerId))),(0,W.removeClass)(e,"nim-dialog_failed"),(0,W.removeClass)(e,"nim-dialog_deleted"),(0,W.addClass)(e,"_im_dialog"),(0,f.toggleOnline)((0,W.geByClass1)("_im_peer_online",e),t.online),(0,W.toggleClass)(e,"nim-dialog_recent",(0,_.isRecentSearchesActive)(a)),(0,W.toggleClass)(e,"nim-dialog_empty",(0,g.isMessageEmpty)(r)&&!T),(0,W.toggleClass)(e,"nim-dialog_unread-out",Se(a,t,l)&&!(0,_.isSearching)(a)),(0,W.toggleClass)(e,"nim-dialog_starred",t.folders&y.FOLDER_IMPORTANT),i&&setTimeout((function(){(0,W.addClass)((0,W.geByClass1)("_im_dialog_"+t.peerId,s),"nim-dialog_injected")}),100)}}function Ae(e,t,a){qe(e,t),(0,W.toggleClass)(e,"nim-dialog_recent",(0,_.isRecentSearchesActive)(a)),(0,W.val)((0,W.geByClass1)("_im_dialog_unread_ct",e),(0,u.simplifyCounter)(t.unread)),(0,W.toggleClass)(e,"nim-dialog_unread",Te(t)),(0,W.toggleClass)(e,"nim-dialog_unread-expiring",Ie(t)),(0,W.toggleClass)(e,"nim-dialog_unread-mentions",(0,S.isUnreadWithMentions)(t)),(0,W.toggleClass)(e,"nim-dialog_unread-reactions",(0,S.hasUnreadReactionsBadge)(a,t.peerId));var s=Ce(a,t.peerId,t,(0,u.isClassicInterface)(a)).photo;t.is_nft_photo&&(s=(0,d.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:s,size:34}));var i=(0,W.geByClass1)(t.is_nft_photo?"nim-peer_search":"_im_dialog_photo",e);i.innerHTML!==s&&(0,W.val)(i,s),(0,f.toggleOnline)((0,W.geByClass1)("_im_peer_online",e),t.online)}function Le(e,t,a,s){if(void 0===a&&(a=null),void 0===s&&(s=!1),!a&&e.custom_body_preview)return e.custom_body_preview;var i=a||Pe(e),n=(0,_.tabIsMessageRequestToChat)(e),r=(0,_.isCasperChat)(t,e.peerId),l=(0,u.isClassicInterface)(t)&&!s;if(n){var c=e.mr&&e.mr.inviter_id,m=(0,E.oCacheGet)(t,c),p=l?m.name:m.short_name;return(l?(0,d.getTemplate)("im_img_prebody",{photo:m.photo}):"")+o.getLang("mail_mr_service_message").replace(/{user}/,p)}if((0,u.isPeerBlocked)(e.peerId,t)){var h=t.get().block_states[e.peerId].name,v=o.getLang("mail_community_answering").replace("{username}",h);return(0,d.getTemplate)("im_drow_prebody",{prebody:v,body:""})}return(0,g.isServiceMsg)(i)&&!n?(0,Y.renderServiceMsg)(t,i,e.peerId,!1):r&&(0,g.isMessageEmpty)(i)?o.getLang("mail_empty_casper_message"):(0,g.isExpiredCasperMessage)(i)?o.getLang("mail_expired_message"):function(e,t,a,s,i,n,r,l,c,g){var m="",p=(0,_.isChannelPeer)((0,_.getTab)(e,a));return t&y.FLAG_OUTBOUND&&!(0,A.isDialogWithYourself)(e.get().id,a)?m=Ee(o.getLang("mail_by_you"),g,p,c):(0,S.isBusinessNotifyTab)((0,_.getTab)(e,a))||!X.Ranges.isChatOrChannelPeer(a)||X.Ranges.isZeroOwner(s)||(m=Ee((0,E.oCacheGet)(e,s).first_name,(0,E.oCacheGet)(e,s).photo,p,c)),r=(0,u.renderShortText)(a,l,r,i,n),m?(0,d.getTemplate)("im_drow_prebody",{prebody:m,body:r}):r}(t,i.flags,e.peerId,i.userId,!s,i.attaches,i.text,i.subject,l,(0,E.oCacheGet)(t,t.get().id).photo)}function Pe(e){var t=e.lastmsg_meta;return Array.isArray(t)&&(t=(0,I.getMessageFromTuple)(t)),t||(0,I.getMessageFromTuple)([-1,0,e.peerId,0,"",{},{},-1,-1,0])}function Re(e,t,a){var s=(0,_.getTab)(e,t),n=(0,_.tabIsMessageRequestToChat)(s),r=(0,u.showLeaveDialog)(e,t,(o=>{a().updateMenu(e);var l=Promise.resolve();X.Ranges.isChatOrChannelPeer(t)&&(l=n?e.set((e=>(0,i.rejectMessageRequest)(t,!1,e))):e.set((e=>(0,i.leaveChat)(t,e)))),o&&l.then((()=>(0,u.cleanHistory)(e,r,a,i.flushHistory,t,o))),(null==s?void 0:s.is_recommended_peer)&&e.set(i.deletedDialog.bind(null,t,Promise.resolve([]))).then((()=>{a().removePeer(e,t),a().updateDialogFilters(e),(0,i.removeFromRecentSearch)(t,cur.imDb),e.set(i.preloadSearchIndex.bind(null,cur.imDb))})),r.hide()}))}function De(e,t,a,s,n,r){var l=(0,W.gpeByClass)("_im_dialog",r,a);if((0,c.cancelEvent)(n),!l)return!1;var _=(0,d.intval)((0,W.domData)(l,"peer")),g=t.get(),m=X.Ranges.isGroupId(_)||X.Ranges.isUserIdTransitional(_);if(g.recentSearch){var p=(0,i.removeFromRecentSearch)(_,cur.imDb);(0,W.re)(l),0===p.length&&Ye(t,s,e)}else(0,u.isClassicInterface)(t)&&m?(0,i.deleteDialog)(_,g).then((a=>{var s=a[0],i=a[1];s?(!function(e,t,a,s,i){var n=(0,W.geByClass1)("_dialog_body",t);(0,W.addClass)(t,"nim-dialog_deleted"),(0,W.removeClass)(t,"_im_dialog"),(0,W.val)(n,(0,d.getTemplate)("im_delete_actions",{text:(0,o.langNumeric)(a,o.getLang("mail_im_X_message_deleted","raw")),peer:e,spam_id:s}))}(_,l,s,i),e().updateMenu(t)):Re(t,_,e)})):Re(t,_,e);return!1}function xe(e,t,a){(0,u.toggleDialogsFolder)(e,(e=>{t().restoreDialogs(e,!0,!0),(0,v.unpackStore)(e).active_tab===h.FOLDER_ALL&&t().updateRecommendationList(e),t().updateDialogFilters(e,!0)}),i.changeDialogsTab,a)}function Oe(e,t,a){var s;void 0===a&&(a="");var i=Ce(e,t.peerId,t,(0,u.isClassicInterface)(e)),n=i.photo,o=i.userLink,l=X.Ranges.isContactId(t.peerId)?(0,u.prepareContactName)(t.tab):t.tab,c=function(e){return!(0,u.isPendingForward)(e)}(e),g=""===a?[]:[a],m=e.get();return(0,_.isRecentSearchesActive)(e)&&g.push("nim-dialog_recent"),(0,u.isClassicInterface)(e)&&g.push("nim-csr_classic"),(0,d.inArray)(t.peerId,e.get().mutedPeers)&&g.push("nim-dialog_muted"),(0,_.isCasperChatTab)(t)&&g.push("nim-dialog_casper"),(0,S.isUnreadWithMentions)(t)&&g.push("nim-dialog_unread-mentions"),(0,S.hasUnreadReactionsBadge)(e,t.peerId)&&g.push("nim-dialog_unread-reactions"),Ie(t)&&g.push("nim-dialog_unread_expiring"),(null==(s=(0,_.getTab)(e,t.peerId))?void 0:s.isDonutChat)&&g.push("nim-dialog_donut"),(0,d.getTemplate)(t.is_nft_photo?"im_conversation_search_nft_row":"im_conversation_search_row",{peer:t.peerId,msg_id:t.lastmsg||"",photo:n,user_link:o,unread:(0,u.simplifyCounter)(t.unread),tab_name:(0,r.stripHTML)(l),is_unread:Te(t)?"nim-dialog_unread":"",is_online:(0,f.onlinePlatformClass)(t.online),is_selected:t.peerId==m.peer&&c?"nim-dialog_selected _im_dialog_selected":"",more:g.join(" ")})}function Be(e,t){switch(t.type){case"sep_btn_search_msg":return(0,u.renderBtnSearchOnlyMessages)(e);case"sep_messages":return(0,u.renderMessagesSep)();case"sep_conversations":return(0,u.renderConversationsSep)();case"sep_popular":return(0,u.renderPopularSuggSep)();case"popular_sugg":return(0,u.renderPopularSuggestions)(e);case"recommend_list":return(0,u.renderConvoRecommendList)(e);case"find_friends_stub":return(0,u.renderFindFriendsStub)(e);case"clear_recent":return(0,u.renderClearRecent)();case"empty_dialogs":return(0,d.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_list_empty"),icon:""});case"empty_business_notify":return(0,d.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_business_notify_empty"),icon:""});case"empty_archives":return(0,d.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_archives_empty"),icon:(0,H.getIcon56ArchiveOutline)().icon});case"empty_message_requests":return(0,d.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_dialogs_mr_empty"),icon:""});case"empty":return(0,d.getTemplate)("im_dialogs_none",{msg:o.getLang("mail_im_search_empty"),icon:""});case"message_request_notice":return(0,d.getTemplate)("im_dialogs_message_requests_notice",{msg:o.getLang("mail_message_request_tab_notice")});case"message_request_button_go":return(0,d.getTemplate)("im_dialogs_message_requests_button",{msg:o.getLang("mail_tab_mr"),counter:(0,j.getFolderUnreadCount)(e,O.ConvoListFolder.MR)});case"business_notify_button_go":return(0,d.getTemplate)("im_dialogs_business_notify_button",{msg:o.getLang("mail_tab_business_notify"),class_name:t.hidden?me:"",counter:(0,j.getFolderUnreadCount)(e,O.ConvoListFolder.BUSINESS_NOTIFY)});case"archive_button_go":return(0,d.getTemplate)("im_dialogs_archives_button",{msg:o.getLang("mail_tab_archives"),class_name:t.hidden?me:"",counter:(0,j.getFolderUnreadCount)(e,O.ConvoListFolder.ARCHIVE),mentions:(0,j.getFolderMentionsCount)(e,O.ConvoListFolder.ARCHIVE)});case"archive_notice":var a=(0,d.getTemplate)("im_dialogs_archive_notice_button",{text:o.getLang("mail_archive_tab_notice_button")}),s=o.getLang("mail_archive_tab_notice_content").replace("{button}",a);return(0,d.getTemplate)("im_dialogs_archive_notice",{title:o.getLang("mail_archive_tab_notice_title"),text:s});case"all":var i=(0,v.unpackStore)(e).active_tab,n={[O.ConvoListFolder.MR]:o.getLang("mail_tab_mr"),[O.ConvoListFolder.BUSINESS_NOTIFY]:o.getLang("mail_tab_business_notify"),[O.ConvoListFolder.ARCHIVE]:o.getLang("mail_tab_archives")}[i],r=(0,j.getFolderInlineMenuActions)(e,i).length>0?(0,d.getTemplate)("im_dialogs_active_folder_button_actions",{folder:i}):"";return(0,d.getTemplate)("im_dialogs_active_folder_button",{msg:n,class_name:`_im_folder_${i}_header`,actions:r});case"new_ui_notice":return(0,d.getTemplate)("im_dialogs_new_ui_notice",{title:o.getLang("mail_new_ui_notice_title"),text:o.getLang("mail_new_ui_notice_text")});default:return t.message?Me(e,t,t.message,{noselect:!0,search:!0}):t.local_index||(0,_.isSearching)(e)?Oe(e,t):Me(e,t)}}function Ne(e,t,a,s,n,r){var l=(0,d.intval)((0,W.domData)(r,"peer")),_=(0,W.domData)(r,"action"),g=(0,W.domData)(r,"sid"),m=(0,W.geByClass1)("_im_dialog_"+l,t),p=(0,d.intval)((0,W.domData)(r,"spam"));switch(_){case"restore":m&&e.set(i.restoreDialog.bind(null,l,g,p)).then((()=>{(0,W.addClass)(m,"_im_dialog"),(0,W.removeClass)(m,"nim-dialog_deleted"),ke(m,e.get().tabs[l],e,t,!1),s().updateMenu(e)}));break;case"spam":var h=`${o.getLang("mail_im_dialog_marked_spam")}\n        <button type="button" class="nim-dialog--daction nim-dialog--daction_last _im_dialog_daction"\n          data-action="restore"\n          data-spam="1"\n          data-sid="${g}" data-peer="${l}">\n            ${o.getLang("mail_restore")}\n        </button>`;if(m){var v=(0,W.geByClass1)("_dialog_body",m);(0,W.val)(v,h),(0,i.spamDialog)(l,g,e.get())}break;case"block":((0,u.isCommunityInterface)(e)?(0,u.showBlacklistBox)(l,e):(0,u.showBlacklistBoxUser)(l,e)).once("success",(function(){e.set(i.flushHistory.bind(null,l)).then((()=>{a().restoreDialogs(e)}))}))}(0,c.cancelEvent)(n)}function Fe(e,t){return e.map((e=>(0,I.getMessageFromTuple)(e))).map((e=>(0,d.extend)({},t[e.peerId],{message:e})))}function Ue(e){return{type:"empty",lang:e}}function He(e,t,a,s){var n=(0,W.gpeByClass)("_im_dialog",s,t),r=(0,d.intval)((0,W.domData)(n,"peer"));return e.set(i.toggleDialogImportant.bind(null,r)),setTimeout((function(){je(e,t,a,s)}),100),(0,c.cancelEvent)(a),!1}function je(e,t,a,s){(0,T.showTooltip)(s,{text:function(){var a=(0,W.gpeByClass)("_im_dialog",s,t),i=(0,W.domData)(a,"peer");return e.get().tabs[i].folders&y.FOLDER_IMPORTANT?o.getLang("mail_im_toggle_important_off"):o.getLang("mail_im_toggle_important")},black:1,zIndex:1,shift:[14,8],toup:tt(e,s.getBoundingClientRect().top)})}function qe(e,t){var a=t.unread>0?o.getLang("mail_im_new_messages",t.unread):"",s=(0,W.geByClass1)("_im_unread_blind_label",e);(0,W.val)(s,a)}function Ge(e,t,a,s,n){var r=(0,W.gpeByClass)("_im_dialog",n,t),u=(0,d.intval)((0,W.domData)(r,"peer"));return e.set(i.markDialogAnswered.bind(null,u)).then((()=>{ke(r,e.get().tabs[u],e,t),(0,_.isRecentSearchesActive)(e)||a().restoreDialogs(e)})),(0,l.showDoneBox)(o.getLang("mail_marked_as_answered"),{out:1e3}),(0,c.cancelEvent)(s),!1}function Ve(e){var t=(0,_.isSearching)(e),a=e.get().searchOnlyMessages;return(0,u.isClassicInterface)(e)?{top:t&&!a?96:60,bottom:(0,u.isCommunityInterface)(e)?42:87}:{top:t&&!a?36:0,bottom:0}}function Ke(e,t){e.hoverFirstElement(re,Ve(t))}function We(e){e.unhoverElements(re)}function Ye(e,t,a){if((0,_.doPopularSuggExist)(e)){t.pipeReplace(Promise.resolve([{type:"sep_popular"},{type:"popular_sugg"}])),t.toTop()}else a().cancelSearch(e),(0,n.cancelStackFilter)("im_search")}function $e(e,t){var a=t.get(),s=parseInt((0,W.domData)(e,"peer")),i=(0,_.getTab)(a,s);if(a.is_peer_profile_enabled&&(0,u.isCommunityInterface)(a)&&i&&!(0,_.isChannelPeer)(i)&&!(0,_.isCommunityChat)(a,s)&&!(0,_.isSearching)(t)){var n=(0,W.geByClass1)(oe,e);if(i.ad_id||a.peer_profile_tags&&i.peer_tags&&i.peer_tags.ids){var r=i.peerTagsMaxWidth||0;if(!r){var o=(0,W.geByClass1)("_im_dialog_name_w",e).offsetWidth;r=340-(o+6+(i.verified?16:0)),t.set((e=>(e.tabs[s].peerTagsMaxWidth=r,Promise.resolve(e))))}(0,m.renderPeerTags)(n,r,t,s)}else n.innerHTML&&(n.innerHTML="")}}function ze(e,t){if((0,u.isCommunityInterface)(e)){["empty_dialogs","empty_business_notify","empty_archives","empty"].includes((0,W.domData)(t,"list-id"))?(0,m.updateEmptyDialogsMargin)():(0,W.hasClass)(t,"_im_dialog")&&$e(t,e)}}function Ze(e){(0,c.checkEvent)(e)||(0,c.cancelEvent)(e)}function Xe(){return window.FriendsSearch?Promise.resolve():window.stManager.add([window.jsc("web/friends_search.js")])}function Qe(e,t,a){var s={new_ui_notice:{selector:"._im_new_ui_notice",setting:"new_ui_notice_hidden"},archive:{selector:"._im_archive_notice",setting:"archives_folder_notice_hidden"}}[a],i=s.selector,n=s.setting;i&&n&&e.set((e=>(0,q.setLocalSettingsValue)(n,1,e))).then((()=>(t.querySelector(i).hidden=!0,(0,G.toggleHideFolderNoticeHandler)((0,v.unpackStore)(e),a,1))))}function Je(e,t,a,s,i,n){return{selectPeer(t,a){for(var s=(0,W.geByClass)("_im_dialog",e),i=a.get().peer,n=0;n<s.length;n++){var r=s[n],o=(0,d.intval)((0,W.domData)(r,"peer")),l=(0,d.intval)((0,W.domData)(r,"msgid"));o===i&&(!be(r)||t===l&&be(r))?((0,W.addClass)(r,"nim-dialog_selected"),(0,W.addClass)(r,"_im_dialog_selected")):(0,W.hasClass)(r,"_im_dialog_selected")&&((0,W.removeClass)(r,"nim-dialog_selected"),(0,W.removeClass)(r,"_im_dialog_selected"))}},appendFastDialogs(t,s,i){(0,W.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),a.saveScroll("list"),i?(a.reset(),(0,u.isPendingForward)(t)||(0,_.isRecentSearchesActive)(t)||!(0,p.doesSearchResultContainConversations)(s)?(0,_.isRecentSearchesActive)(t)&&((0,p.doesSearchResultContainConversations)(s)&&(s=[{type:"clear_recent"}].concat(s)),(0,_.doPopularSuggExist)(t)&&(s=[{type:"sep_popular"},{type:"popular_sugg"}].concat(s))):s=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(s),t.setState({searchOnlyMessages:!1}),a.pipeReplace(Promise.resolve(s)).then((()=>Ke(a,t)))):a.pipe(Promise.resolve(s)),(0,u.isClassicInterface)(t)&&!X.Ranges.isZeroOwner(t.get().peer)||a.toTop()},deactivate(){a.deactivate()},activate(){a.activate()},hoverFirstDialog(e){Ke(a,e)},hoverNextDialog(e){a.hoverNextElement(re,ne,Ve(e))},hoverPrevDialog(e){a.hoverPrevElement(re,ne,Ve(e))},unhoverDialogs:We.bind(a),selectHoveredDialog(t){var i=(0,W.geByClass1)("_im_dialog_hovered",e);(0,U.partConfigEnabled)("mail_dialog_list_disable_enter_default")||i||(i=(0,W.geByClass1)("_im_dialog",e)),i&&we(s,0,t,a,{},i)},appendSearch(t,s,i){var n=Fe(i,s);i.length>0?((0,W.addClass)(e.parentNode,"im-page--dialogs_with-mess"),a.pipe(Promise.resolve([{type:"sep_messages"}].concat(n))).then((()=>Ke(a,t)))):(0===a.getCurrentElements().length&&a.pipeReplace(Promise.resolve([Ue()])),(0,W.removeClass)(e.parentNode,"im-page--dialogs_with-mess"))},update(e){a.pipeReplace(Promise.resolve(et(e))).then(n.track)},updateDialog(t,a){var s=(0,W.geByClass1)("_im_dialog_"+t,e);s&&!be(s)&&ke(s,(0,_.getTab)(a,t),a,e)},focusOnSelected(t){var s=t.get().peer;if(s){var i=(0,W.geByClass1)(`_im_dialog_${s}`,e);i?a.scrollTop(i.offsetTop-i.offsetHeight):a.toTop()}},restoreScroll(e){a.restoreScroll("list")||a.toTop()},forceScrollReinit(){var e=a.getScroller();e&&(e.style.overflowY="hidden",setTimeout((()=>e.style.overflowY=""),0))},restoreDialogs:(t,i,r)=>((0,W.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),t.setState({searchOnlyMessages:!1}),(0,j.isEmptyFolder)(t)&&!a.isLoading()&&(i=!0),i&&a.reset(),r&&a.wipe(),(0,T.hideAllTooltips)(e),a.pipeReplace(Promise.resolve(et(t))).then((()=>{if(i&&(!(0,u.isClassicInterface)(t)||!t.get().peer)){var e=function(e,t,a){return(0,u.isClassicInterface)(a)||t().toggleSettingsLoader(a,!0),e.checkMore(!(0,u.isClassicInterface)(a)).then((()=>{(0,u.isClassicInterface)(a)||t().toggleSettingsLoader(a,!1)}))}(a,s,t);return a.toTop(),e}})).then((()=>We(a))).then(n.track)),appendDialogs(t,s){(0,W.removeClass)(e.parentNode,"im-page--dialogs_with-mess"),s.forEach((a=>{var s=(0,W.geByClass1)("_im_dialog_"+a.peerId,e);s&&Ae(s,a,t)})),(0,u.isPendingForward)(t)||(0,_.isRecentSearchesActive)(t)||!(0,p.doesSearchResultContainConversations)(s)||(s=[{type:"sep_btn_search_msg"},{type:"sep_conversations"}].concat(s)),t.setState({searchOnlyMessages:!1}),a.isEmpty()&&0===s.length&&(0,u.isPendingForward)(t)&&(s=[Ue(o.getLang("mail_im_search_empty_chats"))]),a.replacePreserveOrder(s)},updateCounter(t,a){var s=(0,W.geByClass1)("_im_dialog_"+a,e),i=(0,_.getTab)(t,a);if(s&&!be(s)&&(qe(s,i),(0,W.val)((0,W.geByClass1)("_im_dialog_unread_ct",s),(0,u.simplifyCounter)(i.unread)),(0,W.toggleClass)(s,"nim-dialog_unread",Te(i)),(0,W.toggleClass)(s,"nim-dialog_unread-out",Se(t,i,Pe(i).flags)),(0,W.toggleClass)(s,"nim-dialog_unread-mentions",(0,S.isUnreadWithMentions)(i)),(0,W.toggleClass)(s,"nim-dialog_unread-reactions",(0,S.hasUnreadReactionsBadge)(t,a)),(0,W.toggleClass)(s,"nim-dialog_unread-expiring",Ie(i))),(0,_.isRecentSearchesActive)(t)){var n=(0,W.geByClass1)("_im_sugg_"+a,e);n&&((0,W.val)((0,W.geByClass1)("_sugg_unread_ct",n),(0,u.simplifyCounter)(i.unread)),(0,W.toggleClass)(n,"sugg-is_unread",i.unread>0))}},removeDialog(e,t){a.remove(t)},updateOnline(t,a){var s=(0,W.geByClass1)("_im_dialog_"+t,e);if(s){var i=a.get().tabs[t],n=(0,W.geByClass1)("_im_peer_online",s);(0,f.toggleOnline)(n,i.online)}},updateRecommendedOnline(t,a){var s=(0,S.getRecommendedConvoList)(a),i=e.querySelector(`.ConvoRecommendList__button[data-peer="${t}"]`);if(i&&s){var n=s.item_data[t].online_info,r=i.querySelector("._online");r&&(r.classList.toggle("online",n.is_online||n.is_mobile),r.classList.toggle("mobile",n.is_mobile))}},updateRecommendationList(t){var a=(0,W.se)((0,u.renderConvoRecommendList)(t)),s=a.querySelector(`.${P.CAROUSEL_LAYER_CLASS}`);if(s){var i=e.querySelector(`.ConvoRecommendList .${P.CAROUSEL_VIEWPORT_CLASS}`);if(i){var r=i.querySelector(`.${P.CAROUSEL_LAYER_CLASS}:not(.ConvoRecommendList--fadeOut)`);r&&(r.classList.add(_e),r.addEventListener("animationend",(()=>{s.classList.remove(ue),r.parentNode&&(r.remove(),n.track())}))),s.classList.add(ue),i.appendChild(s)}}else{var o=e.querySelector(".ConvoRecommendList");o&&o.replaceChildren(...a.children)}},setRecommendationListVisibility(t){var a=e.querySelector(".ConvoRecommendList");return!!a&&(a.classList.toggle("ConvoRecommendList--hidden",!t),!0)},setDialogFailed(t,a,s){var i=(0,W.geByClass1)("_im_dialog_"+t,e);i&&(s.get().tabs[t].lastmsg===a&&((0,W.addClass)(i,"nim-dialog_failed"),(0,W.val)((0,W.geByClass1)("_im_dialog_unread_ct",i),"!")))},scrollUp(e,t){void 0===t&&(t=!1),a.toTop(e,t),a.saveScroll("list",!0)},saveScroll(e){a.saveScroll("list",!0)},promoteDialog(s,i,n){void 0===n&&(n=!1);var r=(0,W.geByClass1)("_im_dialog_"+i,e);if(r&&!be(r)||!(0,_.isSearching)(s)){var o=n?String(i):"";a.pipeReplace(Promise.resolve(et(s)),void 0,!0,o).then((t=>{!(0,d.inArray)(i,t)&&r&&ke(r,(0,_.getTab)(s,i),s,e)})),t().updateTyping(i,s)}else a.unsetScroll("list")},removeSelection(t){var s=t.get().peer.toString(),i=`._im_dialog_${s}.${ne.join(".")}`,n=(0,W.domQuery)(i,e)[0];ne.forEach((e=>(0,W.removeClass)(n,e))),(0,u.isClassicInterface)(t)||a.hoverElement(s,re,Ve(t))},updateScroll(){a.updateScroll()},updateTyping(t,a){var s=(0,W.geByClass1)(`_im_dialog_${t}`,e);if(s&&!be(s)&&!a.get().tabs[t].deletedDialog){var i=(0,W.geByClass1)("_im_dialog_typing",s),n=!(0,u.isClassicInterface)(a),r=(0,u.formatTyper)((0,_.getTab)(a,t).activity,t,!X.Ranges.isChatOrChannelPeer(t),a.get(),1,n);(0,W.val)(i,r),(0,W.toggleClass)(s,"nim-dialog_typing",r)}},renderPeerTags(t,a){(void 0===a&&(a=null),a)?$e((0,W.geByClass1)("_im_dialog_"+a,e),t):function(e,t){var a=t.get();a.is_peer_profile_enabled&&(0,u.isCommunityInterface)(a)&&(0,W.geByClass)("_im_dialog",e).forEach((e=>{$e(e,t)}))}(e,t)},updateFolderCounters(t){var a=(0,v.unpackStore)(t),s={[O.ConvoListFolder.ARCHIVE]:u.TOGGLE_ARCHIVES_TAB,[O.ConvoListFolder.BUSINESS_NOTIFY]:u.TOGGLE_BUSINESS_NOTIFY_TAB};[O.ConvoListFolder.MR,O.ConvoListFolder.BUSINESS_NOTIFY,O.ConvoListFolder.ARCHIVE].forEach((t=>{var i=(0,j.getFolderUnreadCount)(a,t),n=e.querySelector(`[data-list-id=${t}_button_go] .im-page--dialogs-folder-button--counter`);n&&(n.innerHTML=i);var r,o,l=s[t];l&&(null==e||null==(r=e.querySelector(`.${l}`))||null==(o=r.classList)||o.toggle(me,(0,j.isConvoListFolderHidden)(a,t)))}));var i=(0,j.getFolderMentionsCount)(a,O.ConvoListFolder.ARCHIVE),n=e.querySelector(`[data-list-id=${O.ConvoListFolder.ARCHIVE}_button_go] .im-page--dialogs-folder-button--mentions`);n&&(n.dataset.mentions=i)},toggleFolder:xe,unmount(){a.unmount(),n.destroy(),(0,w.destroyModule)(i)}}}function et(e){var t,a,s=(0,v.unpackStore)(e),i=s.active_tab,n=null!=(t=null==(a=s.dialog_tabs)?void 0:a[i])?t:[],r=s.tabs,o=n.map((e=>r[e.toString()])).sort(A.sortFn.bind(null,e)),l=(0,u.isViewWithRecommendations)(e)&&o.length<2&&!s.hasContacts;if(i===h.FOLDER_MESSAGE_REQUEST&&o.unshift({type:"message_request_notice"}),i!==O.FOLDER_ARCHIVE||s.settings.archives_folder_notice_hidden||o.unshift({type:"archive_notice"}),!(0,u.isClassicInterface)(e))switch(i){case h.FOLDER_ALL:(0,j.getConvoListFolderCounterDisplayed)(e,O.ConvoListFolder.MR)>0&&o.unshift({type:"message_request_button_go"}),(0,R.isBusinessNotifyEnabled)(e)&&o.unshift({type:"business_notify_button_go",hidden:(0,j.isConvoListFolderHidden)(e,O.FOLDER_BUSINESS_NOTIFY)}),o.unshift({type:"archive_button_go",hidden:(0,j.isConvoListFolderHidden)(e,O.FOLDER_ARCHIVE)});break;case h.FOLDER_UNREAD:o.unshift({type:"archive_button_go",hidden:(0,j.isConvoListFolderHidden)(e,O.FOLDER_ARCHIVE)});break;case h.FOLDER_MESSAGE_REQUEST:case O.FOLDER_BUSINESS_NOTIFY:case O.FOLDER_ARCHIVE:o.unshift({type:"all"})}return(0,u.isViewWithRecommendations)(e)&&(s.hasContacts||n.length>1)&&o.unshift({type:"recommend_list"}),l?o.push({type:"find_friends_stub"}):(0,j.isEmptyFolder)(e)&&o.push(...(0,j.getEmptyFolderEls)(e)),i===h.FOLDER_ALL&&!(0,u.isCommunityInterface)(e)&&!(0,u.isClassicInterface)(e)&&!(0,R.getLocalSettingsValue)(e,"new_ui_notice_hidden")&&o.unshift({type:"new_ui_notice"}),o}function tt(e,t){var a=e.get().gid?220:150;return!((0,m.isPeerTagsFolder)(e)&&t<=a+46)&&(t>a||(0,_.isSearching)(e))}function at(e,t,a,n){var r=(0,w.createMutations)(Je),l=r.callMutations,g=r.bindMutations,p=document.body.appendChild(document.createElement("div"));p.classList.add("im-page--dialogs-inline-menu-container");var h,y,C,E,I=function(e,a){(0,T.showTooltip)(a,{text:()=>{if((0,_.isRecentSearchesActive)(t))return o.getLang("mail_hide_from_recent");var e=Number(a.getAttribute("data-peer")),s=(0,_.getTab)(t,e),i=(0,_.tabIsMessageRequestToChat)(s);return X.Ranges.isChatOrChannelPeer(e)&&!i?(0,S.doesChatTabHaveFlag)((0,_.getTab)(t,e),1024)?o.getLang("mail_unfollow_channel"):(0,_.isChatActive)(s)?o.getLang("mail_leave_chat"):o.getLang("mail_delete"):o.getLang("mail_delete")},black:1,[(0,u.isClassicInterface)(t)?"center":"needLeft"]:!0,shift:(0,u.isClassicInterface)(t)?[-4,10]:[0,10],toup:tt(t,a.getBoundingClientRect().top),zIndex:1})},M=function(a,i){var n=i.dataset.folder;if(n){var r=function(e,t,a,s,i){return a=>{var n,r=a.target.closest(`.${he}`);if(r&&r.dataset.action===O.FolderAction.SHOW){var o={[O.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[O.ConvoListFolder.ARCHIVE]:"archives_folder_hidden"}[s];o&&t.set((e=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,q.setLocalSettingsValue)(o,null,e)))).then((t=>{var a=e.querySelector(`.${pe}`);return a&&(a.hidden=!0),(0,G.toggleHideFolderHandler)((0,v.unpackStore)(t),s,!1,!0)})),null==i||null==(n=i.tt)||n.hide()}}}(e,t,0,n,i),o=(0,j.getFolderInlineMenuActions)(t,n).map((e=>(0,d.getTemplate)("im_page_inline_menu_item",(0,s.default)({},e,{class_name:he})))).join(""),l=(0,d.getTemplate)("im_page_inline_menu",{actions:o});(0,T.showTooltip)(i,{text:l,onCreate:()=>{var e,t;return null==(e=i.tt)||null==(t=e.container)?void 0:t.addEventListener("click",r)},onHide:()=>{var e,t,a;null==(e=i.tt)||null==(t=e.container)||t.removeEventListener("click",r),null==(a=i.tt)||a.destroy()},black:0,dir:"top",shift:[-2,-6],zIndex:130,hasover:!0,appendEl:p,className:"im_page_inline_menu_tt im_page_folder_inline_menu_tt",slide:4,showdt:100,hidedt:100,forcetodown:1,needLeft:!0})}},k=function(i,n){var r=(0,_.getTab)(t,Number(n.dataset.peer));if(r){(0,T.hideAllTooltips)(e),(0,T.destroyAllTooltips)(e),h=null;var o=function(e,t,a,s,i){return n=>{var r,o=n.target.closest("._im_dialog_actions_item");if(o){var l=o.dataset.action;(0,K.handleUiActionForPeer)(e,t,a,l,s),null==i||null==(r=i.tt)||r.hide()}}}(t,a,l,r.peerId,n),c=(0,S.getConvoInlineMenuActions)(t,r).map((e=>(0,d.getTemplate)("im_page_inline_menu_item",(0,s.default)({},e,{class_name:se})))).join(""),u=(0,d.getTemplate)("im_page_inline_menu",{actions:c});h=n.closest("._im_dialog"),(0,T.showTooltip)(n,{text:u,onCreate:()=>{var e,t;return null==(e=n.tt)||null==(t=e.container)?void 0:t.addEventListener("click",o)},onShowStart:()=>{var e,t;null==(e=h)||null==(t=e.classList)||t.add(ie)},onHide:()=>{var e,t;null==(e=h)||null==(t=e.classList)||t.remove(ie),h=null},black:0,dir:"left",shift:[-30,-11],zIndex:130,hasover:!0,className:"im_page_inline_menu_tt im_page_dialog_inline_menu_tt",appendEl:p,slideX:4,showdt:200,hidedt:100})}},A=function(e,a){(0,T.showTooltip)(a,{text:o.getLang("mail_end_conversation"),black:1,center:!0,zIndex:1,shift:[1,4],toup:tt(t,a.getBoundingClientRect().top)})},P=je.bind(null,t,e),R=He.bind(null,t,e),U=Ge.bind(null,t,e,l),H={idFn:e=>function(e,t){try{return t.message?t.message.messageId:(0,_.isSearching)(e)&&t.peerId?t.peerId+"cr":t.peerId||t.type}catch(n){if(t)throw n;var a=(0,v.unpackStore)(e),s=Object.keys(a.tabs).map(Number),i=a.dialog_tabs.all.filter((e=>!s.includes(e)));throw n.message=`Missing convo info for: ${i.join(", ")}`,n}}(t,e),hoverableFn:e=>(0,W.hasClass)(e,"_im_dialog"),renderFn:Be.bind(null,t),more:ye.bind(null,t,l),onScroll:()=>{(0,u.isClassicInterface)(t)&&((document.body.scrollTop||document.documentElement.scrollTop)<=0&&!layers.visible&&L.browser.safari?(0,W.addClass)(n,"im-page--header_static"):(0,W.removeClass)(n,"im-page--header_static"));(0,T.hideAllTooltips)(e)},onRenderFn:ze.bind(null,t)},Y=(0,b.mount)(e,(0,v.default)({limit:40,offset:0,nativeScroll:!!(0,u.isClassicInterface)(t),height:64,elements:et(t)}),(()=>H)),$=(C=new Set,E=e=>{e.forEach((e=>{var t=e.target,a=e.isIntersecting,s=t.dataset,i=s.position,n=s.peer,r=s.trackcode;if(!C.has(n)&&a)C.add(n),(0,D.collectConversationSuggestionItemStats)(r,Number(i),"show");else if(C.has(n)&&!a){if(C.delete(n),!r)return;(0,D.collectConversationSuggestionItemStats)(r,Number(i),"hide")}}))},{track:()=>{y&&y.disconnect();var e=document.querySelector(".ConvoRecommendList");if(e){var t=e.querySelector("._im_carousel_viewport");y=new IntersectionObserver(E,{root:t}),e.querySelectorAll("._convoRecommendUser").forEach((e=>y.observe(e)))}},destroy:()=>{y&&y.disconnect()}});$.track(),L.browser.mozilla&&Xe();var z=we.bind(null,a,l,t,Y),Z=e=>{var t,a;null==(t=h)||null==(a=t.classList)||a.remove(ie)},ne=fe.bind(null,t,e,Y),oe=Ne.bind(null,t,e,l,a),ue=De.bind(null,a,t,e,Y),_e=[O.ConvoListFolder.MR,O.ConvoListFolder.BUSINESS_NOTIFY,O.ConvoListFolder.ARCHIVE,O.ConvoListFolder.ALL].map((e=>i=>{if(i.target.closest(`.${ge}`)){var r=(0,v.unpackStore)(t).settings,l={[O.ConvoListFolder.BUSINESS_NOTIFY]:"number"!=typeof r.business_notify_folder_hidden,[O.ConvoListFolder.ARCHIVE]:"number"!=typeof r.archives_folder_hidden}[e],d={[O.ConvoListFolder.BUSINESS_NOTIFY]:"business_notify_folder_hidden",[O.ConvoListFolder.ARCHIVE]:"archive_folder_hidden"},c=Boolean(cur.imDb.selectByKey(d[e]));l&&!c&&(!function(e,t){var a,i=e.querySelector(`.${B.CONVO_MORE_CLASS}`);if(i){var n,r="feature_intro_tt feature_intro_blue_tt im-page--dialogs--folder_hide_hint";switch(t){case O.ConvoListFolder.BUSINESS_NOTIFY:n={width:206,content:o.getLang("mail_dialog_business_notify_more_hint"),cls:r+" im-page--dialogs--business-notify_hide_hint"};break;case O.ConvoListFolder.ARCHIVE:n={width:164,content:o.getLang("mail_dialog_archive_more_hint"),cls:r+" im-page--dialogs--archives_hide_hint"};break;default:return}null==(a=(0,W.data)(i,"ett"))||null==a.destroy||a.destroy();var l=new F.ElementTooltip(i,(0,s.default)({autoShow:!1,appendTo:document.body,forceSide:"bottom",offset:[15,8],align:"right",withCloseButton:!0,onHide:()=>{l.destroy()}},n));l.show()}}(n,e),cur.imDb.updateByKey(d[e],1)),a().hideFolderButton(t,e)}else xe(t,a,e)})),me=_e[0],be=_e[1],Ce=_e[2],Ee=_e[3],Se=a=>{Qe(t,e,"archive")},Te=a=>{Qe(t,e,"new_ui_notice")},Ie=(0,w.createModule)({handlers:(s,n)=>{n(e,"click",ae,ue),n(e,"click","_im_dialog_markre",U),n(e,"click",ee,R),n(e,"click",Q,z),n(e,"mouseover",Q,Z),n(e,"click",u.MESSAGE_SEARCH_CLASS,ne),n(e,"mouseover",ae,I),n(e,"mouseover",te,k),n(e,"mouseover",pe,M),n(e,"mouseover","_im_dialog_markre",A),n(e,"click",u.CLEAR_RECENT_CLASS,(()=>{(0,i.resetRecentSearch)(cur.imDb),Ye(t,Y,a)})),n(e,"click",u.TOGGLE_MR_TAB,me),n(e,"click",u.TOGGLE_BUSINESS_NOTIFY_TAB,be),n(e,"click",u.TOGGLE_ARCHIVES_TAB,Ce),n(e,"click",u.TOGGLE_ALL_TAB,Ee),n(e,"mouseover",ee,P),n(e,"click","_im_dialog_daction",oe),n(e,"click",J,Ze),n(e,"click",de,(e=>function(e,t){(0,c.cancelEvent)(e);var a=e.target.closest("._convoRecommendUser"),s=a.parentNode,i=Number(a.dataset.position),n=Number(a.dataset.peer),r=a.dataset.trackcode;if(!r){var o=(0,v.unpackStore)(t),l={hasPeer:!!n,hasListData:!!o.recommendationList,hasPeerData:!!o.recommendationList.item_data[n]};throw s.remove(),t.set((e=>(0,x.removeStoredRecommendedListItem)(e,n))),new Error((0,V.getErrorText)(l,"Rec remove log"))}s.remove(),t.set((e=>(0,x.removeStoredRecommendedListItem)(e,n))),(0,N.hideSuggestedContact)({position:i,track_code:r}).catch((e=>{throw new Error((0,V.getErrorText)(e))}))}(e,t))),n(e,"click",le,(e=>function(e){if(!e.target.closest("._convoRecommendUserRemove")){var t=e.target.closest("._convoRecommendUser").dataset,a=t.position,s=t.trackcode;(0,D.collectConversationSuggestionItemStats)(s,Number(a),"click")}}(e))),n(e,"click",ce,(e=>function(e,t){"invite_by_phone_number"===e.target.closest("._convoRecommendAction").dataset.action&&Xe().then((()=>{window.FriendsSearch.inviteBox()}))}(e))),(0,u.isCommunityInterface)(t)&&t.get().is_peer_profile_enabled&&(n(e,"mouseover","_im_peer_tags_extra",(e=>(0,m.onPeerTagsExtraHover)(e,t))),n(e,"click","_im_dialog_peer_tag",(e=>(0,m.onDialogPeerTagClick)(e,t)))),s(e,"mouseover",(0,f.throttle)(Y.unhoverElements.bind(Y,re),100)),n(e,"mouseover",ge,((e,t)=>{(0,T.showTooltip)(t,{text:o.getLang("mail_dialog_folder_button_hide"),black:1,center:!0,shift:[1,6],appendEl:document.body})})),n(e,"click","_im_archive_notice_close",Se),n(e,"click","_im_new_ui_notice_close",Te),n(e,"click","_im_archive_notice_settings",(e=>{a().applySearchAction(t,"settings",e)})),n(e,"mouseover",ve,((e,t)=>{(0,T.showTooltip)(t,{text:o.getLang("mail_dialog_folder_button_back"),black:1,center:!0,shift:[-3,0],appendEl:document.body})})),n(e,"click",ve,Ee)}});return g(e,l,Y,a,Ie,$)}},478810:(e,t,a)=>{"use strict";a.d(t,{mount:()=>p});var s=a(384032),i=a(342269),n=a(873589),r=a(72572),o=a(267806),l=a(661711),d=a(712439),c=a(610124),u=a(663825),_=a(419672);function g(e,t,a,i){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var r=(0,n.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,l.wrapLoading)(r)((0,s.loadImportant)(e.offset).then((t=>{t[0];var a=t[1],o=(t[2],t[3]);e.all=o.all,e.offset=o.offset,e.all?(0,n.addClass)(r,"im-important_all"):e.loading=!1,i.set((e=>(0,s.mergeTabs)(e,(0,l.tabFromIds)(o.msgs,o.hash),!0)));var d=(0,n.ce)("div");d.innerHTML=a,r.appendChild(d),(0,_.ensureDomHasActions)(r)})),"bottom")}}function m(e,t,a){for(var n=arguments.length,r=new Array(n>3?n-3:0),o=3;o<n;o++)r[o-3]=arguments[o];r.filter((e=>(0,i.inArray)(e.type,[u.SET_FLAGS,u.RESET_FLAGS,u.CHANGE_PEER]))).forEach((i=>{if(i.type!==u.CHANGE_PEER){if(i.flags===u.FLAG_IMPORTANT){var n=i.type===u.SET_FLAGS;e.set(s.updateFavMessage.bind(null,[i.messageId],0,n)).then((a=>{t.markImportant(i.messageId,n,e)}))}}else a.hide()}))}function p(e,t,a,s){var i=(0,n.ge)("box_layer_wrap"),u=t.get().longpoll,p=(0,d.default)({peer:0,longpoll:u,oCache:{},tabs:(0,l.tabFromIds)(s.msgs,s.hash)}),h=(0,o.mount)(e.bodyNode,p,(()=>({}))),v=(0,r.mount)(e.bodyNode,t,"fav_box");(0,_.ensureDomHasActions)(e.bodyNode);var f=m.bind(null,t,h,e);u.onData(f);var b=g.bind(null,{all:!1,loading:s.all,offset:s.offset},e,i,p),y=(0,c.createModule)({handlers:(e,t)=>{e(i,"scroll",b)}});return{unmount(){(0,c.destroyModule)(y),v.unmount(),h.unmount(),u.offData(f)}}}},36713:(e,t,a)=>{"use strict";a.d(t,{mount:()=>o});var s=a(661711),i=a(342269),n=a(384032);function r(e){var t=e.get().tabs,a=e.get().peer,r=Object.keys(t).filter((t=>(0,s.isFullyLoadedTab)(e,t)&&(0,i.intval)(t)!==a)).map((e=>t[e]));r.filter((e=>Date.now()-e.last_visited>54e6)).forEach((t=>e.set(n.cleanTab.bind(null,t.peerId)))),r.filter((t=>(0,s.isFullyLoadedTab)(e,t.peerId)&&"string"!=typeof t.history&&Date.now()-t.last_touched>72e5)).forEach((t=>e.set(n.stringifyTab.bind(null,t.peerId))))}function o(e){var t=setInterval(r.bind(null,e),5e3);return{unmount(){clearInterval(t)}}}},973987:(e,t,a)=>{"use strict";a.d(t,{AUDIO_MSG_AUTOSHOW_SETTING_HINT:()=>Be,mount:()=>zt});var s=a(887757),i=a(692137),n=a(384032),r=a(343474),o=a(810890),l=a(798262),d=a(152278),c=a(274642),u=a(873589),_=a(516703),g=a(722199),m=a(993421),p=a(459554),h=a(661711),v=a(75560),f=a(284863),b=a(67328),y=a(43229),w=a(389931),C=a(928322),E=a(610124),S=a(287285),T=a(451228),I=a(506690),M=a(72572),k=a(267806),A=a(57625),L=a(668667),P=a(429639),R=a(955647),D=a(934103),x=a(770776),O=a(663825),B=a(645523),N=a(80871),F=a(900249),U=a(283303),H=a(879346),j=a(49241),q=a(519037),G=a(826338),V=a(206182),K=a(555030),W=a(483295),Y=a(290846),$=a(342269),z=a(368752),Z=a(156563),X=a(506770),Q=a(827749),J=a(35916),ee=a(606542),te=a(146143),ae=a(309756),se=a(897449),ie=a(376473),ne=a(475234),re=a(124041),oe=a(70162),le=a(712860),de=a(314057),ce=a(419672),ue=a(917791),_e=a(163612),ge=a(240367),me=a(588870),pe=a(679483),he=a(844142),ve=-30,fe="._im_to_end",be="._im_to_mention",ye="._im_to_reaction",we="_im_error",Ce="im-page--error--visible",Ee="_im_mess_srv",Se="im_srv_mess_link",Te="_im_mess",Ie="_im_replied_message",Me="center",ke="_im-call-snippet",Ae="_im_mess_callsnippet",Le="_im_call_snippet_join_btn",Pe="_im_mess_pinned",Re="_im_subscribe_button",De="im-mess-stack--lnk",xe="_msg_asr_toggle",Oe="im_msg_audiomsg--transcription-shown",Be="_im_asr_setting_hint",Ne=!1,Fe={},Ue=!1;function He(e){return e.get().isMassMentionsMessageAllowed}function je(e){var t=(0,f.getTab)(e,e.get().peer);return!!(0,f.getPinnedMessage)(e)||!(!t||!t.top_banner)}function qe(e,t){var a=(0,b.unpackStore)(e),s=(0,f.getTab)(a,t);return he.Ranges.isChatOrChannelPeer(t)&&(0,R.isPinnedMessageVisibleInTab)(a,t)||!!s.top_banner&&!(0,f.isSearchShown)(t,a)}function Ge(e){return(0,h.getPinnedMessageHeight)(e)}function Ve(e,t,a){var s=a||(0,u.clientHeight)();return Math.min(s-15,Math.max(0,e,742+t.offsetTop))}function Ke(e,t){var a=(0,$.intval)((0,u.domData)(t.target,"msgid")),s=(0,u.gpeByClass)(`_im_mess_${a}`,t.target),i=(0,u.geByClass1)("_im_log_body",s),n=(0,u.geByClass1)("_im_mess_susp_cont",s);i.innerHTML=n.innerHTML}function We(e,t){return(0,u.geByClass1)("_im_mess_"+t,e)}function Ye(e){e().hideError()}function $e(e,t,a,s,i){if((0,d.checkEvent)(s))return!0;var r=(0,K.fromQueryString)(i.getAttribute("href")),o=(0,$.intval)(r.msgid);o&&e.set(n.changePeer.bind(null,e.get().peer,o,!1)).then((()=>rt(a,t,o,e))),(0,d.cancelEvent)(s)}function ze(e,t,a){var s=(0,f.getTab)(t,a),i=(0,n.strHistory)(s.history);(0,u.toggleClass)(e,"im-page--history_empty-hist",!i)}function Ze(e,t,a,s){if((0,u.hasClass)(a.target,"_im_mess_marker")){var i=a.target,n=(0,b.toArray)((0,u.geByClass)(h.FAILED_CLASS,t));window.tooltips&&n.map((e=>(0,u.geByClass1)("_im_mess_marker",e))).filter((e=>e!==i)).forEach((e=>tooltips.hide(e,{fasthide:!0})));var r=(0,u.domData)(s,"msgid");(0,Y.showTooltip)(i,{content:(0,$.getTemplate)("im_failed_menu",{count:n.length,modifiers:(0,W.classNames)("im-settings_failed",{"im-settings_no_delete":r>0,"im-settings_single":1===n.length}),id:r}),className:"im-page--failed-tt",appendParentCls:"_chat_body_wrap",dir:"down",noZIndex:!0,shift:[12,8],hasover:!0,force:!0})}}function Xe(e){return(0,u.geByClass1)("_im_peer_history",e)}function Qe(e,t){var a=t.contHeight(),s=e.scrollTop+(a-e.contHeight);t.scrollTop(s)}function Je(e,t,a,s,i,r,o,l,d,_,g){void 0===_&&(_=!0),void 0===g&&(g=!1);var m=(t.get().tabs||{})[a];i().hideError(),r.renderPeer(t),l.renderPeer(t),d.render(t);var p=(0,f.isCasperChat)(t,a);if((0,u.toggleClass)(e,"im-page--history_casper",p),!t.get().tabHistoryNotChanged){r.reRenderTitle(t),ze(e,t,a);var v=(0,n.strHistory)(m.history);if(v){var b=(0,u.geByClass1)("_im_peer_history",e);(0,u.val)(b,v)}else i().showEmptyScreen();(0,c.getAudioPlayer)().isPlaying()&&(0,c.getAudioPlayer)().updateCurrentPlaying(),It(t,s,e)}if((0,n.isSearchingInplace)(a,t.get())?i().showSearch(t):i().cancelSearch(t,!1),o.changePeer(a,t),t.get().msgid)rt(s,e,t.get().msgid,t);else if(m.scrollBottom&&_){Qe(m,s);var y=(0,h.isMessagesVisible)(t,e,s)[0];m.skipped||setTimeout((()=>{m.unread&&!y&&(ct(t,e,!0),ut(t,e,!0)),tt(t,s,e),at(t,s,e)}),100)}else nt(s,e,i,t,g)||s.scrollBottom(ve);mt(t,e),(0,J.initWidgets)(e)}function et(e,t,a){void 0===a&&(a=!1);var s=a||t.scrollTop(),i=t.scrollBottom(),r=t.contHeight(),o=e.get().peer;e.set(n.saveHistoryScroll.bind(null,o,s,i,r))}function tt(e,t,a){var s=(0,f.isGoToMentionVisible)(e),i=(0,f.isGoToEndVisible)(e),n=t.getScrollHeight()/4,r=t.scrollTop()>0;t.scrollBottom()>n&&(!i||s)&&r&&ct(e,a,!0,40)}function at(e,t,a){if(He(e)){var s=t.getScrollHeight()/4,i=t.scrollTop()>0,n=(0,f.isGoToMentionVisible)(e);t.scrollBottom()>s&&!n&&i&&ut(e,a,!0,40)}}function st(e,t,a,s,i,r,o,l,d){if(void 0===d&&(d=!0),(e.get().history_init||(e.get().history_init=!0,!(l.scrollTop()>0)))&&!w.screenfull.isFullscreen){i.update(l),i.show();var c=e.get().peer;if(0!==c&&(0,h.isFullyLoadedTab)(e.get(),c)&&(F.default.onHistoryScroll(l.scrollTop()),!layers.visible)){var _=(0,f.getTab)(e,c);_&&!_.skipped&&l.scrollBottom()>40?(tt(e,l,r),at(e,l,r)):_.skipped||_.unread||(Lt(e,r),Pt(e,r));var g=(0,h.wrapLoading)(a);if(!(0,n.isSearchingInplace)(c,e.get())&&d&&s(l),!Ne&&(o<0||0===l.scrollBottom())&&l.scrollBottom()<1e3){if((0,n.isSearchingInplace)(c,e.get()))return;if(_.skipped>0&&!e.get().no_moving_down){var m=(0,u.gpeByClass)("_im_page_history",r),p=e.get();Ne=!0;var v=e.set(n.loadLessHistory).then(t().loadHistory.bind(null,p.peer,{reversed:!0})).then((()=>{t().updateObserver(),Ne=!1,ct(e,m),ut(e,m),_.skipped||e.set(n.changePeer.bind(null,e.get().peer,!1,!1))}));return yt(m,!0),void v.then(yt.bind(null,m,!1))}}if(!Ne&&l.scrollTop()<1e3){if((0,n.isSearchingInplace)(c,e.get())){Ne=!0;var b=t().getSearchResulstModule();return b.isAll(e)?void(Ne=!1):void g(b.loadMore(e).then((a=>{Ne=!1,a&&(t().loadHistory(e.get().peer,{},e,a),s(l))})),"up")}var y=e.get();_.allShown||(Ne=!0,g(e.set(n.loadMoreHistory.bind(null,0,0)).then(t().loadHistory.bind(null,y.peer,{})).then((()=>{Ne=!1,s(l)})),"up"))}o<0&&Ft(e,c,l.scrollBottom(),r,t),(0,C.videoAutoPlayHandler)()}}}function it(e,t){return window.curNotifier&&curNotifier.idle_manager&&curNotifier.idle_manager.is_idle?Promise.resolve():e.set(n.readTillSpecificMessage.bind(null,t,e.get().peer))}function nt(e,t,a,s,i){var n=(0,u.geByClass1)("_im_unread_bar_row",t);if(n){var r=s.get(),o=r.peer,l=n.getBoundingClientRect(),d=(0,u.geByClass1)("_im_chat_body_abs",t).getBoundingClientRect().top+20;(0,h.isClassicInterface)(s)&&(d+=47+(qe(r,o)?Ge(s):0));var c=e.scrollTop()-d+l.top;return e.scrollTop(c),et(s,e,c),setTimeout((()=>{o===s.get().peer&&st(s,a,Xe(t),(function(){}),i,t,0,e)}),80),a().updateObserver(),!0}return!1}function rt(e,t,a,s,i){void 0===i&&(i="top");var n=We(t,a);if(n){var r=(0,h.isClassicInterface)(s),o=s.get().peer,l=r?(0,u.clientHeight)():(0,u.geByClass1)("_im_chat_body_abs",t).offsetHeight,d=n.offsetTop+(0,u.domPN)(n).offsetTop+(0,u.domPN)((0,u.domPN)(n)).offsetTop+(0,u.domPN)((0,u.domPN)((0,u.domPN)(n))).offsetTop;r&&qe(s,o)&&(d-=Ge(s)),"top"===i?e.scrollTop(d-e.getScrollHeight()/2+l/2):e.scrollTop(d-e.getScrollHeight()+l/4),(0,u.addClass)(n,"im-mess_light"),setTimeout((()=>{(0,u.removeClass)(n,"im-mess_light")}),2e3)}}function ot(e,t,a){a.updateLastSeen(e)}function lt(e,t,a,s,i,r){var o=(0,u.domData)(r,"action"),l=(0,u.domData)(r,"msgid"),d=(0,u.geByClass1)("_im_mess_marker",We(a,l)),c=Number(l)>0?"edit":"send",g=e.get().peer,m=Xe(a);switch(o){case"resend":(0,_.statlogsSendingRetry)("retry",c),t(i,r);break;case"resend_all":(0,_.statlogsSendingRetry)("retry",c),s().resendPeer();break;case"delete":(0,_.statlogsSendingRetry)("delete",c),e.set((t=>(0,n.removeFailed)(e,m,g,l,t)));break;case"delete_all":(0,_.statlogsSendingRetry)("delete",c),e.set((t=>(0,n.removeFailed)(e,m,g,void 0,t)))}tooltips.hide(d,{fasthide:!0})}function dt(){var e=(0,te.showBox)("al_im.php",{act:"a_business_notify_info_content"},{title:!1,onDone:()=>{var t=()=>e.hide();document.querySelectorAll("._im_business_notify_info_box_hide").forEach((e=>e.addEventListener("click",t))),e.setOptions({hideButtons:!0})}})}function ct(e,t,a,s){void 0===s&&(s=0);var i=e.get().peer;if(!he.Ranges.isZeroOwner(i)){var r=e.get().tabs[i],o=(t||document).querySelector(fe),l=!1;(a||r.skipped>0||r.unread>0)&&!(0,n.isSearchingInplace)(i,e.get())?(l=!0,pt(t,e),(0,u.addClass)(o,"im-navigation_shown")):At(o,!0),e.set(n.updateGoToEndVisibility.bind(null,[l,+s]))}}function ut(e,t,a,s){if(void 0===s&&(s=0),!He(e))return!1;var i=e.get().peer;if(!he.Ranges.isZeroOwner(i)){var r=e.get().tabs[i],o=r.mentions,l=void 0===o?[]:o,d=r.mention_cmids,c=void 0===d?[]:d,_=(t||document).querySelector(be),g=(0,X.partConfigEnabled)("me_web_read_by_cmid")?c.length:l.length,m=!1;r.unread>0&&g>0&&!(0,n.isSearchingInplace)(i,e.get())?(m=!0,function(e,t,a){(e||document).querySelector(be).querySelector("._im_to_mention_label").innerHTML=a>0?(0,$.formatCount)(a):""}(t,0,g),(0,u.addClass)(_,"im-navigation_shown")):At(_,!0),e.set(n.updateGoToMentionVisibility.bind(null,[m,+s]))}}function _t(e){At((e||document).querySelector(ye),!0)}function gt(e,t){if((0,f.isGoToReactionAvailable)(e)){var a=(0,m.getPeer)(e),s=(0,m.getUnreadReactions)(e,a).size,i=(t||document).querySelector(ye);i&&s&&!(0,n.isSearchingInplace)(a,e.get())?(!function(e,t){var a=e.querySelector("._im_to_reaction_label");a&&(a.innerHTML=t?(0,$.formatCount)(t):"")}(i,s),(0,u.addClass)(i,"im-navigation_shown")):_t(t)}}function mt(e,t){e.set((e=>(0,n.updateGoToReactionAvailability)(!0,e))),gt(e,t)}function pt(e,t){var a=t.get().peer,s=(0,f.getTab)(t,a);(e||document).querySelector(fe).querySelector("._im_to_end_label").innerHTML=Number(s.unread)>0?(0,$.formatCount)(s.unread):""}function ht(e,t){return void 0===t&&(t=0),(0!==e.scrollTop()||0!==e.scrollBottom())&&e.scrollBottom()<(t?30+t:30)}function vt(e,t,a,s,i){var n=(0,u.domData)(i,"msgid"),r=e.get().peer,o=(0,f.getMessage)(e,r,n);o.type===O.EDIT_MESSAGE?(a().sendEditMessage(e,o),a().resendMessage(r,n)):e.get().imQueueResend(r,n).then((t=>{e.get().longpoll.push([(0,B.resendEvent)(r,t.mess)])}))}function ft(e,t,a,s,i,r){var o=(0,$.intval)((0,u.domData)(r,"peer")),l=(0,$.intval)((0,u.domData)((0,u.gpeByClass)("_im_mess",r),"msgid")),d=(0,f.getTab)(e,o);return e.set(n.restoreMessage.bind(null,l,o)).then(h.restoreMessage.bind(null,l,o,Xe(t))).then((()=>It(e,a,t))),(0,n.restoreMessageSend)(l,o,d.hash,e.get().gid).then((()=>{l>d.lastmsg&&(0,n.loadActualLastMessage)(e,o).then((()=>s().updateState(o,e)))})),!1}function bt(e,t){if(e){var a=e.querySelector(fe);(0,u.toggleClass)(a,"im-navigation_loading",t)}}function yt(e,t){if(e){var a=e.querySelector(fe);(0,u.toggleClass)(a,"im-navigation_loading",t)}}function wt(e,t,a,s){var i=t.get().peer,r=(0,f.getTab)(t,i);if((0,h.isFullyLoadedTab)(t,i)){var o=Object.keys(r.msgs).find((e=>{var t=r.msgs[e];return!Array.isArray(t)&&(0,y.isUnread)(r,t)}));if(!r.skipped)return o?rt(s,a,o,t):s.scrollBottom(ve),ct(t,a),ut(t,a),Ft(t,i,0,a,e),void(0,n.readTillSpecificMessage)(r.lastmsg,i,t.get());bt(a,!0),t.set((e=>(0,ue.loadPeer)(e,i,-1,!0,!1,"goToEnd"))).then((()=>{bt(a,!1),e().changePeer(t,!1,!1)}))}}function Ct(e,t,a,s){var i,n=t.get().peer,r=(0,f.getTab)(t,n),o=r.mentions,l=void 0===o?[]:o,d=r.mention_cmids,c=void 0===d?[]:d,u=(0,X.partConfigEnabled)("me_web_read_by_cmid")?c[0]:l[0],_=(0,X.partConfigEnabled)("me_web_read_by_cmid")&&u?null==(i=(0,ie.getMessageByCmid)(t,n,u))?void 0:i.messageId:u;if(!r.skipped)return _&&rt(s,a,_,t,Me),ct(t,a,!0),ut(t,a),it(t,_),void Ft(t,n,0,a,e);bt(a,!0),t.set((e=>(0,ue.loadPeer)(e,n,_,!0,!1,"goToMention"))).then((()=>{bt(a,!1),e().changePeer(t,!1,!1),n===t.get().peer&&(rt(s,a,_,t,Me),it(t,_))}))}function Et(e,t,a,s){var i,n=null==(i=(0,ie.getMessageByCmid)(e,t,s))?void 0:i.messageId;if(n)return Promise.resolve(n);var r=(0,m.getTabCmidToMessageIdMap)(e,t).get(s);return r?Promise.resolve(r):e.set((e=>(0,le.updateCmidToMessageIdMap)(e,t,a,s))).then((e=>(0,m.getTabCmidToMessageIdMap)(e,t).get(s)))}function St(e,t,a){return Tt.apply(this,arguments)}function Tt(){return(Tt=(0,i.default)(s.mark((function e(t,a,i){var n,r,o,l,d;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,m.getPeer)(t),r=(0,m.getGroupId)(t),o=Math.min(...Array.from((0,m.getUnreadReactions)(t,n)))){e.next=5;break}return e.abrupt("return");case 5:return null==(l=(a||document).querySelector(ye))||l.setAttribute("disabled",""),e.next=9,Et(t,n,r,o);case 9:if(d=e.sent,null==l||l.removeAttribute("disabled"),d){e.next=13;break}return e.abrupt("return");case 13:(0,h.focusOnMessage)(t,(()=>rt(i,a,d,t)),n,d);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function It(e,t,a,s){if(void 0===s&&(s=!1),(0,h.isClassicInterface)(e)){var i=t.contHeight(),n=(0,u.geByClass1)("_im_chat_input_w",a),r=(0,u.geByClass1)("im-chat-input",a),o=(0,u.geByClass1)("_im_chat_resize",a),l=(0,u.geByClass1)("EmptyDialogStickers",a);if(!1!==(s=!1!==s?s:(0,h.getClassicChatHeight)())&&s>0){var d=(0,u.clientHeight)(),c=(0,u.geByClass1)("_im_chat_audio_input_parent",a),_=Ve(s,a,d),g=_-((0,u.hasClass)(c,"im-audio-message_recording")||(0,u.hasClass)(c,"im-audio-message_recorded")?c:(0,u.geByClass1)("_im_chat_input_parent",a)).offsetHeight;o.style.height=d-_-15+"px",(0,u.setStyle)(n,{top:g+"px",bottom:"auto"})}else o.style.height="0px",(0,u.setStyle)(n,{top:"auto",bottom:"0px"});var m=(0,u.geByClass1)("_im_peer_history_w",a),p=r.offsetHeight-45,v=n.offsetHeight-16;return(0,u.setStyle)(m,{borderBottomWidth:l?p:v}),t.contHeight()-i}var f=t.getScrollHeight();return t.update(!1,!0),f-t.getScrollHeight()}function Mt(e,t,a,s){var i=t.offsetHeight;s(),e.heightIncreased(t.offsetHeight-i,a)}function kt(e,t){var a=t.getBoundingClientRect().top;(0,Y.showTooltip)(t,{className:"im-page--admin-tt",text:oe.getLang("mail_only_admin_see"),appendParentCls:"_chat_body_wrap",shift:[20,5],dir:"auto",showdt:400,noZIndex:!0,toup:a>200})}function At(e,t){void 0===t&&(t=!1),(0,u.hasClass)(e,"im-navigation_shown")&&(t&&(0,u.addClass)(e,"im-navigation_fast"),(0,u.removeClass)(e,"im-navigation_shown"),t&&(e.offsetHeight,(0,u.removeClass)(e,"im-navigation_fast")))}function Lt(e,t,a){void 0===a&&(a=!1);var s=t.querySelector(fe);e.set(n.updateGoToEndVisibility.bind(null,[!1,0])),At(s,a)}function Pt(e,t,a){void 0===a&&(a=!1);var s=t.querySelector(be);e.set(n.updateGoToMentionVisibility.bind(null,[!1,0])),At(s,a)}function Rt(e,t,a){w.screenfull.isFullscreen||0===t.get().peer||(0,h.isClassicInterface)(t)||e().restoreScroll(t,t.get().peer)}function Dt(e,t){var a=e.get(),s=a.peer,i=(0,u.domClosest)(Ee,t.target),r=(0,$.intval)((0,u.domData)(i,"msgid")),o=(0,f.getMessage)(e,s,r),l=o&&(0,y.isServiceMsg)(o)&&o.kludges.source_act;if(l===h.CHAT_PIN_MESSAGE||l===h.CHAT_UNPIN_MESSAGE){var d=i.querySelector(".im_srv_mess_link");if(d&&"A"!==d.tagName){var c=o.kludges.source_chat_local_id;if(!c||Fe[c])return;Fe[c]=(0,n.getMessageLocalId)(s,c,a).then((e=>{var t=e[0];if(t){var a=`/im?sel=${(0,h.convertPeerToUrl)(s)}&msgid=${t}`,i=d.innerHTML;(0,u.domReplaceEl)(d,(0,_e.getServiceLinkTemplate)(a,i,!0,Se)),delete Fe[c]}}))}}}function xt(e,t,a){var s=e.get(),i=s.peer,n=a.target.href&&a.target.href.match(/msgid=([\d]+)/),r=n&&n[1];"A"!==a.target.tagName||!r||(0,h.isAlreadyDeleted)(e,i,r)||(0,d.checkEvent)(a)||((0,f.getMessage)(e,i,r)?(e.setState({msgid:r}),(0,U.updateLocation)({msgid:r}),t().focusOnMessage()):s.longpoll.push([(0,B.changePeer)(i,r,!1,!1,s.currentEntryPoint||"")]));(0,d.cancelEvent)(a)}function Ot(e){var t=(0,p.getCurrentTab)(e);he.Ranges.isChatOrChannelPeer(t.peerId)&&(t.pinHideId=cur.imDb.select(H.PIN_HIDDEN_ID_OP,t.peerId))}function Bt(e,t,a,s,i){e.setState({isEditing:!1}),(0,u.removeClass)(s,"im-mess_is_editing"),(0,u.removeClass)((0,u.geByClass1)("_im_page_history"),"is_msg_editing"),(0,o.cancelStackFilter)("cancel_edit"),a.setDraft(e,(0,m.getPeer)(e)?(0,f.getTabDraft)((0,p.getCurrentTab)(e)):null),a.toggleStickers(e,!0),a.restoreKeyboard(),Nt(t)}function Nt(e){(0,b.toArray)((0,u.geByClass)("_im_history_tooltip",e)).forEach((e=>(0,u.hide)(e)))}function Ft(e,t,a,s,i){var r=(0,f.getTab)(e,t);if(!(Date.now()-(r.lastReset||0)<1e3)&&(r&&r.msgs&&r.history&&!Ne&&r.offset>300&&0==r.skipped&&a<50&&a>=0&&0===(e.get().selectedMessages||[]).length)){var o=Object.keys(r.msgs).filter((e=>e>0)).sort(((e,t)=>e-t)).slice(0,-50),l=o.slice(-1)[0];e.mutate(n.resetTabAll.bind(null,t)),e.set(n.removeMessages.bind(null,o,t)).then((()=>i().removeStartingFromMessage(l,t,e)))}}function Ut(e,t,a,s){var i=s.target,n=(0,u.domClosest)(Ie,i),r=Number(n.getAttribute("data-msgid")),o=(0,u.domClosest)("im-mess",i),l=Number(o.getAttribute("data-msgid")),d=e.get().peer;r&&!(0,h.isAlreadyDeleted)(e,d,r)?(e.setState({msgid:r}),(0,U.updateLocation)({msgid:r}),(0,h.focusOnMessage)(e,t().focusOnMessage,d,r)):l&&(0,h.showRepliedBox)(e,l,s)}function Ht(e){(0,d.checkEvent)(e)||(0,d.cancelEvent)(e)}var jt=new Map;function qt(e,t){var a,s,i=t.closest(`.${h.AUDIO_MSG_CLASS}`),n=i.querySelector("._msg_asr_empty"),r=t.closest("._im_mess"),o=i.id.replace("audmsg",""),l=!!i.closest(".im-mess_fwd"),d=Boolean(i.dataset.asr_done),c=l?0:Number(null==r?void 0:r.dataset.msgid),u=!i.classList.contains(Oe),_=Number(null==r?void 0:r.dataset.peer)||void 0,g=Number(null==r?void 0:r.dataset.msgid),m=_&&(0,ie.getMessage)(e,_,g),p=Number(null==r?void 0:r.dataset.cmid)||(null==m?void 0:m.chat_local_id),v="audio_message"+o;if(u){var f=(jt.get(i.id)||0)+1;jt.set(i.id,f),d||((0,ge.recogniseAudioMessage)(c,o),p&&_&&(0,Q.collectVoiceStat)("transcript_loading",_,p,v)),f%3==0&&n?n.innerHTML=(s=oe.getLang("me_voice_asr_status_empty_set").split("|"),null==(a=s[Math.floor(Math.random()*s.length)])?void 0:a.trim()):n&&(n.innerHTML=oe.getLang("me_voice_asr_status_empty"))}(u&&!l&&(0,me.markAudioMessageAsListened)(e,g,_).catch((()=>{})),p&&_&&(0,Q.collectVoiceStat)("transcript_toggle",_,p,v,u,"user"),i.classList.toggle(Oe),window.tooltips&&tooltips.destroy(t,{fasthide:!0}),t.closest(".audio-msg-player"))&&i.querySelector(".audio-msg-track_player-attached .audio-msg-track--transcriptToggle").classList.toggle("audio-msg-track--transcript_on",t.classList.contains("audio-msg-track--transcript_on"))}function Gt(e,t){function a(t,a){var s=a.closest("._im_mess");if(s){var i=a.id.replace("audiomsgpl_","audio_message"),n=Number(s.dataset.peer),r=Number(s.dataset.msgid);if(n&&r){var o=(0,ie.getMessage)(e,n,r),l=Number(s.dataset.cmid)||(null==o?void 0:o.chat_local_id);switch(t){case"playing":(0,Q.collectVoiceStat)("play",n,l,i);break;case"paused":(0,Q.collectVoiceStat)("pause",n,l,i);break;case"finished":(0,Q.collectVoiceStat)("finish",n,l,i)}}}}window.AudioMessagePlayer.events.on("listened",(a=>function(e,t,a){var s=t.closest("._im_mess"),i=t.closest(".im_fwd_log_wrap");if(s&&!i){var n=Number(s.dataset.msgid),r=Number(s.dataset.peer);n&&r&&(0,me.markAudioMessageAsListened)((0,b.unpackStore)(e),n,r).then((()=>{a.markMessageAsListened(e,r,n)})).catch((()=>{}))}}(e,a,t()))),window.AudioMessagePlayer.events.on("transcription_toggle",(t=>qt(e,t))),window.AudioMessagePlayer.events.on("playing",(e=>{a("playing",e)})),window.AudioMessagePlayer.events.on("paused",(e=>{a("paused",e)})),window.AudioMessagePlayer.events.on("finished",(e=>{a("finished",e)}))}function Vt(e){var t=e.target.closest("._msg_asr_toggle"),a=e.target.closest(`.${h.AUDIO_MSG_CLASS}`);(0,Y.showTooltip)(t,{text:a.classList.contains(Oe)?oe.getLang("me_voice_asr_toggle_close"):oe.getLang("me_voice_asr_toggle_open"),className:"_im_history_tooltip",appendParentCls:"_im_mess_stack",black:1,shift:[6,12],showdt:400,onHide(){window.tooltips&&tooltips.destroy(t,{fasthide:!0})}})}function Kt(e,t,a){var s=a.target.closest("."+h.MESSAGE_KEYBOARD_BUTTON_CLASS),i=a.target.closest("."+h.MESSAGE_STACK_CLASS);if(s){var n=e.sendMessageFromKeyboard.bind(null,(()=>e)),r=(0,v.getActionObjectFromElement)(s),o=i?i.dataset.peer:void 0,l=a.target.closest("._im_mess"),d=(0,p.getCurrentTab)(t);if(!l||!d)return;var c=Number(l.dataset.msgid),u=(0,f.parserMessage)(c?d.msgs[c]:d.pinned);if(!u)return;return(0,v.handleButtonClick)(r,n,t,{keyboardAuthorId:o,peerId:u.peerId,message:u,onBeforeSend:()=>{(0,h.setCallbackButtonLoadingState)(s,!0)},onSendSuccess:e=>{var a={timeout:setTimeout((()=>{t.set((t=>(0,ne.unsetPressedCallbackButton)({peerId:u.peerId,eventId:e},t))).then((()=>(0,h.setCallbackButtonLoadingState)(s,!1)))}),v.CALLBACK_TIMEOUT_MS),onCallback:()=>{var e,t=Number(s.dataset.index);document.contains(s)?e=s:isNaN(t)||(e=(0,h.getCallbackButton)(document,Number(u.messageId),t)),e&&(0,h.setCallbackButtonLoadingState)(e,!1)}};t.set((t=>(0,ne.setPressedCallbackButton)({peerId:u.peerId,eventId:e},a,t)))},onSendFail:e=>{e.error_msg&&(0,v.handleShowSnackbar)({peerId:u.peerId,store:t,text:e.error_msg}),(0,h.setCallbackButtonLoadingState)(s,!1)}})}}function Wt(e,t){var a=t.target.closest("._im-call-snippet"),s=a.closest("."+Ae),i=a.dataset.type,n=a.dataset.participants,r=n&&n.split(",").reduce(((t,a)=>(+a!==e.get().id&&he.Ranges.isUserIdTransitional(+a)&&t.push(+a),t)),[]),o=+s.dataset.peer;(0,h.isCallToPeerAvailable)(e,o)&&(0,h.startCallFromIm)(e,o,"video"===i,r,h.CALL_ENTRY_POINT_SNIPPET)}function Yt(e,t,a){var s=a.target.closest("._im_mess_pinned");(0,h.updateMessageEditableStatus)(e,e.get().peer,t,s)}function $t(e,t,a,s,i,l,d,c,_,v,w,C,S,T,I,k,A,L,P,R){var D,x=(0,b.throttle)((function(){a.smoothScroll(...arguments)}),300);return{fixKeyboard(){i.fixKeyboard()},removeUnpinnedMessageEditable(e,a){var s=t.querySelector(`._im_mess_pinned:not(._im_mess_${a}`);s&&(s.classList.remove(Pe),(0,h.updateMessageEditableStatus)(e,e.get().peer,t,s))},changePeer(e,n,o){void 0===n&&(n=!0),void 0===o&&(o=!0);var d,v=e.get().peer;if((0,r.revertLastInlineVideo)(t),_.hideReactionsPanel(),0===v)return null==(d=window.StickerPickerViewer)||d.destroy(),I.disable(),i.setDraft(e,null),(0,X.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,pe.loadMarusiaSdk)().then((e=>{e&&(e.stopListening(),e.hide())})),function(e){(0,u.addClass)(e,"im-page--history_empty"),Xe(e).innerHTML=""}(t);if((0,h.isFullyLoadedTab)(e.get(),e.get().peer)){(0,u.removeClass)(t,"im-page--history_search"),s.deselectAll(e),s.changeActions(e),s.showActions(e);var b=e.get().prevPeer;(0,u.removeClass)(t,"im-page--history_loading"),(0,u.toggleClass)(t,"im-page--history_vkcomgroup",(0,h.isFvkcomgroup)(e,v)),n?i.setDraft(e,(0,f.getTabDraft)((0,p.getCurrentTab)(e))):i.updateState(e),ct(e,t),ut(e,t),this.updateGoToReactionsButton(e,t),l().updateTyping(v,e),ot(e,0,s),he.Ranges.isZeroOwner(b)&&!he.Ranges.isZeroOwner(v)?function(e,t,a,s,i,n,r,o,l,d,c){(0,u.removeClass)(e,"im-page--history_empty"),Je(e,t,a,s,i,n,r,o,l,d,c)}(t,e,v,a,l,s,c,k,L,o,I):he.Ranges.isZeroOwner(b)||he.Ranges.isZeroOwner(v)||Je(t,e,v,a,l,s,c,k,L,o,I),(0,f.isCasperChat)(e,v)||(I.enable(),I.toggle(!0),I.reset(a)),he.Ranges.isZeroOwner(v)||setTimeout((()=>{st(e,l,Xe(t),S,I,t,0,a)})),(0,ce.ensureDomHasActions)(t),(0,m.getPeer)(e)===g.VK_OFFICIAL_PEER_ID&&(0,Q.collectOnboardingFindFriendsShowStats)(e.get().viewer_id),i.updateMediaSelectorOptions(e),window.IM&&window.IM.updateHints(v)}},preparePeer(e){var a=(0,m.getPeer)(e);Ot(e),i.setDraft(e,(0,f.getTabDraft)((0,f.getTab)(e,a)),!1),l().updateTyping(a,e),l().hideError(),s.renderPeer(e),k.renderPeer(e),s.hideActions(e),c.changePeer(a,e),ot(e,0,s),I.toggle(!1),Lt(e,t,!0),Pt(e,t,!0),function(e,t){e.set((e=>(0,n.updateGoToReactionAvailability)(!1,e))),_t(t)}(e,t)},saveScroll:e=>et(e,a),loadingPeer(e){(0,n.isAnythingLoading)(e.get())||((0,u.removeClass)(t,"im-page--history_empty"),(0,u.addClass)(t,"im-page--history_loading"))},stopLoading(e){(0,u.removeClass)(t,"im-page--history_loading")},deselectDialog(e){d().removeSelection(e)},replaceMessageAttrs(e,a){(0,h.replaceMessageAttrs)(a.get(),Xe(t),e),R.update()},cleanSelection(e){v.cleanSelection(e)},updateDialogFilters(e,t){d().updateDialogFilters(e,t)},getSearchResulstModule:()=>D,showSearchResults(e){e?((0,u.removeClass)(t,"im-page--history_search-empty"),Xe(t).innerHTML=e):((0,u.addClass)(t,"im-page--history_search-empty"),Xe(t).innerHTML=(0,h.renderEmptySearch)())},insertSearch(e,i){D||(s.deselectAll(i),D=(0,M.mount)(t,i,"message_search")),(0,u.addClass)(t,"im-page--history_search"),l().showSearchResults(e),It(i,a,t),a.scrollBottom(0),ct(i,t),ut(i,t),this.updateGoToReactionsButton(i,t),I.reset(a)},updateChatTopic(e,t){d().updateDialog(e,t),e===t.get().peer&&(s.renderPeer(t),s.renderActions(t),k.renderPeer(t))},updateActions(e){s.changeActions(e)},updateChatPhoto(e,i,n){if((0,h.isPeerActive)(e.peerId,n.get())){s.renderPeer(n),k.renderPeer(n);var r=ht(a);(0,h.addChatPhotoToUpdate)(e,i,n.get(),Xe(t)),r&&a.scrollBottom(ve)}},markImportant(e,a,i){We(t,e)&&(s.changedMessageSelection(i),_.markImportant(e,a,i))},isNewMessagesVisible:e=>function(e,t){return(0,f.getUnreadScrollBottom)(e)>=(0,$.intval)(t.scrollBottom())}(e,a),loadHistory(e,s,i,n){void 0===n&&(n=!1);var r=i.get();if((0,h.isPeerActive)(e,r)){var o=n||r.tabs[e].historyToAppend;if(!o)return;var l=(0,u.geByClass1)("_im_peer_history",t),d=(0,u.domFC)(l),c=a.scrollBottom(),_=s.reversed?e=>l.appendChild(e):e=>l.insertBefore(e,d),g=0;s.reversed&&(g=l.offsetHeight);var m=(0,u.sech)(o),p=document.createDocumentFragment();m.forEach((e=>p.appendChild(e))),_(p),(0,J.initWidgets)(t),s.reversed&&I.heightIncreased(l.offsetHeight-g,a),s.reversed||a.scrollBottomFixSave(c),a.update(!1,!0);var v=m.filter((e=>(0,u.hasClass)(e,"_im_bar_date")));I.parseMore(v,a),(0,ce.ensureDomHasActions)(t),R.update()}},sendMessage(e){0!==e.get().peer&&i.sendMessage()},editMessage(e,i){if((0,h.isFullyLoadedTab)(e,i.peerId)&&(0,h.isPeerActive)(i.peerId,e.get())){if(!We(t,i.messageId))return;et(e,a),(0,h.editAndReplaceMessage)(e.get(),i,t),Qe((0,f.getTab)(e,i.peerId),a),s.reRenderPinned(e),I.reset(a),R.update()}},updateMessageReactions(e,a,s){(0,h.replaceMessageReactions)(t,a,s,e)},addMessage(e,s){if(!(0,n.isSearchingInplace)(s.peerId,e.get())&&(0,h.isFullyLoadedTab)(e,s.peerId)&&(0,h.isPeerActive)(s.peerId,e.get())){if(We(t,s.messageId))return;var i=Xe(t);Mt(I,i,a,(()=>{var n=ht(a),r=(0,u.geByClass1)("_im_unread_bar_row",t),o=(0,h.isMessagesVisible)(e,t,a),d=o[0],c=o[1];(0,ce.appendMessageToHistory)(e.get(),s,i,!0,!d&&!r),(0,u.removeClass)(t,"im-page--history_empty-hist");var _=(0,f.getTab)(e,e.get().peer),g=(0,y.isServiceMsg)(s)&&s.userId===vk.id,m=s.kludges&&s.kludges.source_act,p=g&&m!==h.CHAT_PIN_MESSAGE&&m!==h.CHAT_UNPIN_MESSAGE;_.skipped||d||!(0,y.isUnread)(_,s)||(0,y.isOut)(s)||(ct(e,t,!0,c),ut(e,t,0,c)),(s.local||n||p)&&(Ue=!0,a.scrollBottom(0)),l().updateTyping(s.peerId,e),pt(t,e),Nt(t)}));var r=(0,u.domPS)((0,u.domLC)(i));if((0,u.hasClass)(r,"_im_bar_date")){var o=(0,u.ce)("div");o.innerHTML=r.outerHTML,I.parseMore(o,a)}l().hideError(),I.update(a),(0,n.updateMentions)(e.get()),Ft(e,s.peerId,a.scrollBottom(),0,l),this.updateObserver()}},setMessageErrored(e,a,s,i){s&&"string"==typeof s&&l().showError(s),(0,h.setMessageError)(e,a,t)},markMessagesAsRead(e,a){e.get().peer===a.peerId&&(0,h.markMessagesAsRead)(e.get(),a.peerId,t)},markMessageAsListened(e,a,s){(0,m.getPeer)(e)===a&&(0,h.updateListenedMark)(t,s)},compensateHistoryHeightChange(e){a.scrollTop(a.scrollTop()+e*Ge(C))},updateTyping(e,a){if(!(0,n.isSearchingInplace)(e,a.get())){var s=a.get();if(s.peer===e&&(0,h.isFullyLoadedTab)(s,e)){var i=(0,h.formatTyper)((0,f.getTab)(a,e).activity,e,!1,s),r=(0,u.geByClass1)(h.TYPING_CLASS,t);if(r||i){if(!r){var o=(0,u.geByClass1)("_im_typer_c",t);(0,u.val)(o,(0,$.getTemplate)("im_typing",{cls:(0,h.isClassicInterface)(a)?"im-activity_classic":""})),r=(0,u.geByClass1)(h.TYPING_CLASS,t)}(0,u.val)((0,u.geByClass1)("_im_typing_name",r),i);var d=(0,h.loadSummaryActivityType)((0,f.getTab)(a,e).activity||{})===n.ACTIVITY_TYPE_RECORDING_AUDIO;r.setAttribute("data-activity-type",d?"recording":"typing"),i?((0,u.addClass)(r,"im-page--typing_vis"),l().hideError()):(0,u.removeClass)(r,"im-page--typing_vis")}}}},scrollFix(e,t,s){I.heightIncreased(s,a),I.update(a),(0,h.isPeerActive)(t,e.get())&&ht(a,s)&&a.scrollBottom(ve)},scrollBottom(){a.scrollBottom(ve)},goToEnd(){wt((()=>this),C,t,a)},updateGoToEnd(e,s){var i=(0,f.getTab)(e,e.get().peer);i&&(i.skipped||i.unread)?ct(e,t):Lt(e,t,s),w(0,a,!1);var n=e.get().peer;setTimeout((()=>{e.get().peer===n&&et(e,a)}))},updateGoToMention(e,s){var i=(0,f.getTab)(e,e.get().peer),n=i||{},r=n.mentions,o=void 0===r?[]:r,l=n.mention_cmids,d=void 0===l?[]:l,c=(0,X.partConfigEnabled)("me_web_read_by_cmid")?d[0]:o[0];i&&c?ut(e,t):Pt(e,t,s),w(0,a,!1);var u=e.get().peer;setTimeout((()=>{e.get().peer===u&&et(e,a)}))},newMessage(e){d().newMessage(e),Lt(e,t,!0),Pt(e,t,!0)},scroll(e,t,s,i){if(void 0===s&&(s=!1),void 0===i&&(i=!1),0!==e.get().peer){var n=s?a.getScrollHeight():40;!0===i&&(n=a.contHeight()),n="up"===t?-n:n,s||i?x(n,(()=>{w(n,a)})):(a.scrollTop(a.scrollTop()+n),w(n,a))}},showCreation(e,t){d().showCreation(e,t)},updateScroll:()=>It(C,a,t),toggleBarDate(e){I.toggle(e)},changedMessageSelection(e){s.changedMessageSelection(e)},updateOnline(e,t){(0,h.isTabLoaded)(t.get(),e)&&e===t.get().peer&&s.renderPeer(t)},isEmpty:e=>i.isEmpty(e),replaceAttachmentPlaceholders(e,i){if((0,h.isPeerActive)(i.peerId,e.get()))Mt(I,Xe(t),a,(()=>{var n=ht(a);(0,h.replaceAttaches)(t,i,e.get());var r=(0,f.getTab)(e,i.peerId);if(r.mediacontent[i.messageId].length>=3&&r.mediacontent[i.messageId][2].pinned){var o=(0,f.parserMessage)(r.pinned);o&&o.messageId==i.messageId&&(r.pinned=r.mediacontent[i.messageId][2].pinned,s.reRenderPinned(e))}n&&a.scrollBottom(0)})),I.update(a);else if((0,y.isMoneyRequest)(i)){var n=(0,f.getTab)(e,i.peerId);if(n.mediacontent[i.messageId].length>=3&&n.mediacontent[i.messageId][2].pinned){var r=(0,f.parserMessage)(n.pinned);r&&r.messageId==i.messageId&&(n.pinned=n.mediacontent[i.messageId][2].pinned)}}},replaceBotCarouselPlaceholder(e,s){var i=e.get();(0,h.isPeerActive)(s.peerId,i)&&(Mt(I,Xe(t),a,(()=>{var e=ht(a);(0,h.replaceCarousel)(t,s,i),e&&a.scrollBottom(0)})),I.update(a))},removeMessages(e,i,n){n.get().peer===i&&((0,h.removeMessages)(e,Xe(t)),(0,h.removeExpiredMessagesStub)(e,Xe(t)),It(n,a,t),s.changedMessageSelection(n),this.updateObserver())},removeStartingFromMessage(e,i,n){if(n.get().peer===i){var r=Xe(t),o=(0,u.geByClass1)("_im_mess_"+e,r);(0,h.removeStartingFromMessage)(o,r),It(n,a,t),s.changedMessageSelection(n)}},hideGoToEnd(e){Lt(C,t,e)},hideGoToMention(e){Pt(C,t,e)},removeMessagesRestore(e,a,s,i){i.get().peer===a&&(0,h.removeMessagesWithRestore)(e,a,s,Xe(t))},removeExpiredFailedMessages(e){C.get().peer===e&&C.set(n.removeExpiredFailed.bind(null,Xe(t),e))},handleMessageExpiration(e){(0,h.isFullyLoadedTab)(C.get(),e.peerId)&&((0,h.replaceExpiredMessageWithPlaceholder)(C,t,e),(0,h.replaceExpiredRepliedMessageWithPlaceholder)(t,e),i.detachMessages(e))},updateState(e,t){d().updateState(e,t)},updateBanner(e){k.renderPeer(e)},updateHeader(e){s.renderPeer(e)},updateChat(e,t){e.get().peer===t&&(s.changeActions(e),s.renderPeer(e),s.renderActions(e),k.renderPeer(e),i.updateState(e),(0,n.updateMentions)(e.get()))},updateConvoInList(e,t){d().updateConvoInList(e,t)},focustTxt(e){i.focusOn(e)},startSearch(e){e.get().peer&&(l().showSearch(e),c.changePeer(e.get().peer,e),c.search())},showSearch(e){(0,u.addClass)(t,"im-page--hisory_search-open"),e.setState({searchShown:!0}),je(e)&&this.updateChatTopic(e.get().peer,e),this.cancelEditing(),setTimeout((()=>c.focus(e)),10)},cancelSearch(e,i){if(void 0===i&&(i=!0),e.get().searchShown&&((0,u.removeClass)(t,"im-page--hisory_search-open"),(0,u.removeClass)(t,"im-page--history_search"),(0,u.removeClass)(t,"im-page--history_search-empty"),e.setState({searchShown:!1}),je(e)&&this.updateChatTopic(e.get().peer,e),s.changedMessageSelection(e)),i&&!he.Ranges.isZeroOwner(e.get().peer)&&D){var r=e.get().tabs[e.get().peer],o=(0,n.strHistory)(r.history);o?Xe(t).innerHTML=o:l().showEmptyScreen(),It(e,a,t),a.scrollBottom(0),e.get().msgid&&(rt(a,t,e.get().msgid,e),ct(e,t),ut(e,t)),this.updateGoToReactionsButton(e,t),S(a),I.reset(a)}D&&(D.unmount(),D=!1,(0,ce.ensureDomHasActions)(t))},showEmptyScreen(){var e=(0,u.geByClass1)("_im_peer_history",t);(0,u.addClass)(t,"im-page--history_empty-hist");var a=(0,de.renderHistoryStub)(C);(0,u.val)(e,a)},updateHistory(e){0!==C.get().peer&&e(t)},focusOnMessage(){rt(a,t,C.get().msgid,C)},sendEditMessage(e,t){e.set(n.deliverEditedMessage.bind(null,(0,f.getTab)(e,t.peerId),t)).catch((a=>e.get().longpoll.push([(0,B.failedMessage)(t.peerId,t,a)])))},renderStickersPanel(e){var a=(0,m.getPeer)(e),s=(0,f.getTab)(e,a);if(s&&!(s.block_error&&s.block_error>0)){var i=(0,n.strHistory)(s.history||""),r=t.querySelector("._im_stickers_panel_placeholder");if(r&&!i){var o=(0,de.prepareEmptyDialogStickersTemplate)(e);if(!o)return;(0,u.domReplaceEl)(r,o)}}},deselectAll(e){s.deselectAll(e)},unmount(){(0,E.destroyModule)(e),a.destroy(),clearInterval(T),i.unmount(),s.unmount(),_.unmount(),v.unmount(),c.unmount(),I.unmount(),(0,o.cancelStackFilter)("forward"),A.unmount(),null==P||P.unmount(),R.unmount(),function(e,t){(0,N.removeDraggable)((0,u.geByClass1)(e,t))}("_im_chat_resize_track",t),L.destroy()},removePeer(e,t){d().removePeer(e,t)},restoreScroll(e,t){var s=e.get().tabs[t];s.scrollBottom?Qe(s,a):a.scrollBottom(ve)},resendMessage(e,a){e===C.get().peer&&(0,h.startResendMessage)(e,a,t)},resendPeer(){i.resendPeer()},resendAll(){i.resendAll()},respond(e,t){i.attachMessages(e,t),i.focusOn(e);var s=(0,f.getTab)(e,t);s&&!s.skipped&&(a.scrollBottom(ve),S(a))},restoreDialogs(e,t,a){d().restoreDialogs(e,t,a)},cancelRecording(){i.cancelRecording()},flushDraft(e){i.saveText(e)},hideError(){(0,u.geByClass1)(we,t).classList.remove(Ce)},showError(e){var s=(0,u.geByClass1)(we,t);s.innerHTML=e,s.classList.add(Ce),a.scrollBottom(ve)},startEditing(e){if((0,n.isAnythingLoading)(C.get()))(0,h.showWaitUntilUploadedBox)();else{e=(0,f.parserMessage)(e);var a=(0,h.getNowEditingMessage)(C);if(!(i.isBlocked()||a&&a.messageId==e.messageId)){a&&this.cancelEditing(),Nt(t),C.get().searchShown&&this.cancelSearch(C);var r=We(t,e.messageId);r&&(this.cancelRecording(),function(e,t,a,s,i){e.setState({isEditing:!0}),a.saveText(e),(0,u.addClass)(s,"im-mess_is_editing"),(0,u.addClass)((0,u.geByClass1)("_im_page_history"),"is_msg_editing"),(0,o.cancelStackPush)("cancel_edit",(()=>Bt(e,t,a,s)));var n=new q.ImDraft;n.dData.txt=(0,j.convertEmojiHtmlToRegularText)(i.text),n.dData.attaches=(0,G.convertKludgesToAttaches)(i.kludges,i.messageId),a.toggleStickers(e,!1),a.setDraft(e,n),setTimeout((()=>a.focusOn(e)),0)}(C,t,i,r,e),i.hideKeyboard(),s.deselectAll(C))}}},cancelEditing(){var e=(0,h.getNowEditingMessage)(C);e&&Bt(C,t,i,We(t,e.messageId))},messageKeyboardButtonClick:e=>Kt(i,C,e),getEditingMessage:()=>(0,h.getNowEditingMessage)(C),focusEditingMessage(){var e=(0,h.getNowEditingMessage)(C);e&&rt(a,t,e.messageId,C),i.focusOn(C)},setNetworkWaitingStatus(e,t){s.setNetworkWaitingStatus(e,t)},setNetworkReconnectingStatus(e){s.setNetworkReconnectingStatus(e)},clearNetworkStatus(){s.clearNetworkStatus()},updateCasperMessageStatus(e,a){void 0===a&&(a=!1),(0,h.isFullyLoadedTab)(C.get(),e.peerId)&&C.set(n.updateCasperMessageExpiringStatus.bind(null,e,a)).then((()=>{C.get().peer===e.peerId&&(0,h.setCasperMessageExpiringStatusDOM)(t,a,e.messageId)}))},updateObserver(){A.update(),null==P||P.update(),R.update()},updateFolderCounters(e){d().updateFolderCounters(e)},renderPeerProfile(e){L.render(e)},destroyPeerProfile(){L.destroy()},updateGoToReactionsButton(e,t){gt(e,t)}}}function zt(e,t,a,s,i){var r=(0,u.geByClass1)("_im_peer_history_w",e);(0,Z.hasAccessibilityMode)()&&(0,u.addClass)(r,"history_a11y");var o,v,C,M=(0,E.createMutations)($t),O=M.callMutations,F=M.bindMutations,U=(o=et.bind(null,t),v=(0,z.debounce)(o,100),C=(0,b.throttle)(o,100),e=>{v(e),C(e)}),H=(0,x.mount)(t,e),j=st.bind(null,t,O,r,U,H,e),q=(0,k.mount)(e,t,O),G=(0,D.createScroll)((0,u.geByClass1)("_im_chat_body_abs",e),{onScroll:function(){j(...arguments),(0,X.partConfigEnabled)("mail_history_mention_popover")&&window.reforgedME&&window.reforgedME.profileInfo&&window.reforgedME.profileInfo.mountProfileInfo(null),(0,X.partConfigEnabled)("messages_reactions")&&(!Ue&&q.hideReactionsPanel(),Ue=!1)},nativeScroll:(0,h.isClassicInterface)(t),shadows:!1}),K=(0,h.isClassicInterface)(t)?void 0:G.scroll.container,W=(0,L.mount)(t,K,(e=>function(e,t,a){var s=(0,p.getCurrentTab)(e);if(s){var i=a.reduce(((t,a)=>{if(a.isIntersecting){var i=+a.target.getAttribute("data-msgid")||+a.target.getAttribute("data-last-msgid"),n=(0,f.getMessage)(e,s.peerId,i);i&&n&&!(0,y.isOut)(n)&&t.push(i)}return t}),[]);if(i.length){var r=Math.max(...i);it(e,r).then((()=>{r===s.lastmsg&&e.set((e=>(0,n.setActions)(e))).then((()=>t().updateActions(e)))}))}}}(t,O,e)),((e,t)=>(0,y.isUnread)(t,e))),J=()=>{var e,t;return null==(e=window.curNotifier)||null==(t=e.idle_manager)?void 0:t.is_idle},de=(0,L.mountHistoryMsgsReactionsObserver)(t,K,(()=>mt(t,e)),(e=>{if(!J()&&(0,X.partConfigEnabled)("messages_reactions")){var a=(0,p.getCurrentTab)(t);if(a&&(0,p.shouldUseReactionsShortPolling)(a)){var s=(0,m.getPeer)(t);t.set((t=>(0,le.updateMessagesReactions)(s,e,t))).then((t=>{e.forEach((e=>{var a=(0,ie.getMessageByCmid)(t,s,e),i=null==a?void 0:a.messageId;i&&void 0!==a.kludges.reactions&&O().updateMessageReactions(t,s,i)}))}))}}}),(i=>{if(!J()&&(0,X.partConfigEnabled)("messages_reactions")){var n=(0,m.getPeer)(t),r=(0,m.getGroupId)(t);t.set((e=>{var a=Array.from((0,m.getPendingReadReactionsCmids)(t,n));return(0,ne.setPendingReadReactionsCmids)(n,[...a,...i],e)})).then((t=>{gt(t,e),a.updateCounter(t,n),(0,h.isClassicInterface)(t)&&s.updateCounter(t,n)})).then((()=>(0,le.markReactionsAsRead)(i,n,r))).then((()=>{var e=Array.from((0,m.getPendingReadReactionsCmids)(t,n)),a=new Set(i),s=e.filter((e=>!a.has(e)));t.set((e=>(0,ne.setPendingReadReactionsCmids)(n,s,e)))}))}})),me=(0,m.getLocalSettingsValue)(t,"transcript_auto_show")&&(0,b.unpackStore)(t).isASRSettingHintActive?(0,L.mount)(t,K,(e=>{var a,s,i,n,r,o=null!=(a=null==(s=cur)||null==(i=s.imDb)||null==i.selectByKey?void 0:i.selectByKey("shown_asr_hints"))?a:[];e.forEach((e=>{if(e.isIntersecting){var a=Number(e.target.dataset.msgid||e.target.dataset.lastMsgid);o&&!o.includes(a)&&e.target.querySelector(`.${Be}`)&&(o.length+1<3?o.push(a):(t.set((e=>(e.isASRSettingHintActive=!1,Promise.resolve(e)))),(0,ge.hideHelpHint)("im:transcript_autoshow_setting"),me.unmount(),o=void 0))}})),null==(n=cur)||null==(r=n.imDb)||null==r.updateByKey||r.updateByKey("shown_asr_hints",o)}),y.isAudioMsg):void 0,pe=(0,S.mount)((0,u.geByClass1)("_im_dialog_actions",e),t,O);setTimeout((function(){var a=t.get().peer;if(a){if(Ot(t),((0,p.getCurrentTab)(t).pinned||(0,p.getCurrentTab)(t).top_banner)&&(O().updateChatTopic(a,t),t.set(n.setActions),pe.changeActions(t)),(0,p.getCurrentTab)(t).callInProgress&&O().updateBanner(t),t.get().msgid)rt(G,e,t.get().msgid,t);else if(!nt(G,e,O,t,H)){G.scrollBottom(ve);var s=(0,p.getCurrentTab)(t);(0,h.isTabMarkedUnread)(s)&&t.set((e=>(0,n.markDialogRead)(s.peerId,e)))}t.get().history_init=!1,(0,f.isCasperChat)(t,a)?H.disable():H.reset(G),ct(t,e),ut(t,e),st(t,O,r,U,H,e,0,G),(0,ce.ensureDomHasActions)(e),nav.objLoc.st&&(t.mutate(n.setInplaceSearch.bind(null,nav.objLoc.st,a)),O().startSearch(t)),window.nav.objLoc.open_settings&&(pe.showSettings(t),delete window.nav.objLoc.open_settings,window.nav.setLoc(window.nav.objLoc))}else H.disable()}),15);var Ce=(0,T.mount)((0,u.geByClass1)("_im_text_input",e),t,(0,h.isClassicInterface)(t)?s.updateMenu:void 0,((e,t)=>{a.removeDialog(e,t),a.restoreDialogs(e,!0)}),O),Me=(0,I.mount)((0,u.geByClass1)("_im_dialog_actions",e),t,O),Oe=(0,A.mount)(e,t,(()=>({changedMessageSelection:pe.changedMessageSelection}))),Ne=(0,P.mount)(r);(0,R.mount)(e,t,O);var Fe=(0,V.mount)(e,t,(()=>({hidePinned(){(0,R.pinnedMessageHide)(t,t.get().peer,O,!1)},compensateHistoryHeightChange(e){O().compensateHistoryHeightChange(e)},showPinned(){(0,R.pinnedMessageUnHide)(t,t.get().peer,O,!1)},showMessageRequestRejectDialog(t){!function(e,t,a,s,i){var r=oe.getLang("mail_mr_reject_confirmation"),o=(0,ee.oCacheGet)(e,i),l=`<div class="checkbox _im_is_spam_checkbox" onclick="checkbox(this);" role="checkbox" aria-checked="false">${oe.getLang("mail_report_as_spam")}</div>`,d=o?o.first_name_gen:"",c=(0,te.showFastBox)(oe.getLang("mail_message_request_reject_request"),r.replace("{name}",d),oe.getLang("mail_message_request_reject"),(()=>{var r=(0,se.isChecked)((0,u.geByClass1)("_im_is_spam_checkbox"),t),o=r?oe.getLang("mail_message_request_rejected_and_spam"):oe.getLang("mail_message_request_rejected");e.set((e=>(0,n.rejectMessageRequest)(i,r,e))).then((e=>{(0,h.isClassicInterface)(e)&&s.updateMenu(e),a.removeDialog(e,i),a.restoreDialogs(e,!0),i===e.get().peer&&e.get().longpoll.push([(0,B.resetPeer)()]),(0,h.hideAllBoxes)(),(0,ae.showNotification)({text:o})})).catch((e=>{(0,h.hideAllBoxes)(),(0,b.showErrorBox)(e)}))}));c.setControlsText(l)}(t,e,a,s,t.get().peer)},showBusinessNotifyDialog:dt})));he.Ranges.isZeroOwner(t.get().peer)||t.set((e=>(0,ue.restoreHistoryQueue)(e,t.get().peer))).then((()=>{(0,ue.restoreQueuedMessagesInDom)(t.get(),t.get().peer,Xe(e)),ze(e,t,t.get().peer)})),Gt(t,O),function(e,t,a){var s,i,n=(0,u.geByClass1)(e,t);(0,N.initDraggable)(n,{onStartDrag:(e,t)=>{(0,u.addClass)(document.body,"cursor_ns_resize"),s=t,i=t},onDrop:()=>{(0,u.removeClass)(document.body,"cursor_ns_resize")},onDrag:(e,n)=>{var r=Ve(i-s+n,t);(0,h.setClassicChatHeight)(r),a().fixHeight()}})}("_im_chat_resize_track",e,i);var He=vt.bind(null,t,e,O),je=ft.bind(null,t,e,G,O),qe=e=>{(0,d.cancelEvent)(e),function(e,t){e().showCreation(t)}(i,t)},Ge=wt.bind(null,O,t,e,G),We=Ct.bind(null,O,t,e,G),Qe=St.bind(null,t,e,G),Je=Ze.bind(null,t,e),tt=h.showEditTimeTooltip.bind(null,t),at=h.showMessageInfoTooltip.bind(null,t),_t=lt.bind(null,t,He,e,O),pt=$e.bind(null,t,e,G),ht=Rt.bind(null,O,t,G),bt=Dt.bind(null,t),yt=xt.bind(null,t,O),Et=Ut.bind(null,t,O,e),Tt=Kt.bind(null,Ce,t),It=Ye.bind(null,O),Mt=h.showCasperExpiringTooltip.bind(null,t,e),At=()=>(0,c.showWiki)({w:"expired_messages"}),Lt=Wt.bind(null,t),Pt=e=>function(e,t){var a=t.target.closest("."+Le),s=a.closest("."+Ae),i=a.dataset.link,n=+s.dataset.peer;((0,h.isCallToPeerFromSnippetAvailable)(e,n)||(0,h.isCallToPeerAvailable)(e,n))&&(0,h.joinCallFromIm)(e,n,i,!1,h.CALL_ENTRY_POINT_JOIN_SNIPPET)}(t,e),Bt=Yt.bind(null,t,e),Nt=e=>function(e,t){var a=t.target.closest("._im_subscribe_button"),s=(0,m.getPeer)(e);if(!re.FlatButton.isLocked(a)&&s){var i=e.get().tabs[s].is_subscribed;re.FlatButton.lock(a),e.set((e=>(0,le.setPeerSubscribedStatus)(s,i,e))).then((e=>{var t=(0,b.unpackStore)(e).tabs[s].is_subscribed,i=t?oe.getLang("mail_friend_request_sent"):oe.getLang("mail_add_to_friends"),n=t?re.FlatButtonAppearance.SECONDARY:re.FlatButtonAppearance.PRIMARY;re.FlatButton.unlock(a),re.FlatButton.setAppearance(a,n),re.FlatButton.setLabel(a,i)})).catch((()=>{re.FlatButton.unlock(a)}))}}(t,e),Ft=e=>{var t=(0,u.domClosest)(De,e.target);if(t){var a=(0,u.domClosest)(h.MESSAGE_STACK_CLASS,t),s=parseInt((0,u.domData)(a,"peer"),10)||null;window.reforgedME&&window.reforgedME.profileInfo&&s&&window.reforgedME.profileInfo.mountProfileInfo({peerId:s,targetElement:t})}},jt=(0,E.createModule)({handlers:(a,s)=>{s(e,"click",h.RESTORE_CLASS,je),s(e,"mouseover click",h.FAILED_CLASS,Je),s(e,"mouseover","_im_edit_time",tt),s(e,"mouseover","_im_page_info",at),s(e,"click","_im_mess_susp",Ke.bind(null,e)),s(e,"click","_im_failed_action",_t),s(e,"click","_im_mess_link",pt),s(e,"mouseover","_im_admin_name",kt),s(e,"mouseover",Ee,bt),s(e,"mouseover","im-mess-stack--bomb",Mt),s(e,"mouseover","mem_pseudolink",(e=>function(e,t){var a=e.target.dataset.mention,s=null;switch(!0){case g.MASS_MENTION_ALIASES.all.includes(a):s=oe.getLang("mail_im_mention_all");break;case g.MASS_MENTION_ALIASES.online.includes(a):s=oe.getLang("mail_im_mention_online")}s&&(window.tooltips&&window.tooltips.destroy(e.target),(0,Y.showTooltip)(e.target,{shift:[0,5],center:!0,black:1,className:"im-mass-mention-tt",reverseOffset:!0,toup:e.target.getBoundingClientRect().top>(0,h.getHistoryTopIndent)(t)+37,text:s,noZIndex:!0}))}(e,t))),s(e,"mouseover",Pe,Bt),s(e,"mouseover",xe,Vt),s(e,"click",h.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON,h.onASRCollapseToggleClick),s(e,"click",Be,(()=>{i().openSettings()})),s(e,"click",Se,yt),s(e,"click",we,It),s(e,"click",Ie,Et),s(e,"click","_im_replied_author_link",Ht),s(e,"click","_chat_invitation",((e,a)=>{if((0,d.checkEvent)(e))return!0;if(!(0,u.gpeByClass)("wall_postlink_preview_btn",e.target)&&!(0,u.hasClass)(e.target,"wall_postlink_preview_btn"))return!0;var s=(0,u.geByClass1)("flat_button",a),i={invite_chat_id:(0,u.domData)(s,"inv-id"),invite_hash:(0,u.domData)(s,"hash")};(0,h.showInvitationBox)(t,i,n.leaveInvitation),(0,d.cancelEvent)(e)})),s(e,"click",h.JOIN_CALL_BY_LINK_CLASS,h.handleCallLinkClick),s(e,"click","_im_join_cancel",(()=>t.get().longpoll.push([(0,B.resetPeer)()]))),s(e,"click","_im_retry_media",(e=>function(e,t,a){var s=e.get(),i=(0,u.domClosest)(Te,a.target),r=(0,u.domData)(i,"msgid"),o=(0,f.getMessage)(s,s.peer,r),l=e=>t().replaceAttachmentPlaceholders(e,o);o&&((0,_.statlogsSendingRetry)("retry_attach"),e.set(n.addAttachmentsToStoreData.bind(null,o,[(0,_e.renderMessageMedia)(s,o)])).then(l),e.set(n.loadMedia.bind(null,o)).then(l))}(t,O,e))),s(e,"click",h.MESSAGE_KEYBOARD_BUTTON_CLASS,Tt),s(e,"click",ke,Lt),s(e,"click",Le,Pt),a((0,u.geByClass1)("_im_peer_history_w",e),"mousemove",H.show),a((0,u.geByClass1)("_im_start_new",e),"click",qe),a(e.querySelector(fe),"click",Ge),a(e.querySelector(be),"click",We),a(e.querySelector(ye),"click",Qe),s(e,"click",Re,Nt),a((0,u.geByClass1)("_im_cancel_edit",e),"click",(()=>(O().cancelEditing(),!1))),a((0,u.geByClass1)("_im_edit_focus_cur",e),"click",(()=>(O().focusEditingMessage(),!1))),w.screenfull.raw&&a(document,w.screenfull.raw.fullscreenchange,ht),a(window,"im_goToMessage",(e=>{var a=(0,$.intval)(e.msgid);if(a)return(0,l.statlogsValueEvent)("im_links_to_attachments",1,"to_message"),t.set(n.changePeer.bind(null,e.sel,a,!1)).then((()=>(0,h.focusOnMessage)(t,O().focusOnMessage,t.get().peer,a)))})),s(e,"click","im-expired-message--in",At),(0,X.partConfigEnabled)("mail_history_mention_popover")&&s(e,"mouseover",De,Ft)}});curNotifier.recvClbks.pin_hide=[function(e){e.hide?(0,R.pinnedMessageHide)(t,e.peer,O,!1):(0,R.pinnedMessageUnHide)(t,e.peer,O,!1)}],window.showForwardBox=e=>function(e,t){(0,h.applyMessageHandlers)((0,te.showBox)("al_im.php",t,{params:{width:638,bodyStyle:"padding: 0px",containerClass:"im-show-message-box"}},{}),e)}(t,e);var qt=setInterval(ot.bind(null,t,e,pe),1e4);(0,m.getPeer)(t)===g.VK_OFFICIAL_PEER_ID&&(0,Q.collectOnboardingFindFriendsShowStats)(t.get().viewer_id);var zt=(0,m.getPeer)(t),Zt=(0,f.getTab)(t,zt);return Zt&&(0,p.tabIsMessageRequest)(Zt)&&(0,Q.collectOpenMessageRequestStats)(zt),F(jt,e,G,pe,Ce,O,i,Me,q,Oe,j,t,U,qt,H,Fe,W,Ne,me,de)}},506690:(e,t,a)=>{"use strict";a.d(t,{mount:()=>y});var s=a(610124),i=a(810890),n=a(70162),r=a(342269),o=a(873589),l=a(152278),d=a(368752),c=a(384032),u=a(283536),_="im_hist_search";function g(e,t,a,n,r,o){return{focus(e){uiSearch.focus(t),function(e,t,a,s){(0,i.cancelStackPush)(_,f.bind(null,e,t,a,s))}(e,t,a,n)},changePeer(e,a){uiSearch.getFieldEl(t).value=a.get().tabs[e].searchText||""},search(){o({})},unmount(){(0,s.destroyModule)(r),(0,i.cancelStackFilter)(_),n.then((e=>e.destroy()))}}}function m(e,t,a,s){e.set(c.setCurrentSearchDate.bind(null,e.get().peer,`${s.d}.${s.m}.${s.y}`)).then(h.bind(null,e,t,a))}function p(e,t){e.then((e=>{(0,l.triggerEvent)((0,o.geByClass1)("datepicker_control",t),"mousedown",!1,!0)}))}function h(e,t,a){var s=e.get().peer;uiSearch.showProgress(a),(0,c.searchMessagesInplace)(s,e.get()).then((s=>{uiSearch.hideProgress(a),t().insertSearch(s,e),(0,u.updateCounters)(location.href,document.referrer)})).catch((()=>{uiSearch.focus(a),uiSearch.hideProgress(a)}))}function v(e,t,a,s,i,n){if("keyup"!==n.type||13==n.which){var o=(0,r.clean)(uiSearch.getFieldEl(t).value);e.set(c.setCurrentSearch.bind(null,o,e.get().peer)).then(i.bind(null,e,s,t))}}function f(e,t,a,s){(0,i.cancelStackFilter)(_),s.then((e=>{e.hide()})),e.set(c.cancelSearch.bind(null,e.get().peer)).then((()=>{uiSearch.getFieldEl(t).value="",a().cancelSearch(e)}))}function b(e,t,a,s){a.then((e=>{e.hide()})),e.set(c.clearDate.bind(null,e.get().peer)).then(h.bind(null,e,t,s))}function y(e,t,a){var i=(0,o.geByClass1)("_im_search_date_input",e),r=(0,o.geByClass1)("_im_search_history_input",e),l=function(e,t,a,s){var i='<td class="cal_clear" colspan="7"><button type="button" class="im_cal_clear_lnk _im_clear_date">'+n.getLang("wall_clear_date_filter")+"</button></td>";return new Promise((e=>{window.stManager.add(["ui_controls.js",window.jsc("web/datepicker.js"),"datepicker.css"],(function(){var t=new Datepicker(a,{width:140,resfmt:"plain",addRows:'<tr id="im_day_clear">'+i+"</tr>",addRowsM:'<tr id="im_month_clear">'+i+"</tr>",onUpdate:s,pastActive:!0,noFuture:!0});e(t)}))}))}(0,0,i,m.bind(null,t,a,r)),c=p.bind(null,l,e),u=v.bind(null,t,r,i,a,(0,d.debounce)(h,300)),_=f.bind(null,t,r,a,l),y=b.bind(null,t,a,l,r),w=(0,s.createModule)({handlers:(t,a)=>{t((0,o.geByClass1)("_im_search_date",e),"click",c),t(uiSearch.getFieldEl(r),"keyup",u),t((0,o.geByClass1)("_im_start_inplace_search",e),"click",u),t((0,o.geByClass1)("_im_cancel_inplace_search",e),"click",_),a(e,"click","_im_clear_date",y)}});return g(0,r,a,l,w,u)}},267806:(e,t,a)=>{"use strict";a.d(t,{mount:()=>q});var s=a(384032),i=a(70162),n=a(342269),r=a(873589),o=a(661711),l=a(43229),d=a(284863),c=a(610124),u=a(516703),_=a(290846),g=a(663825),m=a(734209),p=a(163612),h=a(712439),v=a(712860),f=a(993421),b=a(376473),y=a(506770),w=a(954972),C="_im_mess_fav",E="_im_mess_reply",S="_im_mess_forward",T="_im_mess_edit",I="_im_mess_reaction",M="im-mess_reacting",k=0;function A(e,t,a,s,i){var n=(0,o.getHistoryTopIndent)(e);(0,_.showTooltip)(t,{shift:[a,10],black:1,className:"_im_history_tooltip "+s,appendParentCls:"_im_mess_stack",toup:t.getBoundingClientRect().top>n+37,text:i})}function L(e,t,a){var i=(0,r.gpeByClass)("_im_mess",a),o=(0,n.intval)((0,r.domData)(i,"msgid")),c=e.get().peer,u=(0,d.getMessage)(e,c,o),_=!(0,l.isImportant)(u);return e.get().longpoll.push([{peerId:c,messageId:o,type:_?g.SET_FLAGS:g.RESET_FLAGS,flags:g.FLAG_IMPORTANT}]),e.set(s.favMessage.bind(null,[o],_,c)),P(e,-10,t,a,!0),!1}function P(e,t,a,s,n){var o=(0,r.domData)((0,r.gpeByClass)("_im_mess",s),"msgid"),c=(0,d.getMessage)(e,e.get().peer,o),u=i.getLang("mail_im_unmark_important"),_=i.getLang("mail_im_toggle_important"),g=(0,l.isImportant)(c)?u:_,m=g.length>16;n&&window.tooltips&&tooltips.destroy(s),A(e,s,m?84:34,m?"im-star-tt_long":"im-star-tt",c?g:"")}function R(e,t,a,i){var n=e.get().peer,l=+(0,r.domData)((0,r.domClosest)("im-mess",i.target),"msgid");if((0,o.canForwardMessages)(e,[l]))return(0,u.statlogsForwardFromChannel)(),(0,s.processFwd)([l],n,e).then((t=>e.set(s.prepareForward.bind(null,t)))).then((()=>{(0,m.mount)(a,e)})),!1}function D(e,t,a){var i=e.get().peer,n=+(0,r.domData)((0,r.domClosest)("im-mess",a.target),"msgid");return(0,s.processFwd)([n],i,e).then((t=>e.set(s.forwardMessages.bind(null,t,e.get().tfdraft,!0)))).then((()=>t().respond(e,i))),!1}function x(e,t,a,s){A(e,s,18,"im-reply-tt",i.getLang("mail_im_mark_forward"))}function O(e,t,a,s){A(e,s,18,"im-reply-tt",i.getLang("mail_im_reply"))}function B(e,t,a,s){var i=(0,n.intval)((0,r.domData)((0,r.gpeByClass)("_im_mess",s),"msgid")),o=(0,d.getMessage)(e,e.get().peer,i);return o&&t().startEditing(o),!1}function N(e,t,a){A(e,a,18,"im-edit-tt",i.getLang("mail_im_edit"))}function F(e,t,a,s){if(!(0,y.partConfigEnabled)("messages_reactions"))return!1;var i=s.closest("._im_mess");if(!i)return!1;var n=Number(i.dataset.cmid);if(n===k)return H(),!1;k>0&&H();var o=(0,h.unpackStore)(e);if(o.reactions){var l=(0,f.getPeer)(e),d=(0,b.getMyReaction)(e,l,n),c=(0,p.renderReactionsPanel)([...o.reactions.values()],d),u=(0,r.se)(c),_=i.offsetWidth-s.offsetLeft-s.offsetWidth-s.offsetWidth/2;return u.style.setProperty("--right-offset",`${_}px`),s.parentElement.after(u),k=n,i.classList.add(M),setTimeout((()=>{document.addEventListener("click",H)})),!1}}function U(e,t,a){if(!(k>0)){var s=i.getLang("mail_im_set_reaction"),n=s.length>16;A(e,a,n?98:48,n?"im-reaction-tt":"im-reaction-long-tt",s)}}function H(){if(0!==k){k=0;var e=document.getElementById("reaction-panel");if(e){var t=e.closest("._im_mess");null==t||t.classList.remove(M),e.remove(),document.removeEventListener("click",H)}}}function j(e,t,a,s){if(!(0,y.partConfigEnabled)("messages_reactions"))return!1;var i=s.closest("._im_mess"),n=(0,f.getPeer)(e);if(!n||!i)return!1;var r=Number(i.dataset.cmid),o=Number(s.dataset.id),l=(0,b.getMyReaction)(e,n,r),d=Number(i.dataset.msgid),c=l===o,u=(0,f.getGroupId)(e),_=c?e=>(0,w.removeMessageReactionOptimistic)(n,d,l,e):e=>(l?(0,w.removeMessageReactionOptimistic)(n,d,l,e):Promise.resolve(e)).then((e=>(0,w.addMessageReactionOptimistic)(n,d,o,e)));return e.set((e=>_(e))).then((e=>t().updateMessageReactions(e,n,d))).then((()=>(0,v.changeMessageReaction)(n,r,o,l,u))),!1}function q(e,t,a){var s=P.bind(null,t,0),i=L.bind(null,t),n=x.bind(null,t,0),r=R.bind(null,t,e.querySelector("_im_dialog_actions"),a),l=O.bind(null,t,0),d=D.bind(null,t,a),u=N.bind(null,t),_=B.bind(null,t,a),g=U.bind(null,t),m=F.bind(null,t,a),p=j.bind(null,t,a),h=j.bind(null,t,a),v=(0,c.createModule)({handlers:(t,a)=>{a(e,"click",C,i),a(e,"mouseover",C,s),a(e,"click",S,r),a(e,"mouseover",S,n),a(e,"click",E,d),a(e,"mouseover",E,l),a(e,"click",T,_),a(e,"mouseover",T,u),a(e,"click",I,m),a(e,"mouseover",I,g),a(e,"click","_im_reactions_panel_item",p),a(e,"click","_im_message_reaction",h)}});return function(e,t){return{markImportant(t,a){(0,o.updateStar)(t,a,e)},unmount(){(0,c.destroyModule)(t)},hideReactionsPanel(){H()}}}(e,v)}},281829:(e,t,a)=>{"use strict";a.d(t,{mount:()=>h});var s=a(891326),i=a(840060),n=a(342269),r=a(152278),o=a(384032),l=a(661711),d=a(645523),c=a(712439),u=a(610124);function _(e){return e.which||e.keyCode}function g(e,t,a){!a||(0,n.inArray)(_(a),s.UNPRINTABLE_KEYS)||(0,o.isSearchingInplace)(e.get().peer,e.get())||(0,l.isEditableFocused)()||a.ctrlKey||i.browser.mac&&a.metaKey||a.key&&1!==a.key.length||t.signal("printable",a)}function m(e,t,a){_(a)===s.ENTER&&e.signal(_(a),a)}function p(e,t,a,o){var c=_(o);if(!layers.visible){if(c>=49&&c<=57&&(o.ctrlKey||o.metaKey&&i.browser.mac)&&(0,l.isClassicInterface)(t))return function(e,t){var a=e.get().tabbedPeers[t];a&&e.get().longpoll.push([(0,d.changePeer)(a.peer,!1,!0,!0,"right_menu")])}(t,c-49),(0,r.cancelEvent)(o);(0,n.inArray)(c,s.UP_DOWN_CONTROLS)&&e.signal(c,o)}}function h(e,t){var a=i.browser.mozilla?"keydown":"keypress",s=(0,c.default)({signalTimer:!1}),n=g.bind(null,e,t),r=p.bind(null,t,e,s),o=m.bind(null,t,s),l=(0,u.createModule)({handlers:e=>{e(document,"keydown",r),e(document,"keyup",o),e(document,a,n)}});return{unmount(){(0,u.destroyModule)(l)}}}},773499:(e,t,a)=>{"use strict";a.d(t,{mount:()=>at});var s=a(887757),i=a(722122),n=a(692137),r=a(362398),o=a(840060),l=a(372650),d=a(810890),c=a(70162),u=a(733164),_=a(152278),g=a(501389),m=a(342269),p=a(240367),h=a(873589),v=a(973987),f=a(364368),b=a(176651),y=a(265988),w=a(682886),C=a(283303),E=a(934103),S=a(640157),T=a(967181),I=a(610124),M=a(91786),k=a(321714),A=a(663825),L=a(177551),P=a(336470),R=a(668825),D=a(36713),x=a(879346),O=a(66433),B=a(67328),N=a(284863),F=a(43229),U=a(384032),H=a(516703),j=a(661711),q=a(891326),G=a(478810),V=a(281829),K=a(238283),W=a(630910),Y=a(417333),$=a(592380),z=a(368752),Z=a(506770),X=a(375053),Q=a(645523),J=a(407381),ee=a(306151),te=a(459554),ae=a(993421),se=a(475234),ie=a(928322),ne=a(352111),re=a(75560),oe=a(712860),le=a(954972),de=a(730412),ce=a(179288),ue=a(917791),_e=a(163612),ge=a(412827),me=a(376473),pe=a(419672),he=a(294378),ve=a(35916),fe=a(826338),be=a(679483),ye=a(240950),we=a(722199),Ce=a(522925),Ee=a(566542),Se=a(844142),Te=a(135856);function Ie(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return Me(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Me(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Me(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}function ke(e,t,a,s,i){for(var n,r=new Map,l=new Map,d=new Map,c=Ie(i);!(n=c()).done;){var u=n.value;r.has(u.peerId)||r.set(u.peerId,new Set),r.get(u.peerId).add(u.messageId);var _=(0,N.getMessage)(e,u.peerId,u.messageId);_&&l.set(u.messageId,_.chat_local_id),d.set(u.messageId,u)}r.forEach(((i,n)=>{var r=[...i],c=(0,N.getTab)(e,n),u=c&&!c.offset,_=c&&c.inplaceSearch&&!!c.searchOffset;e.set(U.removeMessages.bind(null,r,n)).then((()=>e.set(U.removeMessagesMarkDeleted.bind(null,r,n)))).then((()=>{if(e.get().peer===+n&&(0,j.isFullyLoadedTab)(e.get(),n)){var a=(0,N.getTab)(e,n);t.removeMessages(r,+n,e);var s=a.inplaceSearch;if(!a.offset&&!u&&((0,U.setActions)(e.get()),t.updateActions(e),s||t.showEmptyScreen()),s&&_&&!a.searchOffset&&(t.showSearchResults(),o.browser.safari)){var i=(0,h.geByClass1)("_im_peer_history_w");i.style.display="none",setTimeout((()=>i.style.display=""),0)}}})).then((()=>{var i=(0,N.getTab)(e,n);if(i){var o=r.some((e=>e>=i.lastmsg)),c=(0,Z.partConfigEnabled)("me_web_read_by_cmid")?r.filter((e=>{var t=l.get(e);return t&&t>i.in_up_to_cmid&&!(d.get(e).flags&A.FLAG_OUTBOUND)})):r.filter((e=>e>i.in_up_to&&!(d.get(e).flags&A.FLAG_OUTBOUND)));o?(0,U.loadActualLastMessage)(e,+n).then((()=>{a.promoteDialog(e,n),s&&s.updateCounter(e,n),n===(0,ae.getPeer)(e)&&(t.updateGoToEnd(e,!0),t.updateGoToMention(e,!0))})):c&&(0,J.removeDeletedUnreadMsgsFromTab)(n,c,e.get()).then((()=>a.updateDialog(n,e)))}}))}))}function Ae(e,t){"spam"===t?(0,j.showSpamLayer)(e,P.mount,{}):"fav"===t&&(0,j.showFavvedBox)(e,{},G.mount,{})}function Le(e,t,a,s,i){e.forEach((e=>{switch(e.kludges.source_act){case j.CHAT_PHOTO_REMOVE:case j.CHAT_PHOTO_UPDATE:!function(e,t,a,s){t.set(U.updateChatPhoto.bind(null,e)).then((()=>{var i=e.kludges.source_act;a.updateDialog(e.peerId,t),s.updateChatPhoto(e,i,t)}))}(e,t,a,s)}}))}function Pe(e,t){var a=e.get().longpoll.push.bind(null,[(0,Q.resetPeer)()]),s=()=>{var i=e.get().selectedMessages;i&&i.length?(e.setState({selectedMessages:[]}).then((()=>{t.changedMessageSelection(e),t.cleanSelection(i)})),setTimeout((()=>(0,d.cancelStackPush)("im_peer",s)),0)):a()};(0,d.cancelStackPush)("im_peer",s)}function Re(e,t){return De.apply(this,arguments)}function De(){return(De=(0,n.default)(s.mark((function e(t,a){var i,n,r,o,l,d,c,u,_,g;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("event_add_message"===a.type||"event_edit_message"===a.type){e.next=2;break}return e.abrupt("return",!1);case 2:if(e.prev=2,r=t.get(),o=r.id,l=r.tabs,(0,te.tabIsArchived)(l[a.peerId])){e.next=6;break}return e.abrupt("return",!1);case 6:if(d=null!=(i=null==(n=a.kludges)?void 0:n.marked_users)?i:[],c=Object.values(we.MASS_MENTION_ALIASES).flat(),d.some((e=>{var t=e[0],a=e[1];return t===Ce.MARKED_TYPE.MENTIONS&&(Array.isArray(a)&&a.includes(o)||c.includes(a))}))){e.next=11;break}return e.abrupt("return",!1);case 11:if(!(0,te.isMutedConvo)(t.get(),a.peerId)){e.next=13;break}return e.abrupt("return",!0);case 13:return e.next=15,(0,p.getInfo)();case 15:return u=e.sent,_=u.messages_auto_unarchive,g=void 0!==_&&_,e.abrupt("return",!g);case 21:return e.prev=21,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,null,[[2,21]])})))).apply(this,arguments)}function xe(){return(xe=(0,n.default)(s.mark((function e(t){var a,i,n,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=t.get(),i=a.archiveMentionsMap,!Array.isArray(i)){e.next=4;break}return e.abrupt("return",!1);case 4:if(void 0!==(n=cur.imDb.selectByKey("archive-mentions-map"))){e.next=8;break}return cur.imDb.updateByKey("archive-mentions-map",i),e.abrupt("return",!1);case 8:return r=Object.entries(i).some((e=>{var t=e[0],a=e[1];return!n.hasOwnProperty(t)||n[t]<a})),e.abrupt("return",r);case 12:return e.prev=12,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function Oe(e,t){e.set((e=>(0,se.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((a=>(cur.imDb.updateByKey("archives_folder_hidden",null),(0,j.isClassicInterface)(e)||t.updateFolderCounters(e),(0,ue.toggleHideFolderHandler)((0,B.unpackStore)(a),"archive",!1,!0))))}function Be(e,t,a){var s,n,r;void 0===a&&(a=null);var o=(0,B.unpackStore)(e),l=null!=(s=null==o||null==(n=o.tabs)||null==(r=n[t])?void 0:r.mention_cmids)?s:[];if(l.length){var d=a||Math.max(...l);cur.imDb.updateByKey("archive-mentions-map",(0,i.default)({},cur.imDb.selectByKey("archive-mentions-map")||{},{[t]:d})),e.set((e=>(Array.isArray(e.archiveMentionsMap)&&(e.archiveMentionsMap={}),e.archiveMentionsMap[t]=d,Promise.resolve(e))))}}function Ne(e){var t=e.attaches.filter((e=>"sticker"!==e.type&&"call"!==e.type));return(0,F.isServiceMsg)(e)||0===t.length}function Fe(e,t,a){(0,h.addClass)(a,"im-page_history-show"),t.loadingPeer(e)}function Ue(e,t){var a=(0,j.getRightMenuMaxItems)(e,t.offsetHeight);if(e.get().tabbedPeers.length>a){var s=e.get().tabbedPeers.filter((t=>{var a=t.peer;return(0,m.intval)(a)!==e.get().peer})).map((t=>{var a=t.peer;return e.get().tabs[a]})).sort(((e,t)=>t.last_touched-e.last_touched)),i=[];0!==e.get().peer&&i.push(e.get().tabs[e.get().peer]);var n=i.concat(s).slice(a).map((e=>e.peerId)),r=e.get().tabbedPeers.filter((e=>!(0,m.inArray)(e.peer,n)));return e.set(U.updateTabbedPeers.bind(null,r,!0))}return Promise.resolve(e)}function He(){for(var e=(0,g.curBox)();e;)e.hide(),e=(0,g.curBox)()}function je(e,t,a,s,i,n,r,o,l){e.get().audio_msg.isRecording&&e.set(U.cancelRecording).then((()=>{s.cancelRecording()})),AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),(0,N.isAnyMessageBeingEdited)(e)&&s.cancelEditing(),(0,N.isSearching)(e)&&t.cancelSearch&&(i.clearSearch(e),a.restoreDialogs(e),l().toggleSettingsButton(e,!1)),qe(e,o,l),Fe(e,s,n);var c=e.get().peer;(0,U.updateMentions)(e.get()),(0,j.isFullyLoadedTab)(e,t.peerId)&&(t.msgid&&!(0,N.getMessage)(e,t.peerId,t.msgid)||!t.msgid&&!(0,N.getMessage)(e,t.peerId,(0,N.getTab)(e,t.peerId).lastmsg)||(0,N.getTab)(e,t.peerId).skipped)&&e.mutate((e=>(0,N.makeTabNotFullyLoaded)(e,t.peerId)));var u=e.set(U.changePeer.bind(null,t.peerId,t.msgid,t.entryPoint)).then((e=>{var a=e.get();return a.tabs[t.peerId]?Promise.resolve(a):e.set((()=>(0,ue.loadPeer)(a,t.peerId,t.msgid,!0,!1,"applyPeer")))})).then((()=>{if(a.selectPeer(t.msgid,e),function(e,t){(0,j.isPendingForward)(e)&&((0,d.cancelStackFilter)("forward"),e.set(U.forwardMessages.bind(null,e.get().pendingForward,(0,N.getTabDraft)((0,N.getTab)(e,t)),!1)))}(e,e.get().peer),window.tooltips&&tooltips.hideAll(),He(),s.preparePeer(e),Pe(e,s),(0,j.isClassicInterface)(e)?(a.deactivate(),Ue(e,n).then((()=>r.updateMenu(e))),(0,de.updateFolderCounters)(e)):a.updateFolderCounters(e),!(0,j.isClassicInterface)(e)&&(0,te.isRecommendedConvo)(e,t.peerId)&&Se.Ranges.isUserIdTransitional(t.peerId)&&!Se.Ranges.isContactId(t.peerId)){var i=((0,N.getTab)(e,t.peerId)||{}).online||0,o=(0,j.convertLegacyOnlineToAPIFlags)(i),l=o.is_online,c=o.is_mobile;e.set((e=>(0,J.updateRecommendedListItemOnline)(e,t.peerId,l,c))).then((e=>{a.updateRecommendedOnline(t.peerId,e)}))}}));return(u=t.msgid?u.then((()=>e.set(U.selectPeerOnMessage.bind(null,t.peerId===c,c)))):u.then((()=>e.set((e=>(0,U.selectPeer)(!0,e)))))).then((()=>e.set(U.prepareCasperMessagesFromMessages.bind(null,t.peerId)))).then((()=>{if(e.get().peer===t.peerId){if(t.forward){var a=e.get().tabs[e.get().peer];!a.scrollBottom&&a.unread?e.set(U.setActions).then((()=>s.updateActions(e))):!a.unread&&(0,N.isTabMarkedUnread)(a)&&e.set((e=>(0,U.markDialogRead)(t.peerId,e)))}(0,j.isClassicInterface)(e)&&r.updateMenu(e),s.changePeer(e,!1),s.updateTyping(t.peerId,e),s.removeExpiredFailedMessages(t.peerId),s.updateObserver(),(0,U.updateMentions)(e.get())}})).catch(he.dummyCatch)}function qe(e,t,a){t&&e.get().shown&&(t.hide(e),a().createCanceled(e))}function Ge(e,t,a){(0,N.isSearching)(e)&&(t.clearSearch(e),a.restoreDialogs(e))}function Ve(e,t,a,s,i,n,r){e.setState({isCreating:!0}),(0,j.isClassicInterface)(e)&&(i.saveScroll(e),n.saveScroll(e)),s.showCancelControl(),(0,h.addClass)(r,"im-page_creating"),a&&a.show(e,t),(0,j.isClassicInterface)(e)&&((0,h.setStyle)(r,{height:Qe(r,e).page}),setTimeout((function(){(0,h.addClass)(r,"im-page_cropped")}),200)),(0,U.toggleConversation)(!0)}function Ke(e,t,a,s){(0,j.isTabLoaded)(e.get(),s)&&(t.updateTyping(s,e),a.updateTyping(s,e))}function We(e,t,a,s,i){s.activityType||(s.activityType=i);var n=e=>Ke(e,t,a,s.peerId);(0,j.isSelfMessage)(s.peerId,e.get().gid)||(e.set(U.setActivity.bind(null,s,i)).then(n),e.set(U.waitActivity.bind(null,s,i)).then(n))}function Ye(e,t,a){var s=(0,N.getTab)(a,(0,te.getCurrentTab)(a));if(s&&!(0,te.isBusinessNotifyTab)(s)){var i="im-page_reconnecting";t?e.classList.add(i):e.classList.remove(i)}}function $e(e,t,a,s,i){(0,N.isMessageRequestChangedEvent)(t)?function(e,t,a,s){var i=(0,te.getCurrentTab)(e);switch(t.updateType){case A.MAIL_CHAT_UPDATE_TYPE_CONTACT_CONVERTED:i&&i.peerId===t.updateArg&&e.get().longpoll.push([(0,Q.changePeer)(t.peerId,!1,!1,!1,e.get().currentEntryPoint)]),e.set((e=>(0,U.deletedDialog)(t.updateArg,Promise.resolve([]),e))).then((()=>{a().removePeer(e,t.updateArg),a().updateDialogFilters(e)}));break;case A.MAIL_CHAT_UPDATE_TYPE_MESSAGE_REQUEST_CHANGED:var n=(0,N.getTab)(e,t.peerId);(!(0,Z.partConfigEnabled)("simplified_start_conversation")||n&&(0,te.tabIsNotImportantMessageRequest)(n)?e.set((e=>(0,U.updateMessageRequestsCounter)(t,e))):e.set((e=>Promise.resolve(e)))).then((()=>{n&&t.updateArg===A.MESSAGE_REQUEST_STATUS_REJECTED&&(0,J.updateListedConvos)(e.get(),n,!0,(e=>e.filter((e=>e!==Number(t.peerId)))))})).then((()=>{(0,j.isClassicInterface)(e)?(0,de.updateFolderCounters)(e):s.updateFolderCounters(e),(0,j.checkMessageRequestsTab)(e,s.update),A.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(0,j.isClassicInterface)(e)&&a().updateMenu(e),A.MESSAGE_REQUEST_STATUS_REJECTED===t.updateArg&&0===e.get().dialog_tabs[q.FOLDER_MESSAGE_REQUEST].length&&(0,N.isMessageRequestFolder)(e)&&e.get().longpoll.push([(0,Q.changeTab)(q.FOLDER_ALL)]),A.MESSAGE_REQUEST_STATUS_ACCEPTED===t.updateArg&&(null==i?void 0:i.peerId)===t.peerId&&e.set((()=>(0,U.syncMessageReactStatus)(e,t.peerId)))}))}}(e,t,a,i):(0,N.isBusinessNotifyChangedEvent)(t)?function(e,t,a,s){var i=e.set((e=>(0,J.resetFolderList)(e,ce.ConvoListFolder.BUSINESS_NOTIFY)));e.get().active_tab===ce.ConvoListFolder.BUSINESS_NOTIFY&&i.then((()=>e.set(U.loadDialogs))).then((()=>a().restoreDialogs(e,!0,!0)))}(e,0,a):(0,j.isTabLoaded)(e.get(),t.peerId)&&((0,W.handleEventChatUpdated)(e,t.peerId,t.updateType,t.updateArg,s,i)||!Se.Ranges.isChatOrChannelPeer(t.peerId)||e.set((e=>(0,U.loadChatInfo)(t.peerId,e).then((e=>e.peer===t.peerId?(0,U.setActions)(e):Promise.resolve(e))))).then((()=>{a().updateChatInfo(t.peerId)})))}function ze(e,t,a){var s=null;if(a.kludges.keyboard&&!a.kludges.keyboard.inline){var i=Object.assign(a.kludges.keyboard,{author_id:a.userId});s=e.set(U.setKeyboard.bind(null,a.peerId,i))}else{var n=(0,N.getKeyboard)(e,a.peerId);n&&n.one_time&&n.author_id!==(0,F.getAuthorId)(e,a)&&(s=e.set(U.deleteKeyboard.bind(null,a.peerId)))}a.peerId===(0,ae.getPeer)(e)&&s&&s.then(t.fixKeyboard)}function Ze(e,t,a,i,r,_,p,v,f,b,y,w,C,E,M,k,L,P,R,D,x,O,G){var V=!1;return{changePeer(e,a){t.selectPeer(e,a)},cancelSearch(e){Ge(e,i,t)},loadingPeer(e){Fe(e,a,r)},restoreDialogs(e,a,s){t.restoreDialogs(e,a,s)},showChatInvitationBox(e,a){(0,j.showChatInvitationBox)(e,a,f,t)},toggleSettingsButton(e,t){null==y||y.toggleButton(e,t)},focusSearch(e){i.focusInput()},appendSearch(e,a,s,i){t.appendSearch(e,a,s,i)},appendDialogs(e,a){t.appendDialogs(e,a)},showCreation(e,s){Ve(e,s,b,i,t,a,r)},updateState(e,s){t.updateDialog(e,s),s.get().peer===e&&a.updateChat(s,e)},updateConvoInList(e,a){t.promoteDialog(a,e)},appendFastDialogs(e,a){t.appendFastDialogs(e,a,!0)},createCanceled(e){i.hideCancelControl(),(0,j.isClassicInterface)(e)?((0,h.setStyle)(r,{height:"auto"}),(0,h.removeClass)(r,"im-page_cropped"),setTimeout((()=>i.focusInput()),0),0===e.get().peer?t.restoreScroll(e):a.restoreScroll(e,e.get().peer)):setTimeout((()=>{0===e.get().peer?i.focusInput():a.focustTxt(e)}),0),(0,h.removeClass)(r,"im-page_creating"),e.setState({isCreating:!1})},updateMenu(e){k&&k.updateMenu(e)},goToHistoryEnd(){a.goToEnd()},updateDialog(e,a){t.updateDialog(e,a)},updateRecommendationList(e){e.set(oe.updateConvoRecommendationList).then((e=>{(0,ae.isRecommendationListRerenderNeeded)(e)&&t.updateRecommendationList(e)}))},setRecommendationListVisibility:e=>t.setRecommendationListVisibility(e),focusTxt(e){a.focustTxt(e)},resync(e){(0,N.isSearching)(e)&&i.clearSearch(e),t.restoreDialogs(e,!0,!0).then((()=>{(0,j.isClassicInterface)(e)||t.focusOnSelected(e)})),b&&b.hide(e),(0,j.isCommunityInterface)(e)&&e.get().tabbedPeers.forEach((t=>{var a=t.peer;k.updateCounter(e,a)})),(0,j.isClassicInterface)(e)?(e.get().tabbedPeers.forEach((t=>{var a=t.peer;k.updateCounter(e,a),k.updateName(a,e)})),(0,de.updateFolderCounters)(e)):t.updateFolderCounters(e),a.cleanSelection(e.get().selectedMessages||[]),a.cancelSearch(e,!0),Se.Ranges.isZeroOwner(e.get().peer)||a.changePeer(e,!1),(0,ne.updateUnreadCounter)(e)},toggleSettingsLoader(e,t){y.toggleLoader(e,t)},onUserActions(e,t){if(!(0,U.isSearchingInplace)(e.get().peer,e.get())){var s=e.get(),i=s.peer;if((0,j.isFullyLoadedTab)(s,i))if(!_.is_idle)if((0,N.countUnread)(e.get().peer,e.get())>0)!s.tabs[i].skipped&&a.isNewMessagesVisible(e)&&(a.hideGoToEnd(!0),a.hideGoToMention(!0),a.updateObserver(),Promise.resolve().then((()=>e.set(U.setActions))).then((()=>a.updateActions(e))))}},removeSelection(e){t.removeSelection(e),i.focusInput()},openSettings(){i.openSettings()},route(e,s,n,o){if(void 0!==e[0])return!0;e.box&&(e={box:e.box});var l=!1;return!!(e.mr||e.invite_chat_id&&n.invite_hash)||(o&&o.params&&"left_nav"===o.params._ref&&void 0===e.sel&&t.scrollUp(!0,!0),Object.keys(e).sort().forEach((e=>{switch(e){case"sel":n.q||(l=!0);var d=n.sel?(0,j.unUrlPeer)(n.sel):0,c=o.back;if(0===d)w.get().longpoll.push([(0,Q.resetPeer)(!1,c)]);else if(d!==w.get().peer){var u="";o&&o.params&&o.params.entrypoint&&(u=o.params.entrypoint),w.get().longpoll.push([(0,Q.changePeer)(d,n.msgid||!1,!1,!1,u)])}break;case"invite_chat_id":case"invite_hash":!function(e){e.set(U.leaveInvitation).then((()=>{e.get().longpoll.push([(0,Q.resetPeer)(!1,!1)])}))}(w);break;case"tab":qe(w,b,f),l=!0;var _=n.tab||q.FOLDER_ALL;w.get().longpoll.push([(0,Q.changeTab)(_)]);break;case"act":n.act&&"create"===n.act?Ve(w,[],b,i,t,a,r):function(e,t,a,s){a&&a.hide(e,t)}(w,[],b);break;case"st":n.st&&n.sel?((0,g.curBox)()&&(0,g.curBox)().hide(),w.mutate(U.setInplaceSearch.bind(null,unescape(n.st),n.sel)),a.startSearch(w)):(w.mutate(U.cancelSearch.bind(null,s.sel)),a.cancelSearch(w,!0));break;case"q":n.q?((0,g.curBox)()&&(0,g.curBox)().hide(),i.setSearch(w,n.q,!0)):i.clearSearch(w);break;case"box":Ae(w,n.box)}})),n.msgid&&(w.get().msgid=n.msgid,a.focusOnMessage()),(0,j.isClassicInterface)(w)&&void 0===e.sel&&k.updateMenu(w),l&&Ge(w,i,t),!1)},updateDialogFilters(e,a){void 0===a&&(a=!1),(0,N.isSearching)(e)||a||t.restoreDialogs(e),null==y||y.updateFilter(e)},removePeer(e,a){t.removeDialog(e,a),t.saveScroll(e),e.get().peer===a&&e.get().longpoll.push([(0,Q.resetPeer)()]),(0,j.isClassicInterface)(e)&&k.updateMenu(e)},newMessage(e){(0,j.isClassicInterface)(e)||t.scrollUp(!0)},onQueueEvent(e,s){if(s.entity_type===T.EntityType.Online)e.set((e=>(0,U.updateOnline)(s.data.user_id,!!s.data.online&&s.data.platform,s.data.last_seen,e))).then((e=>{(0,j.isTabLoaded)(e.get(),s.data.user_id)&&(t.updateOnline(s.data.user_id,e),a.updateOnline(s.data.user_id,e)),(0,te.isRecommendedConvo)(e,s.data.user_id)&&t.updateRecommendedOnline(s.data.user_id,e)}))},onEvents(e,s){var n=(0,Q.compactCounterEvents)(s),l=s.filter(F.isServiceMsg),d=s.filter((e=>e.type===A.ADD_MESSAGE)),g=(0,U.checkNewPeople)(l,d,e),w=Promise.resolve();if(g.shouldLoad&&(w=e.set(U.loadNewPeople.bind(null,g,p))),w.then((()=>{Le(l,e,t,a),n.forEach((s=>{switch(s.type){case A.ADD_MESSAGE:var n=s.peerId,l=(0,N.getTab)(e,n),d=!l||!l.msgs||0===l.msgs.length,g=(0,j.getMessageStoreStatus)(s,e.get()),p=(0,N.isCommunityBlocked)(e,s.peerId),w=l&&!l.lastmsg,E=l&&(0,te.isChatConvo)(l)&&l.data.closed;switch(ze(e,a,s),(0,F.isCasperMessage)(s)&&$.casperMessagesStore.add(s),g){case j.MSG_NEW:if(e.set(U.addMessage.bind(null,s)).then((e=>{Re(e,s).then((a=>{a&&(Oe(e,t),Be(e,s.peerId,s.chat_local_id))}))})),Ue(e,r),function(e,t){var a=(0,B.unpackStore)(e),s=a.tabs[t.peerId],i=a.active_tab,n=t.flags&A.FLAG_STEALTH;return!(!s||!i||n)&&(!(i!==q.FOLDER_ALL||(0,te.tabIsArchived)(s)||(0,te.isBusinessNotifyTab)(s)||(0,N.tabIsMessageRequestToChat)(s))||(i===q.FOLDER_PEER_TAGS?(0,ee.applyPeerTagsFilterToTab)(a,s):(0,U.filterFromTab)(i)(s)))}(e,s))if((0,N.tabIsMessageRequest)(l)||(s.flags&A.FLAG_OUTBOUND||e.set(U.updateFavAndTitle.bind(null,s.peerId,!0)),function(e,t){var a=t.peerId,s=e.get().tabs[a],i=t.flags&A.FLAG_OUTBOUND,n=(0,m.inArray)(t.peerId,e.get().mutedPeers),r=t.flags&A.FLAG_DELETED,o=e.get().gid,l=(0,F.isUnread)(s,t);if(!i&&!n&&!r&&l){var d,_,g=t.userId,p=function(e,t){return t<2e9&&e&&!e.match(/^\s*(Re(\(\d*\))?\:)?\s*\.\.\.\s*$/)}(t.subject,t.peerId)||"",h=(p?p+" ":"")+t.text||"";if(t.kludges&&t.kludges.source_act&&(h=(0,u.stripHTML)((0,_e.renderServiceMsg)(e,t,s.peerId,!1))),(!e.get().notify_msg&&!Se.Ranges.isChatOrChannelPeer(a)||o&&!e.get().mute)&&window.Notifier&&Notifier.playSound({author_id:a}),!Se.Ranges.isChatOrChannelPeer(a))return;h=(0,m.trim)((0,u.replaceEntities)((0,u.stripHTML)(h.replace(/<br>/g,"\n").replace(/<\*>.*$/,"")))),h=(0,S.replaceMentions)(h,((e,t,a,s,i)=>i)),Se.Ranges.isChatOrChannelPeer(a)?(d=(0,K.oCacheGet)(e,g).name,s.tab&&(d+=" » "+s.tab),_=(0,K.oCacheGet)(e,g).photo):(d=s.tab,_=s.photo);var v=t.attaches[0];if(v&&"mail"===v.type)h+="\n["+c.getLang("mail_added_msgs")+"]";else if(v){var f="doc"===v.type&&"graffiti"===v.kind?"graffiti":v.type;h+="\n["+c.getLang("mail_added_"+f)+"]"}d=(0,m.trim)((0,u.replaceEntities)((0,u.stripHTML)((d||"").replace("&nbsp;"," ")))),window.Notifier&&Notifier.proxyIm({id:t.messageId,text:h,author_id:a,title:d,author_photo:_})}}(e,s)),t.updateTyping(s.peerId,e),(0,N.isSearching)(e))t.updateDialog(s.peerId,e);else{var T=Boolean(null==l?void 0:l.is_recommended_peer);n&&T&&e.set((e=>(0,se.unsetRecommendedPeer)(e,n))).then((()=>(0,U.setActions)(e.get()))),t.promoteDialog(e,s.peerId,T)}var I=(0,N.isCommunityBlocked)(e,s.peerId),M=l&&!l.offset,L=l&&(0,te.isChatConvo)(l)&&!l.data.closed&&E;(p&&!I||w&&!M||L)&&(L&&(0,U.setActions)((0,B.unpackStore)(e)),a.updateActions(e)),(0,j.isClassicInterface)(e)?(k.updateCounter(e,s.peerId),k.updateMenu(e)):null==y||y.updateFilter(e),e.set(U.updateActivity.bind(null,s)).then(Ke.bind(null,e,a,t,s.peerId)),a.addMessage(e,s),Ne(s)||!(0,j.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(U.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s),(0,ie.videoAutoPlayHandler)()})),s.kludges.has_template&&e.set((e=>(0,U.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)})),(0,H.statlogsSendingTimeStart)(e,s,"send","opt_to_lp");break;case j.MSG_LOCAL_DUPLICATE:Ne(s)||e.set(U.loadMedia.bind(null,s)).then((e=>{a.replaceAttachmentPlaceholders(e,s)})),e.set(U.replaceMessage.bind(null,s)),a.replaceMessageAttrs(s,e),t.updateDialog(s.peerId,e),e.get().active_tab===q.FOLDER_ALL&&(0,te.isRecommendedConvo)(e,s.peerId)&&this.updateRecommendationList(e),s.randomId&&(0,H.statlogsSendingTimeEnd)(e,s,"send","opt_to_lp");break;case j.MSG_DUPLICATE:(0,N.isSearching)(e)||t.promoteDialog(e,s.peerId)}(0,N.tabIsMessageRequest)(l)&&(0,j.checkMessageRequestsTab)(e,t.update),(g===j.MSG_LOCAL_DUPLICATE&&1===l.offset||g===j.MSG_NEW&&w&&!s.local)&&e.set((t=>(0,ue.loadPeer)(t,n,0,!1,!1,"emptyPinnedCrutch").then((t=>((0,J.updateListedConvos)(t,(0,N.getTab)(t,n),!1,(e=>(0,U.addDialog)(n,e,t)),((e,a,s)=>(0,U.shouldIncludeDialog)(t,e,a,s))),n===e.get().peer?(0,U.setActions)(t):t))))).then((e=>t.promoteDialog(e,n))),l&&d&&l.peerId===(0,ae.getPeer)(e)&&D();break;case A.EDIT_MESSAGE:case A.REPLACE_MESSAGE:var P=(0,N.getMessage)(e,s.peerId,s.messageId),R=Boolean((null==P?void 0:P.flags)&A.FLAG_HAS_REACTIONS);if(Boolean(s.flags&A.FLAG_HAS_REACTIONS)!==R)return void e.set((e=>(0,le.setMessageFlag)(e,s.peerId,s.messageId,A.FLAG_HAS_REACTIONS,!0)));e.set(U.editMessage.bind(null,s)).then((e=>{if(Re(e,s).then((a=>{a&&(Oe(e,t),Be(e,s.peerId,s.chat_local_id))})),ze(e,a,s),s.kludges.is_expired)return(0,j.removeExpiredMessageIfNeed)(s,a.handleMessageExpiration),void t.updateDialog(s.peerId,e);t.updateDialog(s.peerId,e),a.updateTyping(s.peerId,e),a.editMessage(e,s),Ne(s)||!(0,j.isFullyLoadedTab)(e,s.peerId)||s.local||e.set(U.loadMedia.bind(null,s)).then((e=>a.replaceAttachmentPlaceholders(e,s))),(null==P?void 0:P.kludges.reactions)&&!s.kludges.reactions&&(0,se.setMessageReactions)(e,s.peerId,s.messageId,P.kludges.reactions).then((t=>P.kludges.reaction_id?(0,se.setMyMessageReaction)(e,s.peerId,s.messageId,P.kludges.reaction_id):Promise.resolve(t))).then((e=>a.updateMessageReactions(e,s.peerId,s.messageId))),s.kludges.has_template&&e.set((e=>(0,U.addCarouselTemplateToStore)(s,e))).then((e=>{a.replaceBotCarouselPlaceholder(e,s)}))}));break;case A.REACTION_CREATE_OR_EDIT_EVENT:var x;if(!(0,Z.partConfigEnabled)("messages_reactions"))break;var O=s.subtype,G=s.peerId,W=s.cmid,Y=s.reactionCounters,z=s.reactionId,ne=1===O||3===O,he=(0,ae.getPeer)(e),ve=Number(null==(x=(0,me.getMessageByCmid)(e,G,W))?void 0:x.messageId);if(!ve)break;e.set((e=>(0,se.setMessageReactions)(e,G,ve,Y).then((e=>ne?(0,se.setMyMessageReaction)(e,G,ve,z):Promise.resolve(e))))).then((e=>{var t=(0,me.getMessageReactedPeerIds)(e,G,W).filter((t=>!(0,K.oCacheExists)(e,t)));return 0===t.length?Promise.resolve(e):(0,U.loadChatMember)({[G]:t},e)})).then((e=>{if(he===G&&a.updateMessageReactions(e,G,ve),(0,j.isFullyLoadedTab)(e,G))return(0,U.addMessageReactionsToHistory)(G,ve,e)}));break;case A.INVALIDATE_MESSAGE:(0,U.reloadMessage)(s.messageId,e.get()).then((t=>{var a=(0,X.getMessageFromTuple)(t);return e.set((e=>(0,U.editMessage)(a,e))).then((()=>a))})).then((s=>{a.editMessage(e,s),t.updateDialog(s.peerId,e),!Ne(s)&&(0,j.isFullyLoadedTab)(e,s.peerId)&&e.set((e=>(0,U.loadMedia)(s,e))).then((e=>a.replaceAttachmentPlaceholders(e,s)))}));break;case A.UNREAD_REACTIONS:(0,Z.partConfigEnabled)("messages_reactions")&&e.set((e=>(0,oe.setUnreadReactions)(e,s.peerId,s.cmids))).then((e=>{t.updateCounter(e,s.peerId),s.peerId===(0,ae.getPeer)(e)&&a.updateGoToReactionsButton(e,document),(0,j.isClassicInterface)(e)&&k.updateCounter(e,s.peerId)}));break;case A.READ_INBOUND:case A.READ_INBOUND_BY_CMID:e.set((e=>(0,U.markInboundMessagesAsRead)(s,e))).then((e=>{t.updateCounter(e,s.peerId),s.peerId===(0,ae.getPeer)(e)&&(a.updateGoToEnd(e,!0),a.updateGoToMention(e,!0),a.updateObserver()),(0,j.isClassicInterface)(e)&&k.updateCounter(e,s.peerId),(0,N.isSearching)(e)||t.restoreDialogs(e),null==y||y.updateFilter(e)}));break;case A.READ_OUTBOUND:case A.READ_OUTBOUND_BY_CMID:e.set(U.markOutboundMessagesAsRead.bind(null,s)).then((e=>{t.updateCounter(e,s.peerId),a.markMessagesAsRead(e,s)}));break;case A.UNREAD_COUNT:e.set((e=>(0,se.setUnreadCounters)(s,e))).then((()=>{null==y||y.updateFilter(e);var a=s.showOnlyNotMuted;a!==(0,ae.getLocalSettingsValue)(e,"show_only_not_muted_messages")&&e.set((e=>(0,se.setLocalSettingsValue)("show_only_not_muted_messages",a,e)));var i=Promise.resolve();s.businessNotifyUnread>0&&1===e.get().settings.business_notify_folder_hidden&&(i=e.set((e=>(0,se.setLocalSettingsValue)("business_notify_folder_hidden",0,e))),(0,ue.toggleHideFolderHandler)((0,B.unpackStore)(e),ce.ConvoListFolder.BUSINESS_NOTIFY,!1)),i.then((a=>{(0,j.isClassicInterface)(e)?((0,de.updateFolderCounters)(e),e.get().tabbedPeers.forEach((t=>{var a=t.peer;k.updateCounter(e,a)}))):t.updateFolderCounters(e)}))}));break;case A.SET_FLAGS:case A.REPLACE_FLAGS:case A.RESET_FLAGS:switch(!0){case Boolean(s.flags&A.FLAG_DELETED):case Boolean(s.flags&A.FLAG_SPAM):s.type!==A.SET_FLAGS||(0,j.isAlreadyDeleted)(e,s.peerId,s.messageId)||e.get().blockedFlagUpdates[s.peerId]||v(s);break;case s.flags===A.FLAG_IMPORTANT:var fe=s.type===A.SET_FLAGS;e.set((e=>(0,U.updateImportant)(fe?1:-1,s.messageId,e))),e.set((e=>(0,U.updateFavMessage)([s.messageId],s.peerId,fe,e))).then((()=>{a.markImportant(s.messageId,fe,e)}));break;case Boolean(s.flags&A.FLAG_AUDIO_MESSAGE_LISTENED):e.set((e=>(0,le.setMessageFlag)(e,s.peerId,s.messageId,A.FLAG_AUDIO_MESSAGE_LISTENED,!0))).then((e=>{var t=s.peerId,i=s.messageId,n=(0,N.getTab)(e,t);if((0,ae.getPeer)(e)===t&&a.markMessageAsListened(e,t,i),n&&(0,j.isFullyLoadedTab)(e,t)){var r=(0,pe.unpackHistory)(n.history);n.history=(0,j.updateListenedMark)(r,i)}}))}break;case A.RECORDING_AUDIO:We(e,a,t,s,U.ACTIVITY_TYPE_RECORDING_AUDIO);break;case A.TYPING:We(e,a,t,s,U.ACTIVITY_TYPE_TYPING);break;case A.NOTIFY_SETTINGS_CHANGED:!function(e,t,a,s){e.set(U.setMutedPeer.bind(null,a,s)).then(t().updateState.bind(null,a))}(e,f,s.peerId,!s.sound);break;case A.CONVO_MAJOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.majorId,i=(0,N.getTab)(e,t);return(a&&i?Promise.resolve(e):(0,ue.loadPeer)(e,t,0,!1,!1,"sortingChange")).then((e=>{var s=(0,N.getTab)(e,t);return s.major_sort_id=a,(0,J.updateListedConvos)(e,s,!1,(a=>(0,U.addDialog)(t,a,e)),((t,a,s)=>(0,U.shouldIncludeDialog)(e,t,a,s))),(0,U.setActions)(e),Promise.resolve(e)}))})).then((e=>{var i=s.peerId;(0,N.getTab)(e,i)&&!(0,N.isSearching)(e)&&t.promoteDialog(e,i),i===e.get().peer&&a.updateActions(e)}));break;case A.CONVO_MINOR_ID_CHANGED:e.set((e=>{var t=s.peerId,a=s.minorId,i=(0,N.getTab)(e,t);return i?(i.minor_sort_id=a,Promise.resolve(e)):Promise.resolve(e)})).then((e=>{var a=s.peerId;(0,N.getTab)(e,a)&&!(0,N.isSearching)(e)&&t.promoteDialog(e,a)}));break;case A.RESYNC:e.get().longpoll.pause(),e.set(U.resync).then(f().resync).then((()=>e.get().longpoll.resume()));break;case A.TRANSITION:C.transition(s.state);break;case A.RESET_PEER:if(s.removeActivePeer){var be=e.get().tabbedPeers.filter((t=>{var a=t.peer,s=t.type;return a!==e.get().peer&&"perm"===s}));e.setState({tabbedPeers:be})}!function(e,t,a,s){e.set(U.cancelRecording).then((()=>{a.cancelRecording()})),AudioMessagePlayer.loaded&&AudioMessagePlayer.detachPlayer(),t.removeSelection(e),(0,h.removeClass)(s,"im-page_history-show"),a.flushDraft(e),a.stopLoading(),a.destroyPeerProfile(),(0,N.isAnyMessageBeingEdited)(e)&&a.cancelEditing();var i=e.get().peer;e.set(U.changePeer.bind(null,0,!1,"")).then((()=>{window.tooltips&&window.tooltips.hideAll(),He(),(0,j.isClassicInterface)(e)&&t.activate(),a.changePeer(e),(0,j.isClassicInterface)(e)&&t.restoreScroll(e),setTimeout((()=>{e.get().longpoll.push([(0,Q.transitionEvent)("search")])}),13),(0,j.isLocksAvailable)(e)&&(0,j.isPeerBlockedByMe)(i,e)&&e.set(U.releaseBlock.bind(null,i))}))}(e,t,a,r),s.cancelSearch&&Ge(e,i,t),(0,j.isClassicInterface)(e)&&k.updateMenu(e),(0,j.isClassicInterface)(e)&&e.get().active_tab===q.FOLDER_ALL&&this.updateRecommendationList(e),i.focusInput(),(0,j.isCommunityInterface)(e)&&(i.initPeerTagsFilter(e),t.renderPeerTags(e));break;case A.CHANGE_TAB:(0,N.isSearching)(e)&&i.clearSearch(e);var ye=e.get().active_tab;(0,j.changeTab)(s.tab,e,f,U.changeDialogsTab).then((e=>{null==y||y.updateFilter(e),s.tab===q.FOLDER_PEER_TAGS&&ye!==s.tab&&i.initPeerTagsFilter(e),s.tab===q.FOLDER_ALL&&this.updateRecommendationList(e)}));break;case A.RESET_DIRECTORIES:case A.SET_DIRECTORIES:case A.REPLACE_DIRECTORIES:var we=s.type,Ce=s.peerId,Ee=s.mask;if(Ee===A.FOLDER_HAS_BANNER)break;var Te=Ee===A.FOLDER_AD_TAG;e.set((e=>(0,U.updateFolderState)(Ce,Ee,we,s.local,Te,e))).then((e=>{(0,N.isSearching)(e)||we===A.RESET_DIRECTORIES&&Ee===q.FOLDER_MASKS[q.FOLDER_IMPORTANT]||we===A.RESET_DIRECTORIES&&Ee===q.FOLDER_MASKS[q.FOLDER_MESSAGE_REQUEST]||we===A.SET_DIRECTORIES&&Ee===q.FOLDER_MASKS[q.FOLDER_MESSAGE_REQUEST_REJECTED]||we===A.REPLACE_DIRECTORIES||t.restoreDialogs(e),t.updateDialog(Ce,e),(0,j.isClassicInterface)(e)&&k.updateCounter(e,Ce),e.get().peer===Ce&&a.changedMessageSelection(e)}));break;case A.DELETE_DIALOG:s.leaveChat||void 0===s.leaveChat?e.set(U.deletedDialog.bind(null,s.peerId,Promise.resolve([]))).then((()=>{f().removePeer(e,s.peerId),f().updateDialogFilters(e),(0,U.removeFromRecentSearch)(s.peerId,cur.imDb),e.set(U.preloadSearchIndex.bind(null,cur.imDb))})):e.set(U.flushDialog.bind(null,s.peerId,Promise.resolve([]))).then((()=>{(0,U.loadActualLastMessage)(e,s.peerId).then((()=>f().updateState(s.peerId,e)))}));break;case A.CHANGE_PEER:je(e,s,t,a,i,r,k,b,f);break;case A.MUTEX:var Ie={[s.peerId]:s},Me=(0,j.isPeerBlocked)(s.peerId,e);e.set(U.updateBlockStates.bind(null,Ie)).then((()=>{t.updateDialog(s.peerId,e);var i=(0,j.isPeerBlocked)(s.peerId,e);(0,j.isFullyLoadedTab)(e.get(),s.peerId)&&Me!==i&&a.updateChat(e,s.peerId)}));break;case A.FAILED_MESSAGE:e.set(U.setMessageErrored.bind(null,s.peerId,s.message)).then((()=>{a.setMessageErrored(s.peerId,s.message,s.error,e),t.setDialogFailed(s.peerId,s.message.messageId,e)}));break;case A.RESEND:var ke=s.message.messageId;e.set(U.resendMessage.bind(null,s.peerId,ke,s.message)).then((()=>{a.resendMessage(s.peerId,ke),t.promoteDialog(e,s.peerId)}));break;case A.PEER_TAGS_CHANGED_EVENT:(0,ee.onPeerTagsChangeEvent)(e,t,s);break;case A.PEER_PROFILE_TAGS_CHANGED_EVENT:(0,ee.onPeerProfileTagsChangedEvent)(e,t);break;case A.CONVERSATION_UPDATED:$e(e,s,f,a,t);break;case A.WAITING_FOR_RECONNECT:setTimeout((()=>{Ye(r,!0,e),a.setNetworkWaitingStatus(s.timeout-1,e)}),1e3);break;case A.RECONNECTING:Ye(r,!0,e),a.setNetworkReconnectingStatus(e);break;case A.RECONNECTED:Ye(r,!1,e),setTimeout(a.clearNetworkStatus,0),o.browser.chrome&&!(0,j.isClassicInterface)(e)&&e.get().peer&&(_.is_idle?V||(_.once("unidle",(()=>{V=!1,t.forceScrollReinit()})),V=!0):t.forceScrollReinit());break;case A.KEYBOARD_CALLBACK_RECEIVED:var Ae=(0,ae.getPressedButtonState)(s.event_id,e);Ae&&(e.set((e=>(0,se.unsetPressedCallbackButton)({peerId:s.peer_id,eventId:s.event_id},e))),Ae.onCallback(),(0,re.handleCallbackAction)(s,e));break;case Q.CHANGE_VOICE_UI:var Le=(0,ae.getPeer)(e);if(!Le)return;var Pe=(0,N.getTab)(e,Le),De=null==Pe?void 0:Pe.msgs;if(!Pe||!De)return;for(var xe=Object.values(De),Fe=function(t){var s=(0,ge.parseMessage)(xe[t]);if((0,j.isAlreadyDeleted)(e,Pe.peerId,s.messageId)||!(0,F.isAudioMsg)(s)&&!(0,me.hasForwards)(s))return"continue";a.editMessage(e,s),e.set((e=>(0,U.loadMedia)(s,e))).then((e=>a.replaceAttachmentPlaceholders(e,s)))},qe=xe.length-1;qe>=0;qe--)Fe(qe)}}))})),(0,Z.partConfigEnabled)("marusya_web_support_proccess_commands")){var E=s.filter(fe.isEventForMarusia);E.length&&(0,be.loadMarusiaSdk)().then((e=>{e&&e.onAddMessage(E.map(ye.convertMessageToMarusia))}))}},updateHistory:e=>a.updateHistory(e),updateChatInfo(e){a.updateChatTopic(e,w),(0,j.isClassicInterface)(w)&&k.updateName(e,w),w.get().peer===e&&a.updateActions(w)},cancelRecording:()=>w.set(U.cancelRecording).then((()=>a.cancelRecording())),fixHeight(){D()},toggleFolder(e,a){t.toggleFolder(e,(()=>this),a)},updateFolderCounters(e){t.updateFolderCounters(e)},hideFolderButton(e,a){var i=(0,B.unpackStore)(e);e.set(function(){var t=(0,n.default)(s.mark((function t(i){var n,r;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=a,t.next=t.t0===ce.ConvoListFolder.BUSINESS_NOTIFY?3:t.t0===ce.ConvoListFolder.ARCHIVE?4:8;break;case 3:return t.abrupt("return",(0,se.setLocalSettingsValue)("business_notify_folder_hidden",1,i));case 4:return n=e.get(),r=n.archiveMentionsMap,cur.imDb.updateByKey("archive-mentions-map",Array.isArray(r)?{}:r),cur.imDb.updateByKey("archives_folder_hidden",1),t.abrupt("return",(0,se.setLocalSettingsValue)("archives_folder_hidden",1,i));case 8:return t.abrupt("return",Promise.resolve(i));case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).then((e=>((0,j.isClassicInterface)(e)||t.updateFolderCounters(e),(0,ue.toggleHideFolderHandler)(i,a,!0))))},makeArchiveVisible(e){Oe(e,t)},actualizeArchiveVisibilityOnUnidle(e){!function(e,t){var a=e.get().settings.archives_folder_hidden,s=cur.imDb.selectByKey("archives_folder_hidden");s&&!a?e.set((e=>(0,se.setLocalSettingsValue)("archives_folder_hidden",1,e))).then((()=>{(0,j.isClassicInterface)(e)||t.updateFolderCounters(e)})):null===s&&a&&e.set((e=>(0,se.setLocalSettingsValue)("archives_folder_hidden",null,e))).then((()=>{(0,j.isClassicInterface)(e)||t.updateFolderCounters(e)}))}(e,t)},addEntityToArchiveMentionsMap(e,t){Be(e,t)},applySearchAction(e,t,a){i.applySearchAction(e,t,a)},deselectAllMessages(e){a.deselectAll(e)},unmount(){(0,I.destroyModule)(e),clearInterval(w.get().update_title_to),_.stop(),x(),O(),$.casperMessagesStore.destroy(),t.unmount();var s=window.devicePixelRatio>=2?"_2x":"";(0,l.setFavIcon)("/images/icons/favicons/fav_logo"+s+".ico"),a.unmount(),i.unmount(),(0,d.cancelStackFilter)("im_peer"),null==y||y.unmount(),b&&b.unmount(),k&&k.unmount(),L&&L(),E&&E(),(0,j.isLocksAvailable)(w)&&w.get().peer&&w.set(U.releaseBlock.bind(null,w.get().peer)),P.unmount(),G.unmount(),k&&k.unmount(),R.unmount(),clearInterval(M),cur.imDb.unmount(),cur.imDb=!1,(0,Z.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,be.loadMarusiaSdk)().then((e=>{e&&e.dispose()})),Ee.MediaScopeStats.stop()}}}function Xe(e,t,a,s){var i=t.get();Se.Ranges.isZeroOwner(i.peer)||e().onUserActions(t,s),i.update_old_title&&t.set(U.updateFavAndTitle.bind(null,!1,!1))}function Qe(e,t){var a=(0,h.ge)("page_header"),s=(0,h.geByClass1)("_im_page_history",e),i=(0,h.clientHeight)()-a.offsetHeight-30-2,n=(0,j.isClassicInterface)(t)?250:400,r={page:Math.max(i,n)};if((0,j.isClassicInterface)(t)){var o=(0,j.getClassicChatHeight)();o=o>0?Math.min(o-a.offsetHeight-30-2,i):i;var l=(0,h.hasClass)(s,"im-page--history_empty-hist")?o:i;r.history=Math.max(o,n),r.chat=Math.max(l,n)}return r}function Je(e,t,a,s,i,n,r){if(void 0===n&&(n=!0),void 0===r&&(r=!1),!(0,B.isFullScreen)()){var l=Qe(e,t);if((0,h.setStyle)(e,{minHeight:l.page}),(0,j.isClassicInterface)(t)&&(void 0===t.get().chatResizeInitialized&&t.set(U.initializeChatResize),(0,h.setStyle)(e,{height:t.get().isCreating?l.page:"auto"}),(0,h.setStyle)((0,h.geByClass1)("_im_page_dialogs",e),{minHeight:l.page}),(0,h.setStyle)((0,h.geByClass1)("_im_page_history",e),{minHeight:l.history,position:"relative",top:0}),(0,h.setStyle)((0,h.geByClass1)("_im_chat_body_abs",e),{minHeight:l.chat,height:l.chat,position:"relative",top:0})),o.browser.safari&&r&&"function"==typeof r&&r(),s&&s.updateScroll(),i&&i.updateScroll&&i.updateScroll(),a){var d=a.updateScroll();a.scrollFix(t,t.get().peer,d)}n&&setTimeout((()=>Je(e,t,a,s,i,!1)),100)}}function et(e,t){e.get().resendAllOnOnline&&t()}function tt(){var e=document.querySelector(".im_page");!function(e){var t="safari-repaint";e.forEach((function(e){(0,h.hasClass)(e,t)&&(0,h.removeClass)(e,t),(0,h.addClass)(e,t)})),setTimeout((function(){e.forEach((function(e){(0,h.removeClass)(e,t)}))}),100)}([(0,h.geByClass1)("_im_dialog_actions",e),(0,h.geByClass1)("_im_chat_input_w",e),(0,h.ge)("side_bar"),(0,h.geByClass1)("_im_right_menu",e),(0,h.geByClass1)("_im_dialogs_footer",e),(0,h.geByClass1)("_im_dialogs_search",e)])}function at(e,t){try{var a;(0,Z.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog={});var s,i=t.get(),n=window.devicePixelRatio>=2?"_2x":"",d=[];(0,l.setFavIcon)("/images/icons/favicons/fav_im"+n+".ico"),Je(e,t,!1,!1,!1,!0);var c=(0,I.createMutations)(Ze),u=c.callMutations,g=c.bindMutations,m=i.useFcLongpoll&&vk.lpConfig.enabled&&Notifier.getLpInstance&&Notifier.getLpInstance(),p=m?Notifier.getLpInstance():t.get().gid?(0,k.startLongPollForGroup)(i.lpConfig):(0,k.startLongPoll)(i);p.onData(Re),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 1, callback set");var S=Notifier.getEventQueueInstance&&Notifier.getEventQueueInstance(),T=S?S.subscribe((e=>u().onQueueEvent(t,e))):()=>{};function Re(){for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];if((0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug"))try{u().onEvents(t,a)}catch(e){var i=new Error("vkm_yakimchuk_38442_debug error");throw(0,O.logError)(i,{breadcrumb:{message:"Log",data:{id:vk.id,mountLog:d}},environment:"debugLog",error:i.message,stack:i.stack}),i}else u().onEvents(t,a)}function De(){m?p.offData(Re):p.stop()}var P=(0,h.geByClass1)("_im_dialogs_search",e),F=(0,h.geByClass1)("_im_dialogs_footer",e),H=(0,r.mount)((0,h.geByClass1)("_im_page_dcontent",e),t,u,P);H.renderPeerTags(t),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 2, dialog mutations rendered");var q,G,W=(0,f.mount)(P,t,u),X=F?(0,b.mount)(F,t,u):null,Q=(0,D.mount)(t),J=(0,w.mount)(t,document.body);if((0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 3, parts mounted"),cur.imDb=(0,x.mount)(t.get().gid?-t.get().gid:vk.id),cur.imDb.updateByKey("archives_folder_hidden",t.get().settings.archives_folder_hidden),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 4, db updated"),t.set(U.preloadSearchIndex.bind(null,cur.imDb)),function(e){return xe.apply(this,arguments)}(t).then((e=>{e&&u().makeArchiveVisible(t)})),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 5, parts mounted"),(0,j.isClassicInterface)(t)){var ee=(0,h.geByClass1)("_im_ui_peers_list",e.parentNode);q=(0,R.mount)(ee,t,u),G=function(e,t,a,s){if(o.browser.mobile)return!1;var i=[t,a,(0,h.geByClass1)("_im_chat_input_w",s),(0,h.geByClass1)("_im_dialog_actions",s)],n=null,r=(0,h.hasClass)(e,"im-page--header_static"),l=(0,h.ge)("im-group-online-disabled-notice");function d(){var t=(0,E.getNativeOption)("scrollLeft"),a=(0,h.hasClass)(e,"im-page--header_static"),s=[];n!==t?s=i.slice().concat([e]):a!==r&&(s=[e]),n=t,r=a,s.length>0&&s.forEach((s=>{var i=e===s&&a?0:-t;(0,h.setStyle)(s,{[cssTransformProp]:0===i?"unset":"translateX("+i+"px)"})}))}return l&&i.push(l),i=i.concat((0,h.geByClass)("_im_aside_notice"),(0,h.geByClass)("_im_aside_promo_block")),(0,_.addEvent)(window,"scroll",d),d(),()=>{(0,_.removeEvent)(window,"scroll",d)}}(P,F,(0,h.geByClass1)("_im_right_menu",e.parentNode),e)}(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 6"),(0,j.isClassicInterface)(t)&&i.peer&&H.deactivate(),i.gid||(s=(0,y.mount)((0,h.geByClass1)("_im_dialogs_creation",e),t,u));var se=(0,v.mount)((0,h.geByClass1)("_im_page_history",e),t,H,q,u);(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 7, history mounted");var ie=i.isCreating,ne=ie?"create":0===i.peer?"search":"default";ie&&s.show(t,[]);var re=(0,M.create)(t,ne,H,se,W,s),le=(0,V.mount)(t,re);se.renderPeerProfile(t),se.updateScroll(),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 8, history updated");var de=Xe.bind(null,u,t,re);if(i.peer&&(t.set(U.prepareCasperMessagesFromMessages.bind(null,i.peer)),(0,Z.partConfigEnabled)("messages_reactions"))){var ce=(0,te.getConvoReactedPeerIds)(i,i.peer).filter((e=>!(0,K.oCacheExists)(i,e)));ce&&(0,U.loadChatMember)({[i.peer]:ce},i)}Se.Ranges.isZeroOwner(i.peer)||setTimeout((()=>Pe(t,se)),10);var _e=new Y.IdleManager({id:"im",element:document,focusElement:window,triggerEvents:"mouseover mousedown keypress"});(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 7, idle manager run");var ge=(0,z.debounce)(tt,300),me=Je.bind(null,e,t,se,H,s,!1,ge),pe=et.bind(null,t,se.resendAll);t.setState({longpoll:p}),t.set(U.setExecStack.bind(null,[])),_e.on("unidle",(function(){var e;null==(e=u())||e.actualizeArchiveVisibilityOnUnidle(t),p.abortWaiting(),de()})),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 8, some stuff done"),Ee.MediaScopeStats.start("vk"),_e.start(),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 9, im started"),nav.objLoc.box&&(Ae(t,nav.objLoc.box),(0,C.updateLocation)({box:null})),nav.objLoc.mr&&Se.Ranges.isChatOrChannelPeer(Number(nav.objLoc.mr))&&(0,j.showChatInvitationBox)(t,nav.objLoc.mr,u,H),(null==(a=window.nav.objLoc)?void 0:a.openSettings)&&(W.openSettings(),(0,C.updateLocation)({openSettings:null}));var he,fe=function(e){var t=e.get();return(0,j.isLocksAvailable)(e)?(0,L.createWorker)(t.mutex_key,(function(e){t.longpoll.push([A.mutexEvent(e)])}),(function(e,a){return(0,U.getMutexQueue)(t.gid).then((e=>e[0]))})).stop:null}(t);if((0,j.isLocksAvailable)(t)&&(he=setInterval(j.blockLatencyCompensation.bind(null,t,i.longpoll),2e3)),t.get().invitation&&(0,j.showInvitationBox)(t,t.get().invitation,U.leaveInvitation),(0,j.isClassicInterface)(t)&&(0,N.existsIncomingMessageRequest)(t)){var be=document.getElementById("ui_rmenu_mr");be&&be.classList.remove("unshown")}var ye=(0,B.throttleAccumulate)(ke.bind(null,t,se,H,q),200),we=j.hideTopNotice.bind(null,t),Ce=j.hideAsideNotice.bind(null,t);$.casperMessagesStore.subscribe((e=>function(e,t,a,s,i){var n=i.type,r=i.message;switch(n){case $.EXPIRING:return t.updateCasperMessageStatus(r);case $.EXPIRING_SOON:return t.updateCasperMessageStatus(r,!0);case $.EXPIRED:(0,N.isCasperChat)(e,r.peerId)?s(r):(t.handleMessageExpiration(r),a.updateDialog(r.peerId,e))}}(t,se,H,ye,e))),$.casperMessagesStore.setTimeshift(i.timeshift);var Ie=e=>{var a=e.target.closest("._im_new_ui_banner");a&&(a.hidden=!0,(0,ue.toggleHideFolderNoticeHandler)(t.get(),"new_ui_banner",1))};(0,Te.onDomReady)((()=>{t.set(oe.updateConvoRecommendationList).then((e=>{(0,ae.isRecommendationListRerenderNeeded)(e)&&H.updateRecommendationList(e)}))})),(0,ve.initWidgets)(e),(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 9, widgets init done");var Me=(0,I.createModule)({handlers:(a,s)=>{a(document,"mousemove mousedown keypress",de),a(window,"resize",me),a(window,"online",pe),s(e,"click",j.HIDE_TOP_NOTICE_CLASS,we),s((0,h.gpeByClass)("_im-page-wrap",e),"click",j.HIDE_ASIDE_NOTICE_CLASS,Ce),s((0,h.gpeByClass)("_im-page-wrap",e),"click",j.HIDE_ASIDE_PROMO_BLOCK_CLASS,j.hideAsidePromoBlock),s((0,h.gpeByClass)("_im-page-wrap",e),"click",j.INSTALL_VKADMIN_LINK,j.installVKAdminApp),(0,j.isClassicInterface)(t)&&!(0,j.isCommunityInterface)(t)&&s((0,h.gpeByClass)("_im-page-wrap",e),"click","_im_new_ui_banner_close",Ie),o.browser.safari&&a(document,"visibilitychange",tt)}});return(0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")&&d.push("mount 10, before bindMutations"),g(Me,H,se,W,e,_e,p,ye,u,s,X,t,re,fe,he,q,G,Q,le,me,De,T,J)}catch(Oe){if((0,Z.partConfigEnabled)("vkm_yakimchuk_38442_debug")){var Le=new Error("vkm_yakimchuk_38442_debug error exception");(0,O.logError)(Le,{breadcrumb:{message:Oe.message,data:{id:vk.id,message:Oe.message,stack:Oe.stack}},environment:"debugLog",error:Le.message,stack:Le.stack})}}}},734994:(e,t,a)=>{"use strict";a.d(t,{mount:()=>J});var s,i,n,r,o,l,d,c,u,_,g,m,p,h,v,f=a(610124),b=a(840060),y=a(810890),w=a(70162),C=a(897449),E=a(828430),S=a(152278),T=a(873589),I=a(342269),M=a(384032),k=a(652817),A=a(661711),L=a(146143),P=a(735179),R=b.browser.msie&&(0,I.intval)(b.browser.version)<10?window.XDomainRequest:window.XMLHttpRequest;function D(e){var t=e%60;return parseInt(e/60)+":"+(t<10?"0":"")+t}var x=!1,O=!1,B=100;function N(e){var t=e.get().peer;(0,A.isFullyLoadedTab)(e,t)&&!(0,A.isAnyMessageBeingEdited)(e)&&Date.now()-((0,A.getTab)(e,t).lastTyping||0)>1e3*M.ACTIVITY_PERIOD&&e.set(M.sendRecordingAudio.bind(null,t))}function F(e){if(!O){O=!0,(0,A.lockButton)(l);var t={peer:u.get().peer,from_place:cur.docsChooseFrom,imhash:cur.docsChooseImHash,blockPersonal:cur.docsChooseBlockPersonal,mail_add:cur.docsChooseMailAdd};(function(e){return new Promise(((t,a)=>{var s=e.getFormData(),i=new R;i.onload=i.onerror=function(e){var s=e.currentTarget.response;200==this.status&&s.length>0&&"{"==s[0]?(s=JSON.parse(s),t(s)):a()},i.open("POST",v.upload_url,!0),i.send(s)}))})(e).then((e=>e.file?new Promise(((a,s)=>{ajax.post("/docs.php",(0,I.extend)({act:"a_save_doc",from:"choose",from_place:t.from_place,imhash:t.imhash,blockPersonal:t.blockPersonal,mail_add:t.mail_add},e),{onDone:(e,s)=>{G(),m([["doc",e+"_"+s,"audiomsg"]],{},t.peer),z(),a()},onFail:function(e){s(e)},progress:null})})):Promise.reject())).then((()=>{(0,A.unlockButton)(l),O=!1})).catch((()=>{O=!1,(0,A.unlockButton)(l),(0,L.showFastBox)(w.getLang("global_error"),w.getLang("mail_audio_message_upload_error"))}))}}function U(){h(),i.innerHTML=D(x.duration),x.duration>=600&&$()}function H(e){e.set(M.cancelRecording).then(W)}function j(){h(),Promise.all([(0,P.voiceMessagePlayerLoader)(),(0,P.speechLoader)()]).then((()=>{x||(x=Speech.newRecorder(),(0,S.addEvent)(x,"progress",U)),AudioMessagePlayer.detachPlayer(),AudioMessagePlayer.pauseGlobalMedia(),x.record().then((()=>{var e;e=u,v.isRecording=!0,(0,y.cancelStackPush)("audio_message_cancel",H.bind(null,e)),(0,C.hideProgress)((0,T.geByClass1)("im-audio-message-send-wrapper",s)),i.innerHTML="0:00",(0,T.addClass)(s,"im-audio-message_recording"),(0,T.removeClass)(s,"im-audio-message_recorded"),function(){s&&s.classList&&s.classList.remove("im-audio-message-input--hidden");(0,T.geByClass1)("_im_chat_input_parent",c).classList.add("im-chat-input--hidden")}(),(g=window.Speech.createVisualization("wave",x.source,n,{color:getComputedStyle(document.body).getPropertyValue("--white")})).start();var t=n.getBoundingClientRect();B=(t.right-t.left)/3})).catch((e=>{var t;switch(AudioMessagePlayer.resumeGlobalMedia(),e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t=w.getLang("mail_audio_message_device_error");break;case"PermissionDeniedError":case"PermissionDismissedError":t=w.getLang("mail_audio_message_permission_error");break;case"Unsupported":t=w.getLang("mail_audio_message_unsupported_error");break;default:t=w.getLang("global_unknown_error")}(0,L.showFastBox)(w.getLang("global_error"),t),console.error(e)}))}))}function q(){x&&x.stop(),g&&(g.destroy(),g=null)}function G(){v.isRecording=!1,(0,y.cancelStackFilter)("audio_message_cancel")}function V(){K(),F(x)}function K(){var e;AudioMessagePlayer.loaded&&AudioMessagePlayer.resumeGlobalMedia(),(0,S.removeEvent)(x,"finish",K),(0,S.removeEvent)(x,"finish",V),e=URL.createObjectURL(x.buffer),(0,T.domData)(_,"duration",x.duration),(0,T.domData)(_,"ogg",e),(0,T.domData)(_,"mp3",e),(0,T.geByClass1)("audio-msg-track--duration",_).innerHTML=D(x.duration),(0,T.geByClass1)("audio-msg-track--wave-wrapper",_).innerHTML=AudioMessagePlayer.getWave(x.wave,B),(0,T.removeClass)(s,"im-audio-message_recording"),(0,T.addClass)(s,"im-audio-message_recorded")}function W(e){void 0===e&&(e=!0),G(),AudioMessagePlayer.loaded&&(AudioMessagePlayer.resumeGlobalMedia(),AudioMessagePlayer.detachPlayer()),(0,S.removeEvent)(x,"finish",K),(0,S.removeEvent)(x,"finish",V),q(),z(),e&&p()}function Y(){x.isRecording?((0,S.addEvent)(x,"finish",V),(0,S.removeEvent)(x,"finish",K),q()):F(x)}function $(){(0,S.addEvent)(x,"finish",K),(0,S.removeEvent)(x,"finish",V),q()}function z(){(0,T.removeClass)(s,"im-audio-message_recorded"),(0,T.removeClass)(s,"im-audio-message_recording"),s&&s.classList&&s.classList.add("im-audio-message-input--hidden"),(0,T.geByClass1)("_im_chat_input_parent",c).classList.remove("im-chat-input--hidden")}function Z(){(0,T.ge)("audiomsg_record"),_=(0,T.ge)("audiomsg_player"),c=(0,T.geByClass1)("_im_chat_input_w"),s=(0,T.geByClass1)("im-audio-message-input",c),i=(0,T.geByClass1)("audio-msg-track--duration",s),n=(0,T.geByClass1)("audio-msg-track--wave",s),o=(0,T.geByClass1)("im-audio-message--cancel-btn",s),l=(0,T.geByClass1)("_im_audio_send",s),d=(0,T.geByClass1)("audio-msg-track--btn",s),(0,T.geByClass1)("im-chat-input--text",c);var e=(0,T.geByClass1)("im-chat-input--textarea",c);(0,T.addClass)(e,"_voice_field_wrap"),(0,S.addEvent)(r,"click",j),(0,S.addEvent)(o,"click",W),(0,S.addEvent)(l,"click",Y),(0,S.addEvent)(d,"click",$)}function X(){!function(){x&&(0,S.removeEvent)(x,"progress",U);(0,S.removeEvent)(r,"click",j),(0,S.removeEvent)(o,"click",W),(0,S.removeEvent)(l,"click",Y),(0,S.removeEvent)(d,"click",$)}(),_=s=i=n=r=o=l=d=null}function Q(e,t,a){return{cancelRecording:W,start:function(){j()},unmount(){W(!1),X()}}}function J(e,t,a,s,i){return u=t,v=t.get().audio_msg,h=N.bind(null,t),m=a,p=i,(0,k.initFailBack)(),(0,A.getAvailableMicrophones)().then((e=>{var a=e.length>0;a?(Z(),s()):(0,E.setCookie)("remixvoice","0",7),t.set(M.setVoiceMessageAvail.bind(null,a))})).catch((e=>{throw(0,E.setCookie)("remixvoice","0",7),e})),(0,(0,f.createMutations)(Q).bindMutations)(e,t,a)}},900249:(e,t,a)=>{"use strict";a.d(t,{default:()=>i});var s=a(873589);const i={onNewMessagesChunk:function(e){var t=(0,s.geByClass)("post");LongView.clearElemsCache&&LongView.clearElemsCache(),t.forEach((e=>LongView.register(e,"im")))},onHistoryScroll:function(e){LongView.onScroll(e,window.innerHeight)}}},668825:(e,t,a)=>{"use strict";a.d(t,{mount:()=>k});var s=a(704103),i=a(733164),n=a(342269),r=a(873589),o=a(152278),l=a(712439),d=a(661711),c=a(384032),u=a(645523),_=a(610124),g=a(179288),m=a(555030),p=a(67328),h=a(290846),v=a(70162),f=a(844142),b=Object.values(g.ConvoListFolder);function y(e){var t=e.get().tabbedPeers.map((t=>e.get().tabs[t.peer]||e.get().mapped_index&&e.get().mapped_index[t.peer])).filter((e=>e)).filter((e=>!e.deletedDialog)).map((e=>({type:"peer",peer:e.peerId})));return t.length>0&&(t=[{type:"sep"}].concat(t)),t}function w(e,t){if("sep"===t.type)return(0,n.getTemplate)("im_right_menu_sep",{});var a=`${(0,d.getBaseLink)(e)}?sel=${t.peer}&tab=${e.get().active_tab}`,s=(0,d.getBareTab)(t.peer,e),r=f.Ranges.isContactId(t.peer)?(0,d.prepareContactName)(s.tab):s.tab,o="";switch(!0){case s.unread>0:o=s.unread;break;case(0,d.isTabMarkedUnread)(s):o=1}return o=(0,n.getTemplate)("im_right_menu_ct",{count:o}),(0,n.getTemplate)("im_right_menu_tpl",{href:a,label:r,peer:t.peer,attrs:`title="${(0,i.stripHTML)(s.tab)}"`,cls:s.unread>0?"im-right-menu--unread":"",extra:o})}function C(e,t,a,s){var i=(0,r.gpeByClass)("_im_peer_tab",s),l=(0,n.intval)((0,r.domData)(i,"list-id")),d=e.get().tabbedPeers.filter((e=>e.peer!==l));return e.set(c.updateTabbedPeers.bind(null,d,!0)).then((()=>{if(E(t,e),l===e.get().peer)e.get().longpoll.push([(0,u.resetPeer)()]);else if(0!==e.get().peer){var a=(0,r.gpeByClass)("_im_right_menu",s);uiRightMenu.hideSliding(a)}})),(0,o.cancelEvent)(a),!1}function E(e,t){return e.pipeReplace(Promise.resolve(y(t)))}function S(e,t,a,s){return{updateMenu(t){!function(e,t){(0,r.geByClass)("_im_peer_tab",e).forEach((e=>{var a=(0,m.fromQueryString)((0,r.attr)(e,"href").split("?")[1]);a.tab!==t.get().active_tab&&(0,r.attr)(e,"href",`${(0,d.getBaseLink)(t)}?sel=${a.sel}&tab=${t.get().active_tab}`)}))}(e,t);var s=(0,r.gpeByClass)("_im_right_menu",e);E(a,t).then((()=>{var e;(e=t.get().peer?(0,r.ge)("ui_rmenu_peer_"+t.get().peer):(0,r.ge)("ui_rmenu_"+t.get().active_tab))&&uiRightMenu.switchMenu(e,!0),uiRightMenu.hideProgress(s)}))},updateName(e,t){var a=(0,r.ge)("ui_rmenu_peer_"+e);if(a){var s=(0,r.geByClass1)("ui_rmenu_label-text",a),i=t.get().tabs[e].tab;(0,r.val)(s,i)}},updateCounter(e,t){var a=(0,r.ge)("ui_rmenu_peer_"+t);if(a){var s=(0,r.geByClass1)("_im_r_ct",a),i=(0,d.getTab)(e,t),n="";switch(!0){case i.unread>0:n=i.unread;break;case(0,d.isTabMarkedUnread)(i):n=1}(0,r.val)(s,n),a.classList.toggle("im-right-menu--unread",i.unread>0||(0,d.isTabMarkedUnread)(i))}},unmount(){(0,_.destroyModule)(s),a.unmount()}}}function T(e,t,a){1===a.which&&(e.get().peer&&e.get().longpoll.push([(0,u.resetPeer)()]),e.get().longpoll.push([(0,u.changeTab)(t)]),(0,o.cancelEvent)(a))}function I(e){(0,h.showTooltip)(e.currentTarget,{text:v.getLang("mail_admin_av_time"),dir:"bottom",needLeft:!0,typeClass:"tt_default_right RightMenuBlockInfo__averageTimeTooltip",width:210,shift:[-14,8],slide:15})}function M(e,t,a){e.set((e=>(0,c.toggleCommunityMute)(!t,e))).then((()=>a.classList.toggle("RightMenuBlockInfo__mute--muted",e.get().mute)))}function k(e,t,a){var i=(0,s.mount)(e,(0,l.default)({limit:50,offset:0,noScroll:!0,elements:y(t)}),(()=>({idFn:e=>e.peer||"000",renderFn:w.bind(null,t)}))),c=C.bind(null,t,i),g=(0,r.geByClass1)("RightMenuBlockInfo"),m=(0,r.geByClass1)("RightMenuBlockInfo__averageTimeHint",g),h=(0,r.geByClass1)("RightMenuBlockInfo__mute",g),v=(0,_.createModule)({handlers:(a,s)=>{s(e,"click","_im_r_cl",c),s(e,"click","_im_peer_tab",((e,a)=>{if(!(0,o.checkEvent)(e)){var s=(0,n.intval)((0,r.domData)(a,"list-id"));(0,p.unpackStore)(t).longpoll.push([(0,u.changePeer)(s,!1,!0,!0,"right_menu")]),(0,o.cancelEvent)(e)}})),b.forEach((s=>{a((0,r.geByClass1)(`_ui_item_${s}`,e.parentNode),"mousedown",T.bind(null,t,s))})),m&&a(m,"mouseover",I),(0,d.isCommunityInterface)(t)&&h&&a(h,"click",(e=>M(t,!1,e.currentTarget)))}});return(0,d.isCommunityInterface)(t)&&h&&(M(t,!0,h),h.classList.remove("RightMenuBlockInfo__mute--hidden")),S(e,0,i,v)}},364368:(e,t,a)=>{"use strict";a.d(t,{CONVO_MORE_CLASS:()=>k,mount:()=>q});var s=a(722122),i=a(384032),n=a(810890),r=a(342269),o=a(284863),l=a(661711),d=a(936979),c=a(610124),u=a(336470),_=a(37426),g=a(327125),m=a(315882),p=a(368752),h=a(511492),v=a(645523),f=a(879346),b=a(290846),y=a(70162),w=a(306151),C=a(179288),E=a(873589),S=a(993421),T=a(470887),I=a(974309),M=(0,p.debounce)(g.statlogsProbValueEvent,1e3),k="_im_search_more",A="im-dialog-select_rotated",L="im-dialog-select_hidden",P="im-page--dialogs-header-controls_hidden",R="_im_create_convo",D="_im_create_call";function x(e,t,a,s,l,d,c){var u=(0,r.trim)(d);if((0,o.isSearchingValue)(e,u)){var _=()=>c.clearSearch(e,t);u?(e.setState({recentSearch:!1}),l.stop()):l.replaceOrAdd(_),(0,n.cancelStackPush)("im_search",_),u&&e.set((e=>(0,i.setCurrentSearch)(u,!1,e))).then(t),s.classList.add("im-page--dialogs-search_fill","_im_d_search"),(0,S.isCommunityInterface)(e)||c.showCancelControl()}else u||(l.stop(),e.set((e=>(0,i.setCurrentSearch)("",!1,e))).then(t),s.classList.remove("im-page--dialogs-search_fill","_im_d_search"),(0,S.isCommunityInterface)(e)||c.hideCancelControl())}function O(e,t,a){return function(){var s=(0,o.getSearchText)(t);s===e&&a(...arguments)}}function B(e,t,a){var s=(0,o.getSearchText)(a);return M(.01,"im_search_stat",1,"search_start"),(0,i.updateSearchQuery)(s),a.setState({recentSearch:!1}),e().toggleSettingsButton(a,!!s),s?(a.get().dialog_search_going=!0,function(e,t,a){var s=O(e,a,(e=>t().appendFastDialogs(a,e)));return(0,i.searchTopConv)(e,a.get()).then((e=>{var t=e.filter((e=>"/images/deactivated_50.png"!==e.photo||"DELETED"!==e.tab));return s(t),t}))}(s,e,a).then((i=>{var n=i.map((e=>e.peerId));return t(s,e,n,a)})).then((()=>{a.get().dialog_search_going=!1})).catch((()=>{}))):(e().restoreDialogs(a,!1,!0),(0,m.removeSearchPositionTracker)("messages"),Promise.resolve(!1))}function N(e,t,a,s){var n=s.get(),r=O(e,s,(e=>t().appendDialogs(s,e))),o=O(e,s,t().appendSearch);return(0,l.isPendingForward)(s)?(0,i.searchHints)(e,a,"all",{},n).then(r):Promise.all([(0,i.searchHints)(e,a,"all",{},n).then(r),(0,i.searchMessages)(e,n)]).then((e=>{var t=e[1],a=t[0],i=t[1];o(s,a,i,!0)}))}function F(e,t,a){var s=a.target;e.set((e=>(0,i.toggleCommunityMute)(t,e))).then((()=>{s.classList.toggle("im-page--gim-mute_muted",e.get().mute),t&&U(e,{target:s})}))}function U(e,t){var a=t.target;return(0,b.showTooltip)(a,{text:()=>e.get().mute?y.getLang("mail_im_sound_off"):y.getLang("mail_im_sound_on"),black:1,shift:[13,9],appendCls:"js-im-page"})}function H(e,t,a,s,i,n){switch(i){case"contacts":s.show();break;case"favorites":nav.go("/im?box=fav");break;case"spam":(0,l.showSpamLayer)(t,u.mount,n);break;case"settings":a.show();break;case C.ConvoAction.CALL_AUDIO:case C.ConvoAction.CALL_VIDEO:case C.ConvoAction.CALL_APP:(0,l.startCallFromIm)(t,null,i===C.ConvoAction.CALL_VIDEO,[],l.CALL_ENTRY_POINT_LIST,i===C.ConvoAction.CALL_APP);break;case C.ConvoAction.CALL_BY_NAME:(0,l.startCallFromIm)(t,null,!1,null,l.CALL_ENTRY_POINT_LIST,!1,!0);break;case C.ConvoAction.BUSINESS_NOTIFY:case C.ConvoAction.ARCHIVE:if(t.get().active_tab===i)break;if(e().toggleFolder(t,i),(0,o.isClassicInterface)(t)){var r=document.getElementById(`ui_rmenu_${i}`);r?T.default.switchMenu(r):T.default.unselectAll(document.querySelector("._im_right_menu"))}var d=n.target.closest("._ui_menu_wrap");d&&uiActionsMenu.hide(d)}}function j(e,t,a,s,i,r,o,l,d,u,_,g){return{focusInput(){uiSearch.focus(s.parentNode)},hideCancelControl(){a.classList.remove(P),t.classList.add(L),t.classList.remove(A)},showCancelControl(){a.classList.add(P),t.classList.add(A),t.classList.remove(L)},setSearch(e,t,a){void 0===a&&(a=!1);var i=a?u:()=>{};s.value=t,x(e,i,0,s,r,t,d())},clearSearch(e,t){(0,n.cancelStackFilter)("im_search"),(0,S.isCommunityInterface)(e)||d().hideCancelControl(),uiSearch.reset(s),e.setState({recentSearch:!1}),x(e,t||(()=>{}),0,s,r,s.value,d())},initPeerTagsFilter(e){(0,w.initPeerTagsFilter)(e)},applySearchAction(e,t,a){H(o,e,_,g,t,a)},openSettings(){_.show()},unmount(){r.stop(),_.hide(),(0,c.destroyModule)(l),uiSearch.destroy(i),(0,n.cancelStackFilter)("im_search")}}}function q(e,t,a){var n=(0,c.createMutations)(j),r=n.callMutations,u=n.bindMutations,g=new _.Settings(t,a),m=new I.ContactList(t,a),p=(0,E.geByClass1)("_im_dialogs_header_controls",e),C=(0,E.geByClass1)(R,e),T=(0,E.geByClass1)(D,e),M=(0,E.geByClass1)("_im_search_cancel",e),A=(0,E.ge)("im_dialogs_search",e),L=(0,E.geByClass1)("_im_gim_mute",e),P=(0,E.geByClass1)("_im_av_time",e),O=(0,E.geByClass1)("_im_peer_tags_filter_control",e),q=(0,E.geByClass1)(k,e),G=(0,d.default)("im_search",[k,R,D,"_im_page_dcontent","_im_d_search","_im_dialog"]),V=(0,h.debouncedPromise)(N,300),K=e=>B(a,V,e),W=e=>x(t,K,0,A,G,e,r()),Y=()=>r().clearSearch(t,K),$=(0,E.geByClass1)("_im_dialogs_search_input",e);uiSearch.init($,{onChange:W}),A.value&&setTimeout((()=>W(A.value)),0);var z=e=>{(0,b.showTooltip)(e.target,{text:y.getLang("mail_admin_av_time"),dir:(0,E.geByClass1)("_im_top_notice")||(0,E.geByClass1)("im-page--dialogs--group-status")?"down":"up",shift:[0,8]})},Z=()=>{var e;e=0===t.get().peer||(0,l.isPendingForward)(t)?"search":"default",(0,o.isSearching)(t)||a().toggleSettingsButton(t,!1),t.get().longpoll.push([(0,v.transitionEvent)(e)])},X=()=>{(0,o.isSearching)(t)&&a().toggleSettingsButton(t,!0),function(e,t,a,n,r,d){if(!(0,o.isSearching)(e)){var c=cur.imDb.select(f.RECENT_SEARCH_OP);if(0!==c.length||(0,o.doPopularSuggExist)(e)){e.setState({recentSearch:!0}),x(e,(()=>{(0,o.isSearching)(e)||(n.stop(),r().toggleSettingsButton(e,!1),r().restoreDialogs(e,!1,!0))}),0,a,n,"",d);var u=c.filter((t=>!(0,l.isTabLoadedWithMessage)(e.get(),t))),_=c.filter((t=>(0,l.isTabLoadedWithMessage)(e.get(),t))).reduce(((t,a)=>(t[a]=(0,o.getTab)(e,a),t)),{});e.get().topConvTree.then((t=>{var a=t.list.filter((e=>u.includes(e[0]))).reduce(((e,t)=>(e[t[0]]=(0,i.localIndexToDialog)(t),e)),{}),n=(0,s.default)({},a,{},_);return r().appendFastDialogs(e,c.map((e=>n[e]))),a})).then((t=>(0,i.searchHints)("",Object.keys(t),!1,{},e.get()))).then((t=>{r().appendDialogs(e,t)}))}}}(t,0,A,G,a,r())},Q=(e,s)=>{var i=s.dataset.action;H(a,t,g,m,i,e)},J=(0,c.createModule)({handlers:(s,i)=>{s(M,"click",Y),s(M,"mouseover",(()=>function(e,t){return(0,b.showTooltip)(t,{appendEl:document.body,text:y.getLang("mail_cancel"),black:1,shift:[3,-1],appendCls:"js-im-page"})}(0,M))),s(C,"click",(()=>a().showCreation(t))),(0,E.domData)(T,"disable-click")||s(T,"click",(()=>{(0,l.startCallFromIm)(t,null,!1,null,l.CALL_ENTRY_POINT_LIST)})),i(e,"click","_im_search_more_action",Q),P&&s(P,"mouseover",z),(0,S.isCommunityInterface)(t)&&L&&(s(L,"click",(e=>F(t,!0,e))),s(L,"mouseover",(e=>U(t,e)))),s(A,"click",X),s(A,"blur",Z),s(A,"focus",(()=>{t.get().longpoll.push([(0,v.transitionEvent)("search")])})),s(q,"mouseenter",(e=>{var a,s,i=q.parentNode;null==(a=i.querySelector("._is_active"))||a.classList.remove("_is_active"),null==(s=i.querySelector(`[data-action='${t.get().active_tab}']`))||s.classList.add("_is_active")})),(0,S.isCommunityInterface)(t)&&O&&(i(e,"change","_im_peer_tags_filter_checkbox",(e=>(0,w.onPeerTagsFilterCheckboxChange)(e,t))),i(e,"click","_im_peer_tags_filter_pane_item",(e=>(0,w.onPeerTagsFilterPaneItemClick)(e,t))))}});return(0,S.isCommunityInterface)(t)&&(O?(0,w.initPeerTagsFilter)(t):L&&F(t,!1,{target:L})),u(e,M,p,A,$,G,a,J,r,K,g,m)}},72572:(e,t,a)=>{"use strict";a.d(t,{doesSearchResultContainConversations:()=>_,mount:()=>g});var s=a(67328),i=a(873589),n=a(342269),r=a(610124),o=a(384032),l=a(661711),d=a(645523);function c(e,t,a,r){var c=(0,n.intval)((0,i.domData)(r,"msgid"));if(!(0,s.getSelectionText)()&&!(0,l.checkSelectClick)(a)){var u=(0,n.intval)((0,i.domData)(r,"peer"));return e.set(o.cancelSearch.bind(null,u)),e.get().longpoll.push([(0,d.changePeer)(u,c,!1,!1,t)]),!1}}function u(e,t){return{isAll:e=>(0,o.isSearchAllLoaded)(e.get().peer,e.get()),loadMore:e=>function(e){return(0,o.isSearchAllLoaded)(e.get().peer,e.get())?Promise.resolve(""):(0,o.searchMessagesInplace)(e.get().peer,e.get())}(e),unmount(){(0,r.destroyModule)(t)}}}function _(e){return e.findIndex((e=>"number"==typeof e.peerId&&e.href))>-1}function g(e,t,a){var s=c.bind(null,t,a);return u(0,(0,r.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",s)}}))}},57625:(e,t,a)=>{"use strict";a.d(t,{mount:()=>m});var s=a(610124),i=a(70162),n=a(342269),r=a(873589),o=a(661711),l=a(384032),d=a(284863),c=a(35916),u=a(973987),_=a(844142);function g(e,t,a,s,g){if(!(0,l.isSearchingInplace)(e.get().peer,e.get())&&!((0,r.hasClass)(g,o.FAILED_CLASS)||(0,r.hasClass)(g,o.SENDING_CLASS)||(0,r.hasClass)(g,"_im_mess_srv")||(0,o.checkSelectClick)(s,g)||(0,d.isAnyMessageBeingEdited)(e)||"A"===s.target.tagName||(0,r.domClosest)("_im_replied_message",s.target)||s.target.classList.contains("_im_retry_media")||s.target.closest("."+o.MESSAGE_KEYBOARD_BUTTON_CLASS)||s.target.closest("."+o.BOT_CAROUSEL_CLASS)||s.target.closest("."+c.WIDGET_ACTIONS)||s.target.closest("."+o.MESSAGE_ASR_COLLAPSE_TOGGLE_BUTTON)||s.target.classList.contains(u.AUDIO_MSG_AUTOSHOW_SETTING_HINT)||(0,r.domClosest)("scroll-button--right",s.target)||(0,r.domClosest)("scroll-button--left",s.target))){var m,p,h=(0,n.intval)((0,r.domData)(g,"msgid")),v=e.get().peer;if(!(0,o.isAlreadyDeleted)(e,v,h))m=s.shiftKey?(0,d.getMessageRangeFromSelection)(e,v,h):[h],e.set(l.addSelection.bind(null,m)).then((()=>{var s=(0,d.getSelectedMessages)(e),o=!1;m.forEach((e=>{var t=(0,r.geByClass1)("_im_mess_"+e,a);if(t){var l=(0,n.inArray)(e,s);o|=l,(0,r.toggleClass)(t,"im-mess_selected",l);var d=l?i.getLang("mail_deselect_message"):i.getLang("mail_select_message"),c=(0,r.geByClass1)("_im_mess_blind_label_select",t);(0,r.attr)(c,"aria-label",d)}})),o&&(window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()),t().changedMessageSelection(e)})).then((()=>{1!==e.get().selectedMessages.length||p?p&&p.hide():p=function(e){var t=e.get();if(t.pinnedMessagesPromo&&_.Ranges.isChatOrChannelPeer(t.peer)){var a=(0,r.geByClass1)("_mess-action-promo"),s=new ElementTooltip(a,{autoShow:!1,appendTo:a,content:(0,n.getTemplate)("im_pinned_messages_promo",{content:i.getLang("mail_pinned_messages_promo_tooltip")}),forceSide:"bottom",cls:"feature_intro_tt",width:260,onHide:function(){e.setState({pinnedMessagesPromo:!1}),(0,l.hidePromoTooltip)()}});return s.show(),s}}(e)}))}}function m(e,t,a){var i=g.bind(null,t,a,e),n=(0,s.createModule)({handlers:(t,a)=>{a(e,"click","_im_mess",i)}});return function(e,t){return{cleanSelection(t){t&&Array.isArray(t)&&t.length&&t.map((t=>(0,r.geByClass1)("_im_mess_"+t,e))).filter((e=>e)).forEach((e=>(0,r.removeClass)(e,"im-mess_selected")))},unmount(){(0,s.destroyModule)(t)}}}(e,n)}},152351:(e,t,a)=>{"use strict";a.d(t,{mount:()=>g});var s,i,n=a(610124),r=a(70162),o=a(873589),l=a(661711);function d(e){var t=(0,o.ge)("page_header"),a=(0,o.clientHeight)()-t.offsetHeight-30-2;(0,o.setStyle)(e,{height:Math.max(a,400)})}function c(e){var t=(0,l.formatTimespan)(Math.floor(Math.max(e,0)/1e3),!0);return t?r.getLang("mail_sick_timer").replace(/{timer}/gi,t):""}function u(){nav.reload({force:!0})}function _(e){return{unmount(){clearInterval(i),clearTimeout(s),(0,n.destroyModule)(e)}}}function g(e,t,a){d(e);var r,o,l=(0,(0,n.createMutations)(_).bindMutations)((0,n.createModule)({handlers:(t,a)=>{t(e.querySelector("._im_sick_reload"),"click",u),t(window,"resize",d.bind(null,e))}})),g=(r=localStorage.getItem("im_sick_timer"),o=r?Math.min(2*parseInt(r),6e5):5e3,localStorage.setItem("im_sick_timer",o),o),m=e.querySelector("._im_sick_timer"),p=+new Date;return m.innerHTML=c(g),i=setInterval((()=>{m.innerHTML=c(p+g-new Date)}),500),s=setTimeout(u,g),l}},336470:(e,t,a)=>{"use strict";a.d(t,{mount:()=>A});var s=a(152278),i=a(70162),n=a(501389),r=a(342269),o=a(873589),l=a(146143),d=a(384032),c=a(661711),u=a(610124),_=a(57625),g=a(712439),m=a(645523),p=a(419672),h=a(124041),v=a(3397),f="_im_spam_not_spam",b="_im_spam_spam";function y(e,t,a,s){if(!e.loading&&!e.all&&a.scrollTop+window.innerHeight-a.scrollHeight>-300){var i=(0,o.geByClass1)("_im_peer_history",t.bodyNode);e.loading=!0,(0,c.wrapLoading)(i)((0,d.loadSpam)(e.offset,s.get().gid).then((t=>{t[0];var a=t[1],n=(t[2],t[3]);e.all=n.all,e.offset=n.offset,e.all?(0,o.addClass)(i,"im-important_all"):e.loading=!1,s.set((e=>(0,d.mergeTabs)(e,(0,c.tabFromIds)(n.msgs,n.hash))));var r=(0,o.ce)("div");r.innerHTML=a,i.appendChild(r),(0,p.ensureDomHasActions)(i)})),"bottom")}}function w(e,t){var a,s=t.get().selectedMessages,n=(0,o.geByClass1)("_im_spam_box",e.bodyNode),r=(0,o.geByClass1)("ui_tab_sel",e.bodyNode);if(s.length>0){var l=i.getLang("mail_selected",s.length);l=l.replace("{count}",s.length),(0,o.val)(r,l+(a=(0,v.getIcon16Cancel)().icon,`<button aria-label="${i.getLang("mail_deselect_all")}" type="button" class="im-deselect ${c.DESELECT_ALL_CLASS}">${a}</button>`))}else(0,o.val)(r,i.getLang("mail_spam"));if(0===s.length)(0,o.removeClass)(n,"im-important-box_with-sel");else{(0,o.addClass)(n,"im-important-box_with-sel");var d=document.querySelector("._im_spam_spam"),u=document.querySelector(`.${f}`);d&&u&&(h.FlatButton.setLabel(d,i.getLang("mail_im_mark_delspam",s.length)),h.FlatButton.setLabel(u,i.getLang("mail_im_mark_notspam",s.length)))}}function C(e,t,a){var s=e.get().selectedMessages;e.set(d.cleanSelected).then(a.cleanSelection.bind(null,s)).then((a=>w(t,e)))}function E(e,t,a,s){var i=(0,o.gpeByClass)("_im_mess",s,t);if(i){var n=(0,r.intval)((0,o.domData)(i,"msgid"));i&&((0,d.removeMessageSend)([n],0,e.get().tabs[0].hash,"undel",e.get()),(0,c.restoreMessage)(n,0,t))}}function S(e,t,a){var s=e.get().selectedMessages;(0,d.removeMessageSend)(s,0,e.get().tabs[0].hash,"delete",e.get()),(0,c.removeMessagesWithRestore)(s,0,"delete",t),C(e,t,a)}function T(e,t,a){var s=e.get().selectedMessages;(0,d.removeMessageSend)(s,0,e.get().tabs[0].hash,"nospam",e.get()),s.map((e=>(0,o.geByClass1)("_im_mess_"+e))).filter((e=>e)).forEach((e=>{var t=(0,r.intval)((0,o.domData)(e,"peer")),a=(0,r.intval)((0,o.domData)(e,"msgid"));(0,o.val)(e,(0,c.renderGoTo)(t,a)),(0,o.addClass)(e,"im-mess_light")})),C(e,t,a)}function I(e,t,a,i,n){var l=(0,o.gpeByClass)("_im_mess",n,t.bodyNode),d=(0,r.intval)((0,o.domData)(l,"peer")),c=(0,r.intval)((0,o.domData)(l,"msgid"));return t.hide(),a().unmount(),e.get().longpoll.push([(0,m.changePeer)(d,c,!1,!1,"spam_box")]),(0,s.stopEvent)(i),(0,s.cancelEvent)(i),!1}function M(e,t,a,s){var r=(0,l.showFastBox)({title:i.getLang("mail_deleteall1"),bodyStyle:"padding: 20px; line-height: 160%;"},i.getLang("mail_delete_all_spam"),i.getLang("mail_delete"),(()=>{(0,d.flushSpam)(e,s).then((e=>{e[0];var t=e[1];(0,n.showDoneBox)(t)})),r.hide(),t.hide(),a().unmount()}),i.getLang("mail_close"),(()=>r.hide()))}function k(e,t){return{unmount(){t.unmount(),(0,u.destroyModule)(e)}}}function A(e,t,a){var s=(0,o.ge)("box_layer_wrap"),i=(0,u.createMutations)(k),n=i.callMutations,r=i.bindMutations,l=(0,g.default)({peer:0,oCache:{},tabs:(0,c.tabFromIds)(a.msgs,a.hash),gid:t.get().gid}),d=y.bind(null,{all:a.all,loading:!1,offset:a.offset},e,s,l),m=E.bind(null,l,e.bodyNode),h=I.bind(null,t,e,n),v=M.bind(null,a.hash,e,n,t.get().gid),A=(0,_.mount)(e.bodyNode,l,(t=>({changedMessageSelection:w.bind(null,e)}))),L=S.bind(null,l,e.bodyNode,A),P=T.bind(null,l,e.bodyNode,A),R=C.bind(null,l,e,A);return(0,p.ensureDomHasActions)(e.bodyNode),r((0,u.createModule)({handlers:(t,a)=>{t(s,"scroll",d),a(e.bodyNode,"click",b,L),a(e.bodyNode,"click",f,P),a(e.bodyNode,"click","_im_spam_flush",v),a(e.bodyNode,"click",c.RESTORE_CLASS,m),a(e.bodyNode,"click","_im_go_to",h),a(e.bodyNode,"click",c.DESELECT_ALL_CLASS,R)}}),A)}},451228:(e,t,a)=>{"use strict";a.d(t,{mount:()=>Je});var s=a(722122),i=a(887757),n=a(692137),r=a(663825),o=a(810890),l=a(769488),d=a(152278),c=a(873589),u=a(342269),_=a(734994),g=a(402601),m=a(241103),p=a(384032),h=a(661711),v=a(327125),f=a(284863),b=a(376473),y=a(740066),w=a(618387),C=a(67328),E=a(610124),S=a(659397),T=a(146143),I=a(290846),M=a(608021),k=a(156563),A=a(368752),L=a(924995),P=a(49241),R=a(519037),D=a(826338),x=a(238283),O=a(110237),B=a(722199),N=a(645523),F=a(459554),U=a(993421),H=a(274642),j=a(506770),q=a(240367),G=a(475234),V=a(917791),K=a(844142),W=a(69957),Y=a(679483),$=a(240950),z=2e3,Z="_mr_button_accept",X="_mr_button_reject",Q="_im_submit_btn",J="_im_media_preview",ee="MassMentionWarning",te="MassMentionWarning--hidden",ae="app_action_mini_apps_ab_direct",se="app_action_mini_apps_ab_chat";function ie(e,t){if(!e)return!1;window.tooltips&&tooltips.hide(e,t)}function ne(e,t,a,s,i,n,o){if(void 0===o&&(o=!0),He(t,s))return Promise.resolve(!1);var l=ge(s),d=(0,f.getTab)(s,t);l.getBoundAttach(a.message)&&!/^https:\/\/(\w)+se\.mvk\.com\//.test(a.message)&&(a.message=""),a.share_url=l.getShareUrl(),a.cancelled_shares=l.getCancelledShares();var c,_=(0,w.random)(),g={peerId:t,messageId:"rid"+_,flags:r.FLAG_OUTBOUND,date:(0,u.intval)(Date.now()/1e3)-s.get().timeshift,subject:"",text:(0,h.replaceSpecialSymbols)((0,u.clean)(a.message)).replace(/\n/gi,"<br>"),local:!0,kludges:{emoji:!0,from_admin:s.get().gid?vk.id:null},type:r.ADD_MESSAGE,attaches:(c=a.attaches,c.map((e=>({id:e[1],type:e[0],kind:e[2]||null})))),minorSortId:d.minor_sort_id};return(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,D.isMarusiaPeer)(t)&&(g.kludges.payload=a.payload),(0,j.partConfigEnabled)("im_chasiky_debug")&&(window.meBufferLog[_]=[{text:g.text,timestamp:Date.now(),ts:window.lpConnect.options.ts}]),a.rid=_,a.mess=g,e(t,a),s.get().longpoll.push([g]),o&&n().clearText(t,s),i().newMessage(s),Promise.resolve(!0)}function re(e,t,a,s,i,n,r,o){void 0===o&&(o=!1),o||(o=e.get().peer);var d=ge(e),c=oe(d,r),_=c?d.dData.attaches.map((e=>[e.type,e.id])):[],g={message:"",attaches:[].concat(_,n)};r&&(0,u.extend)(g,r),le(e,t,!1).then((()=>ne(a,o,g,e,t,s,!1).then((a=>(c&&Ie(e,i,t),Promise.resolve(a)))))).catch((t=>{(0,l.debugLog)(t),_e(e,i)}))}function oe(e,t){var a=e.dData,s=t&&t.sticker_referrer,i=s&&0===s.indexOf("suggestion"),n=t&&t.is_hintach_item;return(!a.txt.trim()||i||n)&&0===a.attaches.filter((e=>"reply"!==e.type)).length}function le(e,t,a){return e.get().tabs[e.get().peer].skipped>0?(t().loadingPeer(e),e.setState({no_moving_down:!0}),e.set(p.changePeer.bind(null,e.get().peer,!1,!1)).then((()=>e.set((t=>(0,V.loadPeer)(t,e.get().peer,-1,!0,!1,"toEnd"))))).then((()=>(t().changePeer(e,!1),e.setState({no_moving_down:!1}),a)))):Promise.resolve(a)}function de(e,t,a){var s=!!(0,u.intval)((0,c.domData)(a,"val"));s!==cur.ctrl_submit&&(cur.ctrl_submit=s,(0,q.setInfo)("messages_multiline_input",String(Number(s))).then((()=>{})),e.set((e=>(0,G.setLocalSettingsValue)("ctrl_submit",Number(s),e))))}function ce(e,t,a,s){return!e.get().delayed_ts&&setTimeout((()=>{e.set(p.setDelayedMessage.bind(null,!1,!1)).then((()=>{a(...s)}))}),t)}function ue(e){void 0===e&&(e=M.getLang("mail_send_error"));var t=M.getLang("global_error");(0,T.showFastBox)({title:t},e,M.getLang("mail_ok"),(()=>{nav.reload({force:!0})}))}function _e(e,t){document.activeElement&&document.activeElement.blur(),ue();var a=(0,c.geByClass1)("_im_send",t);return e.set(p.toggleSendingAbility.bind(null,!0)).then((()=>{(0,h.lockButton)(a)}))}function ge(e){return e.get().tfdraft||new R.ImDraft}function me(e,t,a,s,i,n){var r=(0,U.getPeer)(e),o=(0,f.getCurrentKeyboard)(e)||{},d=o.one_time,u=void 0!==d&&d,_=(0,c.geByClass1)("_im_send",s);return Promise.resolve().then((()=>{if((0,f.isSendingAvailable)(e)){if((0,p.isAnythingLoading)(e.get())||!(0,h.isFullyLoadedTab)(e,e.get().peer)){var s=ce(e,z,me,(0,C.toArray)(arguments));return e.set(p.setDelayedMessage.bind(null,!0,s)).then((()=>{(0,h.lockButton)(_)}))}return clearTimeout(e.get().delayed_ts),e.set(p.setDelayedMessage.bind(null,!1,!1)).then((()=>(0,h.unlockButton)(_))).then(le.bind(null,e,t)).then((()=>{var s=n.keyboardAuthorId,o=n.action||{},l=o.attaches||[],d=(0,S.decodeHTMLEntities)(o.payload||""),c=(0,S.decodeHTMLEntities)(o.label||"");K.Ranges.isChatOrChannelPeer(r)&&(c=`@${(0,x.oCacheGet)(e,s).link.slice(1)} ${c}`);return(0,v.statlogsValueEvent)("message_send_from_keyboard",0,e.get().id,r,s),ne(a,r,{message:c,attaches:l,payload:d},e,t,i,!1)})).then((()=>u?e.set(p.deleteKeyboard.bind(null,r)):Promise.resolve())).then((()=>i().fixKeyboard()))}})).catch((t=>{(0,l.debugLog)(t),_e(e,s)}))}function pe(e,t,a,s,i,n,r,o){return void 0===r&&(r=[]),Promise.resolve().then((()=>{var l=(0,c.geByClass1)("_im_send",s);if(!(0,f.isSendingAvailable)(e))return!1;if((0,p.isAnythingLoading)(e.get())||!(0,h.isFullyLoadedTab)(e,e.get().peer)){var d=ce(e,z,pe,(0,C.toArray)(arguments));return e.set(p.setDelayedMessage.bind(null,!0,d)).then((()=>{(0,h.lockButton)(l)}))}clearTimeout(e.get().delayed_ts),i().saveText(e);var u=!1,_=ge(e),g=_.dData.attaches.map((e=>{var t;if("poll"==e.type){var a=n.pollData();return a||(u=!0),[e.type,e.id,a]}return"share"==e.type&&(null==(t=e.object)?void 0:t.extpage_raw)?[e.type,e.object.extpage_raw]:[e.type,e.id]})).concat(r);if(u)return!1;var m=e.set(p.setDelayedMessage.bind(null,!1,!1)).then((()=>{(0,h.unlockButton)(l)})),v=(0,U.getPeer)(e);return m.then((()=>{var n=_.dData.txt,r=t().getEditingMessage();if(r||n||g.length){if(r)return n||g.length&&!_.hasOnlyReplies(r)?(0,h.isMessageTooLong)(n)?void(0,T.showFastBox)(M.getLang("global_error"),M.getLang("mail_err_edit_too_long")):(t().cancelEditing(),void((0,P.wasMessageReallyModified)(e,r,_)&&((0,P.replaceMsgAfterEdit)(e,r,n,g,_.getShareUrl(),_.getCancelledShares()),t().sendEditMessage(e,r),e.get().longpoll.push([(0,N.editMessageLocallyEvent)(r)])))):void he(e,t,s,r.messageId);var l=(0,h.splitMessageToParts)(n,g).map((s=>{var n={message:s.msgText||"",attaches:s.attaches||[]};return(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,D.isMarusiaPeer)(v)&&o&&(n.payload=JSON.stringify(o)),ne(a,v,n,e,t,i)}));return Promise.all(l)}})).then(le.bind(null,e,t))})).catch((t=>{(0,l.debugLog)(t),_e(e,s)}))}function he(e,t,a,s){var i=e.get(),n=i.peer,r=(0,T.showFastBox)({title:M.getLang("mail_dialog_msg_delete_title")},M.getLang("mail_dialog_msg_delete_for_all"),M.getLang("mail_delete"),(function(e){(0,p.removeMessageSend)([s],n,null,"deleteforall",i),r.hide(),t().cancelEditing()}),M.getLang("global_cancel"),(function(){r.hide(),we((0,c.geByClass1)("_im_text",a))}))}function ve(e,t,a){return e.set(p.deliverMessage.bind(null,t,a,{}))}function fe(e,t,a,s){e.get().longpoll.push([(0,N.failedMessage)(t,a.mess,s)])}function be(e,t,a,s,r,o,l,d,u){var _,g=(0,A.debounce)(je.bind(null,e,a),500);var m=Emoji.init((0,c.geByClass1)("_im_text",t),{ttDiff:93,rPointer:!0,ref:"im",onSend:()=>$e(e,t).then(function(){var t=(0,n.default)(i.mark((function t(a){var n,r,o;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0,r=e.get().peer,!(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,D.isMarusiaPeer)(r)){t.next=10;break}return t.next=5,(0,Y.loadMarusiaSdk)();case 5:if(o=t.sent,n={communication_type:W.CommunicationType.text,voice_assistant:{support_process_commands_by_ids:!0}},!o||o.canSentMessage()){t.next=10;break}return o.onClick(),t.abrupt("return");case 10:return t.abrupt("return",a&&s([],n));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),controlsCont:t,forceTxt:!e.get().editable,checkEditable:function(a,s){var i=e.get().peer,n=Emoji.val(s);K.Ranges.isZeroOwner(i)||He(i,e)||ge(e).dData.txt==n||!n||function(e){var t=e.get().peer;(0,h.isFullyLoadedTab)(e,t)&&!(0,f.isAnyMessageBeingEdited)(e)&&Date.now()-((0,f.getTab)(e,t).lastTyping||0)>1e3*p.ACTIVITY_PERIOD&&e.set(p.sendTyping.bind(null,t))}(e),ze(e,t,n),Xe(e,t,n),g(s);var r=t.offsetHeight;if(_&&_!==r){var o=d().updateScroll();d().scrollFix(e,e.get().peer,o)}_=r},onStickerSend:(e,t,a)=>r([["sticker",e,a]],{sticker_referrer:t}),onHintachSend:(e,t)=>o([[e,t]],{is_hintach_item:!0}),uploadActions:l,suggestionsConfig:e.get().suggestionsConfig,clearText:function(){u().clearText(e.get().peer,e)}});return Emoji.emojiLoadMore(m,{},(()=>d().renderStickersPanel(e))),e.setState({emojiOptId:m}),(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,D.isMarusiaPeer)(e.get().peer)&&Emoji.toggleStickers(m,!0),m}function ye(e,t,a){var s=e.get().peer;if(!(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,D.isMarusiaPeer)(s)){var i=Emoji.val((0,c.geByClass1)("_im_text",t));(0,f.isAnyMessageBeingEdited)(e)&&""!==i||$e(e,t).then((t=>{var s=(0,u.intval)((0,c.domData)(a.target,"tttype"));(2===s&&!0!==t||1===s&&!0===t||3!==s&&""===i)&&window.tooltips&&tooltips.destroy(a.target,{fasthide:!0});var n=ge(e).dData.attaches.length>0;if((0,f.isAnyMessageBeingEdited)(e)&&""===i&&!n)return(0,c.domData)(a.target,"tttype",3),(0,I.showTooltip)(a.target,{text:M.getLang("mail_delete_for_all"),black:!0,force:3!==s,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});if(!0!==t)return(0,c.domData)(a.target,"tttype",1),(0,I.showTooltip)(a.target,{text:(0,h.isCommunityInterface)(e)?M.getLang("mail_send2"):M.getLang("mail_added_audiomsg"),black:!0,force:1!==s,appendParentCls:"_im_chat_input_parent",shift:[-8,-10]});(0,c.domData)(a.target,"tttype",2);var r;return(0,I.showTooltip)(a.target,{text:(r=e.get().settings.ctrl_submit?1:0,(0,u.getTemplate)("ctrl_submit_hint",{enter_on:r?"":"on",ctrl_on:r?"on":""})),dir:"down",shift:[-28,-5],needLeft:!0,className:"im-chat-input--tt",hasover:!0,force:2!==s,showdt:700,zIndex:200,hidedt:700,appendParentCls:"_im_chat_input_parent",onCreate(){radioBtns.im_submit={els:(0,C.toArray)((0,c.geByClass)(Q)),val:e.get().settings.ctrl_submit?1:0}},onHide(){window.tooltips&&tooltips.destroy(a.target,{fasthide:!0})}})}))}}function we(e){Emoji.focus(e,!0),setTimeout(Emoji.correctCaret.pbind(e),10)}function Ce(e,t){Emoji.val(e,(0,u.clean)(t)),we(e)}function Ee(e,t,a,s){var i=e.getFwdRaw(),n=t.querySelector("._im_media_fwd"),r=t.parentNode.querySelector("._im_replied_content");if(!((0,f.getCurrentKeyboard)(s)||{}).hide&&i&&a.toggleKeyboard(!0),n.innerHTML="",r.innerHTML="",i){var o=function(e,t){if(e.get().isEditing){var a=(0,h.getNowEditingMessage)(e);return a&&(0,b.hasReply)(a)}return"reply"===t.type}(s,i),l=o?r:n,d=i.object;l.innerHTML=o?Te(d):function(e,t,a,s){if(a.object&&a.object.authorName){var i=(0,h.renderShortText)(0,"",s.text,!0,(0,D.convertKludgesToAttaches)(s.kludges,0));return(0,u.getTemplate)("im_attach_mess",{title:s.authorName,messages:i,date:(0,M.getSmDate)(s.date,e.get().timeshift)})}return(0,u.getTemplate)("im_attach_mess",{title:M.getLang("mail_im_fwd_msgs_title"),messages:(0,u.getTemplate)("im_dialog_media",{name:M.getLang("mail_title_X_msgs",t.getFwdCount())}),date:""})}(s,e,i,d)}}function Se(e){var t=document.querySelector("._im_chat_audio_input_parent ._im_replied_content"),a=e.getFwdRaw();if(a){var s=a.object;t&&(t.innerHTML=Te(s))}else t.innerHTML=""}function Te(e){var t=(0,h.renderShortText)(0,"",e.text,!0,(0,D.convertKludgesToAttaches)(e.kludges,0));return(0,u.getTemplate)("im_replied_message",{authorName:e.authorName,text:t})}function Ie(e,t,a){return e.set(p.forwardMessages.bind(null,null,ge(e),!1)).then((()=>{var s=t.querySelector("._im_media_fwd"),i=t.parentNode.querySelector("._im_replied_content"),n=document.querySelector("._im_chat_audio_input_parent ._im_replied_content");i&&i.children.length&&(i.innerHTML="",Ae(e,a)),n&&n.children.length&&(n.innerHTML="",Ae(e,a)),s&&s.children.length&&(s.innerHTML="",Ae(e,a)),ze(e,t)}))}function Me(e,t,a){var s=(0,U.getPeer)(e);e.set(p.acceptMessageRequest.bind(null,s)).then((()=>{Ye(e,s,t),a()})).catch((()=>ue()))}function ke(e,t,a){var s=(0,U.getPeer)(e);e.set((e=>(0,p.rejectMessageRequest)(s,!1,e))).then((()=>{(0,h.isClassicInterface)(e)&&t(e),a(e,s),s===e.get().peer&&e.get().longpoll.push([(0,N.resetPeer)()])})).catch((()=>ue()))}function Ae(e,t){var a=t().updateScroll();t().scrollFix(e,e.get().peer,a)}function Le(e,t,a,s){var i=e.get().peer,n=(0,u.inArray)(i,e.get().mutedPeers);e.set(p.toggleMutePeer.bind(null,i,!n,-1)).then(a().updateState.bind(null,i)),(0,d.cancelEvent)(s)}function Pe(e,t,a,s){var i=e.get().peer;e.set(p.returnToChat.bind(null,i)).then((e=>e.set(p.getPinnedMessage.bind(null,i)))).then(a().updateChatTopic.bind(null,i)),(0,d.cancelEvent)(s)}var Re="close",De="open",xe="hide";function Oe(e,t,a,s,i,n,r,o){if(r!==Re&&r!==De&&r!==xe)throw new Error(`Action "${r}" not found`);var l=e.get(),d=(0,f.getCurrentKeyboard)(e),u=(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,D.isMarusiaPeer)(l.peer);((0,h.isCommunityInterface)(e)||!d||l.isEditing||u)&&(r=xe);var _=r===Re||r===xe,g=Promise.resolve();_||a.isMounted||(g=a.init());var m=!d&&r!==De;return g.then((()=>((0,c.toggleClass)(t,"im-chat-input_open-keyboard",!_),(0,c.toggleClass)(t,"im-chat-input_close-keyboard",_&&r!==xe),(0,c.toggleClass)(s,"im_chat-input--keyboard-button_hidden",r===xe),a.toggle(l.peer,_,n)))).then((()=>{if(!m||o){var t=i().updateScroll();return i().scrollFix(e,l.peer,t)}}))}function Be(e,t){if((0,f.isAnyMessageBeingEdited)(e))return!1;var a=e.get();if((0,h.isCommunityInterface)(e))return!1;if(!(0,F.getCurrentTab)(e).moneyTransferAvail)return!1;if(K.Ranges.isGroupId(t))return a.moneyTransferCommAvail;if(K.Ranges.isUserIdTransitional(t)){var s=(0,u.inArray)(t,a.moneyTransferExcept);return t!=vk.id&&!s&&!K.Ranges.isContactId(t)}return!1}function Ne(e,t){return!(0,f.isAnyMessageBeingEdited)(e)&&(!!e.get().moneyRequestAvail&&(!!(0,F.getCurrentTab)(e).moneyRequestAvail&&(!(!K.Ranges.isGroupId(t)&&!K.Ranges.isChatOrChannelPeer(t))||!!K.Ranges.isUserIdTransitional(t)&&(t!=vk.id&&!K.Ranges.isContactId(t)))))}function Fe(e,t,a,i,n,r,o,l,d,_,g,m,p,v,b,y){return{restoreKeyboard(){this.toggleKeyboard(!!(ls.get("is_keyboards_hide")||{})[(0,U.getPeer)(e)])},toggleKeyboard:(t,a)=>(void 0===t&&(t=!(0,f.getCurrentKeyboard)(e).hide),void 0===a&&(a=!0),Oe(e,i,m,g,r,a,t?Re:De)),initKeyboard(){if(!e.get().peer||!(0,f.getCurrentKeyboard)(e))return Promise.resolve();var t=!!(ls.get("is_keyboards_hide")||{})[(0,U.getPeer)(e)];return Oe(e,i,m,g,r,!0,t?Re:De)},fixKeyboard(){var t,a=(0,f.getCurrentKeyboard)(e);return t=a?a.hide?Re:De:xe,Oe(e,i,m,g,r,!0,t,!0)},hideKeyboard:()=>Oe(e,i,m,g,r,!1,xe),updateMediaSelectorOptions(e){var t=e.get().peer,a=(0,s.default)({gift:(0,h.isGiftOptionAvailableForPeer)(e,t)&&!(0,f.isAnyMessageBeingEdited)(e),money:(0,h.isMoneyOptionAvailableForPeer)(e,t)&&!(0,f.isAnyMessageBeingEdited)(e),poll:K.Ranges.isChatOrChannelPeer(t),app_action_mini_apps:(0,h.isAppActionOptionAvailableForPeer)(t),app_action_games:(0,h.isAppActionOptionAvailableForPeer)(t)},function(e,t){var a=!(0,h.isPeerCurrentUser)(e)&&!(0,h.isCommunityInterface)(t);return{[ae]:a&&K.Ranges.isUserId(e),[se]:a&&K.Ranges.isChatOrChannelPeer(e)}}(t,e)),n=(0,c.geByClass1)("ms_items_more",i);Object.entries(a).forEach((e=>{var t=e[0],a=e[1],s=(0,c.geByClass1)("ms_item_"+t,n);(0,c.toggleClass)(s,"ms_item--hidden",!a),a?(0,c.show)(s):(0,c.hide)(s)}))},restoreDraft(e,s,n){t.chosenMedias.length>0&&(e.setState({removingMedias:!0}),t.unchooseMedia(),t.chosenMedias=[],e.setState({removingMedias:!1})),this.updateMediaSelectorOptions(e);var o=e.get().peer,l={im:!0,fromId:-(0,f.getGroupId)(e)||vk.id,peer:o,moneyTransfer:{request:Ne(e,o),send:Be(e,o)}},d=(0,U.getEmojiOptId)(e);if(void 0===d?e.setState({suggestionsConfig:l}):Emoji.setSuggestionsConfig(d,l),K.Ranges.isZeroOwner(o))return Promise.resolve();var c=ge(e);return Emoji.val(a)!==c.dData.txt?(Ce(a,c.dData.txt),Xe(e,i,c.dData.txt)):we(a),(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&((0,D.isMarusiaPeer)(o)?((0,Y.loadMarusiaSdk)().then((t=>{var s,i,n;(0,D.isMarusiaPeer)(e.get().peer)&&(t&&t.init({iconContainer:document.querySelector("._im_send"),suggestContainer:document.querySelector("._marusia_suggest"),draftText:c.dData.txt,unreadMessages:null!=(s=null==(i=e.get().tabs[o])?void 0:i.unread)?s:0,needOnboarding:null==(n=e.get().tabs[o])?void 0:n.is_new,textInput:a,setTextValue:Ce}))})),void 0!==d&&Emoji.toggleStickers(d,!0)):((0,Y.loadMarusiaSdk)().then((e=>{e&&(e.stopListening(),e.hide())})),void 0!==d&&Emoji.toggleStickers(d,!1))),c.prepareObjects(e.get().gid,s&&s.messageId).then((()=>{if(!Ye(e,o,a)&&o==e.get().peer){for(var s=c.dData.attaches,l=0;l<s.length;l++)t.chooseMedia(s[l].type,s[l].id,s[l].object||{});if(Ee(c,i,this,e),n){var d=r().updateScroll();r().scrollFix(e,o,d)}ze(e,i,c.dData.txt)}}))},sendMessage(){n([])},sendMessageFromKeyboard(){for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return me.call(null,e,r,v,i,...a)},choose(e,a,s){t.chooseMedia(e,a,s)},updateChosenMedia(e,a,s){t.updateChosenMedia(e,a,s)},canAddMedia:()=>!t.hasRestrictingAttach()&&!He(e.get().peer,e),isEmpty:e=>!(0,u.trim)(Emoji.val(a))&&!ge(e).hasAttaches(),unchoose(e){t.unchooseMedia(e)},attachCount:()=>t.attachCount(),progress(e,a,s){t.showMediaProgress(e,a,s)},updateState(e){this.restoreKeyboard(),Ye(e,e.get().peer,a)},focusOn(e){Emoji.editableFocus(a,!1,!0)},setDraft(e,a,s){void 0===s&&(s=!0);var i=(0,f.getTab)(e,e.get().peer);(0,F.doesChatTabHaveFlag)(i,1024)&&!e.get().gid||(t.cancelCheckUrl(),p&&p.update(),e.setState({tfdraft:a}),a&&this.restoreDraft(e,r().getEditingMessage(),s))},clearText(e,s){ge(s).clear(),t.cancelCheckUrl(),t.unchooseMedia(),t.chosenMedias=[],Emoji.val(a,""),Ie(s,i,r);var n=r().updateScroll();r().scrollFix(s,s.get().peer,n)},attachMessages(e,t){if(e.get().peer===t){Ee(ge(e),i,this,e);var a=r().updateScroll();r().scrollFix(e,t,a),ze(e,i)}},detachMessages(t){var a=ge(e).getFwdRaw();if(a&&!!a.id.split(";").find((e=>Math.abs(e)===t.messageId)))return Ie(e,i,r).then((()=>{var t=r().updateScroll();r().scrollFix(e,e.get().peer,t)}));return Promise.resolve()},cancelRecording(){null==_||_.cancelRecording()},reHeight(e){var t=r().updateScroll();r().scrollFix(e,e.get().peer,t)},isBlocked:()=>He(e.get().peer,e),toggleStickers(e,t){Emoji.toggleStickers((0,U.getEmojiOptId)(e),!t)},saveText(e){ge(e).setText(Emoji.val((0,c.geByClass1)("_im_text",i)))},resendAll(){b()},resendPeer(){y(e.get().peer)},unmount(){(0,E.destroyModule)(d),t.destroy(),l.unmount(),m.unmount(),p&&p.unmount(),Emoji.destroy((0,U.getEmojiOptId)(e)),null==_||_.unmount()}}}function Ue(e,t){return!!K.Ranges.isChatOrChannelPeer(e)&&t.get().tabs[e].data.kicked}function He(e,t){return Ue(e,t)||(0,f.getTab)(t,e)&&(0,f.getTab)(t,e).block_error>0||(0,h.isLocksAvailable)(t)&&(0,h.isPeerBlocked)(e,t)}function je(e,t,a){var s=e.get().peer,i=Emoji.val(a);K.Ranges.isZeroOwner(s)||ge(e).dData.txt==i||He(s,e)||(t.checkMessageURLs(i,!0,z),ge(e).setText(i))}function qe(e){var t=ge(e).getFwdRaw();t&&window.showForwardBox({act:"a_show_forward_box",will_fwd:t.id,gid:e.get().gid})}function Ge(e,t){e.disabled=!0,e.contentEditable="false",(0,c.addClass)(e,"im-chat-input--text_disabled"),(0,c.addClass)(t,"im-chat-input_error"),(0,c.addClass)((0,c.geByClass1)("_im_page_history"),"is_tf_blocked")}function Ve(e,t){e.disabled=!1,e.contentEditable="true",(0,c.removeClass)(e,"im-chat-input--text_disabled"),(0,c.removeClass)(t,"im-chat-input_error"),(0,c.removeClass)((0,c.geByClass1)("_im_page_history"),"is_tf_blocked")}var Ke="renewSubscriptionButton",We="im-chat-input--donut";function Ye(e,t,a){var s,i=(0,c.gpeByClass)("_im_chat_input_parent",a),n=(0,c.geByClass1)("_im_chat_input_error",i),r=(0,c.geByClass1)("im-chat-input--error",i),o=(0,f.getTab)(e,t),l=He(t,e);if(l){Ge(a,i);var d=function(e,t,a){switch(a.block_error){case 7:case 5:return M.getLang("mail_peer_deleted");case 14:return M.getLang("mail_community_deleted");case 11:return M.getLang("mail_group_banned_messages");case 28:return M.getLang("mail_cant_send_messages_by_time");case 29:return M.getLang("mail_cant_send_messages_by_web_bot");case 4:case 6:case 9:case 19:case 20:case 13:return K.Ranges.isGroupId(t)?M.getLang("mail_send_privacy_community_error"):M.getLang("mail_send_privacy_error");case 23:var s=(0,x.oCacheGet)(e,t);return(0,M.langSex)(s.sex,M.getLang("mail_blacklist_user","raw")).replace("{user}",s.kick_name);case 12:return M.getLang("mail_cant_send_messages_to_community");case 16:return M.getLang("mail_chat_youre_kicked");case 26:return M.getLang("mail_chats_is_disabled");case 0:if(Ue(t,e))return M.getLang("mail_chat_youre_kicked");var i=e.get().block_states[t].name;return M.getLang("mail_community_answering").replace("{username}",i);case 62:return M.getLang("mail_chats_user_not_don_error");default:return M.getLang("mail_send_privacy_error")}}(e,t,o),_=function(e,t){var a;return 62===(null==(a=(0,f.getTab)(t,e))?void 0:a.block_error)}(t,e),g=r.querySelector('[data-type="renewSubscriptionButton"]');if(_&&(null==r||r.classList.add(We),!g)){var m=document.createElement("button");m.textContent=M.getLang("mail_renew_subscription"),m.classList.add("flat_button"),m.dataset.type=Ke,m.onclick=()=>(0,H.showDonutSubscribePopup)(null,null,o.ownerId,"im",{type:"subscribe",params:{act:"subscribe_popup"}}),r.append(m)}if(g&&!_&&(null==r||r.classList.remove(We),g.remove()),(0,f.isChannelPeer)(o)&&(0,c.addClass)((0,c.geByClass1)("_im_page_history"),"is_channel"),(0,F.isBusinessNotifyTab)(o)&&(null==r||r.classList.add("im-chat-input--business-notify")),(0,h.isFvkcomgroup)(e,t)&&!e.get().gid){(0,c.addClass)(i,"is-f-vkcomgroup");var p=(0,u.inArray)(t,e.get().mutedPeers);d=(0,f.isChatActive)(o)?(0,u.getTemplate)("sImPeerMuteUnmute",{text:p?M.getLang("mail_im_unmute"):M.getLang("mail_im_mute"),type:p?"unmute":"mute"}):(0,u.getTemplate)("sImPeerReturnToChat",{text:M.getLang("mail_return_to_vkcomgroup")})}else(0,c.removeClass)(i,"is-f-vkcomgroup");return(0,c.val)(n,d),!0}!l&&(null==r?void 0:r.classList.contains(We))&&(null==r||r.classList.remove(We),null==r||null==(s=r.querySelector('[data-type="renewSubscriptionButton"]'))||s.remove());return o&&(0,h.tabIsMessageRequest)(o)&&!(0,h.tabIsRejectedMessageRequest)(o)&&!(0,j.partConfigEnabled)("simplified_start_conversation")?(Ge(a,i),(0,c.addClass)(i,"is-message_request"),(0,c.val)(n,(0,u.getTemplate)("sImPeerAcceptOrRejectMessageRequest",{cls_accept:Z,cls_reject:X})),!0):(i.classList.contains("is-message_request")&&(Ve(a,i),(0,c.removeClass)(i,"is-message_request"),(0,c.val)(n,"")),a.disabled&&((0,c.removeClass)(i,"is-f-vkcomgroup"),(0,c.removeClass)((0,c.geByClass1)("_im_page_history"),"is_channel"),Ve(a,i),(0,c.removeClass)(i,"is-message_request"),(0,c.val)(n,"")),!1)}function $e(e,t,a){return Promise.resolve().then((()=>{var s=null!=a?a:Emoji.val((0,c.geByClass1)("_im_text",t));if((0,u.trim)(s))return!(0,f.isAnyMessageBeingEdited)(e)||!(0,h.isMessageTooLong)(s);var i=ge(e),n=(0,h.getNowEditingMessage)(e);return i.hasAttaches()&&!i.hasOnlyReplies(n)}))}function ze(e,t,a){var s=(0,c.geByClass1)("_im_send",t.parentNode);ie(s,{fasthide:!0}),Promise.all([$e(e,t,a),(0,h.isVoiceMessageAvailable)(e)]).then((t=>{var a=t[0],i=t[1];if((0,f.isAnyMessageBeingEdited)(e))(0,c.toggleClass)(s,"is_input_empty",!a),(0,c.attr)(s,"aria-label",M.getLang("mail_im_edit"));else{(0,c.toggleClass)(s,"im-send-btn_audio",!a&&i),(0,c.toggleClass)(s,"im-send-btn_send",a),a&&(0,c.removeClass)(s,"im-send-btn_saudio");var n=a?M.getLang("mail_send2"):M.getLang("mail_added_audiomsg");(0,c.attr)(s,"aria-label",n)}}))}function Ze(e){var t=(0,c.geByClass1)(ee,e);t.classList.contains(te)||t.classList.add(te)}function Xe(e,t,a){var s=(0,F.getCurrentTab)(e);if(s){if(!K.Ranges.isChatOrChannelPeer(s.peerId)||(0,f.isChannelPeer)(s))return Ze(t);var i=(a.match(B.MASS_MENTION_REGEXP)||[]).map((e=>e.slice(1)));if(0===i.length)return Ze(t),void e.set((e=>(s.dontReopenWarningForCurrentMassMention=!1,Promise.resolve(e))));var n=(0,c.geByClass1)(ee,t),r=(0,c.geByClass1)("MassMentionWarning__title",n),o=(0,c.geByClass1)("MassMentionWarning__text",n),l=(e,t)=>{s.dontReopenWarningForCurrentMassMention||(r.innerHTML!==e&&(r.innerHTML=e),o.innerHTML!==t&&(o.innerHTML=t),n.classList.remove(te))},d=B.MASS_MENTION_ALIASES.all.some((e=>i.includes(e))),u=B.MASS_MENTION_ALIASES.online.some((e=>i.includes(e)));switch(!0){case d&&s.membersCount>=11:return l(M.getLang("mail_im_mass_mention_warning_title"),M.getLang("mail_im_mass_mention_warning_many_people_mentioned_text",s.membersCount-1));case u&&s.membersCount>=30:return l(M.getLang("mail_im_mass_mention_warning_title"),M.getLang("mail_im_mass_mention_warning_maybe_many_people_mentioned_text"));default:return Ze(t)}}}function Qe(e){var t=e.get().mediaTypes||[["photo",M.getLang("mail_added_photo")],["video",M.getLang("profile_wall_video")],["audio",M.getLang("profile_wall_audio")],["doc",M.getLang("profile_wall_doc")],["map",M.getLang("profile_wall_map")],["gift",M.getLang("profile_wall_gift")]];return(e.get().moneyTransferAvail||e.get().moneyRequestAvail)&&t.push(["money",M.getLang("profile_wall_money")]),function(e,t){var a=t.get().mediaTypesServiceAB||[],s=a[0],i=a[1];if(!s&&!i)return e;var n=s<=i?[s,i+1]:[s,i];s=n[0],i=n[1];var r=e.findIndex((e=>"app_action_mini_apps"===e[0])),o=e.splice(r,2)[0].slice(1);return e.splice(s,0,[ae,...o]),e.splice(i,0,[se,...o]),e}(t,e)}function Je(e,t,a,s,r){cur.share_timehash=t.get().share_timehash;var l=(0,E.createMutations)(Fe),d=l.callMutations,v=l.bindMutations,b=(0,L.mount)(e,t,d),w=ve.bind(null,t);ls.remove("im_send_queue_2"+vk.id),ls.remove("im_send_queue_1"+vk.id);var C=(0,y.initQueue)(w,fe.bind(null,t),{store:!0,key:"im_send_queue_"+vk.id,waitCommit:!0}),S=C.pushMessage,T=C.inspectQueue,A=C.resend,R=C.resendAll,x=C.resendPeer,B=C.setErrored,H=C.complete,q=re.bind(null,t,r,S,d,e),G=re.bind(null,t,r,S,d,e),V=qe.bind(null,t);(0,c.hide)((0,c.geByClass1)("ms_items_more_helper",e));var z,ee=Qe(t),te=new window.MediaSelector((0,c.geByClass1)("_im_media_selector",e),J,ee,{from:"message",maxShown:0,vectorIcon:!0,ignoreMobile:!0,onAddMediaChange:function(a,s,i,n){return a&&d().toggleKeyboard(!0),function(e,t,a,s,i,n,r,o,l){if(!t.get().removingMedias){if("album"===i||"page"===i||"mail"===i||"reply"===i)return!1;if("share"===i&&!r.title)return!1;var d,c;n&&"string"==typeof i?(o&&ge(t).addBindUrl(o,i,n),ge(t).addAttach(i,n,r)):(ge(t).syncWithSelector(l),"number"==typeof n&&l.chosenMedias[n]&&(d=l.chosenMedias[n],c=ge(t),("string"==typeof d[0]&&"string"==typeof d[1]&&d[1]||"string"==typeof d[0]&&"group"===d[0])&&c.dData.cancelled.push(`${d[0]},${d[1]}`)));var u=e().updateScroll();if(e().scrollFix(t,t.get().peer,u),t.get().delayed_message&&!(0,p.isAnythingLoading)(t.get()))return a([]),!1;ze(t,s)}}(r,t,z,e,a,s,i,n,te)},onMediaChange:function(){return function(e,t,a,s,i){if(!t.get().removingMedias){var n=i.getMedias().find((e=>"poll"===e[0]));n&&ge(t).addAttach(n[0],n[1],i.pollData(!0,!0)),ze(t,s)}}(0,t,0,e,te)},editable:1,onChangedSize:function(){var a,s,i=r().updateScroll();r().scrollFix(t,t.get().peer,i),a=e,s=(0,c.ge)(J).offsetHeight,(0,c.toggleClass)(a,"im-chat-input--overflowed",s>400)},sortable:1,teWidth:150,mail:1,teHeight:100,toId:t.get().gid?-t.get().gid:void 0,blockPersonal:t.get().gid?1:0,docParams:t.get().gid?{imhash:t.get().upload_doc_opts.opts.imhash,from:"from_gim"}:{}});z=pe.bind(null,t,r,S,e,d,te);var ae=ye.bind(null,t,e),se=(0,c.geByClass1)("_im_send",e),le=(0,h.isCommunityInterface)(t)?null:(0,_.mount)(e,t,re.bind(null,t,r,S,d,e),(()=>{(0,c.addClass)(se,"im-send-btn_audio"),(0,c.removeClass)(se,"im-send-btn_static")}),(()=>{d().restoreKeyboard()}));!function(e,t){var a=(0,c.geByClass1)("_im_text",e);(window.Wall?Promise.resolve():window.stManager.add(["page.js"])).then((function(){Wall.initComposer(a,{lang:{introText:M.getLang("profile_mention_start_typing"),noResult:M.getLang("profile_mention_not_found")},toup:!0,getValue:()=>K.Ranges.isChatOrChannelPeer(t.get().peer)?(window.Emoji&&Emoji.editableVal||c.val)(a):"",onShow:()=>{(0,c.addClass)(e,"im_mention_shown");var t=data(a,"composer");if(t&&t.wdd&&t.wdd.shown){var s=0,i=!1,n=function(){t.ignoredTerm=t.curTerm,t.curTerm=!1,(0,c.val)(t.wddInput,""),Composer.toggleSelectList(t)};(0,u.each)(t.wdd.shown,(function(){this[0]&&(s++,"@"+t.curTerm==this[2]&&(i=!0))})),!s||i&&1==s?n():(0,o.cancelStackPush)("im_mention",n)}},onHide:()=>{(0,c.removeClass)(e,"im_mention_shown"),(0,o.cancelStackFilter)("im_mention")},searchKeys:[1,7,9],wddOpts:{}})}))}(e,t),t.get().textMediaSelector=te,t.set(p.initTextStore.bind(null,T,A,B,H));var ce=(0,c.geByClass1)("_im_text",e);setTimeout((()=>{(0,U.getPeer)(t)&&d().setDraft(t,(0,f.getTabDraft)((0,F.getCurrentTab)(t))),be(t,e,te,z,q,G,b,r,d),d().updateMediaSelectorOptions(t)}),0);var ue=Ie.bind(null,t,e,r),_e=Me.bind(null,t,ce,(()=>{var e=r().updateScroll();r().scrollFix(t,(0,U.getPeer)(t),e)})),he=ke.bind(null,t,a,s),Ee=Le.bind(null,t,e,r),Te=Pe.bind(null,t,e,r),Ae=de.bind(null,t);Ye(t,t.get().peer,ce);var Re=e.querySelector("._im_keyboard_button"),De=(0,g.mount)(t,e,me.bind(null,t,r,S,e,d),d),xe=(0,h.isCommunityInterface)(t)?(0,m.mount)(t,e.querySelector("._message_templates_container"),(e=>(0,O.setHTML)(ce,e)),(t=>(0,c.toggleClass)(e,"im-chat-input--textarea_show-templates",t))):null,Oe=(0,E.createModule)({handlers:(a,s)=>{a(se,"click",(()=>{Ze(e),Promise.resolve().then((()=>$e(t,e))).then(function(){var e=(0,n.default)(i.mark((function e(a){var s,n,r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a&&!(0,f.isAnyMessageBeingEdited)(t)){e.next=14;break}if(s=void 0,n=t.get().peer,!(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,D.isMarusiaPeer)(n)){e.next=11;break}return s={communication_type:W.CommunicationType.text,voice_assistant:{support_process_commands_by_ids:!0}},e.next=7,(0,Y.loadMarusiaSdk)();case 7:if(!(r=e.sent)||r.canSentMessage()){e.next=11;break}return r.onClick(),e.abrupt("return");case 11:z([],s),e.next=15;break;case 14:(0,D.isMarusiaPeer)(t.get().peer)?(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Y.loadMarusiaSdk)().then((e=>{e&&e.onClick()})):(0,h.isVoiceMessageAvailable)(t).then((e=>{if(e){var a=ge(t);oe(a)&&Se(a),ie(se,{fasthide:!0}),null==le||le.start(),setTimeout((()=>(0,c.removeClass)(se,"im-send-btn_saudio")),300)}}));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),a(se,"mouseover",ae),a(ce,"focus",(()=>{t.get().longpoll.push([(0,N.transitionEvent)("message")]),cur.focused=t.get().peer})),a(ce,"blur",(()=>{var e=0===t.get().peer?"search":"default";t.get().longpoll.push([(0,N.transitionEvent)(e)]),cur.focused=!1})),a(Re,"click",(()=>d().toggleKeyboard(void 0))),a(Re,"mouseover",(()=>{(0,I.showTooltip)(Re,{text(){var e=(0,f.getCurrentKeyboard)(t);return!e||e.hide?M.getLang("mail_show_keyboard"):M.getLang("mail_hide_keyboard")},black:!0,shift:[4,5]})})),a((0,c.geByClass1)("MassMentionWarning__close"),"click",(()=>{!function(e,t){Ze(t),e.set((e=>((0,F.getCurrentTab)(e).dontReopenWarningForCurrentMassMention=!0,Promise.resolve(e))))}(t,e),we(ce)})),s(e.parentNode,"click","_im_peer_mute_unmute",Ee),s(e.parentNode,"click","_im_peer_return_to_chat",Te),s(e.parentNode,"click","_im_remove_replied",ue),s(e.parentNode,"click",Z,_e),s(e.parentNode,"click",X,he),s(e,"click","_im_fwd_close",ue),s(e,"click","_im_will_fwd",V),s(e,"keydown","_im_text",(e=>function(e,t,a,s){if(38===s.which&&a().isEmpty(e)&&!t().getEditingMessage()&&!Emoji.shown&&!(0,k.hasAccessibilityMode)()&&!(0,p.isAnythingLoading)(e.get())){var i=(0,P.findLastMessageToEdit)(e,(0,F.getCurrentTab)(e));if(i){if((0,D.isMarusiaPeer)(e.get().peer))return;t().startEditing((0,f.getMessage)(e,e.get().peer,i))}}}(t,r,d,e))),s(document.body,"click",Q,Ae)}}),Be=v(t,te,ce,e,z,r,T,b,Oe,le,Re,De,xe,S,R,x);return Be.initKeyboard(),(0,j.partConfigEnabled)("marusya_web_support_proccess_commands")&&(0,Y.loadMarusiaSdk)().then((a=>{a&&(a.on(W.MarusiaEvent.PHRASE_START,(e=>{(0,D.isMarusiaPeer)(t.get().peer)&&(Ce(ce,e),(0,$.disableMarusiaTextInput)(ce))})),a.on(W.MarusiaEvent.PHRASE_UPDATE,(e=>{(0,D.isMarusiaPeer)(t.get().peer)&&Ce(ce,e)})),a.on(W.MarusiaEvent.PHRASE_FINISH,(a=>{(0,D.isMarusiaPeer)(t.get().peer)&&(Ce(ce,a),a&&pe(t,r,S,e,d,te,void 0,{communication_type:W.CommunicationType.button,voice_assistant:{support_process_commands_by_ids:!0}}),(0,$.enableMarusiaTextInput)(ce))})),a.on(W.MarusiaEvent.ERROR,(()=>{(0,D.isMarusiaPeer)(t.get().peer)&&(Ce(ce,void 0),(0,$.enableMarusiaTextInput)(ce))})),a.on(W.MarusiaEvent.SUGGEST_UPDATE,(()=>{if((0,h.isClassicInterface)(t)){var e=r().updateScroll();r().scrollFix(t,t.get().peer,e)}else r().scrollBottom()})),a.on(W.MarusiaEvent.SUGGEST_CLICK,(e=>{ne(S,$.MARUSIA_PEER_ID,{message:e,payload:JSON.stringify({communication_type:W.CommunicationType.suggest,voice_assistant:{support_process_commands_by_ids:!0}}),attaches:[]},t,r,d)})))})),Be}},206182:(e,t,a)=>{"use strict";a.d(t,{mount:()=>A});var s=a(722122),i=a(610124),n=a(70162),r=a(146143),o=a(873589),l=a(384032),d=a(284863),c=a(661711),u=a(640157),_=a(820929),g=a(342269),m=a(290846),p=a(327125),h=a(163612),v=a(844142),f="_im_top_banner_hide",b="_im_top_banner_reject_mr",y="_im_top_banner_business_notify",w="_im_top_banner_friend_add",C="_im_top_banner_button_gifts",E="hiddenCallBanners";function S(e){return!e.children.length}function T(e,t,a){void 0===a&&(a={});var s=(0,o.geByClass1)("_im_dialog_actions",e);(0,o.toggleClass)(s,"im-page--chat-header_top-banner",t),(0,o.toggleClass)(s,"im-page--chat-header_top-banner--mr",!!a.messageRequest),(0,o.toggleClass)(s,"im-page--chat-header_top-banner--business-notify",!!a.businessNotify),(0,o.toggleClass)(s,"im-page--chat-header_top-banner--spam",!!a.spam)}function I(e,t){var a=(0,o.geByClass1)(f,e);a&&window.tooltips&&tooltips.hide(a),T(e,!1),t.innerHTML=""}function M(e,t,a){var s=t.participants,i=s.count>0?(0,n.langNumeric)(s.count,n.getLang("mail_im_n_chat_members","raw")):"";return(0,g.getTemplate)("sImCallBannerContent",{user_list:(0,h.renderCallUserList)(e,s.list),title:n.getLang("calls_group_call_banner_title"),desc:i,cls:a?"CallBanner--classic":""})}function k(e){var t=e.peerId;if(v.Ranges.isChatOrChannelPeer(e.peerId)&&!(0,d.isChatActive)(e))return!1;var a=e.callInProgress,s=cur.imDb.selectByKey(E);return s?!(!a||s[t]&&s[t]===a.join_link):!!a}function A(e,t,a){var h=(0,o.geByClass1)("_im_top_banner",e),v=(0,i.createModule)({handlers:(i,u)=>{var _=(0,o.geByClass1)("_im_dialog_actions",e);u(e,"click",f,(()=>{var i=t.get().peer,n=(0,d.getTab)(t,i);k(n)?function(e){var t=e.peerId,a=e.callInProgress,i=cur.imDb.selectByKey(E)||{};cur.imDb.updateByKey(E,(0,s.default)({},i,{[t]:a.join_link}))}(n):t.set((e=>(0,l.hideTopBannerAction)(i,e))),I(e,h);var r=!!(0,c.renderPinnedMessage)(t);(0,c.compensateHistoryHeightChange)(t,r,!0,a)})),u(e,"click","_im_top_banner_button",(s=>{var i=function(e,t,a,s,i){var n=e.target,o=t.get().peer;if(n.classList.contains("_im_call_banner_join_btn")){var d=n.dataset.link;return(0,c.joinCallFromIm)(t,o,d,!1,c.CALL_ENTRY_POINT_JOIN_BANNER),!1}var u=n.dataset.payload;return u?(t.set((e=>(0,l.callbackTopBannerAction)(o,u,e))),I(a,s),!0):(n.classList.contains(b)&&(i().showMessageRequestRejectDialog(t),e.originalEvent.preventDefault()),n.classList.contains(w),n.classList.contains(y)&&(i().showBusinessNotifyDialog(),e.originalEvent.preventDefault()),n.classList.contains(C)&&((0,r.showBox)("al_gifts.php",{act:"get_gift_box",mid:o,ref:"im_birthday_banner"},{stat:["gifts.css","wide_dd.js","wide_dd.css"]}),(0,p.statlogsValueEvent)("gifts_im_birthday_banner","click",o),e.originalEvent.preventDefault()),!1)}(s,t,e,h,a),n=!i,o=!!(0,c.renderPinnedMessage)(t)||!i;(0,c.compensateHistoryHeightChange)(t,o,n,a)})),u(_,"mouseover",f,((e,t)=>{(0,m.showTooltip)(t,{text:n.getLang("mail_top_banner_hide"),black:1,shift:[8,4],appendEl:document.body})}))}});return{renderPeer(t){var s=(0,d.getTab)(t,t.get().peer);if(s){var i=s.top_banner,n=s.callInProgress,r=!S(h),o=k(s);!o&&!i||(0,d.isSearchShown)(t)?r&&I(e,h):(T(e,!0,{messageRequest:i&&"message_request_banner"===i.name,businessNotify:i&&"business_notify_banner"===i.name,spam:i&&"spam_dialog"===i.name}),h.innerHTML=o?function(e,t){return(0,g.getTemplate)("im_top_banner",{text:M(e,t,(0,d.isClassicInterface)(e)),icon:"",buttons:[(0,g.getTemplate)("sImCallBannerButton",{call_link:t.join_link}),(0,g.getTemplate)("im_top_banner_hide_btn",{})].join(""),classes:"im-top-banner_call"})}(t,n):function(e){var t=e.icon?(0,g.getTemplate)("im_top_banner_icon",{icon:e.icon}):"",a=e.text;"employees_banner"===e.name&&(a=(0,_.replaceHyperLinks)(a,(e=>(0,_.linksReplacer)(e))),a=(0,u.replaceMentions)(a));var s=(e.buttons||[]).map((e=>{var t="";switch(e.layout){case"tertiary":t="im-top-banner--button-tertiary";break;case"secondary":t="secondary";break;default:t="blue_button"}switch(e.type){case"link":return(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"reject_mr":return t+=" _im_top_banner_reject_mr",(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"business_notify":return t+=" _im_top_banner_business_notify",(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"spam":return t+=" _im_top_banner_spam",(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"gifts_link":return t+=` ${C}`,(0,g.getTemplate)("im_top_banner_button_link",{link:e.link,text:e.text,css_class:t});case"friend_add":return t+=" _im_top_banner_friend_add",(0,g.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t});default:return(0,g.getTemplate)("im_top_banner_button",{callback_data:e.callback_data,text:e.text,css_class:t})}}));return!1!==e.can_hide&&(s=s.concat([(0,g.getTemplate)("im_top_banner_hide_btn",{})])),(0,g.getTemplate)("im_top_banner",{text:a,icon:t,buttons:s.join(""),classes:{message_request_banner:"im-top-banner--mr",business_notify_banner:"im-top-banner--business-notify",spam_dialog:"im-top-banner--spam"}[e.name]})}(i),i&&"birthday"===i.name&&(0,p.statlogsValueEvent)("gifts_im_birthday_banner","view",t.get().peer));var l=!S(h);(0,c.compensateHistoryHeightChange)(t,l,r,a)}},unmount(){(0,i.destroyModule)(v)}}}},924995:(e,t,a)=>{"use strict";a.d(t,{mount:()=>A});var s=a(146143),i=a(226323),n=a(798262),r=a(520820),o=a(152278),l=a(342269),d=a(873589),c=a(70162),u=a(610124),_=a(256152),g=a(384032),m=a(826338),p=a(506770),h="_im_upload_dropbox",v="jpg jpeg png gif heic heif".split(" "),f=["application/vnd.rn-realmedia-vbr","application/vnd.rn-realmedia"];function b(e){var t=v.slice(0,v.length);if("types"===e){for(var a=t.length,s=0;s<a;++s)t.push(t[s].toUpperCase());return"*."+t.join(";*.")}return"accept"===e?"."+v.join(",."):"mask"===e?v.join("|"):""}function y(e,t,a){var n=void 0!==t.ind?t.ind:t,r=t.fileName?n+"_"+t.fileName:t;if((0,d.re)("upload"+r+"_progress_wrap"),e().unchoose(r),!(0,d.geByClass1)("popup_box_container")){var o=c.getLang("mail_add_doc_error");"wrong_music_file"===a?o=c.getLang("mail_upload_music_fail"):"wrong_arch_file"===a||"wrong_arch_mp3_file"===a?o=c.getLang("mail_upload_arch_fail"):"photo"===Upload.options[n].file_name?o=c.getLang("mail_add_photo_error"):"video_file"===Upload.options[n].file_name?o=c.getLang("video_upload_error"):"wrong_mp3_file"===a&&(o=c.getLang("docs_upload_mp3_fail")),setTimeout((0,s.showFastBox)({title:c.getLang("global_error")},o).hide,2e3)}(0,i.topError)("Upload failed",{dt:-1,type:102,url:((0,d.ge)("file_uploader_form"+n)||{}).action}),Upload.embed(n)}function w(e){var t=void 0!==e.ind?e.ind:e,a=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),s=a?t+"_"+a:e,i=(0,d.ge)("upload"+s+"_progress_wrap");return i&&(0,d.hide)((0,d.geByClass1)("progress_x",i)),s}function C(e,t){if(!e().canAddMedia())return"none";if(!t.items||!t.items.length)return"media";var a="^("+b("mask")+")";return[].slice.call(t.items).every((e=>{var t=e.type.split("/");return new RegExp(a,"i").test(t[1])}))?"photo":[].slice.call(t.items).every((e=>"video"===e.type.split("/")[0]||~f.indexOf(e.type)))?"video":"doc"}function E(e){var t=(0,d.geByClass1)(h),a=(0,d.geByClass1)("im-page--chat-header").getBoundingClientRect(),s=(0,d.geByClass1)("im-chat-input").getBoundingClientRect();(a.width<10||s.bottom-a.bottom<10)&&(e="none"),t.style.top=a.bottom+"px",t.style.left=a.left+1+"px",t.style.width=a.width-2+"px",t.style.height=s.bottom-a.bottom+"px",t.setAttribute("data-mode",e),"none"!==e&&t.classList.add("im-dropbox--visible")}function S(){(0,d.geByClass1)(h).classList.remove("im-dropbox--visible")}function T(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}function I(e,t,a,s){"string"==typeof t&&t.indexOf("TERMINATED")>-1||(t=JSON.parse(t),Upload.onUploadError(e,t.error)),s().reHeight(a)}function M(e,t,a,s,i){var o=t.get().upload_opts,c=(0,d.geByClass1)("_im_upload_photo",i),u=(0,d.geByClass1)("_im_drop_photo",i);return Upload.init(c,o.url,o.params,{accept:b("accept"),file_name:"photo",file_size_limit:26214400,file_types:b("types"),file_match:o.opts.ext_re,lang:o.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"photo",max_attempts:3,server:o.opts.server,error:o.opts.default_error,error_hash:o.opts.error_hash,dropbox:u,dragEl:document.body,onNoFilteredCallback(e){Upload.onFileApiSend(s,e)},onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,s){var i=(0,r.parseJSON)(s);i.photos?function(e,t,a,s){var i=w(e);ajax.post("al_photos.php",(0,l.extend)({act:"choose_uploaded"},t),{onDone:function(e,t){s().choose("photo",e,(0,l.extend)(t,{upload_ind:i}))},onFail:y.bind(null,s,e)})}(e,i,0,a):I(e,s,t,a)},onUploadProgress(e,t,s){var i=void 0!==e.ind?e.ind:e;a().progress("photo",i,T(e,t,s))},onUploadError(e,t){(0,n.statlogsValueEvent)("upload_photo_fails",1,o.opts.server,t),y(a,e,t)},onDragEnter(e){if(!(0,p.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,m.isMarusiaPeer)(t.get().peer)){var s=(0,d.geByClass1)("im-audio-message_recording");e.dataTransfer&&!s&&E(C(a,e.dataTransfer))}},onDragOut(){S()},onDrop(){S()}})}function k(e,t,a,s){var i=t.get().upload_doc_opts,o=(0,d.geByClass1)("_im_upload_doc",s),c=(0,d.geByClass1)("_im_drop_doc",s);return Upload.init(o,i.url,i.params,{file_name:"file",file_size_limit:1024*(parseInt(i.opts.file_size_limit_in_MB)||2048)*1024,file_types:"*.*;",lang:i.opts.lang,multiple:1,multi_progress:1,max_files:10,chooseBox:1,clear:1,type:"doc",max_attempts:3,server:i.opts.server,error:i.opts.default_error,error_hash:i.opts.error_hash,dropbox:c,dragEl:document.body,onUploadStart(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete(e,s){var n=(0,r.parseJSON)(s);n.file?function(e,t,a,s){var i=w(e),n={act:"a_save_doc",blockPersonal:1,from:"choose",mail_add:1};a.opts.imhash&&(n=(0,l.extend)(n,{from_place:"from_gim",imhash:a.opts.imhash})),ajax.post("docs.php",(0,l.extend)(n,t),{onDone:function(e,t,a){s().choose("doc",e+"_"+t,(0,l.extend)(a,{upload_ind:i}))},onFail:y.bind(null,s,e)})}(e,n,i,a):I(e,s,t,a)},onUploadProgress(e,t,s){var i=void 0!==e.ind?e.ind:e;a().progress("doc",i,T(e,t,s))},onUploadError(e,t){(0,n.statlogsValueEvent)("upload_doc_fails",1,i.opts.server,t),y(a,e,t)}})}function A(e,t,a){(0,o.removeEvent)(document.body,"dragover dragenter");var i=(0,d.geByClass1)(h),l=k(0,t,a,i),v=function(e,t,a,s,i){var o=t.get().upload_video_params;if(o){var l=(0,d.geByClass1)("_im_upload_video",i),c=(0,d.geByClass1)("_im_drop_video",i);return o.options.visible_dropbox=!1,(0,_.getUploadModule)(l,c,o,null,{onUploadStart:function(e,t){delete cur.notStarted,this.onUploadProgress(e,0,0)},onUploadComplete:function(e,s){var i=(0,r.parseJSON)(s);i.video_id?(0,_.onVideoUploaded)(e,i,t.get().textMediaSelector,((e,a)=>{var s=document.querySelector('[data-video="'+a+'"]'),i=e.editable.sizes.x[0]||e.thumb;if(s&&i){s.style.backgroundImage=`url(${i})`;var n=(0,d.gpeByClass)("_im_mess",s);"im"===cur.module&&n&&(0,g.updateVideoThumb)(t,n)}})):I(e,s,t,a)},onUploadProgress:function(e,t,s){var i=void 0!==e.ind?e.ind:e;a().progress("video",i,T(e,t,s))},onUploadError:function(e,t){(0,n.statlogsValueEvent)("upload_video_fails",1,o.options.server,t),y(a,e,t)},onNoFilteredCallback:function(e){Upload.onFileApiSend(s,e)},onDragEnter:function(e){if(!(0,p.partConfigEnabled)("marusya_web_support_proccess_commands")||!(0,m.isMarusiaPeer)(t.get().peer)){var s=(0,d.geByClass1)("im-audio-message_recording");e.dataTransfer&&!s&&E(C(a,e.dataTransfer))}},onDragOut:function(){S()},onDrop:function(){S()}})}}(0,t,a,l,i),f=M(0,t,a,v,i);cur.lang.attachments_limit=t.get().upload_opts.opts.lang.max_files_warning;var w=(0,u.createModule)({handlers:e=>{var t=(0,d.ge)("im_full_upload");e(t,"change",(function i(n){if(window.Upload&&n.target.files){if(a().canAddMedia()){var r=Array.from(n.target.files),o=r.filter((e=>Upload.checkFileType(e.name,b("types")))),l=r.filter((e=>Upload.checkFileType(e.name,(0,_.getUploadVideoExtMasks)("types"))));Upload.onFileApiSend(f,o),Upload.onFileApiSend(v,l)}else(0,s.showFastBox)(c.getLang("global_error"),c.getLang("global_error"));(0,u.destroyModule)(w);var d=t.cloneNode();d.value="",t.parentNode.replaceChild(d,t),e(t=d,"change",i)}}))}});return{paste(e){Upload.onFileApiSend(f,e)},unmount(){(0,u.destroyModule)(w),Upload.deinit(f),Upload.deinit(v),Upload.deinit(l)}}}},54233:(e,t,a)=>{"use strict";a.d(t,{mount:()=>f});var s=a(290846),i=a(733164),n=a(342269),r=a(873589),o=a(70162),l=a(384032),d=a(610124),c="_ui_multiselect_cancel";function u(e,t){return t.selection||(t.selection=[]),t.selection.push(e),Promise.resolve(t)}function _(e){return e.selection=[],Promise.resolve(e)}function g(e,t){return t.selection=t.selection.filter((t=>t.id!==e)),Promise.resolve(t)}function m(e,t,a,s,i,o,l){var d=(0,n.intval)((0,r.domData)(l,"peer"));tooltips.hide(l),t.set(g.bind(null,d)).then((n=>{h(e,s,t,i),a().selectionDeleted(t,d)}))}function p(e,t,a,s){e.set(l.setCurrentSearch.bind(null,a,!1)).then(t().onChange)}function h(e,t,a,s){var n=a.get().selection,l=uiSearch.getFieldEl(e);uiSearch.focus(e),n.length>0?(0,r.attr)(l,"placeholder",""):(0,r.attr)(l,"placeholder",(0,i.unclean)(o.getLang("mail_search_creation"))),t.innerHTML=n.map((e=>['<div class="token">',`<div class="token_title">${e.name}</div>`,`<div data-peer="${e.id}" class="token_del ${c}"></div>`,"</div>"])).reduce(((e,t)=>e.concat(t)),[]).join(""),(0,r.toggleClass)(e,"ui_multiselect_has_selection",n.length>0),(0,r.domFC)(e).scrollTop+=50,s()}function v(e,t){return(0,s.showTooltip)(t,{text:o.getLang("mail_create_chat_remove_user"),black:1,shift:[15,8],appendParentCls:"_wrap"})}function f(e,t,a){uiSearch.init(e,{onChange:p.bind(null,t,a)});var s=uiSearch.getFieldEl(e),i=(0,r.ce)("div",{className:"_ui_multiselection ui_multiselect_cnt"});s&&s.parentNode.insertBefore(i,s);var n,o,l=(n=s,o=0,function(){var e=n.offsetWidth;(0,r.setStyle)(n,{width:1});var t=n.offsetLeft;o!==t?(o=t,e=n.parentNode.offsetWidth,(0,r.setStyle)(n,{width:Math.max(30,e-t-20)})):(0,r.setStyle)(n,{width:e})});t.set(_);var f=m.bind(null,e,t,a,i,l),b=t=>{document.activeElement!==s&&uiSearch.focus(e)},y=(0,d.createModule)({handlers:(t,a)=>{a(e,"click",c,f),a(e,"mouseover",c,v),t(e,"click",b)}});return{addSelection:(a,s)=>t.set(u.bind(null,{id:a,name:s})).then(h.bind(null,e,i,t,l)),removeSelection:a=>t.set(g.bind(null,a)).then(h.bind(null,e,i,t,l)),resetSelection(){!function(e,t,a,s){e.set(_).then(h.bind(null,t,a,e,s))}(t,e,i,l)},focus(){uiSearch.focus(e)},save(){t.stash(),h(e,i,t,l)},restore(){t.pop(),h(e,i,t,l)},unmount(){uiSearch.destroy(e),(0,d.destroyModule)(y)}}}},704103:(e,t,a)=>{"use strict";a.d(t,{mount:()=>M});var s=a(661711),i=a(342269),n=a(873589),r=a(67328),o=a(934103),l=a(610124);function d(e,t){return(0,r.toArray)(e).find((e=>(0,n.domData)(e,"list-id")===t))}function c(e,t){return(0,r.toArray)(e).findIndex((e=>(0,n.domData)(e,"list-id")===t))}function u(e,t,a,s){if(a){_(e,t,s);var i=(0,n.domData)(a,"list-id"),r=i&&d(t.children,i);r&&s.forEach((e=>(0,n.addClass)(r,e))),e.setState({hoveredListItemId:i})}}function _(e,t,a){var s=(0,n.domQuery)("."+a.join("."),t);s&&(0,r.toArray)(s).forEach((e=>{a.forEach((t=>(0,n.removeClass)(e,t)))})),e.setState({hoveredListItemId:null})}function g(e,t){var a=t&&(0,n.domQuery)("."+t.join("."),e)[0];return a?(0,n.domData)(a,"list-id"):null}function m(e,t,a){return e.map(t).reduce(((e,t)=>(e[t]=!0,e)),a)}function p(e,t,a){return{ids:m(a.get().elements,e,{}),scrolls:t,activated:!0}}function h(e,t,a){return a.elements=a.elements.filter((a=>t(a)!==e)),delete a.ids[e],Promise.resolve(a)}function v(e,t,a){var s=[];a.elements=a.elements.map((a=>{var i=t(a),n=e.filter((e=>t(e)===i))[0];return s.push(i),n||a}));var n=e.filter((e=>!(0,i.inArray)(t(e),s)));return a.elements=a.elements.concat(n),Promise.resolve(a)}function f(e){var t={};return e.forEach((e=>{"r"===e[0]&&t[`a,${e[1]}`]?delete t[`a,${e[1]}`]:t[`${e[0]},${e[1]}`]=e})),Object.keys(t).map((e=>t[e]))}function b(e,t,a,s,i,r,o){for(var l=0;l<s;l++)e=(0,n.domNS)(e);var d=(0,n.se)(i(t));return(0,n.domData)(d,"list-id",a),e?r.insertBefore(d,e):r.appendChild(d),o&&o(d),e}function y(e,t,a,s,i,o){void 0===o&&(o="");var l=s.get(),d=l.limit,c=l.offset,u=function(e,t){var a=t.get();return!a._sortedEls&&e&&t.setState({elements:a.elements.sort(e),_sortedEls:!0}),t.get().elements}(a().sortFn,s).slice(0,c+d),_=(0,r.toArray)(e.children).map((e=>(0,n.domData)(e,"list-id"))).filter((e=>!!e)),g=u.map((e=>a().idFn(e).toString())),m=function(e,t){for(var a=[],s=Math.max(e.length,t.length),i=0;i<s;i++){var n=e[i],r=t[i];!n&&r?a.push(["a",r,i]):n&&!r?a.push(["r",n,i]):n!==r&&(a.push(["r",n,i]),a.push(["a",r,i]))}var o=f(a),l=f(a.reverse());return o.length>l.length?l:o}(_,g);if(o&&(m=function(e,t,a,s){for(var i=0;i<t.length;i++)if(t[i]===s){-1===e.findIndex((e=>e[1]===s&&"r"===e[0]))&&e.unshift(["r",s,i]);break}for(var n=0;n<a.length;n++)if(a[n]===s){-1===e.findIndex((e=>e[1]===s&&"a"===e[0]))&&e.unshift(["a",s,n]);break}return e}(m,_,g,o)),function(e,t,a,s,i){if(0!==t.length){var r=(t=t.sort(((e,t)=>e[2]-t[2]))).filter((e=>"a"===e[0])),o=t.filter((e=>"r"===e[0]));if(o.map((t=>e.children[t[2]])).forEach((e=>(0,n.re)(e))),0!==r.length)for(var l=r.shift(),d=l[2],c=(b(e.children[d],a[l[2]],l[1],0,s,e,i),0);c<r.length;c++)l=r[c],b(e.children[d],a[l[2]],l[1],l[2]-d,s,e,i),d=l[2]}}(e,m,u,a().renderFn,a().onRenderFn),function(e,t){e.get().loading?t.update(!1,!0):(e.get().loading=!0,t.update(!1,!0),e.get().loading=!1)}(s,t),i)return m.filter((e=>"a"==e[0])).map((e=>parseInt(e[1])))}function w(e,t,a,s,i,n,r){void 0===i&&(i=!1),void 0===n&&(n=0),void 0===r&&(r=0);var o=e.get(),l=t.getContainer().children,d=c(l,s||o.hoveredListItemId);d<0||(o.limit+o.offset<d?e.setState({offset:d-o.limit+1}).then(y.bind(null,t.getContainer(),t,a)):Promise.resolve()).then((()=>{var e=l[d],a=t.scrollTop(),s=t.getScrollHeight(),o=e.offsetHeight;n="center"===n?-.5*s:n,r="center"===r?s/2:r;var c=i?function(e){t.smoothScroll(e-t.scrollTop())}:t.scrollTop.bind(t),u=a+n>e.offsetTop,_=o+e.offsetTop>a+s-r;u?c(e.offsetTop-n):_&&c(e.offsetTop-s+o+r)}))}function C(e,t){if(e.get().loading||e.get().stop||!e.get().activated)return Promise.resolve([]);e.get().loading=!0;for(var a=arguments.length,s=new Array(a>2?a-2:0),i=2;i<a;i++)s[i-2]=arguments[i];return t(...s).then((()=>{e.get().loading=!1}))}function E(e,t,a){return a.scrolls||(a.scrolls={}),a.scrolls[e]&&!t||(a.scrolls[e]={scrolled:a.scrolled||0,scrollItem:a.scrollItem}),Promise.resolve(a)}function S(e,t,a,i){var n=e.get(),r=n.elements,o=i.getContainer(),l=e.setState({offset:n.offset+n.limit}).then((()=>{var a,s=n.offset,l=n.limit;return l+s>r.length?a=t().more(s,l).then((t=>!1===t?[]:(0===t.length&&e.setState({stop:!0}),t))).then(I.bind(null,e,o,i,t,n.pipeId)):(a=Promise.resolve(),y(o,i,t,e)),a}));if(!a){var d=r.length>0?"im-preloader_fixed-bottom":"im-preloader_fixed-center";(0,s.wrapLoading)(o)(l,"bottom",d)}return l}function T(e,t){var a=e.get().pipeId;return!(void 0!==a&&void 0!==t&&a!==t)}function I(e,t,a,s,i,n){return!!T(e,i)&&e.setState(function(e,t,a){var s=e.filter((e=>!a.ids[t(e)]));return{_sortedEls:!1,els:s,ids:m(s,t,a.ids),elements:a.elements.concat(s)}}(n,s().idFn,e.get())).then(y.bind(null,t,a,s))}function M(e,t,a){var s=C.bind(null,t,S.bind(null,t,a)),n=(e,s)=>{(t.get().activated||e)&&(void 0!==s&&t.get().elements.length>0&&t.setState({scrolled:s}),a().onScroll&&a().onScroll())},f=(0,o.createScroll)(e,{noScroll:t.get().noScroll,nativeScroll:t.get().nativeScroll,scrollChange:n.bind(null,!1),more:!!a().more&&s.bind(null,!1)}),b=(0,l.createModule)({handlers:(s,i)=>{i(e,"click",t.get().elCls,a().onClick)}});return t.setState(p(a().idFn,{},t)),{pipe:(e,s)=>(t.setState({pipeId:s}),e.then(I.bind(null,t,f.getContainer(),f,a,s))),replacePreserveOrder:e=>t.set(v.bind(null,e,a().idFn)).then(y.bind(null,f.getContainer(),f,a)),pipeReplace:(e,s,i,n)=>(void 0===i&&(i=!1),void 0===n&&(n=""),t.setState({pipeId:s,stop:!1}),e.then((e=>{if(T(t,s))return t.setState({elements:e,_sortedEls:!1,ids:m(e,a().idFn,{})}).then(y.bind(null,f.getContainer(),f,a,t,i,n))}))),wipe(){f.getContainer().innerHTML=""},deactivate(){t.setState({activated:!1})},activate(){t.setState({activated:!0})},saveScroll:(e,a)=>t.set(E.bind(null,e,a)),updateScroll(){f.update(!1,!0)},toTop(e,t){void 0===t&&(t=!1),t?f.smoothScroll(-f.scrollTop()):f.scrollTop(0),e&&n(e,0)},scrollTop:e=>f.scrollTop(e),restoreScroll(e){var a=t.get().scrolls,s=a[e];return s&&(t.setState({scrolls:(0,i.extend)({},a,{[e]:null})}),f.scrollTop(s.scrolled)),!!s},unsetScroll(e){t.setState({scrolls:(0,i.extend)({},t.get().scrolls,{[e]:null})})},scrollPage(e,t){var a=f.scroll.scroller,s=f.scrollTop(),i=s+("up"===e?-1:1)*a.clientHeight;t?f.smoothScroll(i-s):f.scrollTop(i)},scrollToElement(e,s,i,n){w(t,f,a,e,s,i,n)},getScroller:()=>f.getScroller(),checkMore:e=>t.get().elements.length<t.get().limit?s(e,f):Promise.resolve([]),add:(e,s)=>I(t,f.getContainer(),f,a,s,e),hoverNextElement(e,s,i){void 0===i&&(i={});var n=f.getContainer(),o=n.children,l=c(o,t.get().hoveredListItemId||g(n,s)),d=(0,r.toArray)(o).slice(l+1).find(a().hoverableFn);u(t,n,d,e),w(t,f,a,null,!1,i.top,i.bottom)},hoverPrevElement(e,s,i){void 0===i&&(i={});var n=f.getContainer(),o=n.children,l=c(o,t.get().hoveredListItemId||g(n,s)),d=l>=0&&(0,r.toArray)(o).slice(0,l).reverse().find(a().hoverableFn);u(t,n,d,e),w(t,f,a,null,!1,i.top,i.bottom)},hoverFirstElement(e,s){var i=f.getContainer(),n=i.children,o=(0,r.toArray)(n).findIndex(a().hoverableFn),l=n[o];!t.get().hoveredListItemId&&l&&(u(t,i,l,e),w(t,f,a,o,!1,s.top,s.bottom))},hoverElement(e,s,i){var n=f.getContainer(),r=n.children,o=c(r,e),l=r[o];l&&(u(t,n,l,s),w(t,f,a,o,!1,i.top,i.bottom))},unhoverElements(e){_(t,f.getContainer(),e)},reset(){var e=t.get().scrolls;t.reset(),t.setState(p(a().idFn,e,t))},getHoveredElement:()=>d(f.getContainer().children,t.get().hoveredListItemId),getCurrentElements:()=>t.get().elements,isLoading:()=>t.get().loading,isEmpty:()=>0===t.get().elements.length,remove(e){t.set(h.bind(null,e,a().idFn)).then(y.bind(null,f.getContainer(),f,a))},unmount(){(0,l.destroyModule)(b),f.destroy()}}}},470887:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(722122),_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(342269),_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(873589),_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(152278),_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(897449),_web_lib_fx__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(631351),_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(549357),_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(769488),DATA_ATTR_SUBMENU_NAVIGABLE="data-uirmenu-submenu-navigable",uiRightMenu={go:function(e,t,a,s){if(void 0===s&&(s={}),(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__.checkEvent)(t))return!0;var i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e),n=s,r=n.navOptions,o=n.ignoreSelected,l=void 0!==o&&o,d=n.switchMenuOptions;if(!l&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",i)==e)return!1;if(uiRightMenu.switchMenu(e,void 0,d),uiRightMenu.showProgress(e),!1===a)return!1;var c={onDone:function(){for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];null==r||null==r.onDone||r.onDone(...a),uiRightMenu.hideProgress(e)}},u=(0,_babel_runtime_helpers_extends__WEBPACK_IMPORTED_MODULE_7__.default)({},r||void 0,{},c);return nav.go(a||e,t,u)},switchMenu:function(e,t,a){void 0===a&&(a={});var s=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e),i=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",s),n=a.preventSubmenuExpand,r=void 0!==n&&n;if(e==i&&!t)return!1;var o=[],l=[];if((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(s,"_ui_rmenu_auto_expand")){var d=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass)("_ui_rmenu_sublist",s),c=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"_ui_rmenu_subitem")?(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("_ui_rmenu_sublist",e):!!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domNS)(e),"_ui_rmenu_sublist")&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domNS)(e);(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(d,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(this)&&this!==c&&(o.push(this),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hide)(this))})),r||!c||(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(c)||(l.push(c),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(c)),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(o,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.show)(this)})),(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(l,(function(){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hide)(this)}))}return(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(i,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(e,"ui_rmenu_item_sel"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(s,"_ui_rmenu_auto_expand")?(0,_web_lib_utils_common__WEBPACK_IMPORTED_MODULE_0__.each)(o.concat(l),(function(){uiRightMenu.toggleSubmenu(this)})):(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"_ui_rmenu_subitem")&&!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(e))&&uiRightMenu.toggleSubmenu((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domPN)(e)),!1},unselectAll:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(e,"ui_rmenu_sliding"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",e),"ui_rmenu_item_sel")},isSelectedItem:e=>e.classList.contains("ui_rmenu_item_sel"),showProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e));var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_loading_item",e);t&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(t,"ui_rmenu_loading_item");var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_item_sel",e);(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.hideProgress)(e),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.showProgress)((0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domFC)(a).parentNode,"","",!1),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(e,"ui_rmenu_loading"),(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.addClass)(a,"ui_rmenu_loading_item")},hideProgress:function(e){(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.hasClass)(e,"ui_rmenu")||(e=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e)),(0,_web_lib_ui__WEBPACK_IMPORTED_MODULE_3__.hideProgress)(e);var t=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",e);(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(e,"ui_rmenu_loading");var a=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("ui_rmenu_loading_item",t);a&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.removeClass)(a,"ui_rmenu_loading_item")},toggleSubmenu:function toggleSubmenu(name,ref,event){if(!event||!(0,_web_lib_dom_events__WEBPACK_IMPORTED_MODULE_2__.checkEvent)(event)){var isSubmenuNavigatedResult=toggleSubmenuNavigable(ref);if(isSubmenuNavigatedResult.navigated)return isSubmenuNavigatedResult.navGoResult;var menu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.gpeByClass)("ui_rmenu",ref),el,submenu;if("string"==typeof name?submenu=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_ui_rmenu_"+name+"_list",menu):(submenu=name,name=submenu.getAttribute("data-sublist-id")),el=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.geByClass1)("_ui_rmenu_"+name+"_toggle",menu),!submenu)return!1;el&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.toggleClass)(el,"ui_rmenu_item_expanded",!(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.isVisible)(submenu)),(0,_web_lib_fx__WEBPACK_IMPORTED_MODULE_4__.slideToggle)(submenu,submenu&&(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.getSize)(submenu)[1]?100:0),setTimeout(_web_lib_layout_utils__WEBPACK_IMPORTED_MODULE_5__.updateNarrow,100);var onToggle=(0,_web_lib_dom__WEBPACK_IMPORTED_MODULE_1__.domData)(el,"on-toggle");return onToggle&&setTimeout((function(){try{eval(onToggle)}catch(e){(0,_web_lib_debug_tools__WEBPACK_IMPORTED_MODULE_6__.logEvalError)(e,onToggle)}}),150),!1}},selectLabelNode:e=>null==e?void 0:e.querySelector(".ui_rmenu_label-text")};function isItemSubmenuNavigable(e){return null==e||null==e.hasAttribute?void 0:e.hasAttribute(DATA_ATTR_SUBMENU_NAVIGABLE)}function toggleSubmenuNavigable(e){if(isItemSubmenuNavigable(e)&&!e.classList.contains("ui_rmenu_item_sel"))return{navigated:!0,navGoResult:uiRightMenu.go(e,void 0,void 0,{switchMenuOptions:{preventSubmenuExpand:!0}})};return{navigated:!1}}const __WEBPACK_DEFAULT_EXPORT__=uiRightMenu},80871:(e,t,a)=>{"use strict";a.d(t,{initDraggable:()=>i,removeDraggable:()=>n});var s=a(152278);function i(e,t){var a,i,n=function(s){a=void 0!==s.clientX?s.clientX:s.touches[0].clientX,i=void 0!==s.clientY?s.clientY:s.touches[0].clientY,t.onDrag&&t.onDrag.call(e,a,i)},r=function r(o){t.onDrop&&t.onDrop.call(e,a,i),(0,s.removeEvent)(document,"mouseup touchend mouseleave",r),(0,s.removeEvent)(document,"mousemove touchmove",n)},o=function(o){(1===o.which||o.touches&&o.touches[0])&&((0,s.addEvent)(document,"mouseup touchend mouseleave",r),(0,s.addEvent)(document,"mousemove touchmove",n),a=void 0!==o.clientX?o.clientX:o.touches[0].clientX,i=void 0!==o.clientY?o.clientY:o.touches[0].clientY,t.onStartDrag&&t.onStartDrag.call(e,a,i),t.onDrag&&t.onDrag.call(e,a,i),(0,s.cancelEvent)(o))};e.beginDragHandler=o,(0,s.addEvent)(e,"mousedown touchstart",o)}function n(e){(0,s.removeEvent)(e,"mousedown touchstart",e.beginDragHandler)}},936979:(e,t,a)=>{"use strict";a.d(t,{default:()=>l});var s=a(873589),i=[],n=0,r=!1;function o(e){i=i.reduce(((t,a)=>{var s=a[0],i=a[1];return i(e)?t:t.concat([[s,i]])}),[])}function l(e,t){return void 0===t&&(t=[]),n++,{stop(){n--,function(e){i=i.filter((t=>t[0]!==e)),0===n&&(document.body.removeEventListener("click",o,!0),r=!1)}(e)},replaceOrAdd(a){var n=i.filter((t=>{var a=t[0];return e===a})),l=function(e,t){return 0===t.length?t=>(e(t),!0):a=>{var i=t.reduce(((e,t)=>e&&!(0,s.domClosest)(t,a.target)),!0);return i&&e(a),i}}(a,t);n.length>0?function(e,t){i=i.map((a=>{var s=a[0],i=a[1];return s===e?[e,t]:[s,i]}))}(e,l):function(e,t){!1===r&&(r=!0,document.body.addEventListener("click",o,!0)),i=i.concat([[e,t]])}(e,l)}}}},91786:(e,t,a)=>{"use strict";a.d(t,{create:()=>c});var s=a(712439),i=a(873589),n=a(152278),r=a(661711),o=a(891326);function l(e,t){return t.state=e,Promise.resolve(t)}function d(e,t,a,s,i){switch(t){case o.ARROW_UP:(0,r.isEditableFocused)()||(s.scroll(i,"up"),(0,n.cancelEvent)(a));break;case o.ARROW_DOWN:(0,r.isEditableFocused)()||(s.scroll(i,"down"),(0,n.cancelEvent)(a));break;case o.PAGE_UP:a.ctrlKey||(0,r.isClassicInterface)(i)||(s.scroll(i,"up",!0),(0,n.cancelEvent)(a));break;case o.PAGE_DOWN:a.ctrlKey||(0,r.isClassicInterface)(i)||(s.scroll(i,"down",!0),(0,n.cancelEvent)(a));break;case o.HOME:(0,r.isEditableFocused)()||(s.scroll(i,"up",!1,!0),(0,n.cancelEvent)(a));break;case o.END_KEY:(0,r.isEditableFocused)()||(s.scroll(i,"down",!1,!0),(0,n.cancelEvent)(a));break;case o.PRINTABLE:s.focustTxt(e)}}function c(e,t,a,c,u,_){var g=(0,s.default)({state:t||"default"});return{signal(t,s){if(!(cur.storyLayer||cur.articleEditorLayer||window.isArticleLayerOpen()))switch(g.get().state){case"default":return d(g,t,s,c,e);case"fwd":case"search":return function(e,t,a,s,l,d){switch(t){case o.ARROW_DOWN:s&&s.hoverNextDialog(d),(0,n.cancelEvent)(a);break;case o.ARROW_UP:s&&s.hoverPrevDialog(d),(0,n.cancelEvent)(a);break;case o.ENTER:(0,r.isEditableFocused)()&&!(0,i.gpeByClass)("_im_dialogs_search_input",document.activeElement)||s&&s.selectHoveredDialog(d);break;case o.PRINTABLE:l.focusInput()}}(0,t,s,a,u,e);case"create":return function(e,t,a,s,l){switch(t){case o.PAGE_UP:!a.ctrlKey&&(0,r.isClassicInterface)(l)&&(s.scroll("up"),(0,n.cancelEvent)(a));break;case o.PAGE_DOWN:!a.ctrlKey&&(0,r.isClassicInterface)(l)&&(s.scroll("down"),(0,n.cancelEvent)(a));break;case o.ARROW_DOWN:s.hoverNextElement(l);break;case o.ARROW_UP:s.hoverPrevElement(l);break;case o.ENTER:(0,i.gpeByClass)("_im_dialogs_creation_name",document.activeElement)?s.confirmCreate(l):(0,i.gpeByClass)("im-create--search",document.activeElement)&&s.selectElement(l);break;case o.PRINTABLE:s.focusSearch(l)}}(0,t,s,_,e);case"message":return function(e,t,a,s,i){switch(t){case o.HOME:case o.END_KEY:s.isEmpty(i)&&d(e,t,a,s,i);break;case o.PAGE_UP:case o.PAGE_DOWN:d(e,t,a,s,i)}}(g,t,s,c,e);default:throw new Error("Unknown state: "+g.get().state)}},transition:e=>g.set(l.bind(null,e))}}},321714:(e,t,a)=>{"use strict";a.d(t,{startLongPollForGroup:()=>I,startLongPoll:()=>M});var s=a(384032),i=a(798262),n=a(342269),r=a(712439),o=a(887294),l=a(663825),d=a(511492),c=a(740066),u=a(67328),_=a(988058),g=a(384099),m={},p=Date.now();function h(e,t){var a=Math.floor(t.status/100);t.status&&e.stat&&(t.status>=500&&t.status<600&&(0,i.statlogsValueEvent)("im_longpoll",1,a+"0x",t.getResponseHeader("x-frontend")),m[a]=m[a]?m[a]+1:1,Date.now()-p>=3e4&&(Object.keys(m).forEach((e=>{(0,i.statlogsValueEvent)("im_longpoll",m[e],e+"0x",t.getResponseHeader("x-frontend"))})),m={},p=Date.now()))}function v(e,t){return Promise.resolve((0,n.extend)({},t,{timeout:e<64?2*e:e}))}function f(e,t){return Promise.resolve((0,n.extend)({},t,{imTs:e}))}function b(e){e.set((e=>Promise.resolve((0,n.extend)({},e,{stopped:!0})))).then((()=>{e.get().cancelToken()}))}function y(e,t){return t.cancelToken=e,Promise.resolve(t)}function w(e,t){return t.pauses||(t.pauses=[]),t.pauses.push(e),Promise.resolve(t)}function C(e){return e.pauses||(e.pauses=[]),(0,u.lplog)("Aborting all pauses","error"),e.pauses.forEach((e=>e())),e.pauses=[],Promise.resolve(e)}function E(e,t,a,i){var n=i.failed?(0,d.abortablePause)(4,e):{},r=n.abort,o=n.pause;switch(i.failed){case 1:return(0,u.lplog)("Old timestamp, init resync","error"),e.set(w.bind(null,r)),a([l.resyncEvent()]),e.set(s.loadLongPollTs).then(o).then(S.bind(null,e,t,a));case 2:return(0,u.lplog)("Key is incorrect","error"),e.set(w.bind(null,r)),e.set(s.loadLongPollKey).then(o).then(S.bind(null,e,t,a));case 3:throw nav.reload({force:!0}),new Error("ts is very wrong");default:return e.set(f.bind(null,i.ts)).then((()=>i))}}function S(e,t,a){if(e.get().stopped)return Promise.resolve({updates:[]});if(t())return Promise.reject(new Error("pause"));var s=e.get(),i=`${s.imUrl}/${s.imPart}`,n=(0,o.plaingetCancelable)(i,{act:"a_check",key:s.imKey,version:14,ts:s.imTs,wait:25,mode:s.mode}),r=n.request,l=n.cancel;return e.set(y.bind(null,l)).then((()=>r)).then((t=>{var a=t[0],i=t[1];return i&&h(s,i),e.set(v.bind(null,1)),JSON.parse(a)})).catch((e=>{e[0];var t=e[1];return t&&h(s,t),Promise.reject(new Error(""))})).then(E.bind(null,e,t,a))}function T(e,t,a){e.get().stopped||((0,u.lplog)("New request"),S(e,a,t).then((e=>e.map(l.constructEvent))).then((e=>((0,u.lplog)("Request success","success"),e))).then(t).catch((t=>{if(!e.get().stopped)return(0,u.lplog)("Error, waiting: "+(t.message||"no message (probably browser reset)"),"error"),e.set(v.bind(null,a()?2:e.get().timeout)).then((()=>{var t=(0,d.abortablePause)(e.get().timeout,e),a=t.abort,s=t.pause;return e.set(w.bind(null,a)).then(s)}));(0,u.lplog)("Stopped longpoll")})).then(T.bind(null,e,t,a)))}function I(e){var t=new window.EventEmitter,a=(0,g.createLongpollEventsQueue)(e.ts,(e=>{t.trigger("data",e)})),s=(0,_.createLongpoll)(e,a.onLp);return{onData:e=>t.on("data",e),offData:e=>t.off("data",e),push:e=>t.trigger("data",e),pause:a.pause.bind(a),resume:a.resume.bind(a),abortWaiting:s.abortWaiting.bind(s),onLp:a.onLp.bind(a),stop:s.stopConnection.bind(s),isEnabled:()=>!(!s||s.isStopped())}}function M(e){var t=e.id,a=e.gid,s=e.key,i=e.ts,n=e.url,o=e.lhost,l=e.lpstat,d="main",u=new EventEmitter,_=window.vk.lpConfig&&window.vk.lpConfig.enabled&&window.longpollTesting_onImEvents,g=(0,c.initQueue)((function(e,t){return _&&window.longpollTesting_onImEvents(t),u.trigger("data",t),Promise.resolve({})})),m=g.pause,p=g.resume,h=g.pushMessage,v=g.isPaused,f=g.reset,y=(0,r.default)({id:t,gid:a,mode:202,timeout:1,imKey:s,imTs:i,imPart:n,imUrl:o,pause:!1,stat:l});return T(y,h.bind(null,d),v.bind(null,d)),{onData:e=>u.on("data",e),offData:e=>u.off("data",e),abortWaiting:()=>y.set(C),stop:b.bind(null,y),pause:m.bind(null,d),resume:p.bind(null,d),reset:f.bind(null,d),push:e=>u.trigger("data",e),isEnabled:()=>!y.get().pause&&!y.get().stopped}}},740066:(e,t,a)=>{"use strict";a.d(t,{initQueue:()=>f});var s=a(712439),i=a(342269),n=a(511492),r=a(506770);function o(e,t){return t.queues[e].currEv=!1,Promise.resolve(t)}function l(e,t){var a=t.queues[e].currEv;return a?(t.queues[e].errored.push(a),o(e,t)):Promise.resolve(t)}function d(e,t,a){return a.queues[e]?(a.queues[e].errored=t?[]:a.queues[e].errored.concat(a.queues[e].evs),a.queues[e].evs=[],o(e,a)):Promise.resolve(a)}function c(e,t,a,s){var i=s.get().queues[e];if(i&&!i.currEv&&i.evs.length>0&&!i.pause){var n=c.bind(null,e,t,a,s),r=i.evs.shift();i.currEv=r,t(e,r).then((()=>{s.get().opts.waitCommit||s.set(o.bind(null,e))})).then(n).catch((t=>s.set(l.bind(null,e)).then((()=>{a(e,function(e,t){var a=m(e,t.get()).errored;return a.length>0&&a[a.length-1]}(e,s),t)})).then(n)))}}function u(e,t,a){var s=a.queues[e];return s.errored.filter((e=>e.mess.messageId===t)).forEach((e=>{e.failed=!1,s.evs.push(e)})),s.errored=s.errored.filter((e=>e.mess.messageId!==t)),Promise.resolve(a)}function _(e){var t=Date.now();return Object.keys(e.queues).forEach((a=>g(a,e,t,18e5))),Promise.resolve(e)}function g(e,t,a,s){void 0===a&&(a=0),void 0===s&&(s=0);var i=t.queues[e],n=[];return i.errored.forEach((e=>{e.ts>=a-s?(e.failed=!1,i.evs.push(e)):n.push(e)})),i.errored=n,Promise.resolve(t)}function m(e,t){return t.queues[e]||(t.queues[e]={evs:[],pause:!1,errored:[],currEv:!1}),t.queues[e]}function p(e,t,a){return m(e,a).pause=t,Promise.resolve(a)}function h(e,t,a){return t.ts=Date.now(),m(e,a).evs.push(t),Promise.resolve(a)}function v(e){Object.keys(e.get().queues).forEach((t=>{e.set(l.bind(null,t)),e.set(d.bind(null,t,!1))}))}function f(e,t,a){var l=(0,s.default)({queues:{},debug:a&&a.debug,opts:(0,i.extend)({},a)},a);return a&&a.store?(l.setState(function(e){for(var t={},a=Object.keys(e.queues),s=a.length,i=0;i<s;i++){var n=a[i],r=e.queues[n];(r.currEv||r.evs.length||r.errored.length)&&(t[n]=r)}return{queues:t,opts:e.opts}}(l.get())),v(l)):v(l),{pushMessage:(a,s)=>l.set(h.bind(null,a,s)).then((i=>{(0,r.partConfigEnabled)("im_chasiky_debug")&&window.meBufferLog[s.rid].push("queue push message"),c(a,e,t,i)})),resend:(a,s)=>(void 0===s&&(s=null),l.set(u.bind(null,a,s)).then((()=>{var i=l.get().queues[a].evs.filter((e=>e.mess.messageId===s))[0];return c(a,e,t,l),i}))),resendAll:()=>l.set(_).then((()=>{Object.keys(l.get().queues).forEach((a=>{c(a,e,t,l)}))})),resendPeer:a=>l.set(g.bind(null,a)).then((()=>{c(a,e,t,l)})),reset:a=>l.set(d.bind(null,a,!0)).then((s=>{c(a,e,t,s)})),setErrored:(e,t)=>l.set((a=>(m(e,a).errored=t,Promise.resolve(a)))),pause(e){l.set(p.bind(null,e,!0))},isPaused:e=>!!m(e,l.get()).pause,complete(a,s){var i=l.get();i.queues[a].currEv&&i.queues[a].currEv.rid===s&&l.set(o.bind(null,a)).then((()=>{c(a,e,t,l)}))},resume(a){l.set(p.bind(null,a,!1)).then((0,n.pause)(.1)).then((()=>{c(a,e,t,l)}))},inspectQueue(e,t){if(void 0===t&&(t=!1),!l.get().queues[e])return[];var a=l.get().queues[e];return(t&&a.currEv?[a.currEv]:[]).concat(a.evs.slice()).concat(a.errored.slice().map((e=>(0,i.extend)({},e,{failed:!0})))).sort(((e,t)=>e.ts-t.ts))}}}},177551:(e,t,a)=>{"use strict";a.d(t,{createWorker:()=>p});var s=a(722122),i=a(511492),n=a(342269);function r(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(a)return(a=a.call(e)).next.bind(a);if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var s=0;return function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}var l=new Map,d=!1;function c(e){return e.queue||e.key}function u(){l.forEach(((e,t)=>{var a=e.onData,i=e.onUpdateKey,n=e.ts;if(function(e){var t;return!!(null==(t=window.curNotifier)?void 0:t.addQueues)&&!curNotifier.addQueues[c(e)]}(t)){var r=(0,s.default)({},t,{ts:n});Notifier.addKey(r,m.bind(null,a,i,r))}}))}function _(){d||(d=setInterval(u,3e3))}function g(e){!function(e){var t;if(!(null==(t=window.curNotifier)?void 0:t.addQueues))return!1;delete curNotifier.addQueues[c(e)]}(e),l.delete(e),0===l.size&&(clearInterval(d),d=!1)}function m(e,t,a,s,o){if(o.failed)return g(a),void function(e,t,a,s){var n;switch(e){case 1:case 2:case 3:case 5:n=s(t,e);break;case 4:n=(0,i.pause)(1).then((()=>t));break;default:throw new Error("Unkonwn error from queue: "+e)}(0,i.pause)(3).then((()=>n)).then((e=>{l.set(e,{onUpdateKey:s,onData:a,ts:e.ts}),u(),_()}))}(o.err,a,e,t);var d=(0,n.intval)(o.ts);Object.assign(a,{ts:d}),function(e,t){var a,s=void 0,i=null==e?void 0:e.queue;if(i)for(var n,o=r(l);!(n=o()).done;){var d=n.value[0];if((null==d?void 0:d.queue)===i){s=d;break}}var c=null!=(a=s)?a:e;l.set(c,t)}(a,{onData:e,onUpdateKey:t,ts:d}),o.events.map((e=>"string"==typeof e?e.split("<!>"):e)).forEach(e)}function p(e,t,a){return Notifier.addKey(e,m.bind(null,t,a,e)),l.set(e,{onData:t,onUpdateKey:a,ts:e.ts}),_(),{stop:g.bind(null,e)}}},256152:(e,t,a)=>{"use strict";a.d(t,{default:()=>h,getUploadVideoExtMasks:()=>v,getUploadModule:()=>b,onVideoUploaded:()=>y});var s=a(146143),i=a(733164),n=a(70162),r=a(226323),o=a(798262),l=a(520820),d=a(342269),c=a(501389),u=a(152278),_=a(927766),g=a(873589),m=a(285164),p=a(813549);const h={getUploadModule:(e,t,a,s,i)=>b(e,t,a,s,i),initModalVideoUploader(e){var t=cur.videoUploadParams,a=(0,g.ge)("choose_video_upload");if(!a)return!1;this.initDragEvents();var s={};switch(e){case"article":s.onUploadProgress=()=>{},s.onUploadStartDone=e=>{null==window.cur.onMediaUploadStarted||window.cur.onMediaUploadStarted(e)},s.onUploadError=e=>{null==window.cur.onMediaUploadFail||window.cur.onMediaUploadFail(e)};break;case"market":s.onUploadStart=e=>{var t=e.file;null==window.cur.onMediaUploadStarted||window.cur.onMediaUploadStarted(t)}}return b(a,boxLayerWrap,t,null,s)},initDragEvents(){var e,t=e=>{cur.dragTimeout&&(clearTimeout(cur.dragTimeout),delete cur.dragTimeout);var t=(0,g.ge)("video_choose_upload_area_wrap");if(!(0,g.hasClass)(t,"video_choose_upload_area_enter")){(0,g.addClass)(t,"video_choose_upload_area_enter");var a=(0,g.ge)("video_choose_wrap"),s=(0,g.getXY)(a)[1],i=(0,g.getSize)(t)[1];return(0,g.hide)("video_choose_wrap"),(0,g.setStyle)(t,"height",(0,_.scrollGetY)()+(0,g.clientHeight)()-s+i),(0,u.cancelEvent)(e)}},a=e=>(window.cur.dragTimeout&&(clearTimeout(window.cur.dragTimeout),delete window.cur.dragTimeout),window.cur.dragTimeout=setTimeout((()=>{var e=document.getElementById("video_choose_upload_area_wrap");e&&(e.classList.remove("video_choose_upload_area_enter"),e.style.height="auto",(0,g.show)("video_choose_wrap"))}),100),(0,u.cancelEvent)(e)),s=e=>{if(a(),e.dataTransfer.files.length&&Upload.checkFilesSizes(window.videoInlineUploader,e.dataTransfer.files))return window.Upload&&Upload.checked&&Upload.checked[window.videoInlineUploader]&&Upload.onFileApiSend(window.videoInlineUploader,e.dataTransfer.files),(0,u.cancelEvent)(e)},i=()=>{(0,u.addEvent)(boxLayerWrap,"dragenter dragover",t),(0,u.addEvent)(boxLayerWrap,"dragleave",a),(0,u.addEvent)(boxLayerWrap,"drop",s)};i();var n=null==(e=(0,c.curBox)().getOptions())?void 0:e.onHide;setTimeout((0,c.curBox)().setOptions.pbind({onHide:()=>{if((0,u.removeEvent)(boxLayerWrap,"dragenter dragover",t),(0,u.removeEvent)(boxLayerWrap,"dragleave",a),(0,u.removeEvent)(boxLayerWrap,"drop",s),"function"==typeof n)return n()},onShow:()=>{Video.initChooseBox(),i()}}),0)}};function v(e){return"types"===e?[...m.VIDEO_UPLOAD_EXTS,...m.VIDEO_UPLOAD_EXTS.map((e=>e.toUpperCase()))].map((e=>`*.${e}`)).join(";"):"accept"===e?m.VIDEO_UPLOAD_INPUT_ACCEPT:""}function f(e){if(!cur.leaving){var t=n.getLang("video_upload_changed"),a=!1;if((0,d.each)(window.cur.videoUploaders,((e,t)=>{Upload.isSomethingUploading(t)&&(a=!0)})),1===e){if(!a)return!0;var r=(0,s.showFastBox)({title:n.getLang("global_warning")},t,n.getLang("global_continue"),(function(){cur.leaving=!0,r.hide(),cur.onContinueCb&&cur.onContinueCb()}),n.getLang("global_cancel"),(function(){r.hide(),nav.objLoc.section="upload",nav.setLoc(nav.objLoc)}));return!1}return a?(0,i.winToUtf)(t.replace(/<\/?b>/g,"").replace(/<br\s*\/?>/g,"\n")):void 0}}function b(e,t,a,i,c){if(a){i=i||cur,(c=c||{}).onUploadStart||(c.onUploadStart=e=>{var t;boxQueue.hideLast(),cur.nav.push((function(e,t,a){if(!1===f(1))return cur.onContinueCb=nav.go.pbind(a),!1})),cur.prevBefUnload=window.onbeforeunload,window.onbeforeunload=f,c.onUploadProgress(e,0,0),null==(t=window.Wall)||null==t.showEditPost||t.showEditPost(),c.onUploadStartDone&&c.onUploadStartDone(e)}),c.onUploadComplete||(c.onUploadComplete=(e,t)=>{var a=(0,l.parseJSON)(t);a.video_id?y(e,a,i):"string"==typeof t&&t.indexOf("TERMINATED")>-1||Upload.onUploadError(e);c.onUploadCompleteDone&&c.onUploadCompleteDone(),setTimeout((()=>{c.onUploadAllCompleteDone&&!window.Upload.isSomethingUploading(e.ind)&&c.onUploadAllCompleteDone()}))}),c.onUploadProgress||(c.onUploadProgress=(e,t,a)=>{var s=void 0!==e.ind?e.ind:e;(0,g.show)("_im_media_preview"),i.showMediaProgress&&i.showMediaProgress("video",s,function(e,t,a){return{loaded:t,total:a,fileName:e.fileName?e.fileName.replace(/[&<>"']/g,""):void 0}}(e,t,a))}),c.onUploadError||(c.onUploadError=(e,t)=>{(0,o.statlogsValueEvent)("upload_video_fails",1,a.options.server,t),function(e){var t=void 0!==e.ind?e.ind:e,a=e.fileName?t+"_"+e.fileName:e;if((0,g.re)("upload"+a+"_progress_wrap"),!(0,g.geByClass1)("popup_box_container")){var i=n.getLang("video_upload_error");setTimeout((0,s.showFastBox)({title:n.getLang("global_error")},i).hide,2e3)}(0,r.topError)("Upload failed",{dt:-1,type:102,url:((0,g.ge)("file_uploader_form"+t)||{}).action}),Upload.embed(t)}(e)}),cur.maxFiles=(cur.chooseParams||{}).maxFiles||10;var u=cur.maxFiles-(cur.savedVideos||[]).length;a.lang&&(cur.lang=(0,d.extend)(cur.lang||{},a.lang));var _={accept:v("accept"),file_input:null,file_name:"video_file",file_size_limit:1024*(a.options.file_size_limit_in_GB||m.VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB)*1024*1024,file_types_description:"Video files",file_types:v("types"),chooseBox:1,chunked:1,chunkSize:m.VIDEO_UPLOAD_CHUNK_SIZE,clear:1,dragEl:t===boxLayerWrap?boxLayerWrap:document.body,dropbox:t,from:a.vars.from,lang:a.lang,max_attempts:3,max_files:u,multiple:1,multi_progress:1,requestOptionsForFile:!0,type:"video",visibleDropbox:!a.options.hasOwnProperty("visible_dropbox")||a.options.visible_dropbox},p=Upload.init(e,"",{},Object.assign(_,c));return window.cur.videoUploaders||(window.cur.videoUploaders=[]),window.cur.videoUploaders.push(p),p}}function y(e,t,a,i){a=a||cur;var r=void 0!==e.ind?e.ind:e,o=(e.fileName||e.filename||"").replace(/[&<>"']/g,""),l=o?r+"_"+o:e,c=t.owner_id+"_"+t.video_id,u=cur.isSnippetVideoSelection&&cur.chooseSnippetVideo,_=(0,g.ge)("upload"+l+"_progress_wrap");_&&(0,g.hide)((0,g.geByClass1)("progress_x",_)),ajax.post("al_video.php?act=a_videos_attach_info",{videos:c},{onDone:e=>{u||a.chooseMedia("video",c,(0,d.extend)(e[c],{upload_ind:l,upload_new:!0}));var r=t.owner_id,o=t.video_id,_=t.video_hash,m=0,h=()=>{ajax.post("al_video.php?act=encode_progress",{owner_id:r,vid:o,hash:_,need_thumb:1},{onDone:t=>{var _,m=!0;if(t){if(t.error)return _=(0,p.getUploadErrorText)(t.error_details),void setTimeout((0,s.showFastBox)({title:n.getLang("global_error")},_).hide,2e3);t.thumb&&100===parseInt(t.percents,10)&&(m=!1,ajax.post("al_video.php",{act:"a_video_photo_sizes",oid:r,vid:o},{onDone:t=>{if(cur.isSnippetVideoSelection&&cur.chooseSnippetVideo)return cur.chooseSnippetVideo(c,t),void(0,g.re)("upload"+l+"_progress_wrap");a.hasChosenMedia("video",c)?a.updateChosenMedia("video",c,(0,d.extend)(t,{upload_ind:l,upload_new:!0})):i&&i(e,c)}}))}m&&(u||a.hasChosenMedia("video",c))&&setTimeout(h,1e3)},onFail:()=>{++m<3&&setTimeout(h,2e3*m)}})};h()}})}},216799:()=>{},279262:()=>{},532956:function(e){e.exports=function(){"use strict";var e=function(){return e=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},e.apply(this,arguments)};function t(e,t){var a={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(a[s[i]]=e[s[i]])}return a}var a=function(){function e(e,t){this.ATT_FACTOR=4,this.GRAPH_X=2,this.AMPLITUDE_FACTOR=.6,this.ctrl=e,this.definition=t}return e.prototype.globalAttFn=function(e){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(e,this.ATT_FACTOR)),this.ATT_FACTOR)},e.prototype.xPos=function(e){return this.ctrl.width*((e+this.GRAPH_X)/(2*this.GRAPH_X))},e.prototype.yPos=function(e){return this.AMPLITUDE_FACTOR*(this.globalAttFn(e)*(this.ctrl.heightMax*this.ctrl.amplitude)*(1/this.definition.attenuation)*Math.sin(this.ctrl.opt.frequency*e-this.ctrl.phase))},e.prototype.draw=function(){var e=this.ctrl.ctx;e.moveTo(0,0),e.beginPath();var t=(this.definition.color||this.ctrl.color).replace(/rgb\(/g,"").replace(/\)/g,"");e.strokeStyle="rgba(".concat(t,",").concat(this.definition.opacity,")"),e.lineWidth=this.definition.lineWidth;for(var a=-this.GRAPH_X;a<=this.GRAPH_X;a+=this.ctrl.opt.pixelDepth)e.lineTo(this.xPos(a),this.ctrl.heightMax+this.yPos(a));e.stroke()},e.getDefinition=function(){return[{attenuation:-2,lineWidth:1,opacity:.1},{attenuation:-6,lineWidth:1,opacity:.2},{attenuation:4,lineWidth:1,opacity:.4},{attenuation:2,lineWidth:1,opacity:.6},{attenuation:1,lineWidth:1.5,opacity:1}]},e}(),s=function(){function e(e,t){this.GRAPH_X=25,this.AMPLITUDE_FACTOR=.8,this.SPEED_FACTOR=1,this.DEAD_PX=2,this.ATT_FACTOR=4,this.DESPAWN_FACTOR=.02,this.NOOFCURVES_RANGES=[2,5],this.AMPLITUDE_RANGES=[.3,1],this.OFFSET_RANGES=[-3,3],this.WIDTH_RANGES=[1,3],this.SPEED_RANGES=[.5,1],this.DESPAWN_TIMEOUT_RANGES=[500,2e3],this.ctrl=e,this.definition=t,this.noOfCurves=0,this.spawnAt=0,this.prevMaxY=0,this.phases=[],this.offsets=[],this.speeds=[],this.finalAmplitudes=[],this.widths=[],this.amplitudes=[],this.despawnTimeouts=[],this.verses=[]}return e.prototype.getRandomRange=function(e){return e[0]+Math.random()*(e[1]-e[0])},e.prototype.spawnSingle=function(e){this.phases[e]=0,this.amplitudes[e]=0,this.despawnTimeouts[e]=this.getRandomRange(this.DESPAWN_TIMEOUT_RANGES),this.offsets[e]=this.getRandomRange(this.OFFSET_RANGES),this.speeds[e]=this.getRandomRange(this.SPEED_RANGES),this.finalAmplitudes[e]=this.getRandomRange(this.AMPLITUDE_RANGES),this.widths[e]=this.getRandomRange(this.WIDTH_RANGES),this.verses[e]=this.getRandomRange([-1,1])},e.prototype.getEmptyArray=function(e){return new Array(e)},e.prototype.spawn=function(){this.spawnAt=Date.now(),this.noOfCurves=Math.floor(this.getRandomRange(this.NOOFCURVES_RANGES)),this.phases=this.getEmptyArray(this.noOfCurves),this.offsets=this.getEmptyArray(this.noOfCurves),this.speeds=this.getEmptyArray(this.noOfCurves),this.finalAmplitudes=this.getEmptyArray(this.noOfCurves),this.widths=this.getEmptyArray(this.noOfCurves),this.amplitudes=this.getEmptyArray(this.noOfCurves),this.despawnTimeouts=this.getEmptyArray(this.noOfCurves),this.verses=this.getEmptyArray(this.noOfCurves);for(var e=0;e<this.noOfCurves;e++)this.spawnSingle(e)},e.prototype.globalAttFn=function(e){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(e,2)),this.ATT_FACTOR)},e.prototype.sin=function(e,t){return Math.sin(e-t)},e.prototype.yRelativePos=function(e){for(var t=0,a=0;a<this.noOfCurves;a++){var s=4*(a/(this.noOfCurves-1)*2-1);s+=this.offsets[a];var i=e*(1/this.widths[a])-s;t+=Math.abs(this.amplitudes[a]*this.sin(this.verses[a]*i,this.phases[a])*this.globalAttFn(i))}return t/this.noOfCurves},e.prototype.yPos=function(e){return this.AMPLITUDE_FACTOR*this.ctrl.heightMax*this.ctrl.amplitude*this.yRelativePos(e)*this.globalAttFn(e/this.GRAPH_X*2)},e.prototype.xPos=function(e){return this.ctrl.width*((e+this.GRAPH_X)/(2*this.GRAPH_X))},e.prototype.drawSupportLine=function(){var e=this.ctrl.ctx,t=[0,this.ctrl.heightMax,this.ctrl.width,1],a=e.createLinearGradient.apply(e,t);a.addColorStop(0,"transparent"),a.addColorStop(.1,"rgba(255,255,255,.5)"),a.addColorStop(.8,"rgba(255,255,255,.5)"),a.addColorStop(1,"transparent"),e.fillStyle=a,e.fillRect.apply(e,t)},e.prototype.draw=function(){var e=this.ctrl.ctx;if(e.globalAlpha=.7,e.globalCompositeOperation="lighter",0===this.spawnAt&&this.spawn(),this.definition.supportLine)return this.drawSupportLine();for(var t=0;t<this.noOfCurves;t++)this.spawnAt+this.despawnTimeouts[t]<=Date.now()?this.amplitudes[t]-=this.DESPAWN_FACTOR:this.amplitudes[t]+=this.DESPAWN_FACTOR,this.amplitudes[t]=Math.min(Math.max(this.amplitudes[t],0),this.finalAmplitudes[t]),this.phases[t]=(this.phases[t]+this.ctrl.speed*this.speeds[t]*this.SPEED_FACTOR)%(2*Math.PI);for(var a=-1/0,s=0,i=[1,-1];s<i.length;s++){var n=i[s];e.beginPath();for(var r=-this.GRAPH_X;r<=this.GRAPH_X;r+=this.ctrl.opt.pixelDepth){var o=this.xPos(r),l=this.yPos(r);e.lineTo(o,this.ctrl.heightMax-n*l),a=Math.max(a,l)}e.closePath(),e.fillStyle="rgba(".concat(this.definition.color,", 1)"),e.strokeStyle="rgba(".concat(this.definition.color,", 1)"),e.fill()}return a<this.DEAD_PX&&this.prevMaxY>a&&(this.spawnAt=0),this.prevMaxY=a,null},e.getDefinition=function(){return[{color:"255,255,255",supportLine:!0},{color:"15, 82, 169"},{color:"173, 57, 76"},{color:"48, 220, 155"}]},e}();return function(){function i(i){var n=this,r=i.container,o=t(i,["container"]);this.phase=0,this.run=!1,this.curves=[];var l=window.getComputedStyle(r);this.opt=e({container:r,style:"ios",ratio:window.devicePixelRatio||1,speed:.2,amplitude:1,frequency:6,color:"#fff",cover:!1,width:parseInt(l.width.replace("px",""),10),height:parseInt(l.height.replace("px",""),10),autostart:!0,pixelDepth:.02,lerpSpeed:.1},o),this.speed=Number(this.opt.speed),this.amplitude=Number(this.opt.amplitude),this.width=Number(this.opt.ratio*this.opt.width),this.height=Number(this.opt.ratio*this.opt.height),this.heightMax=Number(this.height/2)-6,this.color="rgb(".concat(this.hex2rgb(this.opt.color),")"),this.interpolation={speed:this.speed,amplitude:this.amplitude},this.canvas=document.createElement("canvas");var d=this.canvas.getContext("2d");if(null===d)throw new Error("Unable to create 2D Context");this.ctx=d,this.canvas.width=this.width,this.canvas.height=this.height,!0===this.opt.cover?this.canvas.style.width=this.canvas.style.height="100%":(this.canvas.style.width="".concat(this.width/this.opt.ratio,"px"),this.canvas.style.height="".concat(this.height/this.opt.ratio,"px")),"ios9"===this.opt.style?this.curves=(this.opt.curveDefinition||s.getDefinition()).map((function(e){return new s(n,e)})):this.curves=(this.opt.curveDefinition||a.getDefinition()).map((function(e){return new a(n,e)})),this.opt.container.appendChild(this.canvas),this.opt.autostart&&this.start()}return i.prototype.hex2rgb=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,(function(e,t,a,s){return t+t+a+a+s+s}));var a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return a?"".concat(parseInt(a[1],16).toString(),",").concat(parseInt(a[2],16).toString(),",").concat(parseInt(a[3],16).toString()):null},i.prototype.intLerp=function(e,t,a){return e*(1-a)+t*a},i.prototype.lerp=function(e){var t=this.interpolation[e];return null!==t&&(this[e]=this.intLerp(this[e],t,this.opt.lerpSpeed),this[e]-t==0&&(this.interpolation[e]=null)),this[e]},i.prototype.clear=function(){this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.globalCompositeOperation="source-over"},i.prototype.draw=function(){this.curves.forEach((function(e){return e.draw()}))},i.prototype.startDrawCycle=function(){this.clear(),this.lerp("amplitude"),this.lerp("speed"),this.draw(),this.phase=(this.phase+Math.PI/2*this.speed)%(2*Math.PI),window.requestAnimationFrame?this.animationFrameId=window.requestAnimationFrame(this.startDrawCycle.bind(this)):this.timeoutId=setTimeout(this.startDrawCycle.bind(this),20)},i.prototype.start=function(){if(!this.canvas)throw new Error("This instance of SiriWave has been disposed, please create a new instance");this.phase=0,this.run||(this.run=!0,this.startDrawCycle())},i.prototype.stop=function(){this.phase=0,this.run=!1,this.animationFrameId&&window.cancelAnimationFrame(this.animationFrameId),this.timeoutId&&clearTimeout(this.timeoutId)},i.prototype.dispose=function(){this.stop(),this.canvas&&(this.canvas.remove(),this.canvas=null)},i.prototype.set=function(e,t){this.interpolation[e]=t},i.prototype.setSpeed=function(e){this.set("speed",e)},i.prototype.setAmplitude=function(e){this.set("amplitude",e)},i}()}()},967181:(e,t,a)=>{"use strict";var s;a.d(t,{EntityType:()=>s,EventQueue:()=>i}),function(e){e.Online="online"}(s||(s={}));class i{constructor({getQueue:e,registerQueue:t}){this.QUEUE_KEY_TTL=3e3,this.MAX_RETRIES=5,this.listeners=[],this.retriesLeft=this.MAX_RETRIES,this.restart=()=>{this.intervalId&&clearInterval(this.intervalId),0!==this.retriesLeft&&(this.retriesLeft--,this.getQueue().then((e=>{this.retriesLeft=this.MAX_RETRIES;const t=Object.assign({},e);this.intervalId=window.setInterval((()=>{this.registerQueue(t,((e,a)=>{if(void 0===a.err){t.ts=a.ts;for(const e of a.events)for(const t of this.listeners)t(e)}else this.restart()}))}),this.QUEUE_KEY_TTL)})).catch((e=>{console.error(e),setTimeout(this.restart,this.QUEUE_KEY_TTL)})))},this.subscribe=e=>(this.listeners.push(e),1===this.listeners.length&&this.restart(),()=>{this.listeners=this.listeners.filter((t=>t!==e)),0===this.listeners.length&&(this.retriesLeft=this.MAX_RETRIES,this.intervalId&&clearInterval(this.intervalId))}),this.registerQueue=t,this.getQueue=e}}},49267:(e,t,a)=>{"use strict";a.d(t,{createLongpollConnect:()=>_});var s=a(511492),i=a(887294),n=a(663825),r=a(506770);const o=(0,r.partConfigEnabled)("me_web_read_by_cmid")?15:14;function l(e,t){e.waitAbortFns.push(t)}function d(e){if(e.isStoppedFn())return Promise.resolve({ts:0,updates:[]});const{request:t,cancel:a}=(0,i.plaingetCancelable)(e.url,{act:"a_check",key:e.key,version:e.version,ts:e.ts,wait:25,mode:e.mode});return e.stopFn=a,t.then((([t,a])=>(e.onData(e,a),e.waitTimeout=2,JSON.parse(t)))).catch((([,t])=>(e.onData(e,t),Promise.reject(new Error(""))))).then((t=>function(e,t){const{abort:a,pause:i}=t.failed?(0,s.abortablePause)(4,null):{abort:()=>{},pause:()=>Promise.resolve()};switch(t.failed){case 1:return l(e,a),e.onHistoryLost(e,t).then((()=>e.onResult({ts:t.ts,updates:[[-1]]}))).then(i).then((()=>d(e)));case 2:return l(e,a),e.onKeyExpired(e,t).then((([t,a,s,i])=>e.onResult({ts:+i,updates:[[-2,t,`${a}/${s}`],[-1]]}))).then(i).then((()=>d(e)));case 3:return e.onLpBroken(e,t);default:return t.updates.some((e=>{switch(e[0]){case 4:return 4===e.length;case 5:case 18:return 3===e.length;default:return!1}}))?e.onHistoryLost(e,t).then((()=>e.onResult({ts:t.ts,updates:[[-1]]}))).then(i).then((()=>d(e))):Promise.resolve(t)}}(e,t)))}function c(e){e.isStoppedFn()||d(e).then(e.onResult.bind(e)).then((()=>e.isReconnecting&&u(e,-5))).catch((t=>function(e,t){if(e.isStoppedFn())return;e.onRequestError(t),e.waitTimeout=Math.min(60,2*e.waitTimeout),u(e,-3);const{abort:a,pause:i}=(0,s.abortablePause)(e.waitTimeout,null);return l(e,a),i().then((()=>u(e,-4)))}(e,t))).then((()=>c(e)))}function u(e,t){e.isReconnecting=-4===t,e.onResult({ts:e.ts,updates:[[t,e.waitTimeout]]})}function _(e,t){let a=!!e.stopped;const s={id:e.id,key:e.key,ts:e.ts,url:e.url,lpstat:e.lpstat||0,version:e.version||o,mode:1226,waitTimeout:2,waitAbortFns:[],isReconnecting:!1,isStoppedFn:()=>a,onResult:e=>{e.ts&&r(s.ts,e.ts,e.updates.map(n.constructEvent))},onData:g(t.onData),onRequestError:g(t.onRequestError),onHistoryLost:m(t.onHistoryLost),onKeyExpired:m(t.onKeyExpired),onLpBroken:m(t.onHistoryLost)},{onEvents:i}=t;function r(e,t,a){s.ts=t;for(let e=0;e<a.length;++e)a[e].type===n.REFRESH_LP_KEY&&(s.key=a[e].key||"",s.url=a[e].url||"");i(e,t,a)}const l={options:s,isStopped:()=>a,stopConnection(){a=!0,s.stopFn&&s.stopFn(),s.stopFn=void 0,document.removeEventListener("resume",d),this.abortWaiting()},reinitConnection(){this.stopConnection(),document.addEventListener("resume",d),u(s,-4),a=!1,c(s)},abortWaiting(){s.waitAbortFns.forEach((e=>e())),s.waitAbortFns=[],s.waitTimeout=2},onLp:r};function d(){l.abortWaiting()}return document.addEventListener("resume",d),c(s),l}function g(e){return e||(()=>{})}function m(e){return e?(...t)=>Promise.resolve(e(...t)):()=>Promise.reject()}},384099:(e,t,a)=>{"use strict";function s(e,t,a){let s=0,i=e,n=[],r=!1;function o(){!n.length||s>0||r||(t(n),n=[])}return{pause(){s++},resume(){s>0&&(s--,o())},onLp(e,t,s){r||(i>=e?(i=t,n.push(...s),o()):a&&(r=!0,a(i).then((([,e,t])=>{i=e,r=!1,n.push(...t),o()}))))}}}a.d(t,{createLongpollEventsQueue:()=>s})},421295:(e,t,a)=>{"use strict";a.d(t,{screenWakeLocker:()=>s});const s=new class{constructor(){this.onVisibilityChange=this._onVisibilityChange.bind(this)}_onVisibilityChange(){this.wakeLockSentinel&&"visible"===document.visibilityState&&this.lock().then((()=>{})).catch(console.error)}requestWakeLock(){return navigator.wakeLock?this.wakeLockSentinel?Promise.resolve():navigator.wakeLock.request("screen").then((e=>{this.wakeLockSentinel=e})):Promise.reject()}isLocked(){return!!this.wakeLockSentinel&&!this.wakeLockSentinel.released}lock(){return this.requestWakeLock().then((()=>{this.wakeLockSentinel&&document.addEventListener("visibilitychange",this.onVisibilityChange)})).catch((()=>{}))}unlock(){return this.wakeLockSentinel?(document.removeEventListener("visibilitychange",this.onVisibilityChange),this.wakeLockSentinel.release().finally((()=>{this.wakeLockSentinel=null}))):Promise.resolve()}}},417333:(e,t,a)=>{"use strict";a.d(t,{IdleManager:()=>l});var s=a(480816),i=a(840060),n=a(961540),r=a(421295);const o=i.browser.iphone||i.browser.ipad||i.browser.ipod;class l extends s.default{constructor(e){super(),this.started=!1,this.is_idle=!0,this.activeTimeStart=null,this.checkIdleCb=()=>{this.started&&(d(this.opts.element,this.opts.triggerEvents,this.cbActive),clearTimeout(this.setIdleTo),this.setIdleTo=setTimeout(this.cbInactive,this.opts.idleTimeout))},this.cbActive=()=>{this.started&&(this.activeTimeStart=(new Date).getTime(),clearTimeout(this.setIdleTo),this.is_idle&&(this.is_idle=!1,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout((()=>{this.emit("unidle"),this.opts.onUnIdleCb&&this.opts.onUnIdleCb()}),100)),c(this.opts.element,this.opts.triggerEvents,this.cbActive),clearTimeout(this.checkIdleCbTo),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))},this.cbInactive=()=>{this.started&&(r.screenWakeLocker.isLocked()||(this.activeTimeStart=null,this.is_idle||(this.is_idle=!0,clearTimeout(this.sendCbTO),this.sendCbTO=setTimeout((()=>{this.emit("idle"),this.opts.onIdleCb&&this.opts.onIdleCb()}),100)),clearTimeout(this.checkIdleCbTo),c(this.opts.element,this.opts.triggerEvents,this.cbActive),d(this.opts.element,this.opts.triggerEvents,this.cbActive),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout)))},this.getActiveTime=()=>!this.is_idle&&this.activeTimeStart?(new Date).getTime()-this.activeTimeStart:0,this.onVisiblityChange=()=>{"visible"===u()?this.cbActive():this.cbInactive()},this._isTopLevel=()=>{const{focusElement:e}=this.opts;return e===window||e===document},this._isFocused=()=>{const{focusElement:e}=this.opts;if(this._isTopLevel()){const e=u();return"string"==typeof e&&"visible"===e}return document.activeElement===e},this.opts=Object.assign({triggerEvents:"mousemove keydown",onIdleCb:()=>{},onUnIdleCb:()=>{},focusElement:e.element,idleTimeout:3e4},e)}stop(){this.started=!1,c(this.opts.element,this.opts.triggerEvents,this.cbActive),(0,n.isMvk)()&&this._isTopLevel()&&_()&&c(document,_(),this.onVisiblityChange),(0,n.isMvk)()&&o||(c(this.opts.focusElement,"focus",this.cbActive),c(this.opts.focusElement,"blur",this.cbInactive)),clearTimeout(this.setIdleTo),clearTimeout(this.checkIdleCbTo),clearTimeout(this.sendCbTO),this.is_idle=!0,this.opts.parentManager&&this.opts.parentManager.off("idle",this.cbInactive)}idle(e){this.is_idle=!0,e||this.opts.onIdleCb(),this.emit("idle")}unidle(e){this.is_idle=!1,e||this.opts.onUnIdleCb(),this.emit("unidle")}start(){this.started=!0,!(0,n.isMvk)()&&i.browser.mobile||(this.is_idle=!this._isFocused(),this.opts.parentManager&&this.opts.parentManager.on("idle",this.cbInactive),(0,n.isMvk)()&&this._isTopLevel()&&_()&&d(document,_(),this.onVisiblityChange),(0,n.isMvk)()&&o||(d(this.opts.focusElement,"focus",this.cbActive),d(this.opts.focusElement,"blur",this.cbInactive)),clearTimeout(this.checkIdleCbTo),this.checkIdleCb(),this.checkIdleCbTo=setTimeout(this.checkIdleCb,this.opts.idleTimeout))}}function d(e,t,a){(0,n.isMvk)()?window.addEvent(e,t,a,{passive:!0}):window.addEvent(e,t,a)}function c(e,t,a){(0,n.isMvk)()?window.removeEvent(e,t,a,{passive:!0}):window.removeEvent(e,t,a)}function u(){return document.visibilityState||document.webkitVisibilityState}function _(){let e="visibilitychange";return document.visibilityState||(document.webkitVisibilityState?e+="webkit":e=""),e}},285098:(e,t,a)=>{"use strict";a.d(t,{MarusiaButton:()=>_});var s=a(243700),i=a(431306),n=a(69957),r=a(311928);const o="im-send-btn--marusia",l="MarusiaButton--visible",d="MarusiaButton--loading",c="MarusiaButton__wave--active",u="MarusiaButton__typing--active";class _{constructor({container:e}){var t,a,n,r;this.readyShownFirstTime=!1,this.button=e,this.container=null!==(t=this.button.querySelector("._marusia_button"))&&void 0!==t?t:document.createElement("span"),this.animationContainer=null!==(a=this.container.querySelector("._marusia_animation"))&&void 0!==a?a:document.createElement("span"),this.typingContainer=null!==(n=this.container.querySelector("._marusia_typing"))&&void 0!==n?n:document.createElement("span"),this.waveContainer=null!==(r=this.container.querySelector("._marusia_wave"))&&void 0!==r?r:document.createElement("span"),this.animation=new i.LottieAnimation(this.animationContainer),this.wave=new s.Wave({min:0,max:128},1.5,{container:this.waveContainer,width:25,height:38,amplitude:.1,autostart:!1})}setAnimations(e){return this.animation.setAnimations(e)}setIconState(e){var t,a,s,i,o,l;if(!this.animation.haveAnimations())return;const d=this.state;if(this.state=e,d!==this.state)switch(this.state===n.MarusiaState.LISTEN?this.wave.start():this.wave.stop(),this.waveContainer.classList.remove(c),this.typingContainer.classList.remove(u),e){case n.MarusiaState.READY:d===n.MarusiaState.LOADING?this.animation.play("load_to_mic"):d===n.MarusiaState.ANSWERING?this.animation.play("stop_to_mic"):d===n.MarusiaState.LISTEN?this.animation.play("load_to_mic"):d===n.MarusiaState.TYPING?this.readyShownFirstTime||(this.readyShownFirstTime=!0,this.animation.play("intro")):this.animation.play("intro");break;case n.MarusiaState.TYPING:this.typingContainer.classList.add(u);break;case n.MarusiaState.LOADING:d===n.MarusiaState.LISTEN?null===(t=this.animation.play("wave_to_load"))||void 0===t||t.then((()=>{r.playerStore.get().isPlaying||this.playLoadingLoop()})):d===n.MarusiaState.READY?null===(a=this.animation.play("mic_to_loader"))||void 0===a||a.then((()=>{this.playLoadingLoop()})):d===n.MarusiaState.ANSWERING&&(null===(s=this.animation.play("stop_to_loader"))||void 0===s||s.then((()=>{this.playLoadingLoop()})));break;case n.MarusiaState.LISTEN:d===n.MarusiaState.READY?null===(i=this.animation.play("mic_to_wave"))||void 0===i||i.then(this.showWave.bind(this)):d===n.MarusiaState.ANSWERING?null===(o=this.animation.play("stop_to_wave"))||void 0===o||o.then(this.showWave.bind(this)):d===n.MarusiaState.LOADING&&(null===(l=this.animation.play("mic_to_wave"))||void 0===l||l.then(this.showWave.bind(this)));break;case n.MarusiaState.ANSWERING:d===n.MarusiaState.LOADING?this.animation.play("load_to_stop"):d===n.MarusiaState.LISTEN?this.animation.play("wave_to_stop"):d===n.MarusiaState.READY&&this.animation.play("load_to_stop");break;case n.MarusiaState.ERROR:d===n.MarusiaState.READY&&this.animation.play("mic_to_error")}}hide(){this.button.classList.remove(o),this.container.classList.remove(l)}show(){this.button.classList.add(o),this.container.classList.add(l)}showPreload(){this.container.classList.add(d)}hidePreload(){this.container.classList.remove(d)}updateWave(e){this.wave.update(e)}dispose(){this.hide(),this.wave.dispose(),this.animationContainer.innerHTML="",this.waveContainer.innerHTML=""}showWave(){this.state===n.MarusiaState.LISTEN&&this.waveContainer.classList.add(c)}playLoadingLoop(){this.state===n.MarusiaState.LOADING&&this.animation.play("load_loop",{loop:!0})}}},744778:(e,t,a)=>{"use strict";a.d(t,{SuggestManager:()=>r});var s=a(70162);const i="MarusiaSuggests--visible",n="MarusiaSuggests__item";class r{constructor({container:e,onSuggestClick:t,onSuggestListUpdate:a}){var s;this.onSuggestListUpdate=()=>{},this.currentCommands=[],this.canvas=document.createElement("canvas"),this.container=e,this.suggestList=null!==(s=e.querySelector("._marusia_suggest_list"))&&void 0!==s?s:document.createElement("div"),this.onSuggestClick=t,a&&(this.onSuggestListUpdate=a),this.suggestList.addEventListener("wheel",(e=>((e,t)=>{e.scrollLeft+=t.deltaY})(this.suggestList,e)))}toggleVisibility(e){this.container.classList.toggle(i,e)}show(){this.container.classList.add(i)}hide(){this.container.classList.remove(i)}clearSuggests(){this.suggestList.innerHTML="",this.onSuggestListUpdate()}update(e,t=!1){this.currentCommands=e,this.toggleVisibility(!!e.length),this.clearSuggests(),(t?e:this.short(e)).forEach((e=>{const t=this.createSuggestItem(e);this.suggestList.appendChild(t)})),this.onSuggestListUpdate()}unmount(){this.hide(),this.suggestList.innerHTML=""}static getSuggestContentForApi(e){let t="";return"event_suggest"===e.type&&(t=e.text),"text_suggest"===e.type&&(t=e.payload),r.replaceSpecialPhrases(t)}static isSuggestCommand(e){return["text_suggest","event_suggest","url_suggest"].includes(e.type)}static replaceSpecialPhrases(e){return e.replace("#DISLIKE#","👎🏻").replace("#LIKE#","👍🏻")}getSuggestWidthPx(e){return this.getTextWidth(r.getSuggestContent(e))+34}getTextWidth(e){const t=this.canvas.getContext("2d");if(!t)return 7*e.length;t.font=this.getContainerFont();return t.measureText(e).width}getContainerFont(){const e=getComputedStyle(this.suggestList);return`${e.getPropertyValue("font-weight")} ${e.getPropertyValue("font-size")} ${e.getPropertyValue("font-family")}`}short(e){let t=this.suggestList.offsetWidth,a=3,s=[],i=!0;return e.forEach((e=>{if(0===a)return void(i=!1);const n=this.getSuggestWidthPx(e);if(t-=n,t>=0)s.push(e);else{if(a-=1,0===a)return void(i=!1);t=1===a?500-n-118:500-n,t>=0&&s.push(e)}})),i||s.push({type:"more"}),s}static getSuggestContent(e){let t="";return"text_suggest"===e.type&&(t=e.text),"event_suggest"===e.type&&(t=e.text),"url_suggest"===e.type&&(t=e.text),r.replaceSpecialPhrases(t)}createSuggestItem(e){if("more"===e.type)return this.createMoreItem();const t=document.createElement("div");return t.className=n,t.innerHTML=r.getSuggestContent(e),t.onclick=()=>{this.onSuggestClick(e)},t}createMoreItem(){const e=document.createElement("div");return e.className=n,e.innerHTML=s.getLang("mail_marusia_suggest_show_more"),e.onclick=()=>{this.update(this.currentCommands,!0)},e}}},377550:(e,t,a)=>{"use strict";a.d(t,{TtsPlayer:()=>d});var s=a(570655),i=a(827648),n=a(614971),r=a(155664),o=a(69957),l=a(311928);class d{constructor({audioPlayer:e,api:t}){this.isInitialized=!1,this.prevVolume=null,this.interruptCurrentAudio=()=>{},this.player=new Audio,this.soundPlayer=new Audio,this.audioPlayer=e,this.api=t}init(){!1===this.isInitialized&&(this.player.src=i.SILENCE,this.player.play().catch((()=>{})),this.isInitialized=!0)}prepareSoundPlay(){this.soundPlayer.src=i.SILENCE,this.soundPlayer.play().catch((()=>{}))}prepareTtsPlay(){this.interruptCurrentAudio(),l.playerStore.setIsPlaying(!1),this.player.src=i.SILENCE,this.player.play().catch((()=>{}))}playSound(e){this.soundPlayer.src=e,this.soundPlayer.play().catch((()=>{}))}stop(){this.restoreMediaVolume(),this.interruptCurrentAudio(),this.player.pause(),l.playerStore.setIsPlaying(!1)}play(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const a=yield this.getTtsUrl(e,t);return l.playerStore.setIsPlaying(!0),new Promise(((e,t)=>{this.player.src=a,this.reduceMediaVolume(),this.player.play().catch((()=>{})),this.interruptCurrentAudio=()=>t(new Error(o.MarusiaError.USER_INTERRUPT)),this.player.onended=()=>{l.playerStore.setIsPlaying(!1),this.restoreMediaVolume(),e()}}))}))}reduceMediaVolume(){null===this.prevVolume&&(this.prevVolume=this.audioPlayer.getVolume()),this.audioPlayer.setVolume(.01)}restoreMediaVolume(){null!==this.prevVolume&&(this.audioPlayer.setVolume(this.prevVolume),this.prevVolume=null)}getTtsUrl(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){let a="";switch(t.type){case"tts":a=yield this.getStreamUrl(e,t.stream_id);break;case"sound":a=t.url}return a}))}getStreamUrl(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const a=yield(0,r.getApiHost)(this.api),s=yield(0,n.getSession)(this.api),i=this.api.generateDeviceId(),o={session_id:s.session_id,device_id:i,stream_id:t,phrase_id:e},l=new URLSearchParams(o).toString();return`${a.server_url}/stream?${l}`}))}}},311928:(e,t,a)=>{"use strict";a.d(t,{playerStore:()=>s});const s=(()=>{let e=0;const t={isPlaying:!1};let a=[];const s=e=>{a.forEach((t=>{t.cb(e)}))};return{get:()=>t,set:(e,a)=>{t[e]=a,s(t)},setIsPlaying:e=>{t.isPlaying=e,s(t)},subscribe:t=>{const s=e++;return a.push({id:s,cb:t}),()=>{a=a.filter((e=>e.id!==s))}}}})()},431306:(e,t,a)=>{"use strict";a.d(t,{LottieAnimation:()=>i});var s=a(570655);class i{constructor(e){this.animations=null,this.targetEl=e}haveAnimations(){return!!this.animations}setAnimations(e){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const t=yield Promise.all([a.e(38288),a.e(55489)]).then(a.bind(a,809499)).then((e=>e.lottie));this.animations=Object.entries(e).reduce(((e,[a,s])=>Object.assign(Object.assign({},e),{[a]:e=>{const i=document.createElement("span");this.targetEl.appendChild(i);const n={container:i,animationData:s,renderer:"svg",name:a,autoplay:!1,loop:!1};return t.loadAnimation(Object.assign(Object.assign({},n),e))}})),{})}))}play(e,t){var a;if(null===(a=this.animations)||void 0===a?void 0:a[e])return new Promise((a=>{if(!this.animations)return void a();const s=this.animations[e](t);s.addEventListener("complete",a),s.addEventListener("DOMLoaded",(()=>{setTimeout((()=>{var e;if(this.currentAnimation){const t=this.currentAnimation.wrapper;this.currentAnimation.destroy(),null===(e=t.parentNode)||void 0===e||e.removeChild(t)}this.currentAnimation=s}),50)})),s.play()}))}}},942763:(e,t,a)=>{"use strict";a.d(t,{getHashesForAudios:()=>r,constructPlayerAudio:()=>o,getVoiceAssistantData:()=>l,isAudioAttach:()=>c,getFullIdFromTuple:()=>u,getCommandsToAutoplay:()=>m,getAudioList:()=>p});var s=a(570655),i=a(722904),n=a(20575);function r(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const a=t.map((e=>`${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]}_${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]}_${e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]}`)).join(","),s=yield e.reloadAudios(a).catch((()=>null));return s?(s.forEach(((e,a)=>{const s=t[a]?t[a][i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]:e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA];e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=s})),s):null}))}function o(e,t=!1,a){var s,n,r,o,l,d,c,u;const _=function(e){var t,a,s,i;if(e.coverUrl)return`${e.coverUrl},${e.coverUrl}`;if((null===(a=null===(t=e.album)||void 0===t?void 0:t.thumb)||void 0===a?void 0:a.photo_68)&&(null===(i=null===(s=e.album)||void 0===s?void 0:s.thumb)||void 0===i?void 0:i.photo_135)){return`${e.album.thumb.photo_68},${e.album.thumb.photo_135}`}return""}(e),g=!!e.album&&[e.album.owner_id,e.album.id,e.album.access_key],m=t?{voiceAssistant:a,marusiaTale:!0}:{voiceAssistant:a},p=new Array(27);return p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID]=null!==(s=e.id)&&void 0!==s?s:0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID]=null!==(n=e.owner_id)&&void 0!==n?n:0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]=e.url,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TITLE]=e.title,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_PERFORMER]=null!==(r=e.artist)&&void 0!==r?r:"Marusia",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=null!==(o=e.duration)&&void 0!==o?o:0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_ID]=null!==(d=null===(l=e.album)||void 0===l?void 0:l.id)&&void 0!==d?d:0,p[7]=0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_AUTHOR_LINK]="",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_LYRICS]=0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FLAGS]=0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_CONTEXT]=t?"":"im",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_EXTRA]=JSON.stringify(m),p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_HASHES]="",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_COVER_URL]=_,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ADS]=null!==(c=e.ads)&&void 0!==c?c:{},p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_SUBTITLE]="",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_MAIN_ARTISTS]="",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_FEAT_ARTISTS]="",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM]=g,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_CODE]=null!==(u=e.track_code)&&void 0!==u?u:"",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_RESTRICTION]=0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ALBUM_PART]=0,p[23]=!0,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_ACCESS_KEY]="marusia_playlist_audio",p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_CHART_INFO_INDEX]=!1,p[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_TRACK_PAGE_ID]="",p}function l(e,t){var a,s;let i;const n=d(e),r=t.find((e=>{var t;return null===(t=e.attaches)||void 0===t?void 0:t.find((e=>e.id===n))}));if(r){const e=null===(a=r.attaches)||void 0===a?void 0:a.findIndex((e=>e.id===n));if(-1!==e){const t=null===(s=r.kludges)||void 0===s?void 0:s[`attach${e+1}_voice_assistant`];try{i=JSON.parse(t)}catch(e){}}}return i}function d(e){var t,a;return(null!==(t=e.meta.owner_id)&&void 0!==t?t:0)+"_"+(null!==(a=e.meta.id)&&void 0!==a?a:0)}function c(e){return"type"in e&&("audio"===e.type||"podcast"===e.type)}function u(e){var t,a;return`${null!==(t=e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_OWNER_ID])&&void 0!==t?t:0}_${null!==(a=e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_ID])&&void 0!==a?a:0}`}function _(e){return"media"===e.type||"playlist"===e.type}function g(e){return Promise.all(e.map(((t,a)=>function(e,t,a){return 0===e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]?new Promise((s=>{const n=new Audio(e[i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_URL]);n.addEventListener("loadedmetadata",(()=>{a[t][i.AUDIO_PLAYER_ENUMS.AUDIO_ITEM_INDEX_DURATION]=n.duration,s()})),setTimeout(s,5e3)})):Promise.resolve()}(t,a,e))))}function m(e,t){const a=t.map((e=>{var t;return null!==(t=e.attaches)&&void 0!==t?t:[]})).flat().filter(c);if(!e.length)return[];const s=a.map((e=>e.id));let i=[];return e.filter(_).forEach((e=>{"media"===e.type&&i.push(e),"playlist"===e.type&&e.tracks.forEach((e=>{i.push(Object.assign(Object.assign({},e),{type:"media"}))}))})),i=i.filter((e=>s.includes(d(e)))),i}function p(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){let a=t[e];const s=t.filter(((t,a)=>a<e)),i=a.media_type;if(s.filter((e=>"media"===e.type&&e.media_type===i)).length)return;const r=t.filter((e=>"media"===e.type&&e.media_type===i)),l=[n.MarusiaMediaType.books,n.MarusiaMediaType.tale],d=r.some((e=>l.includes(e.media_type))),c=r.map((e=>{var t;return o(e.meta,d,{source:null===(t=e.meta)||void 0===t?void 0:t.source})}));return yield g(c),c}))}},512980:(e,t,a)=>{"use strict";a.d(t,{processCommandNeedMoreVkPermissions:()=>i});var s=a(570655);function i(e,t,a){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const s=yield e.upgradeToken(t);a(s)}))}},264859:(e,t,a)=>{"use strict";a.d(t,{MARUSIA_HELP_BUTTON_CLASS:()=>s,isEventListCommand:()=>i,loadSkills:()=>r});const s="_im_marusia_help";function i(e){return"event_list"===e.type}let n;function r(e){return n||(n=e.phraseCreateEvent("full_skill_list")),n}},278747:(e,t,a)=>{"use strict";a.d(t,{MarusiaSharedSdk:()=>b});var s=a(570655),i=a(826338),n=a(69935),r=a(840060),o=a(69957),l=a(543819),d=a(868678),c=a(285098),u=a(377550),_=a(311928),g=a(936892),m=a(614971),p=a(240950),h=a(744778),v=a(20575),f=a(264859);class b{constructor(e){this.suggestsFlat=!1,this.debug=!1,this.BACKEND_COMMAND_TIMEOUT=3e4,this.isInitialized=!1,this.suggestManager=null,this.isLoading=!1,this.isSpeaking=!1,this.isRecording=!1,this.isHidden=!1,this.isDisabled=!1,this.sessionId=null,this.staticStorage=null,this.marusiaState=o.MarusiaState.READY,this.textInput=null,this.backendCommandsQueue=[],this.unsubscribeFromPlayerStore=()=>{},this.marusiaButton=null,this.ttsPlayer=null,this.textSoFar=null,this.onHelpClick=()=>{},this.outboundMessageIds=[],this.setTextValue=void 0,this.showCount=0,this.api=e.api,this.showSkillListModal=e.showSkillListModal,this.audioPlayer=e.audioPlayer,this.commands=e.commands,this.getTextFromInputEvent=e.getTextFromInputEvent,this.suggestsFlat=!!e.suggestsFlat,this.debug=!!e.debug}onPhraseUpdate(e){var t;null===(t=this.phraseUpdateCallback)||void 0===t||t.call(this,e.text_so_far||"...")}onPhraseFinish(e,t){var a;null===(a=this.phraseFinishCallback)||void 0===a||a.call(this,t.result.asr_text),this.processCommands(e,t.result.commands,t.result.controls).then((()=>{var e;this.setMarusiaState(o.MarusiaState.READY);let a=!0;if(t.result.commands.length){"listen"===t.result.commands[t.result.commands.length-1].type&&(a=!1,this.onClick())}a&&(null===(e=this.ttsPlayer)||void 0===e||e.restoreMediaVolume())})).catch((e=>{this.onError(e)})),this.isRecording=!1}onStatusUpdate(e){var t,a,s,i,n,r,l,c,u;switch(this.log("textSoFar",e,null===(t=Object.entries(d.TextSoFarStatus).find((t=>t[1]===e)))||void 0===t?void 0:t[0]),e){case d.TextSoFarStatus.INIT:this.isDisabled=!0,this.setMarusiaState(o.MarusiaState.LOADING);break;case d.TextSoFarStatus.MEDIA_STREAM_ACQUIRED:this.staticStorage&&(null===(a=this.ttsPlayer)||void 0===a||a.playSound(this.staticStorage.sounds.sound_start)),null===(s=this.phraseStartCallback)||void 0===s||s.call(this,"...");break;case d.TextSoFarStatus.PHRASE_CREATED:null===(i=this.textSoFar)||void 0===i||i.start(),this.isDisabled=!1,this.setMarusiaState(o.MarusiaState.LISTEN),this.isRecording=!0;break;case d.TextSoFarStatus.API_ERROR:this.isDisabled=!1,this.setMarusiaState(o.MarusiaState.READY),null===(n=this.phraseFinishCallback)||void 0===n||n.call(this,"");break;case d.TextSoFarStatus.GRACE_STOP:case d.TextSoFarStatus.PRE_RESULT:this.isDisabled=!0,this.staticStorage&&(null===(r=this.ttsPlayer)||void 0===r||r.playSound(this.staticStorage.sounds.sound_end)),this.setMarusiaState(o.MarusiaState.LOADING),this.isRecording=!1;break;case d.TextSoFarStatus.NOTHING:this.isDisabled=!1,this.setMarusiaState(o.MarusiaState.READY),this.isRecording=!1,null===(l=this.phraseFinishCallback)||void 0===l||l.call(this,""),null===(c=this.ttsPlayer)||void 0===c||c.restoreMediaVolume();break;case d.TextSoFarStatus.SUCCESS:this.isDisabled=!1;break;case d.TextSoFarStatus.ERROR:this.isDisabled=!1,this.setMarusiaState(o.MarusiaState.READY),null===(u=this.phraseFinishCallback)||void 0===u||u.call(this,"")}}onAudioProcess(e){var t;null===(t=this.marusiaButton)||void 0===t||t.updateWave(e)}onError(e){var t,a;switch(this.log("onError",e,e.message),e.message){case o.MarusiaError.BACKEND_COMMAND_TIMEOUT:this.setMarusiaState(o.MarusiaState.ERROR);break;case o.MarusiaError.HIDDEN:this.setMarusiaState(o.MarusiaState.READY);break;case o.MarusiaError.USER_INTERRUPT:null===(t=this.ttsPlayer)||void 0===t||t.restoreMediaVolume(),this.setMarusiaState(o.MarusiaState.READY);break;case o.MarusiaError.ATTACH_LOAD_TIMEOUT:break;default:this.log("unknown error",e,e.name,e.message)}null===(a=this.errorCallback)||void 0===a||a.call(this,e.message)}getMarusiaSessionId(){return(0,m.getSession)(this.api)}loadStatic(){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.api.getWebStatic(),t=[...Object.entries(e.animations)],a=yield Promise.all(t.map((e=>fetch(e[1]).then((e=>e.json()))))),s={sounds:e.sounds,animations:{}};return t.forEach(((t,i)=>{const n=t[0],r=a[i],o=e.images.marusia_bg.split("/");r.assets[0].u=o.slice(0,-1).join("/")+"/",r.assets[0].p=o[o.length-1],s.animations[n]=r})),s}))}preload(){return(0,s.__awaiter)(this,void 0,void 0,(function*(){return yield Promise.all([this.loadStatic(),this.getMarusiaSessionId()])}))}waitForBackendCommand(e){return new Promise(((t,a)=>{const s=e.phraseId+e.commandIds.flat().join("-"),i=setTimeout((()=>{this.backendCommandsQueue=this.backendCommandsQueue.filter((e=>e.id!==s)),a(o.MarusiaError.BACKEND_COMMAND_TIMEOUT)}),this.BACKEND_COMMAND_TIMEOUT);this.backendCommandsQueue.push({id:s,callback:()=>{var e;clearTimeout(i);const a=this.backendCommandsQueue.find((e=>e.id===s));this.backendCommandsQueue=this.backendCommandsQueue.filter((e=>e.id!==s)),t([...null!==(e=null==a?void 0:a.events)&&void 0!==e?e:[]])},events:[],signature:e})}))}processBackendCommands(e,t){return this.api.processBackendCommands(e,t),this.waitForBackendCommand({phraseId:e,commandIds:[...t]})}failIfHidden(){if(this.isHidden)throw new Error(o.MarusiaError.HIDDEN)}needNewChunk(e){return(0,p.isSuggestCommand)(e)||"playlist"===e.type||"media"===e.type}processCommands(e,t,a){return(0,s.__awaiter)(this,void 0,void 0,(function*(){if(this.log("commands",t),!this.api)return;let s=[],i=[];for(let a=0;a<t.length;a++){const n=t[a],r=a+1<t.length?t[a+1]:null,o=yield(0,g.isBackendCommand)(this.api,n),l=!!r&&(yield(0,g.isBackendCommand)(this.api,r));if(this.failIfHidden(),this.needNewChunk(n)&&i.length&&(s.push(i),i=[]),o){if(i.push(a),r&&(l||this.needNewChunk(r)))continue;s.push(i),i=[]}else switch(n.type){case"tts":case"sound":yield this.processTtsCommand(e,n);break;case"media":const s=[v.MarusiaMediaType.tale,v.MarusiaMediaType.music,v.MarusiaMediaType.books];this.audioPlayer&&s.includes(n.media_type)&&(yield this.commands.processMedia(this.audioPlayer,a,t));break;case"playlist":this.audioPlayer&&this.commands.processPlaylist(this.audioPlayer,n);break;case"event_suggest":case"text_suggest":case"url_suggest":this.processSuggestCommands(t,a);break;case"portal_deeplink":this.commands.processPortalDeeplink(n);break;case"need_more_vk_permissions":this.commands.processNeedMoreVkPermissions(this.api,n,(()=>{if("text"in n.repeat_data)this.processTextPhrase(n.repeat_data.text);else{const e={};try{e.callback_data=JSON.parse(n.repeat_data.callback_data)}catch(e){this.log(e)}this.onMarusiaEvent(n.repeat_data.event,e)}})).catch((e=>{this.log("NeedMoreVkPermissions error",e)}));break;case"call_start":this.commands.processCallStart(n);break;case"send_event_data":this.processSendEventDataCommand(n)}if(s.length){if(r&&(l||this.needNewChunk(r)))continue;const a=yield this.processBackendCommands(e,s);this.log("%c GOT BACKEND CMD","color: green;",s),this.failIfHidden();const n=t.filter(((e,t)=>s.flat().includes(t))).filter((e=>"media"===e.type||"playlist"===e.type));this.audioPlayer&&(yield this.commands.autoPlayMediaAttaches(this.api,this.audioPlayer,n,a)),s=[],i=[]}}a.forEach((e=>this.audioPlayer&&this.commands.executeControl(this.audioPlayer,e)))}))}getSuggests(e){var t;return(0,s.__awaiter)(this,void 0,void 0,(function*(){const a=yield this.api.getSuggests(e);this.failIfHidden(),null===(t=this.suggestManager)||void 0===t||t.update(a.items,this.suggestsFlat)}))}onSuggestClick(e){var t,a,i;return(0,s.__awaiter)(this,void 0,void 0,(function*(){if("url_suggest"===e.type)return void window.open((0,n.wrapAwayIfExternal)(e.url,!0),"_blank");null===(t=this.suggestManager)||void 0===t||t.clearSuggests(),null===(a=this.suggestManager)||void 0===a||a.hide(),this.stopListening();const s=h.SuggestManager.getSuggestContentForApi(e),r={};try{r.callback_data=JSON.parse(e.callback_data)}catch(e){this.log(e)}"event_suggest"===e.type?this.onMarusiaEvent(e.event,r):this.processTextPhrase(s,r),null===(i=this.suggestClickCallback)||void 0===i||i.call(this,h.SuggestManager.replaceSpecialPhrases(s))}))}processSuggestCommands(e,t){var a;const s=e[t],i=e.filter(((e,a)=>a>t)).filter((e=>h.SuggestManager.isSuggestCommand(e)));if(!h.SuggestManager.isSuggestCommand(s))return;if(i.length)return;const n=e.filter(h.SuggestManager.isSuggestCommand);null===(a=this.suggestManager)||void 0===a||a.update(n,this.suggestsFlat)}processTtsCommand(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){return this.ttsPlayer?this.ttsPlayer.play(e,t):Promise.resolve()}))}handleOutboundMessage(e){var t,a;if(!(0,p.isInActiveTab)())return;const s=JSON.parse(null!==(a=null===(t=e.kludges)||void 0===t?void 0:t.payload)&&void 0!==a?a:"null"),n=(0,i.isMarusiaPeer)(e.peerId)&&s&&s.communication_type===o.CommunicationType.text;if(n&&e.local&&(!this.audioPlayer||this.audioPlayer.isPlaying()||this.audioPlayer.getCurrentAudio()||this.audioPlayer.preparePlay(),this.setMarusiaState(o.MarusiaState.LOADING),"string"==typeof e.messageId)){const t=Number(e.messageId.replace("rid",""));this.outboundMessageIds.push(t)}n&&!e.local&&null!==e.randomId&&this.outboundMessageIds.includes(e.randomId)&&(this.outboundMessageIds=this.outboundMessageIds.filter((t=>t!==e.randomId)),this.processTextPhrase(e.text))}handleInboundMessage(e){var t,a,s;const i=JSON.parse(null!==(a=null===(t=e.kludges)||void 0===t?void 0:t.payload)&&void 0!==a?a:"null");if(!i||!i.voice_assistant)return;(null===(s=i.voice_assistant.commands)||void 0===s?void 0:s.length)&&this.processPayloadCommands(i.voice_assistant.commands);const n=this.backendCommandsQueue.find((e=>{var t;return e.signature.phraseId===(null===(t=i.voice_assistant)||void 0===t?void 0:t.phrase_id)}));if(!n)return;const r=n.signature.phraseId,o=n.signature.commandIds[0];(0,p.isPayloadForCommand)(i,{phraseId:r,commandIds:o})&&(n.signature.commandIds.shift(),n.events.push(e),0===n.signature.commandIds.length&&n.callback())}handleDeeplink(){const e=new URLSearchParams(window.location.search),t=e.get("text"),a=e.get("text_data"),s=e.get("event_name"),i=e.get("event_data");if(t){const e=a?(0,p.parseBase64JSON)(a):null;this.api.sendMessage(p.MARUSIA_PEER_ID,t,{communication_type:o.CommunicationType.other,voice_assistant:{support_process_commands_by_ids:!0}}).then((a=>{a&&this.processTextPhrase(t,{client_data:e})}))}if(s){const e=i?(0,p.parseBase64JSON)(i):null;this.onMarusiaEvent(s,{client_data:e})}}onMarusiaEvent(e,t){var a;return(0,s.__awaiter)(this,void 0,void 0,(function*(){const s=yield this.api.phraseCreateEvent(e,t,null===(a=this.audioPlayer)||void 0===a?void 0:a.getPlayerData());this.failIfHidden(),s?"error"in s?this.onError(new Error(s.error)):yield this.processCommands(s.result.phrase_id,s.result.phrase_result.commands,s.result.phrase_result.controls).then((()=>{this.setMarusiaState(o.MarusiaState.READY)})).catch((e=>{this.onError(e)})):this.setMarusiaState(o.MarusiaState.ERROR)}))}processTextPhrase(e,t){var a;return(0,s.__awaiter)(this,void 0,void 0,(function*(){this.setMarusiaState(o.MarusiaState.LOADING);const s=yield this.api.phraseCreateText(e,t,null===(a=this.audioPlayer)||void 0===a?void 0:a.getPlayerData()).catch((()=>null));this.failIfHidden(),s?this.processCommands(s.result.phrase_id,s.result.phrase_result.commands,s.result.phrase_result.controls).then((()=>{this.setMarusiaState(o.MarusiaState.READY)})).catch((e=>{this.onError(e)})):this.setMarusiaState(o.MarusiaState.ERROR)}))}handleTextInput(e){const t=this.getTextFromInputEvent(e),a=r.browser.safari?"\n"!==t&&!!t:!!t;this.setMarusiaState(a?o.MarusiaState.TYPING:o.MarusiaState.READY)}textInputHaveText(){return!!this.textInput&&!!this.textInput.innerText}processSendEventDataCommand(e){const t={client_data:{}};try{t.client_data.send_event_data=JSON.parse(e.callback_data)}catch(e){}this.onMarusiaEvent(e.event,t)}processPayloadCommands(e){this.log("payload commands",e);for(let t=0;t<e.length;t++){const a=e[t];switch(a.type){case"vk_get_data_event":this.processSendEventDataCommand(a);break;case"event_suggest":case"text_suggest":case"url_suggest":this.processSuggestCommands(e,t)}}}init(e){var t,a,i,n,r;return(0,s.__awaiter)(this,void 0,void 0,(function*(){this.log("init",this,e,this.isInitialized),this.showCount+=1,null===(t=this.suggestManager)||void 0===t||t.show();let s=e.draftText;"..."===s&&(this.clearTextInput(),s=""),this.show(!!s);const l=yield this.api.getLastMessageCommands().catch((()=>null));if(l&&l.length&&!e.needOnboarding&&this.processPayloadCommands(l),null!==l&&0!==l.length||e.needOnboarding||this.getSuggests(!!e.unreadMessages).catch((()=>{})),this.isInitialized||this.isLoading)return;this.setTextValue=e.setTextValue,this.onHelpClick=()=>{this.showSkillListModal(this.api,(e=>{this.onSuggestClick(e)}))},null===(a=document.querySelector("."+f.MARUSIA_HELP_BUTTON_CLASS))||void 0===a||a.addEventListener("click",this.onHelpClick),this.isLoading=!0,this.textInput=e.textInput,this.textInput&&(this.textInput.addEventListener("input",this.handleTextInput.bind(this)),this.isHidden||(0,p.disableMarusiaTextInput)(this.textInput)),e.iconContainer&&(this.marusiaButton=new c.MarusiaButton({container:e.iconContainer}),this.isHidden||this.marusiaButton.show(),this.marusiaButton.showPreload());const[d,g]=yield this.preload();this.sessionId=g.session_id,yield null===(i=this.marusiaButton)||void 0===i?void 0:i.setAnimations(d.animations),this.staticStorage=d,this.ttsPlayer=new u.TtsPlayer({audioPlayer:this.audioPlayer,api:this.api}),this.ttsPlayer.init(),this.unsubscribeFromPlayerStore=_.playerStore.subscribe((e=>{e.isPlaying?(this.isSpeaking=!0,this.setMarusiaState(o.MarusiaState.ANSWERING)):(this.isSpeaking=!1,this.setMarusiaState(o.MarusiaState.READY))})),null===(n=this.marusiaButton)||void 0===n||n.hidePreload(),this.textInput&&!this.isHidden&&(0,p.enableMarusiaTextInput)(this.textInput),e.needOnboarding&&(null===(r=this.api)||void 0===r||r.getOnboarding().then((t=>{t.is_sent||this.getSuggests(!!e.unreadMessages).catch((()=>{}))}))),this.isInitialized=!0,this.isLoading=!1,e.suggestContainer&&(this.suggestManager=new h.SuggestManager({container:e.suggestContainer,onSuggestClick:this.onSuggestClick.bind(this),onSuggestListUpdate:this.suggestUpdateCallback}),this.getSuggests(!!e.unreadMessages).catch((()=>{}))),this.setMarusiaState(this.textInputHaveText()?o.MarusiaState.TYPING:o.MarusiaState.READY),this.handleDeeplink()}))}show(e){var t,a;this.isHidden=!1,this.setMarusiaState(e?o.MarusiaState.TYPING:o.MarusiaState.READY),null===(t=this.marusiaButton)||void 0===t||t.show(),null===(a=document.querySelector("."+p.IM_PAGE_HISTORY_CLASS))||void 0===a||a.classList.add(p.IM_PAGE_HISTORY_MARUSIA_CLASS),this.textInput&&(this.isLoading?(0,p.disableMarusiaTextInput)(this.textInput):(0,p.enableMarusiaTextInput)(this.textInput))}hide(){var e,t,a;this.isHidden=!0,this.setMarusiaState(o.MarusiaState.READY),null===(e=this.marusiaButton)||void 0===e||e.hide(),null===(t=this.suggestManager)||void 0===t||t.hide(),null===(a=document.querySelector("."+p.IM_PAGE_HISTORY_CLASS))||void 0===a||a.classList.remove(p.IM_PAGE_HISTORY_MARUSIA_CLASS),this.textInput&&(0,p.enableMarusiaTextInput)(this.textInput)}canSentMessage(){return this.marusiaState!==o.MarusiaState.LOADING&&(this.marusiaState!==o.MarusiaState.LISTEN&&(this.marusiaState!==o.MarusiaState.ANSWERING&&!this.isLoading))}onAddMessage(e){this.log("onAddMessage",e);try{if(this.isHidden)return;e.forEach((e=>{e.isOutbound?this.handleOutboundMessage(e):this.handleInboundMessage(e)}))}catch(e){console.error(e)}}log(...e){this.debug&&console.log(...e)}on(e,t){switch(e){case o.MarusiaEvent.PHRASE_START:this.phraseStartCallback=t;break;case o.MarusiaEvent.PHRASE_UPDATE:this.phraseUpdateCallback=t;break;case o.MarusiaEvent.PHRASE_FINISH:this.phraseFinishCallback=t;break;case o.MarusiaEvent.ERROR:this.errorCallback=t;break;case o.MarusiaEvent.SUGGEST_UPDATE:this.suggestUpdateCallback=t;break;case o.MarusiaEvent.SUGGEST_CLICK:this.suggestClickCallback=t;break;default:this.log("Unhandled event: ",e)}}setMarusiaState(e){var t,a;this.log("setMarusiaState",null===(t=Object.entries(o.MarusiaState).find((t=>t[1]===e)))||void 0===t?void 0:t[0]),this.marusiaState=e,null===(a=this.marusiaButton)||void 0===a||a.setIconState(this.marusiaState)}onClick(){var e,t,a,i,n,r;return(0,s.__awaiter)(this,void 0,void 0,(function*(){this.isInitialized&&!this.isDisabled&&(this.isSpeaking?null===(e=this.ttsPlayer)||void 0===e||e.stop():(null===(t=this.ttsPlayer)||void 0===t||t.reduceMediaVolume(),null===(a=this.ttsPlayer)||void 0===a||a.prepareSoundPlay(),null===(i=this.ttsPlayer)||void 0===i||i.prepareTtsPlay(),!this.audioPlayer||this.audioPlayer.isPlaying()||this.audioPlayer.getCurrentAudio()||this.audioPlayer.preparePlay(),this.textSoFar||(this.textSoFar=new l.TextSoFar(this.onPhraseUpdate.bind(this),this.onPhraseFinish.bind(this),this.onStatusUpdate.bind(this),this.onAudioProcess.bind(this),(()=>({isHidden:this.isHidden,currentShowCount:this.showCount})),this.api,null!==(n=this.audioPlayer)&&void 0!==n?n:void 0),this.setMarusiaState(o.MarusiaState.LOADING)),this.textSoFar.isRecording?(this.textSoFar.graceStop(),null===(r=this.ttsPlayer)||void 0===r||r.restoreMediaVolume()):yield this.textSoFar.init()))}))}clearTextInput(){var e;this.textInput&&(null===(e=this.setTextValue)||void 0===e||e.call(this,this.textInput,""))}stopListening(){var e,t;(null===(e=this.textSoFar)||void 0===e?void 0:e.isRecording)&&this.textSoFar.stop(!1,!0),null===(t=this.ttsPlayer)||void 0===t||t.stop()}dispose(){var e,t,a;this.stopListening(),this.textSoFar=null,this.backendCommandsQueue=[],this.textInput&&(this.textInput.removeEventListener("input",this.handleTextInput.bind(this)),this.textInput=null),this.marusiaButton&&(this.marusiaButton.dispose(),this.marusiaButton=null),null===(e=this.suggestManager)||void 0===e||e.unmount(),this.suggestManager=null,null===(t=this.ttsPlayer)||void 0===t||t.stop(),this.ttsPlayer=null,this.unsubscribeFromPlayerStore(),this.hide(),null===(a=document.querySelector("."+f.MARUSIA_HELP_BUTTON_CLASS))||void 0===a||a.removeEventListener("click",this.onHelpClick),this.isInitialized=!1}}},243700:(e,t,a)=>{"use strict";a.d(t,{Wave:()=>n});var s=a(532956),i=a.n(s);class n{constructor(e,t,a){this.volumeRange=e,this.maxVisibleAmp=t,this.wave=new(i())(a)}start(){this.wave.start()}stop(){this.wave.stop()}dispose(){this.wave.stop(),this.wave.dispose()}update(e){this.cache||(this.cache=new Uint8Array(e.frequencyBinCount)),e.getByteFrequencyData(this.cache);const t=n.getAverageVolume(this.cache),a=10*this.getAlignedVolume(t);this.wave.setAmplitude(a>this.maxVisibleAmp?this.maxVisibleAmp:a)}getAlignedVolume(e){const{min:t,max:a}=this.volumeRange;return((e=e<t?t:e>a?a:e)-t)/(a-t)}static getAverageVolume(e){return e.reduce(((e,t)=>e+t),0)/e.length}}},936892:(e,t,a)=>{"use strict";a.d(t,{isBackendCommand:()=>n});var s=a(570655);let i=null;function n(e,t){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const a=yield function(e){return(0,s.__awaiter)(this,void 0,void 0,(function*(){return i||(i=e.requestBackendCommands()),(yield i).commands}))}(e);return a.some((e=>{var a,s,i,n,r;return"media"===t.type?"vk"===(null===(s=null===(a=t.meta)||void 0===a?void 0:a.source)||void 0===s?void 0:s.type)&&(t.type===e.type&&t.media_type===e.media_type):("playlist"!==t.type||"vk"===(null===(r=null===(n=null===(i=t.tracks[0])||void 0===i?void 0:i.meta)||void 0===n?void 0:n.source)||void 0===r?void 0:r.type))&&t.type===e.type}))}))}},405844:(e,t,a)=>{"use strict";var s;function i(e){return e===s.PHRASE_RECOGNIZED||e===s.ERROR_OCCURRED||e===s.KEYWORD_NOT_CONFIRMED||e===s.END_OF_PHRASE}function n(e){return e===s.ERROR_OCCURRED||e===s.KEYWORD_NOT_CONFIRMED}a.d(t,{isFinalStatus:()=>i,isErrorOccurred:()=>n}),function(e){e[e.OKAY_GO_ON=1]="OKAY_GO_ON",e[e.KEYWORD_CONFIRMED=2]="KEYWORD_CONFIRMED",e[e.KEYWORD_NOT_CONFIRMED=3]="KEYWORD_NOT_CONFIRMED",e[e.END_OF_PHRASE=4]="END_OF_PHRASE",e[e.ERROR_OCCURRED=5]="ERROR_OCCURRED",e[e.PHRASE_RECOGNIZED=6]="PHRASE_RECOGNIZED"}(s||(s={}))},543819:(e,t,a)=>{"use strict";a.d(t,{TextSoFar:()=>l});var s=a(570655),i=a(70162),n=a(868678),r=a(405844),o=a(681307);class l{constructor(e,t,a,s,i,n,r){this.isRecording=!1,this.chunks=[],this.abortController=new AbortController,this.isChunksBeingProcessed=!1,this.gracefulStopRequested=!1,this.onError=()=>{},this.currentShowCount=0,this.onPhraseUpdateHandler=e,this.onPhraseFinishHandler=t,this.onStatusUpdate=a,this.onAudioProcess=s,this.checkMarusiaVisibility=i,this.api=n,this.player=r}init(){var e;return(0,s.__awaiter)(this,void 0,void 0,(function*(){const t=this.checkMarusiaVisibility().currentShowCount;this.currentShowCount=t,this.onStatusUpdate(n.TextSoFarStatus.INIT);try{const e={audio:{advanced:[{}]}};this.mediaStream=yield navigator.mediaDevices.getUserMedia(e)}catch(e){this.onStatusUpdate(n.TextSoFarStatus.ERROR);let t=e.name;switch(e.name){case"DevicesNotFoundError":case"NotFoundError":case"NotAllowedError":t=i.getLang("mail_audio_message_device_error");break;case"PermissionDeniedError":case"PermissionDismissedError":t=i.getLang("mail_audio_message_permission_error");break;case"Unsupported":t=i.getLang("mail_audio_message_unsupported_error")}throw this.onError(t),e}this.onStatusUpdate(n.TextSoFarStatus.MEDIA_STREAM_ACQUIRED),this.recorder=new o.MarusiaMediaRecorder(this.mediaStream,this.onAudioProcess),this.abortController=new AbortController;try{const a=yield this.api.createAsrPhrase(null===(e=this.player)||void 0===e?void 0:e.getPlayerData());if(this.phraseId=a.result.phrase_id,this.shouldInterrupt(t))return this.stopRecorder(),void this.onStatusUpdate(n.TextSoFarStatus.API_ERROR)}catch(e){return this.stopRecorder(),void this.onStatusUpdate(n.TextSoFarStatus.API_ERROR)}this.onStatusUpdate(n.TextSoFarStatus.PHRASE_CREATED)}))}start(){this.attachDataAvailableHandler(),this.startRecorder()}shouldInterrupt(e){const t=this.checkMarusiaVisibility(),a=null!=e?e:this.currentShowCount;return!(!t.isHidden&&a===t.currentShowCount)}startRecorder(){this.recorder.start(200),this.onStatusUpdate(n.TextSoFarStatus.RECORDING),this.isRecording=!0}stopRecorder(){this.recorder.stop(),this.recorder.stream.getTracks().forEach((e=>e.stop())),this.mediaStream=null,this.isRecording=!1,this.recorder.removeEventListener("dataavailable",this.dataAvailableCallback)}attachDataAvailableHandler(){let e=0;this.dataAvailableCallback=t=>(0,s.__awaiter)(this,void 0,void 0,(function*(){this.enqueueChunk({chunkNumber:e++,eventData:t.data})})),this.recorder.addEventListener("dataavailable",this.dataAvailableCallback)}enqueueChunk(e){this.chunks.push(e),this.gracefulStopRequested&&(this.recorder.removeEventListener("dataavailable",this.dataAvailableCallback),this.processChunks(!0)),!1===this.isChunksBeingProcessed&&this.processChunks()}processChunks(e=!1){return(0,s.__awaiter)(this,void 0,void 0,(function*(){if(this.gracefulStopRequested&&!e)return;if("recording"===this.recorder.state&&0===this.chunks.length)return void(this.isChunksBeingProcessed=!1);if(0===this.chunks.length)return;this.isChunksBeingProcessed=!0;let t=this.chunks.shift();try{const a=yield this.api.addChunk(this.phraseId,t.chunkNumber,e,t.eventData,this.abortController.signal);if(this.onPhraseUpdateHandler(a),(0,r.isFinalStatus)(a.status)||e)return void(yield this.stop((0,r.isErrorOccurred)(a.status)));yield this.processChunks()}catch(e){if("AbortError"===e.name)return;this.onStatusUpdate(n.TextSoFarStatus.API_ERROR),yield this.stop(!0)}}))}graceStop(){this.gracefulStopRequested=!0,this.onStatusUpdate(n.TextSoFarStatus.GRACE_STOP)}stop(e=!1,t=!1){return(0,s.__awaiter)(this,void 0,void 0,(function*(){if(!1===this.gracefulStopRequested&&this.onStatusUpdate(n.TextSoFarStatus.PRE_RESULT),this.abortController.abort(),this.stopRecorder(),this.chunks=[],this.isChunksBeingProcessed=!1,this.gracefulStopRequested=!1,t)this.onStatusUpdate(n.TextSoFarStatus.NOTHING);else if(e)this.onStatusUpdate(n.TextSoFarStatus.ERROR);else try{const e=yield this.api.getPhraseResult(this.phraseId);if(this.shouldInterrupt())return void this.onStatusUpdate(n.TextSoFarStatus.NOTHING);if(null===e.result.asr_text)return void this.onStatusUpdate(n.TextSoFarStatus.NOTHING);if(this.onPhraseFinishHandler(this.phraseId,e),0===e.result.commands.length&&0===e.result.controls.length)return void this.onStatusUpdate(n.TextSoFarStatus.NOTHING);this.onStatusUpdate(n.TextSoFarStatus.SUCCESS)}catch(e){this.onStatusUpdate(n.TextSoFarStatus.API_ERROR)}}))}}},868678:(e,t,a)=>{"use strict";var s;a.d(t,{TextSoFarStatus:()=>s}),function(e){e[e.INIT=0]="INIT",e[e.MEDIA_STREAM_ACQUIRED=1]="MEDIA_STREAM_ACQUIRED",e[e.PHRASE_CREATED=2]="PHRASE_CREATED",e[e.RECORDING=3]="RECORDING",e[e.API_ERROR=4]="API_ERROR",e[e.GRACE_STOP=5]="GRACE_STOP",e[e.PRE_RESULT=6]="PRE_RESULT",e[e.NOTHING=7]="NOTHING",e[e.SUCCESS=8]="SUCCESS",e[e.ERROR=9]="ERROR"}(s||(s={}))},407073:(e,t,a)=>{"use strict";var s;a.d(t,{ControlType:()=>s}),function(e){e.CONTROL_TYPE_RESUME="resume_control",e.CONTROL_TYPE_PAUSE="pause_control",e.CONTROL_TYPE_VOLUME="volume_control",e.CONTROL_TYPE_NEXT="next_control",e.CONTROL_TYPE_PREV="previous_control",e.CONTROL_TYPE_REPEAT="repeat_control",e.CONTROL_TYPE_REPEAT_PLAYLIST="repeat_playlist_control",e.CONTROL_TYPE_REWIND="rewind_control"}(s||(s={}))},95642:(e,t,a)=>{"use strict";a.d(t,{settingsChangesStatCollector:()=>i});var s=a(214547);const i=new class{constructor(){this.productStatCollector=new s.ProductionStatCollector,this.actionStatCollector=new s.ActionStatCollector(this.productStatCollector)}logEvent(e){const t={type:"type_settings_changes_item",type_settings_changes_item:e};this.actionStatCollector.logEvent(t)}}},285164:(e,t,a)=>{"use strict";a.d(t,{SHORT_VIDEO_UPLOAD_EXTS:()=>i,VIDEO_UPLOAD_EXTS:()=>n,SHORT_VIDEO_UPLOAD_INPUT_ACCEPT:()=>r,VIDEO_UPLOAD_INPUT_ACCEPT:()=>o,VIDEO_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>l,CLIP_UPLOAD_MAX_FILE_SIZE_IN_GB:()=>d,VIDEO_UPLOAD_CHUNK_SIZE:()=>c,VIDEO_UPLOAD_FILE_THREAD_NUMBER:()=>u,VIDEO_UPLOAD_CHUNK_MAX_RETRY_NUMBER:()=>_,VIDEO_UPLOAD_SUBTITLES_DISABLED:()=>g,VIDEO_UPLOAD_SUBTITLES_USER_LANG:()=>m});const s=e=>["video/*",...e.map((e=>`.${e}`))].join(","),i="avi mp4 3gp mpeg mov flv f4v wmv mkv webm vob rm rmvb m4v mpg ogv ts m2ts mts mxf".split(" "),n=[...i,"torrent"],r=s(i),o=s(n),l=5,d=1,c=4194304,u=4,_=10,g=-1,m=-2},813549:(e,t,a)=>{"use strict";a.d(t,{getVideoDuration:()=>n,getUploadErrorText:()=>r});var s,i=a(70162);function n(e){return new Promise((t=>{try{const a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=()=>t(Math.round(a.duration)),a.onerror=()=>t(null),a.src=window.URL.createObjectURL(e)}catch(e){t(null)}}))}function r(e){return e?e===s.SHORT_VIDEO_TOO_SHORT?i.getLang("video_upload_encode_error_too_short"):e===s.SHORT_VIDEO_TOO_LONG?i.getLang("video_upload_encode_error_too_long"):void 0:i.getLang("video_upload_encode_error")}!function(e){e[e.SHORT_VIDEO_TOO_SHORT=100]="SHORT_VIDEO_TOO_SHORT",e[e.SHORT_VIDEO_TOO_LONG=101]="SHORT_VIDEO_TOO_LONG"}(s||(s={}))},920502:(e,t,a)=>{"use strict";a.d(t,{MarusiaWebApi:()=>o});var s=a(426231),i=a(414325),n=a(420706);const r=new i.FetchService;class o extends s.MarusiaSharedApi{reloadAudios(e){return r.reloadAudios(e)}generateDeviceId(){return(0,n.generateDeviceId)("vk_web",this.debug)}}},231993:(e,t,a)=>{"use strict";a.d(t,{MarusiaWebCommands:()=>o});var s=a(93260),i=a(512980),n=a(856419),r=a(792482);class o{processMedia(e,t,a){return(0,s.processCommandMedia)(e,t,a)}processPlaylist(e,t){(0,s.processCommandPlaylist)(e,t)}processPortalDeeplink(e){window.open(e.url,"_self")}processNeedMoreVkPermissions(e,t,a){return(0,i.processCommandNeedMoreVkPermissions)(e,t,a)}processCallStart(e){(0,n.processCommandCallStart)(e)}autoPlayMediaAttaches(e,t,a,i){return(0,s.autoPlayMediaAttaches)(e,t,a,i)}executeControl(e,t){(0,r.executeControl)(e,t)}}},856419:(e,t,a)=>{"use strict";a.d(t,{processCommandCallStart:()=>i});var s=a(363035);function i(e){window.Calls&&window.Calls.call&&!window.Calls.isInActiveCall&&window.Calls.call(parseInt(String(e.recipient_id)),!1,void 0,s.CallStatSource.CONVO_HEADER)}},93260:(e,t,a)=>{"use strict";a.d(t,{autoPlayMediaAttaches:()=>c,processCommandMedia:()=>u,processCommandPlaylist:()=>_});var s=a(570655),i=a(43873),n=a(240950),r=a(20575),o=a(69957),l=a(942763);function d(e,t){e.getCurrentPlaylist()&&e.deleteCurrentPlaylist();const a=new i.AudioPlaylist({accessHash:void 0,albumId:`im${n.MARUSIA_PEER_ID}`,blockId:"",hasMore:!1,ownerId:window.vk.id,type:i.AudioPlaylist.TYPE_TEMP});a.mergeWith({list:t}),e.addPlaylist(a),e.play((0,l.getFullIdFromTuple)(t[0]),a,"im")}function c(e,t,a,i){var n,c;return(0,s.__awaiter)(this,void 0,void 0,(function*(){if(!a.length)return;const s=(0,l.getCommandsToAutoplay)(a,i),u=s.every((e=>e.media_type===r.MarusiaMediaType.podcast));if(0===s.length)return;const _=i.filter((e=>e.attaches.some(l.isAudioAttach))).map((e=>document.querySelector(`._im_mess[data-msgid="${e.messageId}"]`))).filter(Boolean);var g;if(_&&(yield(g=_,new Promise(((e,t)=>{let a=!1;const s=setTimeout((()=>{a=!0,t(new Error(o.MarusiaError.ATTACH_LOAD_TIMEOUT))}),3e4),i=()=>{g.every((e=>!!e.querySelector("._audio_row")||!!e.querySelector(".im_msg_media_podcast")))?(clearTimeout(s),e()):a||setTimeout(i,100)};i()})))),u)return void(null===(c=null===(n=_[0])||void 0===n?void 0:n.querySelector(".podcast_snippet__play"))||void 0===c||c.click());const m=s.map((e=>(0,l.constructPlayerAudio)(e.meta,!1,(0,l.getVoiceAssistantData)(e,i)))),p=yield(0,l.getHashesForAudios)(e,m);p&&d(t,p)}))}function u(e,t,a){return(0,s.__awaiter)(this,void 0,void 0,(function*(){const s=yield(0,l.getAudioList)(t,a);s&&d(e,s)}))}function _(e,t){d(e,t.tracks.map((e=>(0,l.constructPlayerAudio)(e.meta,t.media_type===r.MarusiaMediaType.tale))))}},792482:(e,t,a)=>{"use strict";a.d(t,{executeControl:()=>n});var s=a(412546),i=a(407073);function n(e,t){var a;const n=null===(a=document.querySelector("._audio_page_layout"))||void 0===a?void 0:a.firstChild,r=n?(0,s.currentAudioPage)(n):null;switch(t.type){case i.ControlType.CONTROL_TYPE_RESUME:e.play();break;case i.ControlType.CONTROL_TYPE_PAUSE:e.pause();break;case i.ControlType.CONTROL_TYPE_VOLUME:e.setVolume(t.level/100);break;case i.ControlType.CONTROL_TYPE_NEXT:e.playNext(!0);break;case i.ControlType.CONTROL_TYPE_PREV:e.seekToTime(0),setTimeout((()=>e.playPrev()));break;case i.ControlType.CONTROL_TYPE_REPEAT:e.toggleRepeatCurrentAudio(),null==r||r.updateRepeatButton();break;case i.ControlType.CONTROL_TYPE_REPEAT_PLAYLIST:e.toggleRepeatAll(),null==r||r.updateRepeatButton();break;case i.ControlType.CONTROL_TYPE_REWIND:e.seekToTime(t.elapsed)}}},143611:(e,t,a)=>{"use strict";a.d(t,{showSkillListModal:()=>c});var s=a(570655),i=a(146143),n=a(70162),r=a(873589),o=a(501389),l=a(511417),d=a(264859);function c(e,t){var a;return(0,s.__awaiter)(this,void 0,void 0,(function*(){const s=new i.MessageBox({title:void 0,noControls:!0,containerClass:"MarusiaHelp__box"});s.show(),(0,r.hide)(s.bodyNode),(0,o.showBoxLoader)();const c=yield(0,d.loadSkills)(e);if("error"in c)return;const u=c.result.phrase_result.commands.find(d.isEventListCommand),_=null!==(a=null==u?void 0:u.items)&&void 0!==a?a:[],g=document.createElement("ul");g.className="MarusiaHelp__list",_.forEach((e=>{g.appendChild(function(e,t,a){const s=l.colorScheme.isDarkScheme()?e.icons.dark:e.icons.light,i=document.createElement("li");return i.className="MarusiaHelp__item",i.innerHTML=`\n  <div class="MarusiaHelp__wrapper">\n    <img class="MarusiaHelp__icon" src="${s}" alt="${e.title}">\n  </div>\n  <div>\n    <p class="MarusiaHelp__title">${e.title}</p>\n    <p class="MarusiaHelp__subtitle">${e.subtitle}</p>\n  </div>`,i.onclick=()=>{a({type:"text_suggest",callback_data:"",payload:e.subtitle,text:e.subtitle}),t.hide()},i}(e,s,t))})),(0,o.hideBoxLoader)(),(0,r.show)(s.bodyNode),s.setOptions({title:n.getLang("mail_marusia_bottom_sheet_skills_title")}),s.content(g)}))}},853856:(e,t,a)=>{"use strict";a.r(t),a.d(t,{marusiaSdk:()=>d});var s=a(278747),i=a(231993),n=a(677865),r=a(143611),o=a(920502),l=a(274642);const d=new s.MarusiaSharedSdk({api:new o.MarusiaWebApi(window.__dev),showSkillListModal:r.showSkillListModal,audioPlayer:new n.MarusiaWebPlayerAdapter((0,l.getAudioPlayer)()),commands:new i.MarusiaWebCommands,getTextFromInputEvent:e=>e.target.innerText,debug:window.__dev})},679483:(e,t,a)=>{"use strict";a.d(t,{loadMarusiaSdk:()=>n});var s=a(659397),i=a(857833);function n(){return(0,s.asyncImportLoader)((()=>Promise.resolve().then(a.bind(a,853856))),3).then((e=>{if(!e.marusiaSdk)throw new Error("MarusiaSdkEmptyError");return e.marusiaSdk})).catch((e=>(i.marusiaStats.logModuleLoadError(e.message),null)))}},548391:(e,t,a)=>{"use strict";a.d(t,{BotButton:()=>u});var s=a(785893),i=a(667294),n=a(86894),r=a(659397),o=a(69935),l=a(75560),d=a(459554),c=a(475234);function u({button:e,keyboardAuthorId:t,sendMessage:a,store:u}){const[_,g]=(0,i.useState)(!1),m=(0,i.useMemo)((()=>(0,l.getButtonLabel)(e)),[e]),{mode:p,appearance:h}=(0,i.useMemo)((()=>{let t="primary",a="accent";switch((0,l.getButtonAppearance)(e)){case"primary":break;case"secondary":t="secondary";break;case"positive":a="positive";break;case"negative":a="negative"}return{mode:t,appearance:a}}),[e]);const v=(0,i.useMemo)((()=>e.action.type===l.BUTTON_TYPE_OPEN_LINK||e.action.type===l.BUTTON_TYPE_OPEN_MODAL_VIEW?{href:(0,o.wrapAwayIfExternal)(e.action.link,!0),target:"_blank",rel:"nofollow noopener"}:null),[e]);return(0,s.jsx)(n.Button,Object.assign({className:(0,r.classNames)("BotButton",`BotButton--${e.action.type.replace("_","-")}`),onClick:function(){if(_)return;const s=(0,d.getCurrentTab)(u);return s?(0,l.handleButtonClick)(e.action,a,u,{keyboardAuthorId:t,peerId:s.peerId,onBeforeSend(){g(!0)},onSendSuccess(e){const t=()=>{g(!1)},a={timeout:window.setTimeout(t,l.CALLBACK_TIMEOUT_MS),onCallback:t};u.set((t=>(0,c.setPressedCallbackButton)({peerId:s.peerId,eventId:e},a,t))),g(!0)},onSendFail(){g(!1)}}):void 0},mode:p,appearance:h,loading:_,stretched:!0},v,{children:(0,s.jsx)("span",Object.assign({className:"BotButton__labelWrap"},{children:(0,s.jsx)("span",{className:"BotButton__label",dangerouslySetInnerHTML:{__html:m}},void 0)}),void 0)}),void 0)}},682886:(e,t,a)=>{"use strict";a.d(t,{CAROUSEL_VIEWPORT_CLASS:()=>o,CAROUSEL_LAYER_CLASS:()=>l,mount:()=>f});var s=a(610124),i=a(873589),n=a(368752);const r="_im_carousel",o="_im_carousel_viewport",l="_im_carousel_layer",d="_im_carousel_control",c="Carousel__control--hidden";function u(e){return(0,i.domClosest)(r,e.target)}function _(e,t){const a=t.querySelector("._im_carousel_control_left"),s=t.querySelector("._im_carousel_control_right"),i=t.querySelector(`.${o}`),n=t.querySelector(`.${l}`);if(!(s&&a&&i instanceof HTMLElement&&n instanceof HTMLElement))return;const r=i.offsetWidth,d=n.offsetWidth,u=r<d;a.classList.toggle(c,!u||e<=0),s.classList.toggle(c,!u||e+r>=d)}function g(e){const t=u(e),a=(0,i.domClosest)(d,e.target),s=Number(a.dataset.direction);if(!t)return;const n=t.querySelector(`.${o}`),r=t.querySelector(`.${l}`);if(!n||!r||!s)return;const c=Number(t.dataset.scrollCount)||1,g=Math.floor(r.offsetWidth/r.childElementCount),m=(Math.floor(n.scrollLeft/g)+s*c)*g;_(m,t),n.scrollTo({left:m,behavior:"smooth"})}const m=(0,n.debounce)((e=>{const t=u(e),a=t&&t.querySelector(`.${o}`);a&&_(a.scrollLeft,t)}),20);function p(e){const t=u(e);(t&&t.querySelector(`.${o}`)).addEventListener("scroll",m)}function h(e){const t=u(e);(t&&t.querySelector(`.${o}`)).removeEventListener("scroll",m)}function v(e){return{unmount(){(0,s.destroyModule)(e)}}}function f(e,t){const{bindMutations:a}=(0,s.createMutations)(v);return a((0,s.createModule)({handlers:(e,a)=>{a(t,"click",d,g),a(t,"mouseover",r,p),a(t,"mouseout",r,h)}}),e)}},176651:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});var s=a(610124),i=a(384032),n=a(661711),r=a(284863),o=a(179288),l=a(993421),d=a(70162),c=a(342269);const u="_im_to_unread";function _(e,t,a){const _=(e,s)=>{(0,n.showUnreadOnly)(t,a,i.changeDialogsTab).then((e=>{const i=t.get().active_tab;if(!e)return;const n=i===o.ConvoListFolder.UNREAD;s.innerHTML=(0,c.getTemplate)("im_filter",{filter:n?d.getLang("mail_to_all_dialogs"):d.getLang("mail_to_unread")}),i===o.ConvoListFolder.ALL&&a().updateRecommendationList(t)}))},g=(0,s.createModule)({handlers:(t,a)=>{a(e,"click",u,_)}});return function(e,t){return{updateFilter(t){const a=t.get().active_tab,s=a===o.ConvoListFolder.UNREAD;let i,n=[];((0,r.isSearching)(t)||[o.ConvoListFolder.BUSINESS_NOTIFY,o.ConvoListFolder.ARCHIVE,o.ConvoListFolder.MR].includes(a))&&n.push("im-page--dialogs-filter_hidden"),(0,l.getUnreadCountWithMuted)(t)>0?i=s?d.getLang("mail_to_all_dialogs"):d.getLang("mail_to_unread"):(i=d.getLang("mail_all_dialogs"),n.push("im-page--dialogs-filter_disabled"));const u=e.querySelector("._im_to_unread");u&&(u.innerHTML=(0,c.getTemplate)("im_filter",{filter:i,cls:n.join(" ")}))},toggleButton(t,a){const s=e.querySelector(".im-page--dialogs-filter");s&&s.classList.toggle("im-page--dialogs-filter_hidden",a)},toggleLoader(t,a){const s=e.querySelector("._im_dialogs_cog_settings");s&&s.classList.toggle("im-page--dialogs-settings_loading",a)},unmount(){(0,s.destroyModule)(t)}}}(e,g)}},668667:(e,t,a)=>{"use strict";a.d(t,{mount:()=>u,mountHistoryMsgsReactionsObserver:()=>_});var s=a(610124),i=a(712439),n=a(305096),r=a(993421),o=a(342269),l=a(459554),d=a(412827);function c(e,t,a,s){const{observer:i,targets:n}=a.get();n.forEach((e=>i.unobserve(e)));const o=function(e,t,a){const s=(0,r.getPeer)(e);if(!(0,l.isFullyLoadedTab)(e,s))return[];const i=(0,l.getTab)(e,s);return i&&i.msgs?Object.keys(i.msgs).reduce(((e,s)=>{if(!i.msgs)return e;const n=(0,d.parseMessage)(i.msgs[s]);if(!t(n,i))return e;const r=a||document,o=r.querySelector(`._im_mess_${s}`)||r.querySelector(`._im_expired_message_${s}`);return o&&e.push(o),e}),[]):[]}(e,s,t);a.setState({targets:o}),o.forEach((e=>i.observe(e)))}function u(e,t,a,n){const r=(0,i.default)({observer:new IntersectionObserver(a,{root:t}),targets:[]});c(e,t,r,n);const o=(0,s.createModule)({handlers:()=>{}});let l=!1;return{update(){l||c(e,t,r,n)},unmount(){const{observer:e}=r.get();e.disconnect(),(0,s.destroyModule)(o),l=!0}}}function _(e,t,a,l,d){let u=new Set,_=new Map,g=new Map;function m(t){const a=(0,r.getPeer)(e),s=(0,r.getUnreadReactions)(e,a),i=[];for(let e of t)s.has(e)&&i.push(e);return i}const p=(0,n.throttle)((()=>{const e=m(Array.from(u));e.length&&d(e)}),100);const h=setInterval((function(){const e=Array.from(u),t=function(e){const t=Date.now(),a=e.some((e=>{const a=g.get(e),s=_.get(e);return a&&s&&t-a>=15e3&&t-s>=1e3}));return a&&e.forEach((e=>{g.set(e,t)})),a}(e),a=m(e);t&&l(e),a.length&&d(a)}),1e3),v=e=>{u=new Set;const{targets:t}=e.get(),a=new Map,s=new Map;t.forEach((e=>{const t=e.getAttribute("data-cmid"),i=t&&(0,o.intval)(t);if("number"==typeof i){const e=g.get(i)||Date.now(),t=_.get(i);t&&s.set(i,t),a.set(i,e)}})),g=a,_=s},f=(0,i.default)({observer:new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target.getAttribute("data-cmid"),a=t&&(0,o.intval)(t);if("number"==typeof a){if(e.isIntersecting){u.add(a);const e=_.get(a)||Date.now();_.set(a,e)}else u.delete(a),_.delete(a);p()}}))}),{root:t}),targets:[]});c(e,t,f,(()=>!0)),v(f);const b=(0,s.createModule)({handlers:()=>{}});let y=!1;return a(),{update(){y||(c(e,t,f,(()=>!0)),v(f))},unmount(){const{observer:e}=f.get();e.disconnect(),(0,s.destroyModule)(b),y=!0,clearInterval(h)}}}},402601:(e,t,a)=>{"use strict";a.d(t,{mount:()=>_});var s=a(785893),i=a(973935),n=a(99656),r=a(163810),o=a(125672),l=a(610124),d=a(384032);function c(){return document.getElementById("_im_keyboard_container")}function u(e,t,a){return{init(){return new Promise((e=>{this.isMounted=!0,function(e,t,a){const l=c();if(l){const d=(0,s.jsx)(n.AppRootProvider,{children:(0,s.jsx)(o.default,Object.assign({value:e},{children:(0,s.jsx)(r.default,{send:t},void 0)}),void 0)},void 0);i.render(d,l,a)}}(t,a,e)}))},toggle:(e,a,s)=>t.set(d.toggleKeyboard.bind(null,e,a,s)),unmount(){const t=c();t&&this.isMounted&&i.unmountComponentAtNode(t),this.isMounted=!1,(0,l.destroyModule)(e)}}}function _(e,t,a){const{bindMutations:s}=(0,l.createMutations)(u);return s((0,l.createModule)({handlers:()=>{}}),e,a)}},241103:(e,t,a)=>{"use strict";a.d(t,{mount:()=>C});var s=a(785893),i=a(973935),n=a(125672),r=a(610124),o=a(384032),l=a(284863),d=a(459554),c=a(516703),u=a(354897),_=a(659397),g=a(939817),m=a(146143),p=a(993421);const h=a(219053).default,v=a(944194).default,{MAIN:f,EDIT:b}=a(944194);function y(e,t){return(0,u.default)().reduce(((t,a)=>t.replace(new RegExp(`({${a.id}})`,"gi"),a.process(e))),t).replace(/&lt;br&gt;/gi,"<br>")}function w(e,t,a,r,u){let h;return{closeSettingsPopup(){h&&h.hide()},showSettingsPopup(e){const a="TemplatesSettings",r={hideButtons:!0,bodyStyle:"padding: 0; background: none;",width:500,onShow:()=>{const r=document.getElementById(a);r&&i.render((0,s.jsx)(n.default,Object.assign({value:t},{children:(0,s.jsx)(v,{popup:h,section:e,getTemplates:()=>(0,l.getTemplates)(t),saveTemplate:this.saveTemplate.bind(this),deleteTemplate:this.deleteTemplate.bind(this),closePopup:this.closeSettingsPopup.bind(this)},void 0)}),void 0),r),requestAnimationFrame((()=>h.updateBoxCoords()))}};h=new m.MessageBox(r).content(`<div id="${a}"></div>`),h.show()},applyTemplate(e){const a=(0,l.getTemplates)(t).find((({id:t})=>t===e));(0,c.statlogsCommunityTemplatesClickEvent)(),r(y(t,(0,g.prepareToWriting)(a.text)))},getPreparedTemplates:()=>(0,l.getTemplates)(t).map((e=>Object.assign({},e,{name:e.name,text:y(t,e.text)}))),saveTemplate(e){const a=(0,_.decodeHTMLEntities)(e.name),s=(0,_.decodeHTMLEntities)(e.text);return t.set(e.id?o.updateTemplate.bind(null,e.id,a,s):o.createTemplate.bind(null,a,s))},deleteTemplate:e=>t.set(o.deleteTemplate.bind(null,e)),isNeedRenderTemplates(){const e=(0,p.getPeer)(t);if(!e)return!1;if(!(0,l.isCommunityInterface)(t))return!1;const a=(0,d.getCurrentTab)(t);return(!a||!(0,l.isChannelPeer)(a))&&!(0,l.isCommunityChat)(t,e)},toggleImText(e=this.isNeedRenderTemplates()){u(e)},update(){this.toggleImText()},unmount(){this.toggleImText(!1)}}}function C(e,t,a,o){const{bindMutations:l}=(0,r.createMutations)(w),d=l((0,r.createModule)({handlers:()=>{}}),e,t,a,o);if("function"!=typeof d){d.toggleImText();const a=(0,s.jsx)(n.default,Object.assign({value:e},{children:(0,s.jsx)(h,{getTemplates:d.getPreparedTemplates,applyTemplate:d.applyTemplate.bind(d),isNeededRendering:d.isNeedRenderTemplates,showSettingsPopup:d.showSettingsPopup.bind(d,f),showCreatingTemplatePopup:d.showSettingsPopup.bind(d,b)},void 0)}),void 0);i.render(a,t)}return d}},981311:(e,t,a)=>{"use strict";var s=a(773499),i=a(501389),n=a(152351),r=a(712439),o=a(645523),l=a(384032),d=a(238283),c=a(661711),u=a(342269),_=a(70162),g=a(873589),m=a(520797),p=a.n(m),h=a(506770),v=a(997109),f=a(488317);a(216799);window.IM={init(e){var t;if((0,u.addTemplates)(p()),window.cur.lang.dont_attach=_.getLang("mail_dont_add_media"),e.failed)return(0,n.mount)((0,g.geByClass1)("im-sick",(0,g.ge)("page_body")),null);localStorage.removeItem("im_sick_timer"),window.cur.ctrl_submit=Boolean(e.settings.ctrl_submit),window.cur.module="im",window.cur.mutedPeers=e.mutedPeers,window.cur.gid=e.gid,window.cur.peer=e.peer,window.cur.options={blacklist_hash:e.thash};const a=-10800-60*(new Date).getTimezoneOffset(),m=e.timeshift,f=Object.entries(e.defaultReactions).reduce(((e,[t,a])=>e.set(Number(t),a)),new Map),b=Object.assign(Object.assign({},e),{owners:void 0,tabbedPeers:(e.tabbedPeersArray||[]).map((e=>({peer:e,type:"perm"}))),blockedFlagUpdates:{},msgid:(0,u.intval)(window.nav.objLoc.msgid),timeshift:m-a,oCache:{},ref_id:window.nav.objLoc.ref,ref_source:window.nav.objLoc.ref_source,topConvTree:new Promise((()=>{})),hintsTree:new Promise((()=>{})),imTopConvList:new Promise((()=>{})),callbackEventButtons:new Map,reactions:f,pendingReadReactionsCmids:new Map,cmidToMessageIdMap:new Map});let y=(0,r.default)(b);null===(t=e.owners)||void 0===t||t.forEach((e=>(0,d.oCacheAdd)(y,e))),(0,c.normalizeTabsGotFromServer)(y,y.get().tabs),window.cur.imClassicInterface=(0,c.isClassicInterface)(y);let w=(0,s.mount)((0,g.geByClass1)("js-im-page",(0,g.ge)("page_body")),y);(0,l.updateMentions)(y.get()),e.group_calls_feature_tt_hash&&(0,c.showGroupCallsOnboardingBox)(y.get(),e.group_calls_feature_tt_hash),e.group_calls_new_year_feature_tt_hash&&(0,c.showGroupCallsNewYearTooltip)(y.get(),e.group_calls_new_year_feature_tt_hash),window.IMBRIDGE={chatPhotoSaved(e){(0,i.curBox)()&&(0,i.curBox)().hide();let t=(e||{})[1];return t?(window.cur.pvShown&&window.layers.fullhide(!0,!0),"im"!=window.cur.module||y.get().peer!=t?window.nav.go("/im?sel=c"+(t-2e9)):void 0):window.nav.reload()},syncHistory(){y.set((e=>(0,l.syncHistory)(e))).then((()=>{}),(()=>{}))},activateTab(e,t="notifications"){y.get().gid||y.get().longpoll.push([(0,o.changePeer)((0,u.intval)(e),!1,!1,!0,t)])},selectedPeer:()=>y.get().peer,openSettings(){w.openSettings()}},(0,h.partConfigEnabled)("debug_messenger")&&(window.IMBRIDGE.store=y);let C=!1;window.cur.nav.push((function(){var e;return!!C||((null===(e=y.get().audio_msg)||void 0===e?void 0:e.isRecording)&&w.cancelRecording(),window.AudioMessagePlayer.detachPlayer(),w.route.apply(null,arguments))})),(0,v.pushNavDestroy)((function(){if(C)return!0;w.unmount(),window.IMBRIDGE=void 0,y.unmount(),window.store=void 0,C=!0,e=!1,y=!1,w=!1}))},initOnboarding:f.initOnboarding,updateHints:f.updateHints,activeHints:[],onboardingParams:{}};try{window.stManager.done("imn.js")}catch(e){}},954972:(e,t,a)=>{"use strict";a.d(t,{setMessageFlag:()=>n,addMessageReactionOptimistic:()=>r,removeMessageReactionOptimistic:()=>o});var s=a(376473),i=a(459554);function n(e,t,a,n,r){const o=(0,i.getTab)(e,t),l=(0,s.getMessage)(e,t,a);return o&&o.msgs&&l?(l.flags=r?l.flags|n:l.flags&~n,o.msgs[a]=l,Promise.resolve(e)):Promise.resolve(e)}function r(e,t,a,n){var r;const o=(0,i.getTab)(n,e),l=(0,s.getMessage)(n,e,t),d=(null==l?void 0:l.kludges.reactions)||[],c=n.id;if(!l||!(null==o?void 0:o.msgs))return Promise.resolve(n);const u=d.findIndex((e=>e.reaction_id===a));if(l.kludges.reaction_id=a,l.kludges.reactions||(l.kludges.reactions=[]),-1===u)l.kludges.reactions.push({reaction_id:a,count:1,user_ids:[c]});else{const e=d[u];null===(r=e.user_ids)||void 0===r||r.unshift(c),e.count=e.count+1,l.kludges.reactions=[...d.slice(0,u),e,...d.slice(u+1)]}return o.msgs[t]=l,Promise.resolve(n)}function o(e,t,a,n){var r;const o=(0,i.getTab)(n,e),l=(0,s.getMessage)(n,e,t);if(!l)return Promise.resolve(n);const d=(null==l?void 0:l.kludges.reactions)||[],c=n.id;if(delete l.kludges.reaction_id,0===d.length||!(null==o?void 0:o.msgs))return Promise.resolve(n);const u=d.findIndex((e=>e.reaction_id===a)),_=d[u];return _.user_ids=null===(r=_.user_ids)||void 0===r?void 0:r.filter((e=>e!==c)),_.count=_.count-1,l.kludges.reactions=[...d.slice(0,u),_,...d.slice(u+1)].filter((e=>0!==e.count)),o.msgs[t]=l,Promise.resolve(n)}},974309:(e,t,a)=>{"use strict";a.d(t,{ContactList:()=>c});var s=a(785893),i=a(360542),n=a(359284),r=a(781402),o=a(70162),l=a(973935);const d=({store:e,browserEnv:t,onClose:a,onSelect:l})=>(0,s.jsxs)(n.default,Object.assign({onClose:a,disableBodyScroll:!0},{children:[(0,s.jsx)(r.default.Header,{title:o.getLang("mail_contacts_list"),onClose:a},void 0),(0,s.jsx)("div",Object.assign({style:{width:550,height:560}},{children:(0,s.jsx)(i.ContactListApp,{store:e,env:t,onSelect:l},void 0)}),void 0)]}),void 0);class c{constructor(){this.isMounted=!1}renderContactListPopup(e,t){const a=c.getContainer(),i=()=>this.hide();a&&l.render((0,s.jsx)(d,{store:e,browserEnv:t,onClose:i,onSelect:e=>this.onSelectPeer(e)},void 0),a)}static getContainer(){return document.getElementById("ContactList")}hide(){if(!this.isMounted)return;const e=c.getContainer();e&&l.unmountComponentAtNode(e),this.isMounted=!1}show(){var e;const t=null===(e=window.reforgedME)||void 0===e?void 0:e.contactListContext;if(!t)return;const{store:a,browserEnv:s}=t;this.renderContactListPopup(a,s),this.isMounted=!0}onSelectPeer(e){this.hide(),window.nav.go(`/im?sel=${e}`,null,{params:{entrypoint:"contacts_list"}})}}},218233:(e,t,a)=>{"use strict";a.d(t,{Api:()=>u});var s=a(570655),i=a(607815),n=a(816405),r=a(616963),o=a(891047),l=a(189798),d=a(840060);const c=["messages.getLongPollServer","messages.getLongPollHistory","queue.subscribe","account.setOnline"];class u{constructor(e){this.abortTrackers=new Map,this.fetch=(e,t,a={})=>(0,s.__awaiter)(this,void 0,void 0,(function*(){if("queue.subscribe"===e)return Promise.resolve({base_url:"mock",queues:[]});a.timeout||(a.timeout=1e4),t=this.enrichParams(e,t);const n=c.includes(e),r=`${e} ${JSON.stringify(t)}`;let o=a.retries||0,l=0;for(;;)try{if(n&&window.curNotifier&&!window.curNotifier.is_server&&!d.browser.safari){yield g((u=500,_=1500,Math.random()*(_-u+1)+u));const e=yield this.cache.get(r);if(e)return e}const{response:o,abort:l}=this.request(e,t,a.timeout);a.trackId&&this.abortTrackers.set(a.trackId,l);const c=yield o.catch((e=>{if("api_error"===e.type){const t=e.error,{error_code:a,error_message:n}=t,r=(0,s.__rest)(t,["error_code","error_message"]);throw new i.IApi.RequestError(a,n,r)}throw e})).finally((()=>{a.trackId&&this.abortTrackers.delete(a.trackId)}));if(c.execute_errors)throw new i.IApi.ExecuteErrors(c.execute_errors);return n&&this.cache.set(r,c).catch((()=>{})),c}catch(e){if(e instanceof i.IApi.AbortError)throw e;if(l++,l===o+1)throw e;yield g(Math.min(500*Math.pow(2,l-1),2e4))}var u,_})),this.request=(e,t,a)=>{const s=new AbortController;let r,o=!1;a&&(r=window.setTimeout((()=>{o=!0,s.abort()}),a));const d={};for(const e of Object.keys(t))void 0!==t[e]&&(d[e]=t[e]);return{response:(0,l.api)(e,d,{version:n.API_VERSION},{signal:s.signal}).catch((t=>{if(s.signal.aborted)throw o?new i.IApi.TimeoutError(`[API] Timeout Error: ${e}`):new i.IApi.AbortError(`[API] Abort Error: ${e}`);throw t})).finally((()=>{r&&clearTimeout(r)})),abort:()=>{s.abort()}}},this.enrichParams=(e,t)=>{switch(e.slice(0,e.indexOf("."))){case"users":case"friends":return Object.assign(Object.assign({},t),{fields:r.API_USER_FIELDS.join(",")});case"groups":return Object.assign(Object.assign({},t),{fields:r.API_GROUP_FIELDS.join(",")});default:return"extended"in t&&t.extended?Object.assign(Object.assign({},t),{fields:Array.from(new Set([...r.API_USER_FIELDS,...r.API_GROUP_FIELDS])).join(",")}):t}},this.cache=new _(3e3,e)}static dropCache(){indexedDB.deleteDatabase(_.CACHE_DB_NAME)}dangerouslyAbort(e){var t;e&&(null===(t=this.abortTrackers.get(e))||void 0===t||t(),this.abortTrackers.delete(e))}fetchMany(e,t){const a=[],s=[];let i=!1;for(let t=e.length-1;t>=0;t--){const n=e[t];if(!n){s[t]="null";continue}const r=`res${t}`,o=`API.${n.method}(${JSON.stringify(this.enrichParams(n.method,n.params))})`;i?(a[t]=`var ${r}=fork(${o});`,s[t]=`wait(${r})`):(i=!0,a[t]=`var ${r}=${o};`,s[t]=`${r}`)}const n=`${a.join("")}return [${s.join(",")}];`;return this.fetch("execute",{code:n},t)}fetchSeq(e,t){const a=[],s=[];for(let t=0;t<e.length;t++){const i=e[t];if(!i){s.push("null");continue}const n=`res${t}`;a.push(`var ${n}=API.${i.method}(${JSON.stringify(this.enrichParams(i.method,i.params))});`),s.push(`${n}`)}const i=`${a.join("")}return [${s.join(",")}];`;return this.fetch("execute",{code:i},t)}}class _{constructor(e,t){this.invalidateTimeout=e,this.cache=o.createStore(_.CACHE_DB_NAME,"api-cache-"+t)}get(e){return o.get(e,this.cache).then((t=>{if(void 0!==t){if(!(t.expiresAt<Date.now()))return setTimeout((()=>{o.del(e,this.cache).catch((()=>{}))}),Date.now()-t.expiresAt),t.response;o.del(e,this.cache).catch((()=>{}))}})).catch((()=>{}))}set(e,t){const a={response:t,expiresAt:Date.now()+this.invalidateTimeout};return o.set(e,a,this.cache).then((()=>{setTimeout((()=>{o.del(e,this.cache).catch((()=>{}))}),this.invalidateTimeout)})).catch((()=>{}))}}function g(e){return new Promise((t=>setTimeout(t,e)))}_.CACHE_DB_NAME="reforged-db-v1"},891747:(e,t,a)=>{"use strict";a.d(t,{BrowserNotifications:()=>i});var s=a(327125);class i{constructor(){this.getState=()=>{var e;return(null===(e=window.pushNotifier)||void 0===e?void 0:e.loadEndpoint())||window.ls.get("im_ui_notify_off")?"external":this.isBrowserNotificationsEnabled()},this.onChange=e=>e&&!this.isBrowserNotificationsEnabled()?new Promise((e=>{window.DesktopNotifications.requestPermission((()=>{this.statlogsBrowserNotificationsOn(),e("external")}))})):!e&&this.isBrowserNotificationsEnabled()?(window.ls.set("im_ui_notify_off",1),this.statlogsBrowserNotificationsOff(),Promise.resolve(!1)):Promise.resolve(e),this.onExternal=()=>window.nav.go("/settings?act=notify"),this.isBrowserNotificationsEnabled=()=>window.DesktopNotifications.supported()&&!window.DesktopNotifications.checkPermissionNeeded()&&!window.ls.get("im_ui_notify_off"),this.statlogsBrowserNotificationsOn=()=>{(0,s.statlogsProbValueEvent)(1,"im_browser_notifications_on",1)},this.statlogsBrowserNotificationsOff=()=>{(0,s.statlogsProbValueEvent)(1,"im_browser_notifications_off",1)}}}},497138:(e,t,a)=>{"use strict";a.d(t,{GeoLocation:()=>i});var s=a(75560);class i{get(){return new Promise((e=>{(0,s.sendLocationFromKeyboard)((([,t])=>{const[a,s]=t.split("_");e([a,s])}))}))}}},159003:(e,t,a)=>{"use strict";a.d(t,{Idle:()=>s});class s{constructor(e){this.logger=e,this.listeners=new Set,this.isIdle=()=>void 0===this.timeoutId,this.subscribe=e=>(this.listeners.add(e),()=>{this.listeners.delete(e)}),this.onVisibilityChange=()=>{document.hidden?(document.removeEventListener("mousemove",this.onActive),document.removeEventListener("keydown",this.onActive,!0),this.onIdle()):(document.addEventListener("mousemove",this.onActive),document.addEventListener("keydown",this.onActive,!0),this.onActive())},this.onIdle=()=>{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0,this.notify())},this.onActive=()=>{const e=void 0!==this.timeoutId;this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=window.setTimeout(this.onIdle,3e4),e||this.notify()},this.notify=()=>{this.logger.info("[IDLE]","user became "+(this.isIdle()?"idle":"active"));for(const e of this.listeners)e(this.isIdle())},this.onVisibilityChange(),document.addEventListener("visibilitychange",this.onVisibilityChange)}}},402508:(e,t,a)=>{"use strict";a.d(t,{Logger:()=>i});var s=a(721422);class i{constructor(){this.visible=!1,this.configureScope=()=>{},this.info=(...e)=>{this.visible&&console.log(...e)},this.error=(e,t)=>{t?console.error(e,t):console.error(e);const a=e=>{(0,s.logError)(e,{environment:"messenger"})};if(t instanceof Error){const s=new Error(e+" "+t.message);return s.name=t.name,s.stack=t.stack,a(s)}if("string"==typeof t)return a(new Error(e+" "+t));if(t&&"api_error"===t.type){const s=JSON.stringify(t.error);return a(new Error(e+" "+s))}return a(new Error(e))},this.show=()=>{this.visible=!0},this.hide=()=>{this.visible=!1}}}},370894:(e,t,a)=>{"use strict";a.d(t,{Notification:()=>s});class s{notify(){}playSound(){}setCounters(){}}},189754:(e,t,a)=>{"use strict";a.d(t,{FCVoicePlayer:()=>u,FCPlayer:()=>_});var s=a(937884),i=a(274642),n=a(43873),r=a(331811),o=a(873589);const l=([e,t,a,s,i,n,,,,,,,,,,,,,,,r,,,,,],o)=>({audioTrack:{id:`${t}_${e}`,url:a,progress:o,duration:n},title:s,artist:i,trackCode:r}),d=e=>{const[t,a]=e;return`${a}_${t}`},c=({audioTrack:e,title:t,artist:a,trackCode:s})=>{const{id:i,url:n,duration:r}=e,[o,l]=i.split("_");return[Number(l),Number(o),n,t,a,r,0,0,"",0,0,"im","[]","/////undefined/","",{},"","","",!1,s||"",0,0,0,"",!1]};class u extends r.EventBus{constructor(){super(),this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},window.AudioMessagePlayer.events.on("playing",(e=>{if(this.state.currentTrackEntity&&e!==this.audioEl){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state=Object.assign(Object.assign({},this.state),{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:Object.assign(Object.assign({},e),{audioTrack:Object.assign(Object.assign({},t),{progress:0})})}),this.emit("stateupdated",this.state),this.audioEl=void 0,this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},this.emit("stateupdated",this.state)}if(e===this.audioEl&&"string"==typeof e.dataset.audioTrack){const t=e.dataset.convoAudioTrack&&JSON.parse(e.dataset.convoAudioTrack);this.state=Object.assign(Object.assign({},this.state),{status:"playing",currentTrackEntity:t}),this.emit("stateupdated",this.state)}})),window.AudioMessagePlayer.events.on("progress",((e,t)=>{if(this.audioEl===t&&this.state.currentTrackEntity){const{currentTrackEntity:t}=this.state,{audioTrack:a}=t;this.state=Object.assign(Object.assign({},this.state),{currentTrackEntity:Object.assign(Object.assign({},t),{audioTrack:Object.assign(Object.assign({},a),{progress:e})})}),this.emit("stateupdated",this.state)}})),window.AudioMessagePlayer.events.on("fc_paused",(e=>{e===this.audioEl&&"playing"===this.state.status&&(this.state=Object.assign(Object.assign({},this.state),{status:"paused"}),this.emit("stateupdated",this.state))})),window.AudioMessagePlayer.events.on("finished",(e=>{if(e===this.audioEl&&this.state.currentTrackEntity){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state=Object.assign(Object.assign({},this.state),{status:"ended",playedTimeAccumulator:{},currentTrackEntity:Object.assign(Object.assign({},e),{audioTrack:Object.assign(Object.assign({},t),{progress:0})})}),this.emit("stateupdated",this.state),this.state=Object.assign(Object.assign({},this.state),{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:Object.assign(Object.assign({},e),{audioTrack:Object.assign(Object.assign({},t),{progress:0})})}),this.emit("stateupdated",this.state)}}))}play(e){var t;if(e.audioTrack.id===(null===(t=this.state.currentTrackEntity)||void 0===t?void 0:t.audioTrack.id)&&"paused"===this.state.status)return this.state.currentTrackEntity=e,void this.resume();if(this.state.currentTrackEntity&&e.audioTrack.id!==this.state.currentTrackEntity.audioTrack.id){const{currentTrackEntity:e}=this.state,{audioTrack:t}=e;this.state=Object.assign(Object.assign({},this.state),{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:Object.assign(Object.assign({},e),{audioTrack:Object.assign(Object.assign({},t),{progress:0})})}),this.emit("stateupdated",this.state)}const{url:a,duration:s,id:i}=e.audioTrack,n="MessagedConvoVoiceTrack"===e.kind?e.urlOgg:void 0,r=`<div id="audiomsgpl_${window.vk.id}_${i}" class="audio-msg-track " data-duration="${s}" data-mp3="${a}" data-ogg="${n}" <button class="audio-msg-track--btn"></button> <button class="audio-msg-track--transcriptToggle _msg_asr_toggle"> <span class="audio-msg-track--transcriptToggleShow"></span> <span class="audio-msg-track--transcriptToggleHide"></span> </button> <div class="audio-msg-track--duration"></div> <div class="audio-msg-track--wave-wrapper"> <svg class="audio-msg-track--wave"></svg></div></div>`;this.audioEl=(0,o.ce)("div",{innerHTML:r}).firstChild,this.audioEl.dataset.convoVoiceTrack=JSON.stringify(e),this.state=Object.assign(Object.assign({},this.state),{status:"playing",playedTimeAccumulator:{},currentTrackEntity:e}),this.emit("stateupdated",this.state),window.AudioMessagePlayer.togglePlay(this.audioEl),window.AudioMessagePlayer.seek(e.audioTrack.progress)}pause(){this.audioEl&&window.AudioMessagePlayer.toggle()}stop(){this.audioEl&&window.AudioMessagePlayer.toggle()}resume(){this.audioEl&&this.state.currentTrackEntity&&(this.audioEl.dataset.convoVoiceTrack=JSON.stringify(this.state.currentTrackEntity),window.AudioMessagePlayer.seek(this.state.currentTrackEntity.audioTrack.progress),window.AudioMessagePlayer.toggle())}getState(){return this.state}playNext(){return!1}init(){}setVolume(){}setMute(){}playPrev(){}setShuffle(){}seek(){}setRepeatMode(){}setPlaybackRate(){}stopPlayer(){}}class _ extends r.EventBus{constructor(){super(),this.vkComPlayer=(0,i.getAudioPlayer)(),this.state={status:"stopped",playedTimeAccumulator:{},volume:100,playbackRate:1,mute:!1,shuffle:!1,repeatMode:"none"},this.vkComPlayer.on(this,s.events.PLAY_REQUESTED,(e=>{if(!e)return;const t=Object.assign({},this.state);if(t.currentTrackEntity&&t.currentTrackEntity.audioTrack){const{currentTrackEntity:e}=t,{audioTrack:a}=e;this.state=Object.assign(Object.assign({},t),{status:"stopped",playedTimeAccumulator:{},currentTrackEntity:Object.assign(Object.assign({},e),{audioTrack:Object.assign(Object.assign({},a),{progress:0})})}),this.emit("stateupdated",this.state)}const a=l(e,0);this.state=Object.assign(Object.assign({},this.state),{status:"playing",playedTimeAccumulator:{},currentTrackEntity:a}),this.emit("stateupdated",this.state)})),this.vkComPlayer.on(this,s.events.PLAY,(e=>{e&&(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===d(e)||(this.state.currentTrackEntity=l(e,0)),this.state=Object.assign(Object.assign({},this.state),{status:"playing"}),this.emit("stateupdated",this.state))})),this.vkComPlayer.on(this,s.events.PAUSE,(e=>{e&&(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===d(e)||(this.state.currentTrackEntity=l(e,0)),this.state=Object.assign(Object.assign({},this.state),{status:"paused"}),this.emit("stateupdated",this.state))})),this.vkComPlayer.on(this,[s.events.STOP,s.events.ENDED],(e=>{e&&(this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===d(e)||(this.state.currentTrackEntity=l(e,1)),this.state=Object.assign(Object.assign({},this.state),{status:"stopped"}),this.emit("stateupdated",this.state))})),this.vkComPlayer.on(this,s.events.PROGRESS,((e,t)=>{if(!e||"number"!=typeof t)return;this.state.currentTrackEntity&&this.state.currentTrackEntity.audioTrack.id===d(e)||(this.state.currentTrackEntity=l(e,t)),"stopped"===this.state.status&&t&&(this.state.status="paused");const a=Object.assign({},this.state),s=a.currentTrackEntity;this.state=Object.assign(Object.assign({},a),{currentTrackEntity:Object.assign(Object.assign({},s),{audioTrack:Object.assign(Object.assign({},s.audioTrack),{progress:t||0})})}),this.emit("stateupdated",this.state)}))}play(e,t){var a;const{progress:s}=e.audioTrack,i=this.vkComPlayer.getPlaylist(n.AudioPlaylist.TYPE_TEMP,window.vk.id,`im${(null===(a=e.fromMessage)||void 0===a?void 0:a.peerId)||""}`);i.mergeWith({list:null==t?void 0:t.getConvoAudiosList().map(c)}),this.vkComPlayer.play(c(e),i,"im"),s>0&&this.vkComPlayer.seek(s),this.vkComPlayer.play()}pause(){this.vkComPlayer.pause()}stop(){this.vkComPlayer.stop()}resume(){this.vkComPlayer.resume()}getState(){return this.state}playNext(){return!1}init(){}setVolume(){}setMute(){}playPrev(){}setShuffle(){}seek(){}setRepeatMode(){}setPlaybackRate(){}stopPlayer(){}}},607660:(e,t,a)=>{"use strict";a.d(t,{ProxyStorage:()=>n});var s=a(570655),i=a(423481);class n{constructor(e){this.identify=e=>{this.storage.identify(e)},this.get=e=>"settings-sound-notifications-on"===e?!window.ls.get("sound_notify_off"):this.storage.get(e),this.set=(e,t)=>{"settings-sound-notifications-on"!==e?this.storage.set(e,t):window.ls.set("sound_notify_off",Number(!t))},this.del=e=>{"settings-sound-notifications-on"!==e?this.storage.del(e):window.ls.remove("sound_notify_off")},this.getIDB=e=>(0,s.__awaiter)(this,void 0,void 0,(function*(){return this.storage.getIDB(e)})),this.setIDB=(e,t)=>(0,s.__awaiter)(this,void 0,void 0,(function*(){this.storage.setIDB(e,t)})),this.delIDB=e=>(0,s.__awaiter)(this,void 0,void 0,(function*(){this.storage.delIDB(e)})),this.storage=new i.Storage(e),this.dbName=e}}},90526:(e,t,a)=>{"use strict";a.d(t,{FCRecorder:()=>s});class s{start(){return Promise.resolve()}stop(){return Promise.resolve()}pause(){return Promise.resolve()}resume(){return Promise.resolve()}onStart(){}onPause(){}onResume(){}onStop(){}onDataAvailable(){}subscribeToAnalyzer(){return[]}}},334943:(e,t,a)=>{"use strict";a.d(t,{SharedEngine:()=>i});var s=a(482025);class i{constructor(e,t){if(this.logger=e,this.isMaster=t,this.queued={kind:"Buffer",buffer:[]},this.ts=0,this.pts=0,this.connect=e=>(this.ts=e.ts,this.pts=e.pts,this.engine.connect(e)),this.poll=()=>this.engine.poll(),this.isConnected=()=>this.engine.isConnected(),this.switch=e=>{if(this.broadcast)switch(this.logger.info("[SHARED ENGINE] switch to",e),e){case"master":switch(this.queued.kind){case"Callback":this.queued.cancel();break;case"Buffer":this.queued.buffer=[]}return void(this.isMaster=!0);case"slave":return void(this.isMaster=!1)}},this.fetch=(e,t,a)=>Promise.resolve().then((()=>{if(!this.isMaster)return this.fetchSlave();const s="number"==typeof t.ts?t.ts:1/0;return this.logger.info("[SHARED ENIGNE]",this.ts,s),s>this.ts?Promise.resolve({failed:1}):this.fetchMaster(e,t,a)})).then((e=>("ts"in e&&(this.ts=e.ts,this.pts=e.pts),e))),this.fetchMaster=(e,t,a)=>{this.logger.info("[SHARED ENGINE] fetch master",e);const s=new Headers;s.append("Connection","keep-alive"),s.append("Content-Type","application/x-www-form-urlencoded");const i=Object.keys(t).reduce(((e,a)=>(void 0!==t[a]&&e.append(a,t[a]),e)),new URLSearchParams);return fetch(e,{method:"POST",signal:a,headers:s,body:i}).then((e=>{if(!e.ok)throw new Error(`ServerError ${e.status}`);return e.json()})).then((e=>{const t=this.ts;return setTimeout((()=>{this.broadcast&&this.broadcast({type:"updates",payload:{tsOld:t,data:e}})})),e}))},this.fetchSlave=()=>{if("Callback"===this.queued.kind)return Promise.reject(new Error("vkcom engine slave double fetch error"));this.logger.info("[SHARED ENGINE] fetch slave");const e=this.queued.buffer.shift(),t=e?Promise.resolve(e):new Promise((e=>{this.queued={kind:"Callback",push:t=>{this.queued={kind:"Buffer",buffer:[]},e(t)},cancel:()=>{this.queued={kind:"Buffer",buffer:[]},e({tsOld:this.ts,data:{ts:this.ts,pts:this.pts,updates:[]}})}}}));return t.then((e=>e.tsOld>this.ts?(this.queued={kind:"Buffer",buffer:[]},Promise.resolve({failed:1})):e.data))},this.engine=new s.Engine(this.logger,((...e)=>this.fetch(...e))),this.version=this.engine.version,void 0!==window.BroadcastChannel){const e=new BroadcastChannel("messenger-shared-engine");this.broadcast=t=>e.postMessage(t),e.onmessage=e=>{if("updates"===e.data.type){const t=e.data.payload;if(this.isMaster)return;if(this.logger.info("[SHARED ENGINE] broadcast received",t),!this.isConnected())return;return"Callback"===this.queued.kind?void this.queued.push(t):void this.queued.buffer.push(t)}this.logger.error("[SHARED ENGINE] Неизвестный бродкаст")}}}}},246767:(e,t,a)=>{"use strict";a.d(t,{SharedQueue:()=>s});class s{constructor(){this.MAX_BUFFER_SIZE=50,this.unsubscribe=null,this.empty=()=>({kind:"Buffer",buffer:[]}),this.poll=()=>{if("Callback"===this.queued.kind)return this.queued.reject("Queue.poll вызван дважды!"),new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}));const e=this.queued.buffer.shift();if(e)return Promise.resolve(e);if(!this.isConnected())throw new Error("Queue.connect еще не был вызван!");return new Promise(((e,t)=>{this.queued={kind:"Callback",resolve:e,reject:t}}))},this.disconnect=()=>{switch(this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,this.queued.kind){case"Callback":this.queued.resolve({kind:"Disconnected",reason:"manual"}),this.queued=this.empty();break;case"Buffer":this.queued.buffer.push({kind:"Disconnected",reason:"manual"});break;default:this.queued}},this.isConnected=()=>!!this.unsubscribe,this.queued=this.empty()}connect(){if(this.isConnected())return;this.queued=this.empty();const e=window.Notifier.getEventQueueInstance();this.unsubscribe=e.subscribe((e=>{const t={kind:"Batch",ts:"1",events:[e]};if("Callback"===this.queued.kind){const e=this.queued.resolve;return this.queued=this.empty(),void e(t)}if(this.queued.buffer.length>=this.MAX_BUFFER_SIZE)return this.unsubscribe&&this.unsubscribe(),this.unsubscribe=null,void this.queued.buffer.push({kind:"Disconnected",reason:"backpressure"});this.queued.buffer.push(t)}))}}},927866:(e,t,a)=>{"use strict";a.d(t,{Stats:()=>o});var s=a(940441),i=a(724702),n=a(746133),r=a(95642);class o{constructor(){this.logEvent=(e,t)=>{!function(e,t){switch(e){case"type_action":{const e=t;switch(e.type){case"type_ab_custom_metrics_item":s.customMetricsCollector.logEvent(e.type_ab_custom_metrics_item);break;case"type_messaging_action_item":i.messagingActionItemStatCollector.logEvent(e.type_messaging_action_item);break;case"type_messaging_audio_message_item":n.audioMessageStatCollector.logEvent(e.type_messaging_audio_message_item);break;case"type_settings_changes_item":r.settingsChangesStatCollector.logEvent(e.type_settings_changes_item)}break}}}(e,t)}}}},37426:(e,t,a)=>{"use strict";a.d(t,{Settings:()=>N});var s=a(785893),i=a(601156),n=a(184290),r=a(616963),o=a(575730),l=a(166919),d=a(308996),c=a(42759),u=a(261383),_=a(959139),g=a(475234),m=a(352111),p=a(189754),h=a(90526),v=a(218233),f=a(159003),b=a(402508),y=a(607660),w=a(891747),C=a(370894),E=a(246767),S=a(334943),T=a(927866),I=a(497138),M=a(973935),k=a(476288),A=a(359284),L=a(743927),P=a(70162),R=a(471996),D=a(645523),x=a(511492),O=a(961540);const B=({onClose:e,store:t,browserEnv:a})=>(0,s.jsxs)(A.default,Object.assign({onClose:e},{children:[(0,s.jsx)(L.ModalHeader,{title:P.getLang("mail_im_settings_header"),onClose:e},void 0),(0,s.jsx)(k.ModalBody,Object.assign({hasScroll:!1},{children:(0,s.jsx)("div",Object.assign({style:{width:"560px",margin:"0 -25px",padding:"4px 20px"}},{children:(0,s.jsx)(i.SettingsApp,{store:t,env:a,set:new Set(["ctrSubmit","soundNotifications","showRecommendations","countOnlyNotMuted","autoUnarchive","transcriptAutoShow"])},void 0)}),void 0)}),void 0)]}),void 0);class N{constructor(e,t){this.isMounted=!1,this.imStore=e,this.imPageMutations=t}renderSettingsPopup(e,t){const a=N.getContainer(),i=()=>this.hide();a&&M.render((0,s.jsx)(B,{onClose:i,store:e,browserEnv:t},void 0),a)}static getContainer(){return document.querySelector("#MessengerSettings")}getContext(){var e;if(null===(e=window.reforgedME)||void 0===e?void 0:e.settingsContext)return window.reforgedME.settingsContext;if(this.ownContext)return this.ownContext;(0,n.initConfig)();const t=(0,O.getHostName)(),a=window.vk.id,s=(0,R.createFeatureFlags)(),i=new v.Api(a),g=new b.Logger,m=new y.ProxyStorage(r.STORAGE_DB_NAME),M=new S.SharedEngine(g,(0,R.isMasterTab)()),k=new T.Stats,A=(0,R.createLang)(g),L={system:new o.Modals,stack:new o.Stack},P=new l.Uploader(i),D=new p.FCPlayer,x=new p.FCVoicePlayer,B=new h.FCRecorder,N=new R.VkComRouter(s,t),F=new d.MEAppMediaMediator,U={vkDomain:t,api:i,lang:A,logger:g,storage:m,player:D,voicePlayer:x,videoMessagePlayer:new c.MEAppVideoMessagePlayer(F),browserNotifications:new w.BrowserNotifications,externalEvents:new u.ExternalEvents,idle:new f.Idle(g),stats:k,geoLocation:new I.GeoLocation,openApp:()=>{},vkcom_textInput:(0,R.vkcom_textInputStub)(),vkcom_mediaSelector:(0,R.vkcom_mediaSelectorStub)(),botKeyboard:{update:()=>{},subscribe:()=>()=>{},openApp:()=>{},openLink:()=>{},openSnackbar:()=>{},addEventId:()=>{}},modals:L,router:N,uploader:P,voiceRecorder:B},H={api:i,engine:M,queue:new E.SharedQueue,lang:A,logger:g,storage:m,player:D,voicePlayer:x,stats:k,botKeyboard:{update:()=>{},subscribe:()=>()=>{},openApp:()=>{},openLink:()=>{},openSnackbar:()=>{},addEventId:()=>{}},modals:L,router:N,notification:new C.Notification},j=(0,_.createStore)(H,s,void 0,a);return j.start(),this.ownContext={store:j,browserEnv:U},this.ownContext}hide(){if(!this.isMounted)return;const e=N.getContainer();e&&M.unmountComponentAtNode(e),this.unsubscribe(),this.isMounted=!1}show(){const{store:e,browserEnv:t}=this.getContext();let a=e.getState().viewer.settings;this.unsubscribe=e.subscribe((e=>{const t=e.viewer.settings;a.ctrSubmit!==t.ctrSubmit&&(window.cur.ctrl_submit=t.ctrSubmit,this.imStore.set((e=>(0,g.setLocalSettingsValue)("ctrl_submit",Number(t.ctrSubmit),e)))),a.showRecommendations!==t.showRecommendations&&this.imStore.set((e=>(0,g.setLocalSettingsValue)("messages_recommendation_list_hidden",Number(!t.showRecommendations),e))).finally((()=>{if(!t.showRecommendations)return void this.imPageMutations().setRecommendationListVisibility(!1);this.imPageMutations().setRecommendationListVisibility(!0)||(this.hide(),window.nav.reload())})),a.countOnlyNotMuted!==t.countOnlyNotMuted&&this.imStore.set((e=>(0,g.setLocalSettingsValue)("show_only_not_muted_messages",Number(t.countOnlyNotMuted),e))).then((e=>{(0,m.updateUnreadCounter)(e)})),a.transcriptAutoShow!==t.transcriptAutoShow&&this.imStore.set((e=>(0,g.setLocalSettingsValue)("transcript_auto_show",Number(t.transcriptAutoShow),e))).then((()=>(0,x.pause)(.25))).then((()=>{var e;return null===(e=this.imStore.get().longpoll)||void 0===e?void 0:e.push([(0,D.changeVoiceTranscriptUI)()])})),a=e.viewer.settings})),this.renderSettingsPopup(e,t),this.isMounted=!0}}},314057:(e,t,a)=>{"use strict";a.d(t,{renderHistoryStub:()=>v,prepareEmptyDialogStickersTemplate:()=>f});var s=a(353799),i=a(993421),n=a(342269),r=a(506770),o=a(923876),l=a(608021),d=a(564452),c=a(355664),u=a(431976),_=a(734481),g=a(459554),m=a(222131),p=a(236742),h=a(844142);function v(e){const t=(0,i.getPeer)(e),a=h.Ranges.isContactId(t),s=t&&(0,g.getTab)(e,t),p=(0,o.getEmptyScreenUserInfo)(e,t);if(s&&(0,g.isCasperChatTab)(s))return(0,n.getTemplate)("sImEmptyCasper");const v=a||(0,g.isUserEmptyScreenRich)(e,t)&&p&&0!==(null==p?void 0:p.canWrite);if(!s||!(0,r.partConfigEnabled)("messages_new_empty_dialog_screen")||!v)return l.getLang("mail_im_here_history");const b=a?(0,m.prepareContactName)(s.tab):(0,n.stripHTML)(s.tab),y=a?(0,m.prepareContactName)(s.name):s.name,w=s.contact_name,C=a?l.getLang("mail_empty_history_with_contact").replace("{user_name}",y):(0,l.langSex)(s.sex,l.getLang("mail_empty_history_with_user","raw")).replace("{user_name}",y),E=w?(0,l.langSex)(s.sex,l.getLang("mail_saved_in_contacts_as","raw")).replace("{contact_name}",w):"";let S="";S=s.is_nft_photo&&s.photo?(0,n.getTemplate)("sImDialogImRowAvatarRichSkinPhoto",{photo:s.photo,size:80}):s.photo?`<img src="${s.photo}" alt="${y}">`:(0,n.getTemplate)("sImContactAvatar",{name:(0,m.getUserInitials)(y),size:80,classes:""});const T=s.is_subscribed,I=T?"sImEmptyDialogStubUnsubscribeButton":"sImEmptyDialogStubSubscribeButton",M=T?l.getLang("mail_friend_request_sent"):l.getLang("mail_add_to_friends"),k=a||s.is_friend?"":(0,n.getTemplate)(I,{button_text:M}),[A,L]=p?function(e){if(e.occupation){const{icon:t}="work"===e.occupationType?(0,d.getIcon20WorkOutline)():(0,c.getIcon20EducationOutline)();return[e.occupation,t]}if(e.bdate){const{icon:t}=(0,u.getIcon20CakeOutline)(),[a,s]=e.bdate.split("."),i=new Date;i.setDate(+a),i.setMonth(+s-1);return[(0,l.langDate)(i.getTime(),l.getLang("mail_birthday_day_month","raw"),0,l.getLang("months_of","raw"),!0),t]}if(e.city){const{icon:t}=(0,_.getIcon20HomeOutline)();return[e.city,t]}return["",""]}(p):["",""],P=(null==p?void 0:p.mutualFriends.length)?function(e){const t=e.mutualFriends.map((e=>(0,n.getTemplate)("sImEmptyDialogStubMutualFriend",{name:e.name,src:e.photo}))).join("");return(0,n.getTemplate)("sImEmptyDialogStubMutualFriends",{friends:t,text:(0,l.langNumeric)(e.commonCount||0,l.getLang("mail_mutual_friends_count","raw"))})}(p):"",R=a?"":(0,n.getTemplate)("sImEmptyDialogStubUserInfo",{profile_href:s.href,subscribe_button:k,additional_info:A,additional_icon:L,mutual_friends:P});return`${(0,n.getTemplate)("sImEmptyDialogStub",{avatar:S,name:b,stub_text:C,secondary_block:R,saved_as:E,classes:(0,i.isClassicInterface)(e)?"EmptyDialogStub--classic":""})}${f(e)}`}function f(e){var t,a;const r=(0,i.getPeer)(e),o=(0,g.getTab)(e,r),l=(0,i.getEmojiOptId)(e);if(!o)return"";const d=o.is_new,c=(null===(t=window.stickersKeywords)||void 0===t?void 0:t["привет"])||[],u=new Map;if(c.reduce(((e,t)=>{var a;const{packId:s,sticker:i}=(null===(a=window.Emoji.stickersById)||void 0===a?void 0:a[t])||{};return t<0||!i?e:e.set(t,[t,256,"",i[3],s])}),u),d){((null===(a=window.Emoji.stickers[s.Emoji.TAB_NEW_CONVO_STICKERS])||void 0===a?void 0:a.stickers)||[]).reduce(((e,t)=>e.set(t[0],t)),u)}const _=[...u.values()].reduce(((e,t)=>{const[a,,,s,i]=t,r={sticker_id:a,sticker_url:p.Stickers.getStickerUrl(a,((0,n.isRetina)()?256:128)+"b"),animation_url:s,set_id:i||0,opt_id:l},o=s?"sImEmptyDialogAnimatedSticker":"sImEmptyDialogSticker";return`${e}${(0,n.getTemplate)(o,r)}`}),"");if(!_)return"";const m=(0,n.getTemplate)("sImCarousel",{content:_,controls_class:"",scroll_count:"3"});return(0,n.getTemplate)("sImEmptyDialogStickers",{content:m})}},730412:(e,t,a)=>{"use strict";a.d(t,{updateFolderCounters:()=>o});var s=a(712439),i=a(179288),n=a(578843);const r=[i.ConvoListFolder.MR,i.ConvoListFolder.BUSINESS_NOTIFY,i.ConvoListFolder.ARCHIVE];function o(e){const t=(0,s.unpackStore)(e);r.forEach((e=>{var a,s;const i=(0,n.getFolderUnreadCount)(t,e),r=document.querySelector(`._im_right_menu_counter[data-tab="${e}"]`);r&&(r.innerHTML=i,null===(s=null===(a=r.closest(".ui_rmenu_item"))||void 0===a?void 0:a.classList)||void 0===s||s.toggle("ui_rmenu_item_hidden",(0,n.isConvoListFolderHidden)(t,e)))}));const a=(0,n.getFolderMentionsCount)(t,i.ConvoListFolder.ARCHIVE),o=document.querySelector(`._im_right_menu_mentions[data-tab="${i.ConvoListFolder.ARCHIVE}"]`);o&&(o.dataset.mentions=a)}},928322:(e,t,a)=>{"use strict";function s(){window.cur.videoAutoplayScrollHandler&&window.cur.videoAutoplayScrollHandler()}a.d(t,{videoAutoPlayHandler:()=>s})},988058:(e,t,a)=>{"use strict";a.d(t,{createLongpoll:()=>l});var s=a(49267),i=a(437361),n=a(887294),r=a(384032),o=a(315882);function l(e,t){return(0,s.createLongpollConnect)(e,{onEvents:t,onData:u,onRequestError:_,onHistoryLost:g,onKeyExpired:m,onLpBroken:p})}let d={},c=Date.now();function u(e,t){if(!t||!t.status||!e.lpstat)return;const a=t.status.toString();t.status>=500&&t.status<600&&(0,o.statlogsValueEvent)("fc_longpoll",1,a,t.getResponseHeader("x-frontend")||""),d[a]=a in d?d[a]+1:1,Date.now()-c>=3e4&&(Object.keys(d).forEach((e=>{(0,o.statlogsValueEvent)("fc_longpoll",d[e],e,t.getResponseHeader("x-frontend")||"")})),d={},c=Date.now())}function _(e){(0,i.lpLogFc)("red","LP error",e.message||"no message (probably browser reset)")}function g(e,t){(0,i.lpLogFc)("red","LP failed: old timestamp; resync, next ts",t.ts)}function m(e){return(0,i.lpLogFc)("red","LP failed: key is incorrect; refresh key"),(0,n.post)(r.CONTROLLER,{act:"a_get_key",uid:e.id,gid:e.id<0?-e.id:0},1e3)}function p(){throw window.nav.reload({force:!0}),new Error("ts is very wrong")}},437361:(e,t,a)=>{"use strict";function s(e,t,...a){if(!window.vk.lpConfig.debug)return;const s=`background: ${e}; color: white`,i=new Date,n=e=>e<10?"0"+e.toString():e.toString();console.log(`%c ${i.getHours()}:${n(i.getMinutes())}:${n(i.getSeconds())}:${i.getMilliseconds()} ${t} `,s,...a)}function i(){return window.lpBufferFc||(window.lpBufferFc=[]),window.lpBufferFc}function n(){return window.lpBufferIm||(window.lpBufferIm=[]),window.lpBufferIm}function r(){return"im"===window.cur.module&&window.store&&window.store.get().longpoll&&!window.store.get().stopped}function o(){r()&&(n().forEach((e=>{!i().find((t=>e.ev===t.ev))&&e.time<Date.now()-1e3&&!e.warned&&(e.warned=!0,s("red","im not fc",e.ev))})),i().forEach((e=>{const t=n().find((t=>t.ev===e.ev));t&&t.warned&&!e.warned&&(e.warned=!0,s("red","now fc like im",e.ev))}))),function(){const e=Date.now()-3e4;window.lpBufferFc=i().filter((t=>t.time>e)),window.lpBufferIm=n().filter((t=>t.time>e))}()}function l(e){r()&&(i().push(...e.map((e=>({time:Date.now(),ev:JSON.stringify(e),warned:!1})))),setTimeout(o,0)),s("green","fc",...e)}a.d(t,{lpLogFc:()=>s,longpollTestingOnFcEvents:()=>l}),window.longpollTestingOnImEvents=function(e){r()&&(n().push(...e.map((e=>({time:Date.now(),ev:JSON.stringify(e),warned:!1})))),setTimeout(o,1100)),s("blue","im",...e)}}},__webpack_module_cache__={},deferred,leafPrototypes,getProto,inProgress,loadStylesheet,installedCssChunks;function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var a=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(a.exports,a,a.exports,__webpack_require__),a.exports}__webpack_require__.m=__webpack_modules__,deferred=[],__webpack_require__.O=(e,t,a,s)=>{if(!t){var i=1/0;for(l=0;l<deferred.length;l++){for(var[t,a,s]=deferred[l],n=!0,r=0;r<t.length;r++)(!1&s||i>=s)&&Object.keys(__webpack_require__.O).every((e=>__webpack_require__.O[e](t[r])))?t.splice(r--,1):(n=!1,s<i&&(i=s));if(n){deferred.splice(l--,1);var o=a();void 0!==o&&(e=o)}}return e}s=s||0;for(var l=deferred.length;l>0&&deferred[l-1][2]>s;l--)deferred[l]=deferred[l-1];deferred[l]=[t,a,s]},__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},getProto=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,__webpack_require__.t=function(e,t){if(1&t&&(e=this(e)),8&t)return e;if("object"==typeof e&&e){if(4&t&&e.__esModule)return e;if(16&t&&"function"==typeof e.then)return e}var a=Object.create(null);__webpack_require__.r(a);var s={};leafPrototypes=leafPrototypes||[null,getProto({}),getProto([]),getProto(getProto)];for(var i=2&t&&e;"object"==typeof i&&!~leafPrototypes.indexOf(i);i=getProto(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>e[t]));return s.default=()=>e,__webpack_require__.d(a,s),a},__webpack_require__.d=(e,t)=>{for(var a in t)__webpack_require__.o(t,a)&&!__webpack_require__.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},__webpack_require__.f={},__webpack_require__.e=e=>Promise.all(Object.keys(__webpack_require__.f).reduce(((t,a)=>(__webpack_require__.f[a](e,t),t)),[])),__webpack_require__.u=e=>9375===e?"voice_message_player.a24b5302dda38f2690dc.js":28762===e?"speech.2ae50810d84f10a5626e.js":57468===e?"SilentModeForms.f50c33cf80f4ac9afc47.js":75980===e?"menu_settings.0f17151bd588fe6a5267.js":29019===e?"ReportForm.1b63c7385d20fd86c921.js":34932===e?"MarketItemsCarousel.9df741ebd0ad05a1d9d2.js":79344===e?"sticker.171c0dcdbaf4dd68d47b.js":55489===e?"lottie-light.19743fa6c7bec04c41d3.js":51162===e?"StickersKit.54f58d0bafecd8ed40cb.js":98755===e?e+".8ca384853a77dadc5887.js":81937===e?e+".73ee5b13db6e8f5fe53b.js":28477===e?"79f240c94e0513d166c44bb8a64a95e6.1ec7fa6f5c679bdf48e1.js":31848===e?"f79ca980fcc26ca55859ad5158f5fea8.a21da118a04c4c099bce.js":882===e?"fba43c7a1c8ad19aa306e4c66812a52a.d7ab345c37273764361f.js":void 0,__webpack_require__.miniCssF=e=>882===e?"fba43c7a1c8ad19aa306e4c66812a52a.ffdcb73f01486cfead70.css":e+"."+{29019:"b2496d8ef6849a2fecca",34932:"87de96d33c3d48146e0c",57468:"36d8e7db328f8ee92e7d",75980:"519f671449550110bbb1",79344:"cd1e4159749f662b5108"}[e]+".css",__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),inProgress={},__webpack_require__.l=(e,t,a,s)=>{if(inProgress[e])inProgress[e].push(t);else{var i,n;if(void 0!==a)for(var r=document.getElementsByTagName("script"),o=0;o<r.length;o++){var l=r[o];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")=="vk:"+a){i=l;break}}i||(n=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,__webpack_require__.nc&&i.setAttribute("nonce",__webpack_require__.nc),i.setAttribute("data-webpack","vk:"+a),i.src=e),inProgress[e]=[t];var d=(t,a)=>{i.onerror=i.onload=null,clearTimeout(c);var s=inProgress[e];if(delete inProgress[e],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach((e=>e(a))),t)return t(a)},c=setTimeout(d.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=d.bind(null,i.onerror),i.onload=d.bind(null,i.onload),n&&document.head.appendChild(i)}},__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.p="/dist/",loadStylesheet=e=>new Promise(((t,a)=>{var s=__webpack_require__.miniCssF(e),i=__webpack_require__.p+s;if(((e,t)=>{for(var a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var i=(r=a[s]).getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(i===e||i===t))return r}var n=document.getElementsByTagName("style");for(s=0;s<n.length;s++){var r;if((i=(r=n[s]).getAttribute("data-href"))===e||i===t)return r}})(s,i))return t();((e,t,a,s)=>{var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.onerror=i.onload=n=>{if(i.onerror=i.onload=null,"load"===n.type)a();else{var r=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=r,l.request=o,i.parentNode.removeChild(i),s(l)}},i.href=t,document.head.appendChild(i)})(e,i,t,a)})),installedCssChunks={655:0},__webpack_require__.f.miniCss=(e,t)=>{installedCssChunks[e]?t.push(installedCssChunks[e]):0!==installedCssChunks[e]&&{882:1,29019:1,34932:1,57468:1,75980:1,79344:1}[e]&&t.push(installedCssChunks[e]=loadStylesheet(e).then((()=>{installedCssChunks[e]=0}),(t=>{throw delete installedCssChunks[e],t})))},(()=>{__webpack_require__.b=document.baseURI||self.location.href;var e={655:0};__webpack_require__.f.j=(t,a)=>{var s=__webpack_require__.o(e,t)?e[t]:void 0;if(0!==s)if(s)a.push(s[2]);else if(75980!=t){var i=new Promise(((a,i)=>s=e[t]=[a,i]));a.push(s[2]=i);var n=__webpack_require__.p+__webpack_require__.u(t),r=new Error;__webpack_require__.l(n,(a=>{if(__webpack_require__.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;r.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",r.name="ChunkLoadError",r.type=i,r.request=n,s[1](r)}}),"chunk-"+t,t)}else e[t]=0},__webpack_require__.O.j=t=>0===e[t];var t=(t,a)=>{var s,i,[n,r,o]=a,l=0;for(s in r)__webpack_require__.o(r,s)&&(__webpack_require__.m[s]=r[s]);if(o)var d=o(__webpack_require__);for(t&&t(a);l<n.length;l++)i=n[l],__webpack_require__.o(e,i)&&e[i]&&e[i][0](),e[n[l]]=0;return __webpack_require__.O(d)},a=self.webpackChunkvk=self.webpackChunkvk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var __webpack_exports__=__webpack_require__.O(void 0,[76429,75514,24509,56990,98066,76400,40885,38288,68592,37283,37615,77433,79542,22061,88869,23299,43639,43087,93424,56058,57783],(()=>__webpack_require__(981311)));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();