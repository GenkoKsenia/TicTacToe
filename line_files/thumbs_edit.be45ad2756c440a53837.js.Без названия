(()=>{"use strict";var e,t,i,a,n,r,o={220796:(e,t,i)=>{i.d(t,{processThumbs:()=>g,compute:()=>p,getSize:()=>m,move:()=>_,scale:()=>f,crop:()=>b,getRatio:()=>w,convert:()=>T,isValidThumbType:()=>l.isValidThumbType,THUMB_TYPE_ALBUM:()=>l.THUMB_TYPE_ALBUM,THUMB_TYPE_DOC:()=>l.THUMB_TYPE_DOC,THUMB_TYPE_MARKET_ALBUM:()=>l.THUMB_TYPE_MARKET_ALBUM,THUMB_TYPE_PHOTO:()=>l.THUMB_TYPE_PHOTO,THUMB_TYPE_VIDEO:()=>l.THUMB_TYPE_VIDEO,THUMB_DRAG_ANIMATION_DURATION:()=>d,THUMBS_CONTAINER_DEFAULT_RATIO:()=>h,THUMBS_MESH_GAP:()=>c});var a,n=i(722122),r=i(733164),o=i(683609),s=i(961540),l=i(282568);(0,s.isMvk)()||(a=()=>+new Date,window.vkExpand=window.vkExpand||"VK"+a(),window.vkUUID=window.vkUUID||0,window.vkCache=window.vkCache||{});var h=1.5,d=(0,s.isMvk)()?200:120,c=5,u=(0,s.isMvk)()?604:537,v=(0,s.isMvk)()?360:343;function g(e,t,i,a){var n=function(e){var t=0;return(0,r.each)(e,((e,i)=>{t+=i})),t},o=function(e,t,i){return(t-(e.length-1)*i)/n(e)},h=(a=M(a)?a:{}).wide,d=[],g=0,m=[],_=[];(0,r.each)(i,((e,t)=>{(0,l.isValidThumbType)(t.type)&&(m[m.length]=t[t.type]),t.type===l.THUMB_TYPE_VIDEO&&d.push(g),g++}));var f="",b=[],T=m.length;(0,r.each)(m,((i,a)=>{var n=w(a,e,t);f+=n>1.2?"w":n<.8?"v":"q",b[b.length]=n}));var E,C,B=b.length>0?n(b)/b.length:1,U=c;(0,s.isMvk)()&&(U=window.innerWidth>=480?6:3);var x=U;a.force?(E=e,C=t):(h?(E=u,C=v):e>=381?(E=381,C=1==T?361:237):(E=337,C=1==T?320:214),e<E&&(E=e,C=t),(0,s.isMvk)()&&(E=Math.min(u,window.innerWidth),C=Math.min(v,E)));var O=E/C,A=0,I=0;if(1==T){var P={lastColumn:1,lastRow:1,single:1};m[0].thumb?(A=279,I=185):b[0]>=1*O?(A=E,I=Math.min(A/b[0],C)):(I=C,A=Math.min(I*b[0],E));var H=p(m[0],A,I,P);!H.unsized&&(H.image.width<A&&H.image.height<=C||H.image.height<I&&H.image.width<=E)&&(A=H.image.width,I=H.image.height,H=p(m[0],A,I,P)),_[0]=H}else if(2==T){var k,R;switch(f){case"ww":if(B>1.4*O&&b[1]-b[0]<.2){R=E,k=Math.min(R/b[0],R/b[1],(C-x)/2),_[0]=p(m[0],R,k,{lastColumn:1}),_[1]=p(m[1],R,k,{lastColumn:1,lastRow:1}),A=E,I=2*k+x;break}case"vv":case"qv":case"vq":case"qq":R=(E-U)/2,k=Math.min(R/b[0],R/b[1],C),_[0]=p(m[0],R,k,{lastRow:1}),_[1]=p(m[1],R,k,{lastRow:1,lastColumn:1}),A=E,I=k;break;default:var Y=(0,r.intval)((E-U)/b[1]/(1/b[0]+1/b[1])),z=E-Y-U;k=Math.min(C,Y/b[0],z/b[1]),_[0]=p(m[0],Y,k,{lastRow:1}),_[1]=p(m[1],z,k,{lastColumn:1,lastRow:1}),A=E,I=k}}else if(3==T)if((b[0]>1.2*O||B>1.5*O)&&"www"==f){var D,N=E,L=Math.min(N/b[0],.66*(C-x));if(_[0]=p(m[0],N,L,{lastColumn:1}),"www"==f){var S=(0,r.intval)(E-U)/2;D=Math.min(C-L-x,S/b[1],S/b[2]),_[1]=p(m[1],S,D,{lastRow:1}),_[2]=p(m[2],E-S-U,D,{lastColumn:1,lastRow:1})}else{var $=(0,r.intval)((E-U)/b[2]/(1/b[1]+1/b[2])),j=E-$-U;D=Math.min(C-L-x,$/b[2],j/b[1]),_[1]=p(m[1],$,D,{lastRow:1}),_[2]=p(m[2],$,D,{lastRow:1,lastColumn:1})}A=E,I=L+D+x}else{var V=C,G=(0,r.intval)(Math.min(V*b[0],.75*(E-U)));_[0]=p(m[0],G,V,{lastRow:1});var F=b[1]*(C-x)/(b[2]+b[1]),X=C-F-x,q=Math.min(E-G-U,(0,r.intval)(F*b[2]),(0,r.intval)(X*b[1]));_[1]=p(m[1],q,X,{lastColumn:1}),_[2]=p(m[2],q,F,{lastColumn:1,lastRow:1}),A=G+q+U,I=C}else if(4==T)if((b[0]>1.2*O||B>1.5*O)&&"wwww"==f){var K=E,W=Math.min(K/b[0],.66*(C-x));_[0]=p(m[0],K,W,{lastColumn:1});var J=(E-2*U)/(b[1]+b[2]+b[3]),Q=(0,r.intval)(J*b[1]),Z=(0,r.intval)(J*b[2]),ee=K-Q-Z-2*U;J=Math.min(C-W-x,J),_[1]=p(m[1],Q,J,{lastRow:1}),_[2]=p(m[2],Z,J,{lastRow:1}),_[3]=p(m[3],ee,J,{lastColumn:1,lastRow:1}),A=E,I=W+J+x}else{var te=C,ie=Math.min(te*b[0],.66*(E-U)),ae=(C-2*x)/(1/b[1]+1/b[2]+1/b[3]),ne=(0,r.intval)(ae/b[1]),re=(0,r.intval)(ae/b[2]),oe=te-ne-re-2*x;ie+(ae=Math.min(E-ie-U,ae))+U<E&&te*b[0]>ie&&(ie=Math.min(te*b[0],E-U-ae)),_[0]=p(m[0],ie,te,{lastRow:1}),_[1]=p(m[1],ae,ne,{lastColumn:1}),_[2]=p(m[2],ae,re,{lastColumn:1}),_[3]=p(m[3],ae,oe,{lastColumn:1,lastRow:1}),A=ie+ae+U,I=C}else{var se=[],le=0;B>(d.length?1.3:1.1)?(0,r.each)(b,((e,t)=>{se[se.length]=Math.max(1,t)})):(0,r.each)(b,((e,t)=>{~d.indexOf(le)?se[se.length]=t:se[se.length]=Math.min(1,t),le++}));var he,de,ce={};for(ce[T+""]=[o(se,E,U)],he=1;he<=T-1;he++)ce[he+","+(de=T-he)]=[o(se.slice(0,he),E,U),o(se.slice(he),E,U)];for(he=1;he<=T-2;he++)for(de=1;de<=T-he-1;de++)ce[he+","+de+","+(T-he-de)]=[o(se.slice(0,he),E,U),o(se.slice(he,he+de),E,U),o(se.slice(he+de),E,U)];var ue,ve=null,ge=0;for(var pe in ce)if(ce.hasOwnProperty(pe)){var me=ce[pe],_e=n(me)+x*(me.length-1),fe=Math.abs(_e-C);if(~pe.indexOf(",")){for(var be=pe.split(","),we=0;we<be.length;we++)be[we]=(0,r.intval)(be[we]);(be[0]>be[1]||be[2]&&be[1]>be[2])&&(fe+=50,fe*=1.5)}(null===ve||fe<ge)&&(ve=pe,ge=fe,ue=_e)}for(var Te=y(m),ye=y(se),Me=ve.split(","),Ee=ce[ve],Ce=Me.length-1,Be=0;Be<Me.length;Be++){var Ue=parseInt(Me[Be]),xe=Te.splice(0,Ue),Oe=Ee.shift(),Ae=xe.length-1,Ie={};Ce==Be&&(Ie.lastRow=!0);for(var Pe=E,He=0;He<xe.length;He++){var ke=xe[He],Re=ye.shift(),Ye=Ie,ze=void 0;Ae==He?(ze=Math.ceil(Pe),Ye.lastColumn=!0):Pe-=(ze=(0,r.intval)(Re*Oe))+U,_[_.length]=p(ke,ze,Oe,Ye)}}A=E,I=ue}return{width:(0,r.intval)(A),height:(0,r.intval)(I),thumbs:_}}function p(e,t,i,a){var n={id:e.id,width:(0,r.intval)(t),height:(0,r.intval)(i),lastColumn:a.lastColumn,lastRow:a.lastRow,single:a.single,image:m(e,t,i,a.single),unsized:e.unsized,type:e.type,orig:e};return e.title&&void 0!==e.size?Object.assign(n,{title:e.title,size:e.size}):e.title&&void 0!==e.msize?Object.assign(n,{title:e.title,msize:e.msize}):e.type===l.THUMB_TYPE_VIDEO&&e.name&&Object.assign(n,{name:e.name}),"number"==typeof e.duration&&(e.duration=(0,o.formatTime)(e.duration)),n.unsized?n.ratio=1:n.ratio=n.image.width/n.image.height,n}function m(e,t,i,a){if(!e)return{};t=(0,r.intval)(t),i=(0,r.intval)(i);var n,o=window.devicePixelRatio||1;if(e.type===l.THUMB_TYPE_VIDEO||e.type===l.THUMB_TYPE_DOC){(e.vid?["x","y","l","s","m"]:["o","z","y","x","m","s","temp"]).forEach((a=>{e.sizes[a]&&(!n||t*o<=e.sizes[a][1]&&i*o<=e.sizes[a][2])&&(n=e.sizes[a])}))}else{var s=e.thumb?e.thumb.sizes:e.sizes,h=s.x||s[s.length-1],d=h?(h[1]||1)/(h[2]||1):1,c=0;d>t/i?(c=i,d>1&&(c*=d)):(c=t,d<1&&(c/=d)),i*=o,t*=o;var u=!a&&s.o,v="";v=s.temp?"temp":c<75?"s":c<130?"m":u&&s.o&&s.o[1]>=t&&s.o[2]>=i?"o":u&&s.p&&s.p[1]>=t&&s.p[2]>=i?"p":u&&s.q&&s.q[1]>=t&&s.q[2]>=i?"q":u&&s.r&&s.r[1]>=t&&s.r[2]>=i?"r":"x",n=s[v]||[]}return n[1]=(0,r.intval)(n[1]),n[2]=(0,r.intval)(n[2]),n[1]&&n[2]||(e.unsized=!0),{src:n[0],width:n[1],height:n[2]}}function _(e,t,i){if(i>=e.length)for(var a=i-e.length;1+a--;)e.push(void 0);return e.splice(i,0,e.splice(t,1)[0]),e}function f(e,t,i,a){i=(0,r.intval)(i),a=(0,r.intval)(a)||i;var n=e,o=t;return e>=t&&e>i?(n=(0,r.intval)(i),o=(0,r.intval)(t/(e/i))):e<t&&t>a&&(o=(0,r.intval)(a),n=(0,r.intval)(e/(t/a))),[n,o]}function b(e,t,i){var a=t,n=i,o=0,s=0;if(!e.vid&&e.image.width&&e.image.height){var h=e.image.width/e.image.height;h<t/i?(e.single&&e.image.width<t&&(t=e.image.width,i=Math.min(i,e.image.height)),(n=(a=t)/h)>i&&(s=-(0,r.intval)((n-i)/2))):(e.single&&e.image.height<i&&(i=e.image.height,t=Math.min(t,e.image.width)),(a=(n=i)*h)>t&&(o=-(0,r.intval)((a-t)/2)))}return{width:a,height:n,marginLeft:o,marginTop:e.orig&&(e.type===l.THUMB_TYPE_MARKET_ALBUM||e.type===l.THUMB_TYPE_ALBUM)&&e.single?0:s}}function w(e,t,i){var a;switch(e.type){case l.THUMB_TYPE_DOC:a=e.ratio;break;case l.THUMB_TYPE_VIDEO:a=e.ratio||1.777;break;case l.THUMB_TYPE_ALBUM:case l.THUMB_TYPE_MARKET_ALBUM:a=1.5;break;default:if(e.sizes&&e.sizes.x){var n=e.sizes.x,r=n[1],o=n[2];r&&o&&(a=r/o)}if(e.sizes&&e.sizes.temp){var s=e.sizes.temp,h=s[1],d=s[2];h&&d&&(a=h/d)}}return a||1}function T(e,t,i,a){var r=t.split("_"),o=r[0],s=r[1],h=(0,n.default)({owner_id:o,ownerId:o,itemId:s,type:e,remove:i.remove,click:i.click,temp:"temp"in i.sizes},a);switch(e){case l.THUMB_TYPE_DOC:h.data={sizes:i.sizes,ratio:i.ratio,label:i.label,href:i.href},h.doc=h.data;break;case l.THUMB_TYPE_PHOTO:h.data={pid:s,sizes:i.sizes,restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},h.photo=h.data;break;case l.THUMB_TYPE_VIDEO:h.data={vid:s,duration:i.duration,platform:i.platform,play_icon:i.play_icon,preview:i.preview,active_live:i.active_live,restriction:i.restriction,ratio:i.ratio,sizes:i.sizes,name:i.name},h.video=h.data;break;case l.THUMB_TYPE_ALBUM:h.data={aid:s,title:i.title,size:i.size,thumb:{sizes:i.sizes},restrictionBlur:i.restrictionBlur,restrictionGeo:i.restrictionGeo,photoId:i.photoId},h.album=h.data;break;case l.THUMB_TYPE_MARKET_ALBUM:h.data={type:l.THUMB_TYPE_MARKET_ALBUM,aid:s,title:i.title,msize:i.msize,thumb:{sizes:i.sizes}},h.market_album=h.data}return h.data.type=e,h.data.id=h.temp?`${e}temp_${o}`:`${e}${h.ownerId}_${h.itemId}`,h}function y(e,t){var i=M(e)||void 0===e.length?{}:[];for(var a in e)(!/webkit/i.test(_ua)||"layerX"!=a&&"layerY"!=a&&"webkitMovementX"!=a&&"webkitMovementY"!=a)&&(t&&"object"==typeof e[a]&&"prototype"!==a&&null!==e[a]?i[a]=y(e[a]):i[a]=e[a]);return i}var M=e=>"[object Object]"===Object.prototype.toString.call(e)},772614:(e,t,i)=>{i.d(t,{ThumbsEdit:()=>v});var a=i(274642),n=i(840060),r=i(70162),o=i(631351),s=i(152278),l=i(342269),h=i(873589),d=i(733164),c=i(220796),u=i(290846),v={cache:function(){return cur._thEdCache||(cur._thEdCache={}),cur._thEdCache},loaded:function(){return cur._thEdLoaded||(cur._thEdLoaded={}),cur._thEdLoaded},cur:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){return cur._thEdCur||(cur._thEdCur={}),cur._thEdCur})),getMedias:function(e){var t=[];return(e=(0,h.ge)(e))?((this.cache()[e.id]?this.cache()[e.id].previews:[]).forEach((e=>{this.isValidThumbType(e.type)&&t.push([e.type,`${e.ownerId}_${e.itemId}`])})),t):t},init:function(e,t,i){if(e=(0,h.ge)(e)){(i="boolean"==typeof i?{wide:i}:(0,l.clone)(i)||{}).width&&i.height?i.force=!0:(i.width=e.parentNode.offsetWidth,i.height=Math.round(i.width/c.THUMBS_CONTAINER_DEFAULT_RATIO));var a=[];t.forEach((e=>{this.isValidThumbType(e.type)&&a.push(e)})),(0,h.domData)(e,"te-inited",1),this.cache()[e.id]={previews:a,opts:i,wide:i.wide,height:0,thumbs:[]};var n=this.cur().timer;n&&clearTimeout(n),a.length?this.cur().timer=setTimeout((()=>{var t=this.processThumbs(i.width,i.height,a,i);this.cache()[e.id].thumbs=t.thumbs,this.cache()[e.id].height=t.height;var n=(0,h.cf)();t.thumbs.forEach(((t,i)=>{n.appendChild(this.createThumbEl(e.id,t,i))})),(0,h.val)(e,""),(0,h.toggleClass)(e,"wide",i.wide),(0,h.setStyle)(e,{width:t.width,height:t.height}),e.appendChild(n),(0,h.show)(e),(0,d.isFunction)(i.onUpdate)&&i.onUpdate()}),0):((0,h.hide)(e),(0,h.val)(e,""))}},getParentTooltipCls:function(e){return(0,h.gpeByClass)("_im_text_input",e)?"_im_text_input":"thumb_wrap"},loadAndDisplayImage:function(e,t){if(e&&t&&t.oldImage){var i=new Image,a=t.image,n=t.oldImage;if(this.loaded()[a.src]&&e.src!==a.src)return e.src=a.src,void delete t.oldImage;var r=()=>{e.src===n.src&&(e.src=a.src,delete t.oldImage,this.loaded()[a.src]=!0),(0,s.removeEvent)(i,"load",r)};(0,s.addEvent)(i,"load",r),i.src=a.src}},createThumbEl:function(e,t,i){if(t&&this.isValidThumbType(t.type)){var n,o=t.oldImage||t.image,v=this.crop(t,t.width,t.height),g="draggable_thumb _draggable clear_fix"+(t.unsized?" unsized"+(t.single?" unsized_single":""):""),p=`thumb_wrap fl_l thumb_${t.type}_wrap`;switch(t.lastColumn&&(p+=" last_column"),t.lastRow&&(p+=" last_row"),t.height<50&&(p+=" thumb_no_controls"),t.type){case c.THUMB_TYPE_ALBUM:case c.THUMB_TYPE_MARKET_ALBUM:t.orig.restrictionGeo||t.image.src.match(/^\/images\//)&&(p+=" page_album_nocover"),(t.title||t.thumb)&&(n=`\n            <div class="page_album_title">\n              <div class="page_album_size">${t.msize||t.size}</div>\n              <div class="page_album_title_text">${t.title}</div>\n            </div>\n          `),t.orig.restrictionBlur&&(g+=" PostPhotoRestriction--blur"),t.orig.restrictionGeo&&(g+=" PostPhotoRestriction--geo");break;case c.THUMB_TYPE_PHOTO:t.orig.restrictionBlur&&(g+=" PostPhotoRestriction--blur"),t.orig.restrictionGeo&&(g+=" PostPhotoRestriction--geo");var m=(0,a.isPhotoeditor3Available)()&&!vk.widget&&!t.orig.restrictionGeo,_=this.cache()[e];n=!(_&&_.opts&&_.opts.nocl)?`\n          <div class="photo_thumb_btns_container">\n            <div class="photo_thumb_btns_overlay">\n              <div class="photo_thumb_btns">\n                <div class="photo_thumb_btn_show _photo_thumb_btn_show" id="ui_btn_show"></div>\n                ${m?'<div class="photo_thumb_btn_editor _photo_thumb_btn_editor" id="ui_btn_pe"></div>':""}\n              </div>\n            </div>\n          </div>\n        `:"";break;case c.THUMB_TYPE_DOC:n=`\n          ${t.orig.label}\n          <a href="${t.orig.href}" class="post_doc_thumb_link" target="_blank" rel="noopener"></a>\n        `;break;case c.THUMB_TYPE_VIDEO:n=t.orig.preview}var f="";t.orig.photoId&&(f=`data-photo-id="${(0,l.clean)(t.orig.photoId)}"`);var b=vk.widget?(0,l.clean)((0,d.unclean)(o.src)):(0,l.clean)(o.src),w=t.unsized||t.orig.preview?"":`\n      <img class="preview _preview" src="${b}" width="${Math.round(v.width)}" height="${Math.round(v.height)}" style="margin:${v.marginTop}px 0 0 ${v.marginLeft}px;"/>\n    `,T=`\n      <div index="${i}" attachment="${t.id}" ${f} class="${p}"${t.name?` aria-label="${(0,l.clean)(t.name)}"`:""} style="width: ${(0,l.intval)(t.width)}px;height: ${(0,l.intval)(t.height)}px;">\n        <div class="${g}" ${t.unsized?` style="background-image:url(${(0,l.clean)(o.src)})"`:""}>\n          ${w}\n          ${n}\n          ${t.type!==c.THUMB_TYPE_VIDEO?'<div class="overlay _overlay"></div>':""}\n          <div class="ui_thumb_x_button _close_btn" role="link" aria-label="${(0,l.clean)(r.getLang("dont_attach"))}">\n            <div class="ui_thumb_x"></div>\n          </div>\n        </div>\n      </div>\n    `,y=(0,h.se)(T),M=(0,h.geByClass1)("_preview",y),E=(0,h.geByClass1)("_draggable",y),C=(0,h.geByClass1)("_close_btn",y);if(t.oldImage&&M&&this.loadAndDisplayImage(M,t),(0,s.addEvent)(E,"click",(e=>{if(this.cur().updating||(0,h.domClosest)("_close_btn",e.target))(0,s.cancelEvent)(e);else{var t=(0,h.gpeByClass)("thumb_wrap",e.target),i=this.cache()[t.parentNode.id].previews[t.getAttribute("index")].click;cur.openEditor=(0,h.hasClass)(e.target,"_photo_thumb_btn_editor"),(0,d.isFunction)(i)&&i(e)}})),(0,s.addEvent)(E,"mousedown touchstart",(e=>this.startDrag(e))),(0,s.addEvent)(C,"click",(e=>{var t=(0,h.gpeByClass)("thumb_wrap",e.target);(0,h.hide)((0,h.geByClass1)("_draggable",t)),this.removeMedia(t.parentNode.id,t.getAttribute("index"))})),(0,s.addEvent)(C,"mouseover",(()=>(0,u.showTooltip)(C,{text:r.getLang("dont_attach"),shift:[11,8],black:1}))),t.type===c.THUMB_TYPE_PHOTO){var B=(0,h.geByClass1)("_photo_thumb_btn_show",y);B&&(0,s.addEvent)(B,"mouseover",(()=>(0,u.showTooltip)(B,{text:r.getLang("global_photo_attach_show"),shift:[10,8],black:1,appendParentCls:this.getParentTooltipCls(E)})));var U=(0,h.geByClass1)("_photo_thumb_btn_editor",y);U&&(0,s.addEvent)(U,"mouseover",(()=>(0,u.showTooltip)(U,{text:r.getLang("global_pe_edit"),shift:[9,8],black:1,appendParentCls:this.getParentTooltipCls(E)})))}return y}},getCoords:function(e,t){var i=[];return t=t||(0,h.getXY)(e),Array.from(e.childNodes).forEach((e=>{if((0,h.hasClass)(e,"thumb_wrap")){var a=(0,h.getXY)(e);i[i.length]={id:e.getAttribute("attachment"),x:(0,l.intval)(a[0]-t[0]),y:(0,l.intval)(a[1]-t[1]),width:(0,l.intval)(e.offsetWidth),height:(0,l.intval)(e.offsetHeight),index:(0,l.intval)(e.getAttribute("index")),node:e}}})),i},startDrag:function(e){var t=e.touches&&1==e.touches.length,i=null==e.button||0!=e.button&&!(1==e.button&&n.browser.msie8);if((0,h.hasClass)(e.target,"_photo_thumb_btn_show")||(0,h.hasClass)(e.target,"_photo_thumb_btn_editor"))return(0,s.cancelEvent)(e);if(!(i&&!t||(0,h.domClosest)("_close_btn",e.target)||this.cur().updating)){var a=(0,h.hasClass)(e.target,"draggable_thumb")?e.target:(0,h.gpeByClass)("draggable_thumb",e.target),r=(0,h.gpeByClass)("editable_thumbs",a),o=this.cache()[r.id];if(o&&!((o.previews||[]).length<2))return this.cur().el=a,this.cur().dragHandler=e=>this.drag(e),this.cur().dropHandler=e=>this.drop(e),(0,s.addEvent)(window,"mousemove touchmove",this.cur().dragHandler),(0,s.addEvent)(window,"mouseup touchend touchcancel",this.cur().dropHandler),t||(0,s.cancelEvent)(e)}},drag:function(e){var t=this.cur().el;if(e.touches&&e.touches.length>1)return this.drop();var i=n.browser.android?e.touches[0].pageX+(e.pageX||0):e.pageX,a=n.browser.android?e.touches[0].pageY+(e.pageY||0):e.pageY,r=this.cur();if((0,h.hasClass)(t,"moving")){var d=i-(r.pos[0]+r.x),u=a-(r.pos[1]+r.y);(0,h.setStyle)(t,{left:d,top:u});var v=r.wpos,g={x:d=r.pos[0]+(0,l.intval)(t.style.marginLeft)+d-v[0],y:u=r.pos[1]+(0,l.intval)(t.style.marginTop)+u-v[1],offsetX:t.offsetWidth,offsetY:t.offsetHeight,index:r.i,node:t},p=!1,m=r.i,_=-1,f=c.THUMBS_MESH_GAP;(0,l.each)(r.coords,(function(e,t){if(e!=r.i&&e!=_){t.offsetX=t.node.offsetWidth+f,t.offsetY=t.node.offsetHeight+f;var i=r.coords[e-1],a=r.coords[e+1],n=g.x+g.offsetX/2,o=g.y+g.offsetY/2,s=t.x+t.offsetX/2,l=t.y+t.offsetY/2,d=t.x+t.offsetX,c=t.y+t.offsetY,u=(i&&i.x==t.x&&i.y!=t.y&&0!=t.y||a&&a.x==t.x&&a.y!=t.y)&&0!=t.x,v=n>=s&&(a&&(n<=a.x+a.offsetX/2&&(a.offsetY==t.offsetY||n<d)||a.y!=t.y)||!a&&g.x<=d)&&o>t.y&&o<c,b=n<s&&n>=t.x&&(!i||i.y!=t.y&&!(i.x==t.x&&!a))&&o>t.y&&o<c,w=u&&o>=l&&o<c&&n>t.x&&n<d,T=u&&o<l&&o>=t.y&&n>t.x&&n<d;v=v&&!u,b=b&&!u&&!v,(v||b||w||T)&&(p=!0,m=t.index<r.i&&(v||w)?t.index+1:g.index<t.index&&(T||b)?t.index-1:t.index),m!=r.i?(0,h.setStyle)(t.node,{left:v?-2:b?2:0,top:w?-2:T?2:0}):(0,h.setStyle)(t.node,{left:0,top:0}),v&&a&&a.y==t.y&&a.x>t.x&&g.index>t.index&&((0,h.setStyle)(t.node,{left:0,top:0}),(0,h.setStyle)(a.node,{left:2,top:0}),_=e+1),w&&a&&a.x==t.x&&a.y>t.y&&o<=l&&((0,h.setStyle)(a.node,{left:0,top:0}),_=e+1),T&&i&&i.x==t.x&&i.y<t.y&&o<=l&&((0,h.setStyle)(i.node,{left:0,top:-2}),(0,h.setStyle)(t.node,{left:0,top:0}))}})),r.to_i=p?m:r.i}else{var b=t.parentNode.parentNode,w=(0,h.geByClass1)("_overlay",t),T=(0,h.geByClass1)("_preview",t),y=(0,l.intval)(t.parentNode.getAttribute("index")),M=this.cache()[b.id].thumbs[y],E=(0,h.getXY)(b),C=(0,h.getXY)(t.parentNode),B=this.getCoords(b,E);r.id=b.id,r.i=y,r.to_i=y,r.x=i-C[0],r.y=a-C[1],r.t=M,r.w=M.width,r.h=M.height,r.pos=C,r.wpos=E,r.crop=this.crop(M,M.width,M.height),r.coords=B;var U=this.scale(M.width,M.height,75),x=U[0],O=U[1],A=(0,l.intval)((M.width-x)*(n.browser.mobile?.5:r.x/M.width)),I=(0,l.intval)((M.height-O)*(n.browser.mobile?.5:r.y/M.height));(0,h.addClass)(t,"moving"),(0,h.setStyle)(t,"zIndex",100);var P={duration:c.THUMB_DRAG_ANIMATION_DURATION,transition:o.Fx.Transitions.easeOutCubic},H=this.crop(M,x,O);(0,o.animate)(t,{opacity:.85,width:x,height:O,marginLeft:A,marginTop:I},P),(0,o.animate)(w,{opacity:1},P),T&&(0,o.animate)(T,H,P)}return(0,s.cancelEvent)(e)},drop:function(e){var t=this.cur();document.removeEventListener("touchmove",this.preventScroll),t.updating=!0;var i=t.el,a=(0,h.geByClass1)("_overlay",i),n=(0,h.geByClass1)("_preview",i);if((0,s.removeEvent)(window,"mousemove touchmove",t.dragHandler),(0,s.removeEvent)(window,"mouseup touchend touchcancel",t.dropHandler),!(0,h.hasClass)(i,"moving"))return t.updating=!1,(0,s.cancelEvent)(e);if(t.to_i==t.i){var r=t.crop,u={duration:c.THUMB_DRAG_ANIMATION_DURATION,transition:o.Fx.Transitions.easeOutCubic};(0,o.animate)(i,{marginTop:0,marginLeft:0,top:0,left:0,width:t.w,height:t.h,opacity:1},(0,l.extend)(u,{onComplete:()=>{(0,h.setStyle)(i,"zIndex",null),t.updating=!1}})),(0,o.animate)(a,{opacity:0},u),n&&(0,o.animate)(n,r,u)}else{var v=this.cache()[t.id].previews;v=this.move(v,t.i,t.to_i),this.update(t.id,v);var g=this.cache()[t.id];(0,d.isFunction)((g.opts||{}).onMove)&&this.cache()[t.id].opts.onMove(),(0,d.isFunction)((g.opts||{}).onIndexChanged)&&this.cache()[t.id].opts.onIndexChanged(t.i,t.to_i)}return(0,h.removeClass)(i,"moving"),(0,s.cancelEvent)(e)},update:function(e,t){if(e=(0,h.ge)(e)){var i=e.id,a=(0,h.ge)(i),n=this.cache()[a.id],r=n.thumbs,s=n.height,u=n.opts,v=!0===u||!1===u?{wide:u}:(0,l.clone)(u||{}),g=v.width,p=v.height;g&&p?v.force=!0:(g=e.parentNode.offsetWidth,p=Math.round(g/c.THUMBS_CONTAINER_DEFAULT_RATIO));var m=this.processThumbs(g,p,t,v),_=(0,h.se)(`\n      <div style="height: 0;overflow: hidden;">\n        <div class="_editable_thumbs editable_thumbs${n.wide?" wide":""}" style="width: ${m.width}px;height: ${m.height}px;"></div>\n      </div>\n    `),f=(0,h.geByClass1)("_editable_thumbs",_);m.thumbs.forEach(((e,t)=>{f.appendChild(this.createThumbEl(i,e,t))})),a.parentNode.appendChild(_);var b=this.getCoords(f);(0,l.each)(b,((e,t)=>{for(var i=null,a=this.cur().coords,n=0,s=a.length;n<s;++n)if(a[n].id==t.id){i=a[n];break}if(null!=i){var d=(0,h.geByClass1)("_draggable",i.node),u=(0,h.geByClass1)("_overlay",d),v=(0,h.geByClass1)("_preview",d),g=r[i.index],p=null;(0,l.each)(m.thumbs,((e,t)=>{t.id==g.id&&(this.loaded()[t.image.src]||(t.oldImage=g.image),p=t)})),(0,h.setStyle)(i.node,{left:0,top:0}),i.height==t.height&&i.width==i.width&&t.x==i.x&&t.y==i.y&&i.index!=this.cur().i||((0,h.hasClass)(d,"moving")&&(0,o.fadeOut)(u,c.THUMB_DRAG_ANIMATION_DURATION),setTimeout((()=>{(0,o.animate)(d,{top:t.y-i.y,left:t.x-i.x,marginLeft:0,marginTop:0,height:t.height,width:t.width,opacity:1},c.THUMB_DRAG_ANIMATION_DURATION);var e=this.crop(p,t.width,t.height);v&&(0,o.animate)(v,e,c.THUMB_DRAG_ANIMATION_DURATION),(0,h.toggleClass)(d,"unsized_single",p.unsized&&p.single)}),4))}})),s!=m.height&&setTimeout((()=>{(0,o.animate)(a,{height:m.height},c.THUMB_DRAG_ANIMATION_DURATION)}),4),setTimeout((()=>{(0,d.isFunction)(v.onUpdate)&&v.onUpdate(),(0,h.setStyle)(a,{height:m.height,width:m.width}),a.innerHTML="",this.cache()[i].thumbs=m.thumbs,this.cache()[i].previews=t,this.cache()[i].height=m.height,m.thumbs.forEach(((e,t)=>{a.appendChild(this.createThumbEl(i,e,t))})),(0,h.re)(_),this.cur().updating=!1}),c.THUMB_DRAG_ANIMATION_DURATION)}},setWide:function(e,t,i){if(e=(0,h.ge)(e)){var a=this.cache()[e.id],n=(0,l.clone)(i||{});void 0===t&&(t=!1),n.wide=t,a.wide!=t&&this.init(e,a.previews,n)}},hasMedia:function(e,t){if(e=(0,h.ge)(e)){var i=e.id,a=this.cache()[i];if(a){for(var n=0;n<a.previews.length;n++)if(a.previews[n][a.previews[n].type].id==t)return!0;return!1}}},addMedia:function(e,t){if((e=(0,h.ge)(e))&&t){var i=e.id,a=this.cache()[i];if(a){var n=(0,l.clone)(a.previews);10==n.length||this.hasMedia(e,t[t.type].id)||(n[n.length]=t,this.cache()[i]=null,this.init(i,n,(0,l.clone)(a.opts)))}}},updateMedia:function(e,t,i,a){if((e=(0,h.ge)(e))&&t&&i&&a){var n=e.id,r=this.cache()[n];if(r){for(var o=(0,l.clone)(r.previews),s=!1,d=t+i,c=0;c<o.length;c++)if(o[c][o[c].type].id==d){var u=this.convert(t,i,a.editable);o[c]=u,s=!0;break}s&&(this.cache()[n]=null,this.init(n,o,(0,l.clone)(r.opts)))}}},refresh:function(e){if(e=(0,h.ge)(e)){var t=e.id,i=this.cache()[t];i&&(this.cache()[t]=null,this.init(t,(0,l.clone)(i.previews),(0,l.clone)(i.opts)))}},removeAll:function(e){if(e=(0,h.ge)(e)){var t=e.id,i=this.cache()[t];i&&(this.cache()[t]=null,this.init(t,[],i.opts))}},removeMedia:function(e,t){var i;if(!(e=(0,h.ge)(e)))return null;t=(0,l.intval)(t);var a=this.cache()[e.id];if(a){var n=a.previews.splice(t,1),r=n[0][n[0].type].id;(0,l.each)(e.childNodes,((e,t)=>{if(t.getAttribute&&t.getAttribute("attachment")==r){var i=((0,h.geByClass1)("_close_btn",t)||{}).tt;return i&&i.destroy&&i.destroy(),!1}})),this.cur().coords=this.getCoords(e),0==a.previews.length?this.init(e,[],a.opts):this.update(e,a.previews);var o=null==a||null==(i=a.opts)?void 0:i.onDelete;return(0,d.isFunction)(o)&&o(t),n[0]&&n[0].remove&&n[0].remove(),n}},removeById:function(e,t){if(!(e=(0,h.ge)(e)))return null;for(var i=(this.cache()[e.id]||{}).previews||[],a=0,n=i.length;a<n;++a)if(i[a].type==c.THUMB_TYPE_DOC&&i[a].doc.id==t||i[a].type==c.THUMB_TYPE_PHOTO&&i[a].photo.id==t||i[a].type==c.THUMB_TYPE_VIDEO&&i[a].video.id==t||i[a].type==c.THUMB_TYPE_ALBUM&&i[a].album.id==t||i[a].type==c.THUMB_TYPE_MARKET_ALBUM&&i[a].market_album.id==t)return this.removeMedia(e,a);return null},processThumbs:c.processThumbs,compute:c.compute,getSize:c.getSize,move:c.move,scale:c.scale,crop:c.crop,getRatio:c.getRatio,convert:c.convert,isValidThumbType:c.isValidThumbType}},282568:(e,t,i)=>{i.d(t,{NO_POST_ID:()=>n,THUMB_TYPE_DOC:()=>r,THUMB_TYPE_PHOTO:()=>o,THUMB_TYPE_VIDEO:()=>s,THUMB_TYPE_ALBUM:()=>l,THUMB_TYPE_MARKET_ALBUM:()=>h,isValidThumbType:()=>d,getThumbsMediaItems:()=>u,moveThumbsInData:()=>v,getThumbByIndex:()=>g,deleteThumbInData:()=>p,addThumbsInData:()=>m});var a=i(506770);const n="no_post_id",r="doc",o="photo",s="video",l="album",h="market_album";function d(e){const t=[r,o,s];return(0,a.partConfigEnabled)("attachments_primary_mode_web_feature")||t.push(l,h),!!~t.indexOf(e.toString())}const c=([e,,t])=>e===r?"editable"in t&&function(e){return e.editable&&"gif"!==e.ext}(t):d(e),u=e=>{var t;return null!==(t=null==e?void 0:e.filter(c))&&void 0!==t?t:[]};const v=(e,t,i)=>{const a=u(i),n=i.map((e=>d(e[0])?void 0:e)),r=a[e];return a.splice(e,1),a.splice(t,0,r),n.map((e=>e||a.shift()))},g=(e,t)=>u(t)[e],p=(e,t)=>{const i=g(e,t);return t.filter((e=>e!==i))},m=(e,t)=>{const[i,a]=e,n=t.findIndex((([e,t])=>e===i&&t===a));return n<0?t.push(e):t[n]=e,t}},381621:(e,t,i)=>{var a=i(772614);window.ThumbsEdit=a.ThumbsEdit;try{window.stManager.done(window.jsc("web/thumbs_edit.js"))}catch(e){}}},s={};function l(e){var t=s[e];if(void 0!==t)return t.exports;var i=s[e]={exports:{}};return o[e].call(i.exports,i,i.exports,l),i.exports}l.m=o,e=[],l.O=(t,i,a,n)=>{if(!i){var r=1/0;for(d=0;d<e.length;d++){for(var[i,a,n]=e[d],o=!0,s=0;s<i.length;s++)(!1&n||r>=n)&&Object.keys(l.O).every((e=>l.O[e](i[s])))?i.splice(s--,1):(o=!1,n<r&&(r=n));if(o){e.splice(d--,1);var h=a();void 0!==h&&(t=h)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[i,a,n]},l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},i=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,l.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var n=Object.create(null);l.r(n);var r={};t=t||[null,i({}),i([]),i(i)];for(var o=2&a&&e;"object"==typeof o&&!~t.indexOf(o);o=i(o))Object.getOwnPropertyNames(o).forEach((t=>r[t]=()=>e[t]));return r.default=()=>e,l.d(n,r),n},l.d=(e,t)=>{for(var i in t)l.o(t,i)&&!l.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},l.f={},l.e=e=>Promise.all(Object.keys(l.f).reduce(((t,i)=>(l.f[i](e,t),t)),[])),l.u=e=>9375===e?"voice_message_player.a24b5302dda38f2690dc.js":28762===e?"speech.2ae50810d84f10a5626e.js":57468===e?"SilentModeForms.f50c33cf80f4ac9afc47.js":75980===e?"menu_settings.0f17151bd588fe6a5267.js":void 0,l.miniCssF=e=>e+"."+{57468:"36d8e7db328f8ee92e7d",75980:"519f671449550110bbb1"}[e]+".css",l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},l.l=(e,t,i,n)=>{if(a[e])a[e].push(t);else{var r,o;if(void 0!==i)for(var s=document.getElementsByTagName("script"),h=0;h<s.length;h++){var d=s[h];if(d.getAttribute("src")==e||d.getAttribute("data-webpack")=="vk:"+i){r=d;break}}r||(o=!0,(r=document.createElement("script")).charset="utf-8",r.timeout=120,l.nc&&r.setAttribute("nonce",l.nc),r.setAttribute("data-webpack","vk:"+i),r.src=e),a[e]=[t];var c=(t,i)=>{r.onerror=r.onload=null,clearTimeout(u);var n=a[e];if(delete a[e],r.parentNode&&r.parentNode.removeChild(r),n&&n.forEach((e=>e(i))),t)return t(i)},u=setTimeout(c.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=c.bind(null,r.onerror),r.onload=c.bind(null,r.onload),o&&document.head.appendChild(r)}},l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="/dist/",n=e=>new Promise(((t,i)=>{var a=l.miniCssF(e),n=l.p+a;if(((e,t)=>{for(var i=document.getElementsByTagName("link"),a=0;a<i.length;a++){var n=(o=i[a]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(n===e||n===t))return o}var r=document.getElementsByTagName("style");for(a=0;a<r.length;a++){var o;if((n=(o=r[a]).getAttribute("data-href"))===e||n===t)return o}})(a,n))return t();((e,t,i,a)=>{var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.onerror=n.onload=r=>{if(n.onerror=n.onload=null,"load"===r.type)i();else{var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+s+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=o,l.request=s,n.parentNode.removeChild(n),a(l)}},n.href=t,document.head.appendChild(n)})(e,n,t,i)})),r={53081:0},l.f.miniCss=(e,t)=>{r[e]?t.push(r[e]):0!==r[e]&&{57468:1,75980:1}[e]&&t.push(r[e]=n(e).then((()=>{r[e]=0}),(t=>{throw delete r[e],t})))},(()=>{var e={53081:0};l.f.j=(t,i)=>{var a=l.o(e,t)?e[t]:void 0;if(0!==a)if(a)i.push(a[2]);else if(75980!=t){var n=new Promise(((i,n)=>a=e[t]=[i,n]));i.push(a[2]=n);var r=l.p+l.u(t),o=new Error;l.l(r,(i=>{if(l.o(e,t)&&(0!==(a=e[t])&&(e[t]=void 0),a)){var n=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;o.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",o.name="ChunkLoadError",o.type=n,o.request=r,a[1](o)}}),"chunk-"+t,t)}else e[t]=0},l.O.j=t=>0===e[t];var t=(t,i)=>{var a,n,[r,o,s]=i,h=0;for(a in o)l.o(o,a)&&(l.m[a]=o[a]);if(s)var d=s(l);for(t&&t(i);h<r.length;h++)n=r[h],l.o(e,n)&&e[n]&&e[n][0](),e[r[h]]=0;return l.O(d)},i=self.webpackChunkvk=self.webpackChunkvk||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var h=l.O(void 0,[76429,75514,24509,56990,98066,76400,40885,68592],(()=>l(381621)));h=l.O(h)})();