(self.webpackChunkvk=self.webpackChunkvk||[]).push([[85820],{428817:t=>{t.exports={reactions_preview_item:'<div class="ReactionsPreviewItem ReactionsPreviewItem--stackOverlay %class%" style="background-image: url(\'%image_url%\');" aria-label="%title%"></div>'}},613327:(t,e,n)=>{"use strict";n.d(e,{preservePositionBetween:()=>a});var i=n(830104),o=n(659397);function a(t,{scrollByImpl:e=window.scrollBy}={}){let n=t;return{start:(0,o.once)((function(t){t&&(n=t);const a=(0,i.getElementOffset)(n);return(0,o.once)((function(t){if(t&&(n=t),n.isConnected){const t=(0,i.getElementOffset)(n);e(0,t.top-a.top)}}))}))}}},819633:(t,e,n)=>{"use strict";n.d(e,{getAnimationAsync:()=>i,onAnimationReady:()=>o,destroyAnimationItem:()=>a,animationModuleLoaderAsync:()=>r});const i=({animationDataGet:t,animationDataSet:e,animationModuleLoader:n})=>(...i)=>n().then((({loadAnimation:n})=>(({animationDataGet:t,animationDataSet:e,loadAnimation:n})=>(i,o,a)=>{const r=i,s=t?t({animationId:r}):void 0,c=n({animationData:s,animationURL:i,container:o,loadAnimationParams:null==a?void 0:a.loadAnimationParams});return!s&&e&&function(t,e){t.addEventListener("data_ready",(()=>{e(t.animationData)}))}(c,(t=>{e({animationId:r,loadedAnimationData:t})})),c})({animationDataGet:t,animationDataSet:e,loadAnimation:n})(...i)));function o(t,e){t.isLoaded?e():t.addEventListener("DOMLoaded",(()=>{e()}))}function a(t){const e=function(t){return!t._cbs}(t);e||t.destroy()}const r=()=>Promise.all([n.e(38288),n.e(55489)]).then(n.bind(n,809499)).then((t=>{return{loadAnimation:(e=t.lottie,({animationData:t,animationURL:n,container:i,loadAnimationParams:o={}})=>{var a,r;const s=t?{animationData:t}:{path:n},c={renderer:"svg",autoplay:null!==(a=null==o?void 0:o.autoplay)&&void 0!==a&&a,loop:null===(r=null==o?void 0:o.loop)||void 0===r||r,rendererSettings:{progressiveLoad:!0}},l=Object.assign(Object.assign(Object.assign({},s),c),{container:i});return e.loadAnimation(l)})};var e}))},508271:(t,e,n)=>{"use strict";n.d(e,{HIDE_TOOLTIP_TIMEOUT:()=>i,SHOW_TOOLTIP_TIMEOUT:()=>o,REACTION_ID_DEFAULT:()=>a,REACTION_ID_MAX:()=>r,REACTION_ID_MIN:()=>s,REACTION_ID_UNSET:()=>c,REACTION_SET_ITEMS_MIN_COUNT:()=>l,OPENED_REACTED_USERS_DEFAULT_REACTION_ID:()=>u});const i=600,o=140,a=0,r=7,s=0,c=void 0,l=2,u=a},464746:(t,e,n)=>{"use strict";n.d(e,{isDebugEnabled:()=>a});var i=n(15305);let o;const a=()=>(void 0!==o||(o=!!i.ls.get("reactions.debug_enabled")),o)},714396:(t,e,n)=>{"use strict";n.d(e,{reactionCountsBrandUnwrap:()=>o,reactionCountsBrandWrap:()=>a});var i=n(165594);const o=t=>(0,i.unwrap)(t),a=t=>(0,i.wrap)(t)},82701:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>o});var i=n(66433);function o({error:t,reportError:e=!1}){e&&(0,i.logError)(t,{environment:"reactions"}),console.error(t)}},517760:(t,e,n)=>{"use strict";n.d(e,{isUnknownObject:()=>s,getReaction:()=>c,getDefaultReaction:()=>l,getDefaultReactionTitle:()=>u,prepareReactionMenuSet:()=>v,isReactionIdSet:()=>m,isReactionIdUnset:()=>g,isValidReactionId:()=>p,parseReactionId:()=>_,parseReactionIdOrUnset:()=>b,validateReactionSetPayloaditems:()=>w,parseReactionMenuConfig:()=>I,calcCounters:()=>R,calcCountersSum:()=>S,calcCountersWeightedSum:()=>f,hasReactionsForCounts:()=>E,counterForReactionId:()=>y,areCountersEqual:()=>P});var i=n(508271),o=n(714396),a=n(659397);const r=Number.isInteger||(t=>"number"==typeof t&&isFinite(t)&&Math.floor(t)===t),s=t=>null!==t&&"object"==typeof t,c=(t,e)=>t.itemsById[e],l=t=>c(t,i.REACTION_ID_DEFAULT),u=t=>{var e;return null===(e=l(t))||void 0===e?void 0:e.title},d=(t,e)=>0===t.length?"":((t,e,n=!0)=>t.reduce(((t,i)=>{const o=e(i),a=e(t);return a===o?n?t:i:a<o?t:i})))(t,(t=>Math.pow(e.width-t.width,2)+Math.pow(e.height-t.height,2)),!1).url,v=(t,e,n)=>{const i=e.map((({asset:t,color_sets:e,id:i,score:o,title:a})=>({animationURL:t.animation_url||void 0,backgroundColor:null==e?void 0:e.background,id:i,imageMenuURL:d(t.images,n.imageMenuSize),imagePreviewURL:"imagePreviewSize"in n?d(t.images,n.imagePreviewSize):void 0,imageStoryPanelURL:"imageStoryPanelSize"in n?d(t.images,n.imageStoryPanelSize):void 0,imageStoryPreviewURL:"imageStoryPreviewSize"in n?d(t.images,n.imageStoryPreviewSize):void 0,score:o,title:a,titleColor:null==e?void 0:e.foreground}))),o={};return i.forEach((t=>{o[t.id]=t})),{id:t,items:i,itemsById:o}},m=t=>t!==i.REACTION_ID_UNSET,g=t=>t===i.REACTION_ID_UNSET,p=t=>r(t)&&t>=i.REACTION_ID_MIN&&t<=i.REACTION_ID_MAX,_=t=>{const e=parseInt(t,10);return p(e)?{isValid:!0,value:e}:{isValid:!1}},b=t=>{const e=_(t);return e.isValid?e.value:i.REACTION_ID_UNSET},w=(t,e)=>{if(t.length<i.REACTION_SET_ITEMS_MIN_COUNT)return{error:new Error(`Invalid reactions items count in set '${e}': ${t.length}`)}},I=t=>{if(!s(t))return;const e={},{animationShowStaticAfterEnd:n,menuShowDelay:o,openedDefaultReactionId:a,reportJsErrors:r}=t;return"number"!=typeof o&&void 0!==o||(e.menuShowDelay=o),"boolean"==typeof n&&(e.animationShowStaticAfterEnd=n),"boolean"==typeof r&&(e.reportJsErrors=r),"number"==typeof a||null===a?null===a?e.openedDefaultReactionId=void 0:p(a)&&(e.openedDefaultReactionId=a):e.openedDefaultReactionId=i.OPENED_REACTED_USERS_DEFAULT_REACTION_ID,e},R=(t,e)=>{const n=(0,o.reactionCountsBrandWrap)({});return Object.entries((0,o.reactionCountsBrandUnwrap)(t)).forEach((([t,i])=>{var o,a,r;const s=t,c=null!==(r=null===(a=null===(o=null==e?void 0:e.itemsById)||void 0===o?void 0:o[s])||void 0===a?void 0:a.score)&&void 0!==r?r:1;n[s]=c*(i||0)})),n},S=t=>Object.values((0,o.reactionCountsBrandUnwrap)(t)).reduce(((t,e)=>t+(e||0)),0),f=t=>S((0,o.reactionCountsBrandWrap)(t)),E=t=>S(t)>0,y=(t,e)=>{var n;return null!==(n=t[e])&&void 0!==n?n:void 0},P=(t,e)=>t&&e?(0,a.isEqual)(t,e):t===e},165594:(t,e,n)=>{"use strict";n.d(e,{unwrap:()=>i,wrap:()=>o});const i=t=>t,o=t=>t},964141:(t,e,n)=>{"use strict";n.d(e,{stripPercentVars:()=>i});const i=t=>t.replace(/%[-\w]+%/g,"")},465864:(t,e,n)=>{"use strict";function i(t){const e=t.match(/^([a-z_]+)([0-9\-_]+)$/);if(!e)return null;const[,n,i]=e;return{objectType:n,objectId:i}}n.d(e,{parseLikeObjectId:()=>i,likePostObjectId:()=>o,likeReplyObjectId:()=>a,getElementLikeButtonCount:()=>r,getElementLikeButtonIcon:()=>s,getElementLikeButtonLabel:()=>c});const o=t=>`wall${t}`,a=t=>`wall_reply${t}`,r=t=>{var e;return null!==(e=null==t?void 0:t.querySelector(".like_button_count, ._like_button_count"))&&void 0!==e?e:void 0},s=t=>{var e;return null!==(e=null==t?void 0:t.querySelector(".like_button_icon, ._like_button_icon"))&&void 0!==e?e:void 0},c=t=>{var e;return null!==(e=t.querySelector(".like_button_label, ._like_button_label"))&&void 0!==e?e:void 0}},93682:(t,e,n)=>{"use strict";n.d(e,{ATTR_USER_REACTION_ID:()=>i});const i="data-reaction-user-reaction-id"},330752:(t,e,n)=>{"use strict";n.d(e,{updateReactionButtonContainerForCounts:()=>f,updateReactionButtonForCurrentReaction:()=>E,updateReactionButtonCounts:()=>y,getLastOwnReactionChangeTime:()=>P,setDataCurrentId:()=>A});var i=n(570655),o=n(733164),a=(n(830104),n(70162)),r=n(819633),s=n(464746),c=n(517760),l=n(873589),u=n(631351),d=n(93682),v=n(646346),m=n(808591),g=n(672544),p=n(385667);const _="data-reaction-last-own-change-time",b="PostButtonReactions__icon--animationActive";const w=t=>{var e;const n=null===(e=t.__reactionIconAnimation)||void 0===e?void 0:e.animationItem;if(n){!n._cbs||n.destroy(),delete t.__reactionIconAnimation}},I=(t,e,n,o)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var i;if(!(t!==(null===(i=n.__reactionIconAnimation)||void 0===i?void 0:i.animationURL))&&t||(w(n),e.innerHTML="",n.classList.remove(b)),!o||!t)return;const a=yield(0,v.getAnimationAsync)(t,e,{loadAnimationParams:{autoplay:!0,loop:!1}});(0,r.onAnimationReady)(a,(()=>{n.classList.add(b)}));a.addEventListener("complete",(()=>{(function(){const t=(0,p.getReactionConfig)();return!0===(null==t?void 0:t.animationShowStaticAfterEnd)})()&&(n.classList.remove(b),w(n))})),n.__reactionIconAnimation={animationItem:a,animationURL:t}})),R=(t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-icon"]');if(!n)return;const{currentOption:i,isUserAction:o}=e;if(i.isReactionSet){const t=i.current,e=null==t?void 0:t.imageMenuURL;n.style.backgroundImage=`url('${e}')`,n.setAttribute("aria-label",null==t?void 0:t.title)}else{const t=i.default;n.style.backgroundImage="",(null==t?void 0:t.title)&&n.setAttribute("aria-label",null==t?void 0:t.title)}n.classList.toggle("PostButtonReactions__icon--custom",i.isReactionSet);{const t=i.isReactionSet?i.current.animationURL:void 0,e=(t=>{let e=t.querySelector(".PostButtonReactions__iconAnimation");return e||(e=(0,l.se)('<div class="PostButtonReactions__iconAnimation" data-section-ref="reactions-button-icon-animation"></div>'),t.appendChild(e),e)})(n);I(t,e,n,o)}},S=(t,e,n)=>{t.classList.toggle("PostButtonReactions--icon-active",e),t.classList.toggle("PostButtonReactions--active",e)},f=(t,e)=>{const n=!e||!(0,c.hasReactionsForCounts)(e);t.classList.toggle("PostBottomAction--empty",n)},E=(t,e,n,i)=>{const o=!(0,c.isReactionIdUnset)(e),r=((t,e)=>{let n,i=(0,c.getDefaultReaction)(t);if((0,c.isReactionIdUnset)(e)){if(i)return{isReactionSet:!1,default:i}}else{if(n=t.itemsById[e],n)return{isReactionSet:!0,current:n};console.error(new Error(`Missing reaction meta for ${e} in set '${t.id}'`))}return{_error:!0}})(n,e);"_error"in r||(R(t,{currentOption:r,isUserAction:i}),((t,e)=>{const{currentOption:n}=e,i=n.isReactionSet?n.current.titleColor:void 0,o=n.isReactionSet?n.current.backgroundColor:void 0,a=i?{"--reaction-button-title-color-light":i.light,"--reaction-button-title-color-dark":i.dark}:{"--reaction-button-title-color-light":null,"--reaction-button-title-color-dark":null},r=o?{"--reaction-button-background-color-light":o.light,"--reaction-button-background-color-dark":o.dark}:{"--reaction-button-background-color-light":null,"--reaction-button-background-color-dark":null},s=Object.assign(Object.assign({},a),r);Object.entries(s).forEach((([e,n])=>{t.style.setProperty(e,n)}))})(t,{currentOption:r}),((t,e)=>{const{currentOption:n}=e;let i="";i=n.isReactionSet?(0,a.langReplace)(a.getLang("reactions_button_unset_reaction_title")||"",{reaction_name:n.current.title||""}):(0,a.langReplace)(a.getLang("reactions_button_set_reaction_with_name")||"",{reaction_name:n.default.title||""})||a.getLang("reactions_button_title")||"",t.setAttribute("aria-label",i||"")})(t,{currentOption:r}),(0,m.isCounterEnabledForBtn)(t)||((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{currentOption:i}=e,o=i.isReactionSet?i.current.title:i.default.title;o?n.innerText=o:(0,s.isDebugEnabled)()&&console.log("reactions: setReactionNameTitle: missing title",i)})(t,{currentOption:r})),S(t,o),i&&function(t,e){t.setAttribute(_,String(e))}(t,Date.now())},y=(t,e,n,i,o)=>{const r=(0,m.getCounterForTitle)(t,e,i,o);if((0,m.isCounterEnabled)(r)&&(((t,e)=>{const n=t.querySelector('[data-section-ref="reactions-button-title"]');if(!n)return;const{counterForTitle:i}=e;if((0,m.isCounterAvailable)(i)){const t=i.buttonText;(0,u.animateCount)(n,t,{allowZero:i.allowZeroAnimation,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})}else(0,s.isDebugEnabled)()&&console.log("reactions: setReactionTitle: missing title",i)})(t,{counterForTitle:r}),i)){((t,e)=>{var n;const i=null===(n=(0,g.getClosestLikeBtnContainerElem)(t))||void 0===n?void 0:n.querySelector('[data-section-ref="reactions-button-screen-reader-counter"]');if(!i)return;const o=(0,a.langNumeric)(e,a.getLang("reactions_n_reacted","raw")||"%s",!0);i.innerText=o})(t,(0,c.calcCountersSum)(i))}},P=t=>{const e=t.getAttribute(_);if(e&&(0,o.isNumeric)(e))try{return new Date(Number.parseInt(e)).getTime()||void 0}catch(t){return void console.error(t)}};const A=(t,e)=>{t.setAttribute(d.ATTR_USER_REACTION_ID,(0,c.isReactionIdUnset)(e)?"":String(e))}},1925:(t,e,n)=>{"use strict";n.d(e,{TitleVariantWithLikedUsers:()=>i,TITLE_VARIANT_DEFAULT:()=>o,ReactionMenuTitleVariants:()=>a});const i="WithLikedUsers",o=i,a=[i,"TitleOnly"]},54789:(t,e,n)=>{"use strict";n.d(e,{ButtonStyleVariant:()=>i});const i={Post:"post",Reply:"reply"}},52521:(t,e,n)=>{"use strict";n.d(e,{renderPreviewItems:()=>u});var i=n(517760),o=n(483295),a=n(873589),r=n(428817),s=n.n(r),c=n(54789),l=n(385667);const u=(t,e,n,r,u)=>{const d=((t,e,n=!1)=>{let o=[];for(const e of Object.keys(t)){const n=(0,i.parseReactionId)(e);n.isValid&&t[n.value]>0&&o.push(n.value)}return o=o.sort(((e,n)=>(t[n]||0)-(t[e]||0))).slice(0,e),n&&o.reverse(),o})(e,3),v=t.querySelector(".ReactionsPreview__items"),m=(0,l.getReactionSet)(n),g=0===(0,i.calcCountersSum)(e),p=s().reactions_preview_item;v&&m&&"string"==typeof p?(v.innerHTML=d.map((t=>{const e=m.itemsById[t];if(!e)return"";const n=(0,o.classNames)({"ReactionsPreviewItem--lite ReactionsPreviewItem--stackOverlayLite":u===c.ButtonStyleVariant.Reply,"ReactionsPreviewItem--post ReactionsPreviewItem--stackOverlayPost":u===c.ButtonStyleVariant.Post});return(0,a.rs)(p,{image_url:e.imagePreviewURL,title:e.title,class:n})})).join(""),t.classList.toggle("ReactionsPreview--empty",g),t.classList.toggle("ReactionsPreview--active",void 0!==r)):console.warn("Unable to render reaction previews",{itemsContainer:v,previewItemTemplate:p,reactionSet:m})}},908706:(t,e,n)=>{"use strict";n.d(e,{isVariantInActionStatusBar:()=>o,isVariantHidden:()=>a,previewVisibilityUseCurrent:()=>r,isIntentPreviewInActionStatusBar:()=>s,isIntentPreviewHidden:()=>c,isIntentPreviewUseCurrent:()=>l,previewVisibilityIntentForVariant:()=>u,parsePreviewVariant:()=>d});var i=n(404608);const o=t=>t===i.PreviewVariantActionStatusBar,a=t=>t===i.PreviewVariantHidden,r={kind:"useCurrent"},s=t=>t.kind===i.PreviewVariantActionStatusBar,c=t=>t.kind===i.PreviewVariantHidden,l=t=>"useCurrent"===t.kind,u=t=>t?{kind:t}:r,d=t=>i.PreviewVariants.includes(t)?t:void 0},404608:(t,e,n)=>{"use strict";n.d(e,{PreviewVariantActionStatusBar:()=>i,PreviewVariantHidden:()=>o,PreviewVariants:()=>a});const i="action_status_bar",o="hidden",a=[i,o]},95146:(t,e,n)=>{"use strict";n.d(e,{SUPPORTED_OBJECT_TYPES:()=>i,SIZE_32:()=>o,SIZE_40:()=>a,SIZE_96:()=>r,SIZE_128:()=>s,REACTIONS_COUNTS_RESPONSE_FIELD:()=>c,WK_SECTION_PREFIX_REACTIONS:()=>l});const i={wall:"wall",wall_reply:"wall_reply"},o={width:32,height:32},a={width:40,height:40},r={width:96,height:96},s={width:128,height:128},c="reactions_counts",l="reactions"},646346:(t,e,n)=>{"use strict";n.d(e,{animationItemHasData:()=>r,getAnimationAsync:()=>s});var i=n(819633);const o=(0,n(419223).makeSharedState)("reactions-animations-storage",(()=>({animationItemsData:new Map})),{version:0}),a=()=>o().animationItemsData,r=t=>a().has(t),s=(0,i.getAnimationAsync)({animationDataGet:({animationId:t})=>a().get(t),animationDataSet:({animationId:t,loadedAnimationData:e})=>{a().set(t,e)},animationModuleLoader:i.animationModuleLoaderAsync})},485207:(t,e,n)=>{"use strict";n.d(e,{isDebugEnabled:()=>i.isDebugEnabled,ENABLED_IN_POST_REPLY:()=>o});var i=n(464746);const o=!1},808591:(t,e,n)=>{"use strict";n.d(e,{isCounterEnabledForBtn:()=>a,getCounterForTitle:()=>r,isCounterEnabled:()=>s,isCounterAvailable:()=>c});var i=n(517760),o=n(70162);const a=t=>!!t.getAttribute("data-reaction-button-text-is-counter");function r(t,e,n,r){if(!a(t))return{kind:"disabled"};if(!n)return{kind:"error"};const s=0!==(r?(0,i.calcCountersSum)(r):0);if(!(0,i.hasReactionsForCounts)(n))return{kind:"enabled",allowZeroAnimation:s,buttonText:""};const c=(0,i.calcCounters)(n,e),l=(0,i.calcCountersWeightedSum)(c);return{kind:"enabled",allowZeroAnimation:s,buttonText:(0,o.langNumeric)(l,"%s",!0)}}function s(t){return!!t&&"disabled"!==t.kind}function c(t){return"enabled"===t.kind}},892239:(t,e,n)=>{"use strict";n.d(e,{addDataUpdateListener:()=>r,emitDataUpdate:()=>s,addReactionChooseListener:()=>c,emitReactionChoose:()=>l});var i=n(480816);const o=(0,n(419223).makeSharedState)("reactions-menu-events",(()=>({emitter:new i.default})),{version:0}),a=()=>o().emitter,r=(t,e)=>{const n=a(),i={[`${t}:data_update`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},s=(t,e)=>{a().emit(`${t}:data_update`,e)},c=(t,e)=>{const n=a(),i={[`${t}:reaction_choose`]:e};return n.addListeners(i),()=>{n.removeListeners(i)}},l=t=>{a().emit(`${t}:reaction_choose`)}},301718:(t,e,n)=>{"use strict";n.d(e,{getPreviewVariantForLikeBtn:()=>g,reactionsElemPayload:()=>p,shouldReactionsPreviewBeVisible:()=>_,updateReactionsPreview:()=>w,updateReactionsButtonForCounts:()=>I});var i=n(520820),o=n(517760),a=n(631351),r=n(70162),s=n(385667),c=n(672544),l=n(740672),u=n(908706),d=n(52521),v=n(93682);const m=t=>{const e=t.getAttribute("data-reaction-counts");if(null===e)return{};const n=e?(0,i.parseJSON)(e):void 0;return"object"==typeof n&&null!==n?n:void 0},g=t=>{const e=t.getAttribute("data-reaction-preview-variant");if(e)return(0,u.parsePreviewVariant)(e)},p=t=>{const e=t.getAttribute("data-reaction-target-object"),n=t.getAttribute("data-reaction-hash"),i=t.getAttribute("data-reaction-set-id");if(null===i)return;const a=t.getAttribute(v.ATTR_USER_REACTION_ID),r=a?(0,o.parseReactionIdOrUnset)(a):void 0,s=t.getAttribute("data-reaction-style-variant"),c=s&&(0,l.isValidButtonStyleVariant)(s)?s:void 0,u=t.getAttribute("data-reaction-menu-title-variant"),d=u&&(0,l.isValidButtonTitleVariant)(u)?u:void 0,p=g(t);return{counts:m(t),csrfHash:n,objectRaw:e,reactionSetId:i,styleVariant:c,titleVariant:d,userReactionId:r,previewVariant:p}},_=t=>(0,o.hasReactionsForCounts)(t),b=(t,{counts:e,countsPrevious:n,objectRaw:i,reactionId:l,reactionSetId:u,styleVariant:v})=>{const m=(0,s.getReactionSet)(u),g=(0,o.calcCounters)(e,m),p=(0,o.calcCountersWeightedSum)(g),_=(0,o.calcCountersSum)(e),b=n?(0,o.calcCountersSum)(n):0,w=(0,c.getPreviewElem)(i);w&&((0,d.renderPreviewItems)(w,e,u,l,v),((t,e,n,i)=>{var o,s;const c=(0,r.langNumeric)(n,r.getLang("reactions_n_reacted","raw")||"%s",!0);t.setAttribute("aria-label",c);const l=(t=>{var e;return null!==(e=t.querySelector('[data-section-ref="like-button-count"]'))&&void 0!==e?e:void 0})(t);if(!l)return;t.tt&&"object"==typeof t.tt&&(t.tt.shown||t.tt.showing||null===(s=null===(o=t.tt)||void 0===o?void 0:o.destroy)||void 0===s||s.call(o));const u=(0,r.langNumeric)(e,"%s",!0);(0,a.animateCount)(l,u,{allowZero:0!==i,str:!0,noWrapWidth:!0,noSpaceIfEmpty:!0})})(w,p,_,b))},w=(t,e)=>{const n=(0,c.getLikeBtnElem)(t),i=e.counts;n&&i?((t,e,n)=>{const i=p(t);i&&i.objectRaw&&b(0,{counts:e,countsPrevious:n,objectRaw:i.objectRaw,reactionId:i.userReactionId,reactionSetId:i.reactionSetId,styleVariant:i.styleVariant})})(n,i,e.countsPrevious):console.warn("Unable to update object reactions",{objectRaw:t,options:e})},I=(t,{counts:e})=>{const n=(0,c.getLikeBtnElem)(t);n&&((t,e)=>{t.setAttribute("data-reaction-counts",JSON.stringify(e))})(n,e)}},582982:(t,e,n)=>{"use strict";n.d(e,{reactionLogError:()=>a});var i=n(82701),o=n(385667);const a=({error:t})=>{var e;const n=(0,o.getReactionConfig)(),a=null!==(e=null==n?void 0:n.reportJsErrors)&&void 0!==e&&e;(0,i.reactionLogError)({error:t,reportError:a})}},672544:(t,e,n)=>{"use strict";n.d(e,{getLikeBtnElem:()=>i,getClosestLikeBtnContainerElem:()=>o,getLikeWrap:()=>a,getMenuMount:()=>r,getPreviewElem:()=>s});const i=t=>{var e;return null!==(e=document.querySelector(`[data-section-ref="reactions-button"][data-reaction-target-object="${t}"]`))&&void 0!==e?e:void 0},o=t=>{var e;return null!==(e=t.closest('[data-section-ref="reactions-button-container"]'))&&void 0!==e?e:void 0},a=t=>{const e=i(t);var n;if(e)return null!==(n=e.closest(".like_wrap"))&&void 0!==n?n:void 0},r=t=>{var e,n;return null!==(n=null===(e=t.closest('[data-section-ref="reactions-button-container"]'))||void 0===e?void 0:e.querySelector('[data-section-ref="reactions-menu-mount"]'))&&void 0!==n?n:null},s=t=>document.querySelector(`[data-section-ref="reactions-preview-items"][data-reaction-target-object="${t}"]`)},385667:(t,e,n)=>{"use strict";n.d(e,{storageAddSets:()=>d,getReactionSet:()=>v,storageSetConfig:()=>m,getReactionConfig:()=>g});var i=n(659397),o=n(517760),a=n(419223),r=n(582982),s=n(95146),c=n(485207);const l=(0,a.makeSharedState)("reactions-storage",(()=>new Map),{version:0}),u=(0,a.makeSharedState)("reactions-config",(()=>({config:void 0})),{version:0}),d=t=>{(0,c.isDebugEnabled)()&&console.log(t),Object.entries(t).forEach((([t,e])=>{const n=(0,o.validateReactionSetPayloaditems)(e,t);if(n)return void(0,r.reactionLogError)({error:n.error});const a=e.map((t=>Object.assign(Object.assign({},t),{title:(0,i.decodeHTMLEntities)(t.title)})));l().set(t,(0,o.prepareReactionMenuSet)(t,a,{imageMenuSize:s.SIZE_96,imagePreviewSize:s.SIZE_32,imageStoryPanelSize:s.SIZE_128,imageStoryPreviewSize:s.SIZE_40}))}))},v=t=>{const e=l().get(t);if(e)return e;{const e=new Error(`Reaction set not found: ${t}`);(0,r.reactionLogError)({error:e})}},m=t=>{(0,c.isDebugEnabled)()&&console.log(t);const e=(0,o.parseReactionMenuConfig)(t);e?u().config=e:console.warn("Reactions: invalid menu config passed",t)},g=()=>{var t;return null===(t=u())||void 0===t?void 0:t.config}},740672:(t,e,n)=>{"use strict";n.d(e,{isValidEnvironment:()=>r,preloadImage:()=>s,usePrevious:()=>c,usePreviousRef:()=>l,isValidButtonTitleVariant:()=>d,isValidButtonStyleVariant:()=>v});var i=n(667294),o=n(1925),a=n(54789);const r=()=>{var t,e,n;return"function"==typeof(null===(t=window.cur)||void 0===t?void 0:t.viewAsBox)?(window.cur.viewAsBox(),!1):!(window.vk.widget&&!window.vk.id)||(null===(n=null===(e=window.Widgets)||void 0===e?void 0:e.oauth)||void 0===n||n.call(e),!1)},s=t=>new Promise(((e,n)=>{const i=new Image;i.src=t,i.onload=()=>e(),i.onerror=()=>n()})),c=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e.current},l=t=>{const e=(0,i.useRef)(t);return(0,i.useEffect)((()=>{e.current=t})),e},u=Object.values(a.ButtonStyleVariant),d=t=>o.ReactionMenuTitleVariants.includes(t),v=t=>u.includes(t)},665872:(t,e,n)=>{"use strict";n.d(e,{reactionsCountsUpdatePayload:()=>o,isReactionsFullUpdatePayload:()=>a,reactionsCountsOnlyUpdatePayload:()=>r});var i=n(571904);const o=(t,e)=>Object.assign(Object.assign({kind:i.PayloadKindFull},t),{reactionIdState:{reactionId:e.id}}),a=t=>t.kind===i.PayloadKindFull,r=t=>Object.assign({kind:i.PayloadKindCountsOnly},t)},571904:(t,e,n)=>{"use strict";n.d(e,{PayloadKindCountsOnly:()=>i,PayloadKindFull:()=>o});const i="counts_only",o="counts_with_current_reaction"},130273:(t,e,n)=>{"use strict";n.d(e,{postRenderReactionsInit:()=>L});var i=n(330752),o=n(659397),a=n(613327),r=n(873589),s=n(964141),c=n(465864),l=n(485207),u=n(301718),d=n(908706),v=n(672544),m=n(665872),g=n(267740),p=n(44610),_=n(928634),b=n(892239),w=n(404608),I=n(385667);const R=(t,e,n)=>{var i;void 0===n&&(n=null===(i=window.cur)||void 0===i?void 0:i.wallTpl);const o=null==n?void 0:n[t];if(o)return(0,s.stripPercentVars)((0,r.rs)(o,e));console.warn(`renderTemplate: missing template '${t}'`,n)},S=({isUserAction:t=!1},...e)=>{t?console.error(...e):(0,l.isDebugEnabled)()&&console.warn(...e)};const f=(t,e,{isActionStatusBarVisible:n,isReactionsPreviewVisible:i,positionTrackingEnd:a})=>{const s=((t,e)=>{var n,i;const o=(0,v.getLikeWrap)(t);if(!o)return;const a=(0,p.getPostElem)(e,o),s=null==a?void 0:a.querySelector('[data-section-ref="post-action-status-bar"]');if(s)return{actionStatusBar:s};const c=(0,_.isWkLayerWallPostOpen)()?null===(n=window.wkcur)||void 0===n?void 0:n.wallTpl:null===(i=window.cur)||void 0===i?void 0:i.wallTpl,l=(0,r.se)(R("post_action_status_bar",{class:"PostActionStatusBar--hidden"},c));return l?((0,r.domInsertBefore)(l,o),{actionStatusBar:l}):void 0})(t,e.postFullId);if(!s)return void S({},"Unable to init ActionStatusBar in post",e);const{actionStatusBar:c}=s;if(c.classList.toggle("PostActionStatusBar--hidden",!n),n&&!(0,v.getPreviewElem)(t)){const e=function(t,e,n={}){var i,a;const r=(0,_.isWkLayerWallPostOpen)()?null===(i=window.wkcur)||void 0===i?void 0:i.wallTpl:null===(a=window.cur)||void 0===a?void 0:a.wallTpl,s=(0,o.classNames)({"ReactionsPreview--empty":!t,"ReactionsPreview--isInActionStatusBar":!!n.isInActionStatusBar});return R("post_reactions_preview",{class:s,object_raw:e},r)}(i,t,{isInActionStatusBar:!0});c.prepend((0,r.se)(e))}if(a){const e=(0,v.getLikeBtnElem)(t);null==a||a(e)}},E=t=>{if(!(t=>void 0!==t.counts)(t))return void S(t,"Counts is invalid or missing");const e=(0,c.likePostObjectId)(t.postFullId),n=(0,p.getPostElem)(t.postFullId,(0,v.getLikeWrap)(e));n||S(t,"Missing post element for reactions preview update",{payload:t,likeWrap:(0,v.getLikeWrap)(e)});const i=(0,v.getLikeBtnElem)(e);if(!i)return void S(t,"Unable to find reactions button",{likeObjectId:e});const o=(0,u.reactionsElemPayload)(i),a=null==o?void 0:o.counts;y({elemPayload:o,likeBtnElem:i,likeObjectId:e,payload:t}),P({countsPrevious:a,likeBtnElem:i,likeObjectId:e,payload:t,postEl:n})},y=({elemPayload:t,likeBtnElem:e,likeObjectId:n,payload:o})=>{const{counts:a}=o;if(!!o.isQueueUpdate&&(t=>{const e=(0,i.getLastOwnReactionChangeTime)(t);if(!e)return!1;const n=e+1e4;return Date.now()<n})(e))(0,l.isDebugEnabled)()&&console.log("Ignoring reactions update from queue",o);else{if(t){const{counts:n,reactionSetId:r}=t,s=(0,I.getReactionSet)(r);if((0,m.isReactionsFullUpdatePayload)(o)){const t=o.reactionIdState.reactionId;s&&(0,i.updateReactionButtonForCurrentReaction)(e,t,s,o.isUserAction)}s&&((0,i.updateReactionButtonCounts)(e,s,o.isUserAction,a,n),(0,i.updateReactionButtonContainerForCounts)(e,a))}if((0,m.isReactionsFullUpdatePayload)(o)){const n=o.reactionIdState.reactionId;(0,i.setDataCurrentId)(e,n),o.isUserAction&&(null==t?void 0:t.objectRaw)&&(0,b.emitDataUpdate)(t.objectRaw,{currentReactionId:n})}(0,u.updateReactionsButtonForCounts)(n,{counts:a})}},P=({countsPrevious:t,likeBtnElem:e,likeObjectId:n,payload:i,postEl:o})=>{const{counts:r,previewVisibility:s=d.previewVisibilityUseCurrent}=i,c=((t,e)=>{if((0,d.isIntentPreviewInActionStatusBar)(t))return{previewVariant:w.PreviewVariantActionStatusBar};if((0,d.isIntentPreviewHidden)(t))return{previewVariant:w.PreviewVariantHidden};if((0,d.isIntentPreviewUseCurrent)(t)){const t=(0,u.getPreviewVariantForLikeBtn)(e);if(t)return{previewVariant:t}}})(s,e);if(!c)return;const{previewVariant:l}=c,v=(0,d.isVariantInActionStatusBar)(l),m=(0,u.shouldReactionsPreviewBeVisible)(r),g=(0,d.isVariantHidden)(l)||v&&!m;if(v){let t;i.isPrimaryLikeButtonClick&&!i.isFromWkLayer&&(t=(0,a.preservePositionBetween)(e).start());const r=m;null==o||o.classList.toggle("post--withActionStatusBar",r),f(n,i,{isActionStatusBarVisible:r,isReactionsPreviewVisible:m,positionTrackingEnd:t})}g||(0,u.updateReactionsPreview)(n,{counts:r,countsPrevious:t})},A=t=>{if(!l.ENABLED_IN_POST_REPLY)return!1;const{counts:e}=t;if(!e)return;const n=(0,c.likeReplyObjectId)(t.replyFullId);(0,u.updateReactionsPreview)(n,{counts:e,countsPrevious:void 0}),(0,u.updateReactionsButtonForCounts)(n,{counts:e})},L=()=>{let t=[(0,g.registerUniqueListener)("wall-post-action-status-bar",g.WallDataEvents.post_reactions_counts_update,E),(0,g.registerUniqueListener)("wall-reply-reactions-counts",g.WallDataEvents.reply_reactions_counts_update,A)];return{onDestroy:()=>{t.forEach((t=>{t()})),t=[]}}}},453580:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>a,registerUniqueListener:()=>c,registerNonGlobalNonUniqueListener:()=>l,emitEvent:()=>u});var i=n(480816),o=n(419223);const a={post_reactions_counts_update:"wall/post_reactions_counts_update",reply_reactions_counts_update:"wall/reply_reactions_counts_update",post_subscribe_update:"wall/post_subscribe_update"},r=(0,o.makeSharedState)("wall-data",(()=>({emitter:new i.default,keyedListeners:Object.create(null)})),{version:0}),s=(t,e,n)=>{var i,o;const a=r(),s=null===(o=null===(i=a.keyedListeners)||void 0===i?void 0:i[t])||void 0===o?void 0:o[e];return s&&a.emitter.removeListener(t,s),((t,e,n)=>{const i=r();return i.emitter.addListener(t,n),i.keyedListeners[t]=Object.assign(Object.assign({},i.keyedListeners[t]),{[e]:n}),()=>{var o,a;i.emitter.removeListener(t,n),(null===(o=i.keyedListeners[t])||void 0===o?void 0:o[e])===n&&(null===(a=i.keyedListeners[t])||void 0===a||delete a[e])}})(t,e,n)},c=(t,e,n)=>s(e,t,n),l=(t,e)=>((t,e)=>{const n=r();return n.emitter.addListener(t,e),()=>{n.emitter.removeListener(t,e)}})(t,e),u=(t,e)=>{r().emitter.emit(t,e)}},267740:(t,e,n)=>{"use strict";n.d(e,{WallDataEvents:()=>i.WallDataEvents,registerUniqueListener:()=>i.registerUniqueListener});var i=n(453580)},44610:(t,e,n)=>{"use strict";n.d(e,{getPostElem:()=>i,replyUserImageLinkClosest:()=>o,replyUserImageImg:()=>a});const i=(t,e)=>{var n,i;return null!==(i=null!==(n=(t=>{var e;if("string"==typeof t)return null!==(e=document.querySelector(`#post${t}`))&&void 0!==e?e:void 0})(t))&&void 0!==n?n:null==e?void 0:e.closest("._post, .wl_post"))&&void 0!==i?i:void 0},o=t=>{var e;return null!==(e=t.closest(".reply_image, ._reply_image"))&&void 0!==e?e:void 0},a=t=>{var e;return null!==(e=t.querySelector("img.reply_img"))&&void 0!==e?e:void 0}}}]);try{stManager.done("dist/90f8cf219bb6d5a2f2ecd964325e4940.7add6ab7eae5e9d79fee.js")}catch(t){}